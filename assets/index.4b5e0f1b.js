function iE(t,e){for(var i=0;i<e.length;i++){const s=e[i];if(typeof s!="string"&&!Array.isArray(s)){for(const a in s)if(a!=="default"&&!(a in t)){const h=Object.getOwnPropertyDescriptor(s,a);h&&Object.defineProperty(t,a,h.get?h:{enumerable:!0,get:()=>s[a]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const h of a)if(h.type==="childList")for(const p of h.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&s(p)}).observe(document,{childList:!0,subtree:!0});function i(a){const h={};return a.integrity&&(h.integrity=a.integrity),a.referrerpolicy&&(h.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?h.credentials="include":a.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(a){if(a.ep)return;a.ep=!0;const h=i(a);fetch(a.href,h)}})();function Km(t,e){const i=Object.create(null),s=t.split(",");for(let a=0;a<s.length;a++)i[s[a]]=!0;return e?a=>!!i[a.toLowerCase()]:a=>!!i[a]}const nE="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",rE=Km(nE);function cv(t){return!!t||t===""}function Jm(t){if(ri(t)){const e={};for(let i=0;i<t.length;i++){const s=t[i],a=Nn(s)?aE(s):Jm(s);if(a)for(const h in a)e[h]=a[h]}return e}else{if(Nn(t))return t;if(an(t))return t}}const sE=/;(?![^(]*\))/g,oE=/:(.+)/;function aE(t){const e={};return t.split(sE).forEach(i=>{if(i){const s=i.split(oE);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function Ul(t){let e="";if(Nn(t))e=t;else if(ri(t))for(let i=0;i<t.length;i++){const s=Ul(t[i]);s&&(e+=s+" ")}else if(an(t))for(const i in t)t[i]&&(e+=i+" ");return e.trim()}const Rn=t=>Nn(t)?t:t==null?"":ri(t)||an(t)&&(t.toString===fv||!hi(t.toString))?JSON.stringify(t,uv,2):String(t),uv=(t,e)=>e&&e.__v_isRef?uv(t,e.value):Ol(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((i,[s,a])=>(i[`${s} =>`]=a,i),{})}:hv(e)?{[`Set(${e.size})`]:[...e.values()]}:an(e)&&!ri(e)&&!pv(e)?String(e):e,Yi={},zl=[],ps=()=>{},lE=()=>!1,cE=/^on[^a-z]/,Zd=t=>cE.test(t),Qm=t=>t.startsWith("onUpdate:"),vr=Object.assign,eg=(t,e)=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)},uE=Object.prototype.hasOwnProperty,bi=(t,e)=>uE.call(t,e),ri=Array.isArray,Ol=t=>Xd(t)==="[object Map]",hv=t=>Xd(t)==="[object Set]",hi=t=>typeof t=="function",Nn=t=>typeof t=="string",tg=t=>typeof t=="symbol",an=t=>t!==null&&typeof t=="object",dv=t=>an(t)&&hi(t.then)&&hi(t.catch),fv=Object.prototype.toString,Xd=t=>fv.call(t),hE=t=>Xd(t).slice(8,-1),pv=t=>Xd(t)==="[object Object]",ig=t=>Nn(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,md=Km(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Yd=t=>{const e=Object.create(null);return i=>e[i]||(e[i]=t(i))},dE=/-(\w)/g,Vs=Yd(t=>t.replace(dE,(e,i)=>i?i.toUpperCase():"")),fE=/\B([A-Z])/g,ec=Yd(t=>t.replace(fE,"-$1").toLowerCase()),Kd=Yd(t=>t.charAt(0).toUpperCase()+t.slice(1)),_p=Yd(t=>t?`on${Kd(t)}`:""),wu=(t,e)=>!Object.is(t,e),yp=(t,e)=>{for(let i=0;i<t.length;i++)t[i](e)},Id=(t,e,i)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:i})},pE=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let by;const mE=()=>by||(by=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let zs;class mv{constructor(e=!1){this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=zs,!e&&zs&&(this.index=(zs.scopes||(zs.scopes=[])).push(this)-1)}run(e){if(this.active){const i=zs;try{return zs=this,e()}finally{zs=i}}}on(){zs=this}off(){zs=this.parent}stop(e){if(this.active){let i,s;for(i=0,s=this.effects.length;i<s;i++)this.effects[i].stop();for(i=0,s=this.cleanups.length;i<s;i++)this.cleanups[i]();if(this.scopes)for(i=0,s=this.scopes.length;i<s;i++)this.scopes[i].stop(!0);if(!this.detached&&this.parent&&!e){const a=this.parent.scopes.pop();a&&a!==this&&(this.parent.scopes[this.index]=a,a.index=this.index)}this.parent=void 0,this.active=!1}}}function gv(t){return new mv(t)}function gE(t,e=zs){e&&e.active&&e.effects.push(t)}const ng=t=>{const e=new Set(t);return e.w=0,e.n=0,e},_v=t=>(t.w&ea)>0,yv=t=>(t.n&ea)>0,_E=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=ea},yE=t=>{const{deps:e}=t;if(e.length){let i=0;for(let s=0;s<e.length;s++){const a=e[s];_v(a)&&!yv(a)?a.delete(t):e[i++]=a,a.w&=~ea,a.n&=~ea}e.length=i}},rm=new WeakMap;let uu=0,ea=1;const sm=30;let us;const Na=Symbol(""),om=Symbol("");class rg{constructor(e,i=null,s){this.fn=e,this.scheduler=i,this.active=!0,this.deps=[],this.parent=void 0,gE(this,s)}run(){if(!this.active)return this.fn();let e=us,i=Ko;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=us,us=this,Ko=!0,ea=1<<++uu,uu<=sm?_E(this):wy(this),this.fn()}finally{uu<=sm&&yE(this),ea=1<<--uu,us=this.parent,Ko=i,this.parent=void 0,this.deferStop&&this.stop()}}stop(){us===this?this.deferStop=!0:this.active&&(wy(this),this.onStop&&this.onStop(),this.active=!1)}}function wy(t){const{deps:e}=t;if(e.length){for(let i=0;i<e.length;i++)e[i].delete(t);e.length=0}}let Ko=!0;const vv=[];function tc(){vv.push(Ko),Ko=!1}function ic(){const t=vv.pop();Ko=t===void 0?!0:t}function Gr(t,e,i){if(Ko&&us){let s=rm.get(t);s||rm.set(t,s=new Map);let a=s.get(i);a||s.set(i,a=ng()),xv(a)}}function xv(t,e){let i=!1;uu<=sm?yv(t)||(t.n|=ea,i=!_v(t)):i=!t.has(us),i&&(t.add(us),us.deps.push(t))}function ho(t,e,i,s,a,h){const p=rm.get(t);if(!p)return;let c=[];if(e==="clear")c=[...p.values()];else if(i==="length"&&ri(t))p.forEach((b,T)=>{(T==="length"||T>=s)&&c.push(b)});else switch(i!==void 0&&c.push(p.get(i)),e){case"add":ri(t)?ig(i)&&c.push(p.get("length")):(c.push(p.get(Na)),Ol(t)&&c.push(p.get(om)));break;case"delete":ri(t)||(c.push(p.get(Na)),Ol(t)&&c.push(p.get(om)));break;case"set":Ol(t)&&c.push(p.get(Na));break}if(c.length===1)c[0]&&am(c[0]);else{const b=[];for(const T of c)T&&b.push(...T);am(ng(b))}}function am(t,e){const i=ri(t)?t:[...t];for(const s of i)s.computed&&Ey(s);for(const s of i)s.computed||Ey(s)}function Ey(t,e){(t!==us||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const vE=Km("__proto__,__v_isRef,__isVue"),bv=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(tg)),xE=sg(),bE=sg(!1,!0),wE=sg(!0),Ty=EE();function EE(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...i){const s=Ii(this);for(let h=0,p=this.length;h<p;h++)Gr(s,"get",h+"");const a=s[e](...i);return a===-1||a===!1?s[e](...i.map(Ii)):a}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...i){tc();const s=Ii(this)[e].apply(this,i);return ic(),s}}),t}function sg(t=!1,e=!1){return function(s,a,h){if(a==="__v_isReactive")return!t;if(a==="__v_isReadonly")return t;if(a==="__v_isShallow")return e;if(a==="__v_raw"&&h===(t?e?NE:Sv:e?Av:Tv).get(s))return s;const p=ri(s);if(!t&&p&&bi(Ty,a))return Reflect.get(Ty,a,h);const c=Reflect.get(s,a,h);return(tg(a)?bv.has(a):vE(a))||(t||Gr(s,"get",a),e)?c:vn(c)?p&&ig(a)?c:c.value:an(c)?t?Iv(c):nc(c):c}}const TE=wv(),AE=wv(!0);function wv(t=!1){return function(i,s,a,h){let p=i[s];if(Vl(p)&&vn(p)&&!vn(a))return!1;if(!t&&(!Pd(a)&&!Vl(a)&&(p=Ii(p),a=Ii(a)),!ri(i)&&vn(p)&&!vn(a)))return p.value=a,!0;const c=ri(i)&&ig(s)?Number(s)<i.length:bi(i,s),b=Reflect.set(i,s,a,h);return i===Ii(h)&&(c?wu(a,p)&&ho(i,"set",s,a):ho(i,"add",s,a)),b}}function SE(t,e){const i=bi(t,e);t[e];const s=Reflect.deleteProperty(t,e);return s&&i&&ho(t,"delete",e,void 0),s}function IE(t,e){const i=Reflect.has(t,e);return(!tg(e)||!bv.has(e))&&Gr(t,"has",e),i}function PE(t){return Gr(t,"iterate",ri(t)?"length":Na),Reflect.ownKeys(t)}const Ev={get:xE,set:TE,deleteProperty:SE,has:IE,ownKeys:PE},ME={get:wE,set(t,e){return!0},deleteProperty(t,e){return!0}},CE=vr({},Ev,{get:bE,set:AE}),og=t=>t,Jd=t=>Reflect.getPrototypeOf(t);function Jh(t,e,i=!1,s=!1){t=t.__v_raw;const a=Ii(t),h=Ii(e);i||(e!==h&&Gr(a,"get",e),Gr(a,"get",h));const{has:p}=Jd(a),c=s?og:i?cg:Eu;if(p.call(a,e))return c(t.get(e));if(p.call(a,h))return c(t.get(h));t!==a&&t.get(e)}function Qh(t,e=!1){const i=this.__v_raw,s=Ii(i),a=Ii(t);return e||(t!==a&&Gr(s,"has",t),Gr(s,"has",a)),t===a?i.has(t):i.has(t)||i.has(a)}function ed(t,e=!1){return t=t.__v_raw,!e&&Gr(Ii(t),"iterate",Na),Reflect.get(t,"size",t)}function Ay(t){t=Ii(t);const e=Ii(this);return Jd(e).has.call(e,t)||(e.add(t),ho(e,"add",t,t)),this}function Sy(t,e){e=Ii(e);const i=Ii(this),{has:s,get:a}=Jd(i);let h=s.call(i,t);h||(t=Ii(t),h=s.call(i,t));const p=a.call(i,t);return i.set(t,e),h?wu(e,p)&&ho(i,"set",t,e):ho(i,"add",t,e),this}function Iy(t){const e=Ii(this),{has:i,get:s}=Jd(e);let a=i.call(e,t);a||(t=Ii(t),a=i.call(e,t)),s&&s.call(e,t);const h=e.delete(t);return a&&ho(e,"delete",t,void 0),h}function Py(){const t=Ii(this),e=t.size!==0,i=t.clear();return e&&ho(t,"clear",void 0,void 0),i}function td(t,e){return function(s,a){const h=this,p=h.__v_raw,c=Ii(p),b=e?og:t?cg:Eu;return!t&&Gr(c,"iterate",Na),p.forEach((T,P)=>s.call(a,b(T),b(P),h))}}function id(t,e,i){return function(...s){const a=this.__v_raw,h=Ii(a),p=Ol(h),c=t==="entries"||t===Symbol.iterator&&p,b=t==="keys"&&p,T=a[t](...s),P=i?og:e?cg:Eu;return!e&&Gr(h,"iterate",b?om:Na),{next(){const{value:k,done:C}=T.next();return C?{value:k,done:C}:{value:c?[P(k[0]),P(k[1])]:P(k),done:C}},[Symbol.iterator](){return this}}}}function No(t){return function(...e){return t==="delete"?!1:this}}function LE(){const t={get(h){return Jh(this,h)},get size(){return ed(this)},has:Qh,add:Ay,set:Sy,delete:Iy,clear:Py,forEach:td(!1,!1)},e={get(h){return Jh(this,h,!1,!0)},get size(){return ed(this)},has:Qh,add:Ay,set:Sy,delete:Iy,clear:Py,forEach:td(!1,!0)},i={get(h){return Jh(this,h,!0)},get size(){return ed(this,!0)},has(h){return Qh.call(this,h,!0)},add:No("add"),set:No("set"),delete:No("delete"),clear:No("clear"),forEach:td(!0,!1)},s={get(h){return Jh(this,h,!0,!0)},get size(){return ed(this,!0)},has(h){return Qh.call(this,h,!0)},add:No("add"),set:No("set"),delete:No("delete"),clear:No("clear"),forEach:td(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(h=>{t[h]=id(h,!1,!1),i[h]=id(h,!0,!1),e[h]=id(h,!1,!0),s[h]=id(h,!0,!0)}),[t,i,e,s]}const[kE,RE,DE,zE]=LE();function ag(t,e){const i=e?t?zE:DE:t?RE:kE;return(s,a,h)=>a==="__v_isReactive"?!t:a==="__v_isReadonly"?t:a==="__v_raw"?s:Reflect.get(bi(i,a)&&a in s?i:s,a,h)}const OE={get:ag(!1,!1)},FE={get:ag(!1,!0)},BE={get:ag(!0,!1)},Tv=new WeakMap,Av=new WeakMap,Sv=new WeakMap,NE=new WeakMap;function UE(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function VE(t){return t.__v_skip||!Object.isExtensible(t)?0:UE(hE(t))}function nc(t){return Vl(t)?t:lg(t,!1,Ev,OE,Tv)}function jE(t){return lg(t,!1,CE,FE,Av)}function Iv(t){return lg(t,!0,ME,BE,Sv)}function lg(t,e,i,s,a){if(!an(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const h=a.get(t);if(h)return h;const p=VE(t);if(p===0)return t;const c=new Proxy(t,p===2?s:i);return a.set(t,c),c}function co(t){return Vl(t)?co(t.__v_raw):!!(t&&t.__v_isReactive)}function Vl(t){return!!(t&&t.__v_isReadonly)}function Pd(t){return!!(t&&t.__v_isShallow)}function Pv(t){return co(t)||Vl(t)}function Ii(t){const e=t&&t.__v_raw;return e?Ii(e):t}function jl(t){return Id(t,"__v_skip",!0),t}const Eu=t=>an(t)?nc(t):t,cg=t=>an(t)?Iv(t):t;function Mv(t){Ko&&us&&(t=Ii(t),xv(t.dep||(t.dep=ng())))}function Cv(t,e){t=Ii(t),t.dep&&am(t.dep)}function vn(t){return!!(t&&t.__v_isRef===!0)}function Uu(t){return Lv(t,!1)}function GE(t){return Lv(t,!0)}function Lv(t,e){return vn(t)?t:new $E(t,e)}class $E{constructor(e,i){this.__v_isShallow=i,this.dep=void 0,this.__v_isRef=!0,this._rawValue=i?e:Ii(e),this._value=i?e:Eu(e)}get value(){return Mv(this),this._value}set value(e){const i=this.__v_isShallow||Pd(e)||Vl(e);e=i?e:Ii(e),wu(e,this._rawValue)&&(this._rawValue=e,this._value=i?e:Eu(e),Cv(this))}}function zt(t){return vn(t)?t.value:t}const HE={get:(t,e,i)=>zt(Reflect.get(t,e,i)),set:(t,e,i,s)=>{const a=t[e];return vn(a)&&!vn(i)?(a.value=i,!0):Reflect.set(t,e,i,s)}};function kv(t){return co(t)?t:new Proxy(t,HE)}function qE(t){const e=ri(t)?new Array(t.length):{};for(const i in t)e[i]=Rv(t,i);return e}class WE{constructor(e,i,s){this._object=e,this._key=i,this._defaultValue=s,this.__v_isRef=!0}get value(){const e=this._object[this._key];return e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}}function Rv(t,e,i){const s=t[e];return vn(s)?s:new WE(t,e,i)}var Dv;class ZE{constructor(e,i,s,a){this._setter=i,this.dep=void 0,this.__v_isRef=!0,this[Dv]=!1,this._dirty=!0,this.effect=new rg(e,()=>{this._dirty||(this._dirty=!0,Cv(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!a,this.__v_isReadonly=s}get value(){const e=Ii(this);return Mv(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}Dv="__v_isReadonly";function XE(t,e,i=!1){let s,a;const h=hi(t);return h?(s=t,a=ps):(s=t.get,a=t.set),new ZE(s,a,h||!a,i)}function Jo(t,e,i,s){let a;try{a=s?t(...s):t()}catch(h){Qd(h,e,i)}return a}function ms(t,e,i,s){if(hi(t)){const h=Jo(t,e,i,s);return h&&dv(h)&&h.catch(p=>{Qd(p,e,i)}),h}const a=[];for(let h=0;h<t.length;h++)a.push(ms(t[h],e,i,s));return a}function Qd(t,e,i,s=!0){const a=e?e.vnode:null;if(e){let h=e.parent;const p=e.proxy,c=i;for(;h;){const T=h.ec;if(T){for(let P=0;P<T.length;P++)if(T[P](t,p,c)===!1)return}h=h.parent}const b=e.appContext.config.errorHandler;if(b){Jo(b,null,10,[t,p,c]);return}}YE(t,i,a,s)}function YE(t,e,i,s=!0){console.error(t)}let Tu=!1,lm=!1;const nr=[];let Fs=0;const Fl=[];let ao=null,Oa=0;const zv=Promise.resolve();let ug=null;function hg(t){const e=ug||zv;return t?e.then(this?t.bind(this):t):e}function KE(t){let e=Fs+1,i=nr.length;for(;e<i;){const s=e+i>>>1;Au(nr[s])<t?e=s+1:i=s}return e}function dg(t){(!nr.length||!nr.includes(t,Tu&&t.allowRecurse?Fs+1:Fs))&&(t.id==null?nr.push(t):nr.splice(KE(t.id),0,t),Ov())}function Ov(){!Tu&&!lm&&(lm=!0,ug=zv.then(Bv))}function JE(t){const e=nr.indexOf(t);e>Fs&&nr.splice(e,1)}function QE(t){ri(t)?Fl.push(...t):(!ao||!ao.includes(t,t.allowRecurse?Oa+1:Oa))&&Fl.push(t),Ov()}function My(t,e=Tu?Fs+1:0){for(;e<nr.length;e++){const i=nr[e];i&&i.pre&&(nr.splice(e,1),e--,i())}}function Fv(t){if(Fl.length){const e=[...new Set(Fl)];if(Fl.length=0,ao){ao.push(...e);return}for(ao=e,ao.sort((i,s)=>Au(i)-Au(s)),Oa=0;Oa<ao.length;Oa++)ao[Oa]();ao=null,Oa=0}}const Au=t=>t.id==null?1/0:t.id,eT=(t,e)=>{const i=Au(t)-Au(e);if(i===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return i};function Bv(t){lm=!1,Tu=!0,nr.sort(eT);const e=ps;try{for(Fs=0;Fs<nr.length;Fs++){const i=nr[Fs];i&&i.active!==!1&&Jo(i,null,14)}}finally{Fs=0,nr.length=0,Fv(),Tu=!1,ug=null,(nr.length||Fl.length)&&Bv()}}function tT(t,e,...i){if(t.isUnmounted)return;const s=t.vnode.props||Yi;let a=i;const h=e.startsWith("update:"),p=h&&e.slice(7);if(p&&p in s){const P=`${p==="modelValue"?"model":p}Modifiers`,{number:k,trim:C}=s[P]||Yi;C&&(a=i.map(H=>H.trim())),k&&(a=i.map(pE))}let c,b=s[c=_p(e)]||s[c=_p(Vs(e))];!b&&h&&(b=s[c=_p(ec(e))]),b&&ms(b,t,6,a);const T=s[c+"Once"];if(T){if(!t.emitted)t.emitted={};else if(t.emitted[c])return;t.emitted[c]=!0,ms(T,t,6,a)}}function Nv(t,e,i=!1){const s=e.emitsCache,a=s.get(t);if(a!==void 0)return a;const h=t.emits;let p={},c=!1;if(!hi(t)){const b=T=>{const P=Nv(T,e,!0);P&&(c=!0,vr(p,P))};!i&&e.mixins.length&&e.mixins.forEach(b),t.extends&&b(t.extends),t.mixins&&t.mixins.forEach(b)}return!h&&!c?(an(t)&&s.set(t,null),null):(ri(h)?h.forEach(b=>p[b]=null):vr(p,h),an(t)&&s.set(t,p),p)}function ef(t,e){return!t||!Zd(e)?!1:(e=e.slice(2).replace(/Once$/,""),bi(t,e[0].toLowerCase()+e.slice(1))||bi(t,ec(e))||bi(t,e))}let hs=null,tf=null;function Md(t){const e=hs;return hs=t,tf=t&&t.type.__scopeId||null,e}function Uv(t){tf=t}function Vv(){tf=null}function iT(t,e=hs,i){if(!e||t._n)return t;const s=(...a)=>{s._d&&Ny(-1);const h=Md(e);let p;try{p=t(...a)}finally{Md(h),s._d&&Ny(1)}return p};return s._n=!0,s._c=!0,s._d=!0,s}function vp(t){const{type:e,vnode:i,proxy:s,withProxy:a,props:h,propsOptions:[p],slots:c,attrs:b,emit:T,render:P,renderCache:k,data:C,setupState:H,ctx:ee,inheritAttrs:se}=t;let pe,fe;const ye=Md(t);try{if(i.shapeFlag&4){const Ue=a||s;pe=Os(P.call(Ue,Ue,k,h,H,C,ee)),fe=b}else{const Ue=e;pe=Os(Ue.length>1?Ue(h,{attrs:b,slots:c,emit:T}):Ue(h,null)),fe=e.props?b:nT(b)}}catch(Ue){mu.length=0,Qd(Ue,t,1),pe=Fi($a)}let Se=pe;if(fe&&se!==!1){const Ue=Object.keys(fe),{shapeFlag:$e}=Se;Ue.length&&$e&7&&(p&&Ue.some(Qm)&&(fe=rT(fe,p)),Se=Gl(Se,fe))}return i.dirs&&(Se=Gl(Se),Se.dirs=Se.dirs?Se.dirs.concat(i.dirs):i.dirs),i.transition&&(Se.transition=i.transition),pe=Se,Md(ye),pe}const nT=t=>{let e;for(const i in t)(i==="class"||i==="style"||Zd(i))&&((e||(e={}))[i]=t[i]);return e},rT=(t,e)=>{const i={};for(const s in t)(!Qm(s)||!(s.slice(9)in e))&&(i[s]=t[s]);return i};function sT(t,e,i){const{props:s,children:a,component:h}=t,{props:p,children:c,patchFlag:b}=e,T=h.emitsOptions;if(e.dirs||e.transition)return!0;if(i&&b>=0){if(b&1024)return!0;if(b&16)return s?Cy(s,p,T):!!p;if(b&8){const P=e.dynamicProps;for(let k=0;k<P.length;k++){const C=P[k];if(p[C]!==s[C]&&!ef(T,C))return!0}}}else return(a||c)&&(!c||!c.$stable)?!0:s===p?!1:s?p?Cy(s,p,T):!0:!!p;return!1}function Cy(t,e,i){const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!0;for(let a=0;a<s.length;a++){const h=s[a];if(e[h]!==t[h]&&!ef(i,h))return!0}return!1}function oT({vnode:t,parent:e},i){for(;e&&e.subTree===t;)(t=e.vnode).el=i,e=e.parent}const aT=t=>t.__isSuspense;function lT(t,e){e&&e.pendingBranch?ri(t)?e.effects.push(...t):e.effects.push(t):QE(t)}function gd(t,e){if($n){let i=$n.provides;const s=$n.parent&&$n.parent.provides;s===i&&(i=$n.provides=Object.create(s)),i[t]=e}}function uo(t,e,i=!1){const s=$n||hs;if(s){const a=s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides;if(a&&t in a)return a[t];if(arguments.length>1)return i&&hi(e)?e.call(s.proxy):e}}function cT(t,e){return fg(t,null,{flush:"post"})}const Ly={};function fu(t,e,i){return fg(t,e,i)}function fg(t,e,{immediate:i,deep:s,flush:a,onTrack:h,onTrigger:p}=Yi){const c=$n;let b,T=!1,P=!1;if(vn(t)?(b=()=>t.value,T=Pd(t)):co(t)?(b=()=>t,s=!0):ri(t)?(P=!0,T=t.some(fe=>co(fe)||Pd(fe)),b=()=>t.map(fe=>{if(vn(fe))return fe.value;if(co(fe))return kl(fe);if(hi(fe))return Jo(fe,c,2)})):hi(t)?e?b=()=>Jo(t,c,2):b=()=>{if(!(c&&c.isUnmounted))return k&&k(),ms(t,c,3,[C])}:b=ps,e&&s){const fe=b;b=()=>kl(fe())}let k,C=fe=>{k=pe.onStop=()=>{Jo(fe,c,4)}};if(Iu)return C=ps,e?i&&ms(e,c,3,[b(),P?[]:void 0,C]):b(),ps;let H=P?[]:Ly;const ee=()=>{if(!!pe.active)if(e){const fe=pe.run();(s||T||(P?fe.some((ye,Se)=>wu(ye,H[Se])):wu(fe,H)))&&(k&&k(),ms(e,c,3,[fe,H===Ly?void 0:H,C]),H=fe)}else pe.run()};ee.allowRecurse=!!e;let se;a==="sync"?se=ee:a==="post"?se=()=>Sr(ee,c&&c.suspense):(ee.pre=!0,c&&(ee.id=c.uid),se=()=>dg(ee));const pe=new rg(b,se);return e?i?ee():H=pe.run():a==="post"?Sr(pe.run.bind(pe),c&&c.suspense):pe.run(),()=>{pe.stop(),c&&c.scope&&eg(c.scope.effects,pe)}}function uT(t,e,i){const s=this.proxy,a=Nn(t)?t.includes(".")?jv(s,t):()=>s[t]:t.bind(s,s);let h;hi(e)?h=e:(h=e.handler,i=e);const p=$n;$l(this);const c=fg(a,h.bind(s),i);return p?$l(p):Ua(),c}function jv(t,e){const i=e.split(".");return()=>{let s=t;for(let a=0;a<i.length&&s;a++)s=s[i[a]];return s}}function kl(t,e){if(!an(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),vn(t))kl(t.value,e);else if(ri(t))for(let i=0;i<t.length;i++)kl(t[i],e);else if(hv(t)||Ol(t))t.forEach(i=>{kl(i,e)});else if(pv(t))for(const i in t)kl(t[i],e);return t}function sr(t){return hi(t)?{setup:t,name:t.name}:t}const _d=t=>!!t.type.__asyncLoader,Gv=t=>t.type.__isKeepAlive;function hT(t,e){$v(t,"a",e)}function dT(t,e){$v(t,"da",e)}function $v(t,e,i=$n){const s=t.__wdc||(t.__wdc=()=>{let a=i;for(;a;){if(a.isDeactivated)return;a=a.parent}return t()});if(nf(e,s,i),i){let a=i.parent;for(;a&&a.parent;)Gv(a.parent.vnode)&&fT(s,e,i,a),a=a.parent}}function fT(t,e,i,s){const a=nf(e,t,s,!0);sf(()=>{eg(s[e],a)},i)}function nf(t,e,i=$n,s=!1){if(i){const a=i[t]||(i[t]=[]),h=e.__weh||(e.__weh=(...p)=>{if(i.isUnmounted)return;tc(),$l(i);const c=ms(e,i,t,p);return Ua(),ic(),c});return s?a.unshift(h):a.push(h),h}}const go=t=>(e,i=$n)=>(!Iu||t==="sp")&&nf(t,(...s)=>e(...s),i),pT=go("bm"),rf=go("m"),mT=go("bu"),gT=go("u"),_T=go("bum"),sf=go("um"),yT=go("sp"),vT=go("rtg"),xT=go("rtc");function bT(t,e=$n){nf("ec",t,e)}function Ma(t,e,i,s){const a=t.dirs,h=e&&e.dirs;for(let p=0;p<a.length;p++){const c=a[p];h&&(c.oldValue=h[p].value);let b=c.dir[s];b&&(tc(),ms(b,i,8,[t.el,c,t,e]),ic())}}const Hv="components",qv=Symbol();function Cd(t){return Nn(t)?wT(Hv,t,!1)||t:t||qv}function wT(t,e,i=!0,s=!1){const a=hs||$n;if(a){const h=a.type;if(t===Hv){const c=JT(h,!1);if(c&&(c===e||c===Vs(e)||c===Kd(Vs(e))))return h}const p=ky(a[t]||h[t],e)||ky(a.appContext[t],e);return!p&&s?h:p}}function ky(t,e){return t&&(t[e]||t[Vs(e)]||t[Kd(Vs(e))])}function Ga(t,e,i,s){let a;const h=i&&i[s];if(ri(t)||Nn(t)){a=new Array(t.length);for(let p=0,c=t.length;p<c;p++)a[p]=e(t[p],p,void 0,h&&h[p])}else if(typeof t=="number"){a=new Array(t);for(let p=0;p<t;p++)a[p]=e(p+1,p,void 0,h&&h[p])}else if(an(t))if(t[Symbol.iterator])a=Array.from(t,(p,c)=>e(p,c,void 0,h&&h[c]));else{const p=Object.keys(t);a=new Array(p.length);for(let c=0,b=p.length;c<b;c++){const T=p[c];a[c]=e(t[T],T,c,h&&h[c])}}else a=[];return i&&(i[s]=a),a}const cm=t=>t?rx(t)?vg(t)||t.proxy:cm(t.parent):null,Ld=vr(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>cm(t.parent),$root:t=>cm(t.root),$emit:t=>t.emit,$options:t=>pg(t),$forceUpdate:t=>t.f||(t.f=()=>dg(t.update)),$nextTick:t=>t.n||(t.n=hg.bind(t.proxy)),$watch:t=>uT.bind(t)}),ET={get({_:t},e){const{ctx:i,setupState:s,data:a,props:h,accessCache:p,type:c,appContext:b}=t;let T;if(e[0]!=="$"){const H=p[e];if(H!==void 0)switch(H){case 1:return s[e];case 2:return a[e];case 4:return i[e];case 3:return h[e]}else{if(s!==Yi&&bi(s,e))return p[e]=1,s[e];if(a!==Yi&&bi(a,e))return p[e]=2,a[e];if((T=t.propsOptions[0])&&bi(T,e))return p[e]=3,h[e];if(i!==Yi&&bi(i,e))return p[e]=4,i[e];um&&(p[e]=0)}}const P=Ld[e];let k,C;if(P)return e==="$attrs"&&Gr(t,"get",e),P(t);if((k=c.__cssModules)&&(k=k[e]))return k;if(i!==Yi&&bi(i,e))return p[e]=4,i[e];if(C=b.config.globalProperties,bi(C,e))return C[e]},set({_:t},e,i){const{data:s,setupState:a,ctx:h}=t;return a!==Yi&&bi(a,e)?(a[e]=i,!0):s!==Yi&&bi(s,e)?(s[e]=i,!0):bi(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(h[e]=i,!0)},has({_:{data:t,setupState:e,accessCache:i,ctx:s,appContext:a,propsOptions:h}},p){let c;return!!i[p]||t!==Yi&&bi(t,p)||e!==Yi&&bi(e,p)||(c=h[0])&&bi(c,p)||bi(s,p)||bi(Ld,p)||bi(a.config.globalProperties,p)},defineProperty(t,e,i){return i.get!=null?t._.accessCache[e]=0:bi(i,"value")&&this.set(t,e,i.value,null),Reflect.defineProperty(t,e,i)}};let um=!0;function TT(t){const e=pg(t),i=t.proxy,s=t.ctx;um=!1,e.beforeCreate&&Ry(e.beforeCreate,t,"bc");const{data:a,computed:h,methods:p,watch:c,provide:b,inject:T,created:P,beforeMount:k,mounted:C,beforeUpdate:H,updated:ee,activated:se,deactivated:pe,beforeDestroy:fe,beforeUnmount:ye,destroyed:Se,unmounted:Ue,render:$e,renderTracked:Ye,renderTriggered:Qe,errorCaptured:at,serverPrefetch:wt,expose:Mt,inheritAttrs:Lt,components:ei,directives:gi,filters:Ut}=e;if(T&&AT(T,s,null,t.appContext.config.unwrapInjectedRef),p)for(const li in p){const si=p[li];hi(si)&&(s[li]=si.bind(i))}if(a){const li=a.call(i,i);an(li)&&(t.data=nc(li))}if(um=!0,h)for(const li in h){const si=h[li],Bi=hi(si)?si.bind(i,i):hi(si.get)?si.get.bind(i,i):ps,ln=!hi(si)&&hi(si.set)?si.set.bind(i):ps,cn=Qi({get:Bi,set:ln});Object.defineProperty(s,li,{enumerable:!0,configurable:!0,get:()=>cn.value,set:Ri=>cn.value=Ri})}if(c)for(const li in c)Wv(c[li],s,i,li);if(b){const li=hi(b)?b.call(i):b;Reflect.ownKeys(li).forEach(si=>{gd(si,li[si])})}P&&Ry(P,t,"c");function pt(li,si){ri(si)?si.forEach(Bi=>li(Bi.bind(i))):si&&li(si.bind(i))}if(pt(pT,k),pt(rf,C),pt(mT,H),pt(gT,ee),pt(hT,se),pt(dT,pe),pt(bT,at),pt(xT,Ye),pt(vT,Qe),pt(_T,ye),pt(sf,Ue),pt(yT,wt),ri(Mt))if(Mt.length){const li=t.exposed||(t.exposed={});Mt.forEach(si=>{Object.defineProperty(li,si,{get:()=>i[si],set:Bi=>i[si]=Bi})})}else t.exposed||(t.exposed={});$e&&t.render===ps&&(t.render=$e),Lt!=null&&(t.inheritAttrs=Lt),ei&&(t.components=ei),gi&&(t.directives=gi)}function AT(t,e,i=ps,s=!1){ri(t)&&(t=hm(t));for(const a in t){const h=t[a];let p;an(h)?"default"in h?p=uo(h.from||a,h.default,!0):p=uo(h.from||a):p=uo(h),vn(p)&&s?Object.defineProperty(e,a,{enumerable:!0,configurable:!0,get:()=>p.value,set:c=>p.value=c}):e[a]=p}}function Ry(t,e,i){ms(ri(t)?t.map(s=>s.bind(e.proxy)):t.bind(e.proxy),e,i)}function Wv(t,e,i,s){const a=s.includes(".")?jv(i,s):()=>i[s];if(Nn(t)){const h=e[t];hi(h)&&fu(a,h)}else if(hi(t))fu(a,t.bind(i));else if(an(t))if(ri(t))t.forEach(h=>Wv(h,e,i,s));else{const h=hi(t.handler)?t.handler.bind(i):e[t.handler];hi(h)&&fu(a,h,t)}}function pg(t){const e=t.type,{mixins:i,extends:s}=e,{mixins:a,optionsCache:h,config:{optionMergeStrategies:p}}=t.appContext,c=h.get(e);let b;return c?b=c:!a.length&&!i&&!s?b=e:(b={},a.length&&a.forEach(T=>kd(b,T,p,!0)),kd(b,e,p)),an(e)&&h.set(e,b),b}function kd(t,e,i,s=!1){const{mixins:a,extends:h}=e;h&&kd(t,h,i,!0),a&&a.forEach(p=>kd(t,p,i,!0));for(const p in e)if(!(s&&p==="expose")){const c=ST[p]||i&&i[p];t[p]=c?c(t[p],e[p]):e[p]}return t}const ST={data:Dy,props:Da,emits:Da,methods:Da,computed:Da,beforeCreate:gr,created:gr,beforeMount:gr,mounted:gr,beforeUpdate:gr,updated:gr,beforeDestroy:gr,beforeUnmount:gr,destroyed:gr,unmounted:gr,activated:gr,deactivated:gr,errorCaptured:gr,serverPrefetch:gr,components:Da,directives:Da,watch:PT,provide:Dy,inject:IT};function Dy(t,e){return e?t?function(){return vr(hi(t)?t.call(this,this):t,hi(e)?e.call(this,this):e)}:e:t}function IT(t,e){return Da(hm(t),hm(e))}function hm(t){if(ri(t)){const e={};for(let i=0;i<t.length;i++)e[t[i]]=t[i];return e}return t}function gr(t,e){return t?[...new Set([].concat(t,e))]:e}function Da(t,e){return t?vr(vr(Object.create(null),t),e):e}function PT(t,e){if(!t)return e;if(!e)return t;const i=vr(Object.create(null),t);for(const s in e)i[s]=gr(t[s],e[s]);return i}function MT(t,e,i,s=!1){const a={},h={};Id(h,of,1),t.propsDefaults=Object.create(null),Zv(t,e,a,h);for(const p in t.propsOptions[0])p in a||(a[p]=void 0);i?t.props=s?a:jE(a):t.type.props?t.props=a:t.props=h,t.attrs=h}function CT(t,e,i,s){const{props:a,attrs:h,vnode:{patchFlag:p}}=t,c=Ii(a),[b]=t.propsOptions;let T=!1;if((s||p>0)&&!(p&16)){if(p&8){const P=t.vnode.dynamicProps;for(let k=0;k<P.length;k++){let C=P[k];if(ef(t.emitsOptions,C))continue;const H=e[C];if(b)if(bi(h,C))H!==h[C]&&(h[C]=H,T=!0);else{const ee=Vs(C);a[ee]=dm(b,c,ee,H,t,!1)}else H!==h[C]&&(h[C]=H,T=!0)}}}else{Zv(t,e,a,h)&&(T=!0);let P;for(const k in c)(!e||!bi(e,k)&&((P=ec(k))===k||!bi(e,P)))&&(b?i&&(i[k]!==void 0||i[P]!==void 0)&&(a[k]=dm(b,c,k,void 0,t,!0)):delete a[k]);if(h!==c)for(const k in h)(!e||!bi(e,k)&&!0)&&(delete h[k],T=!0)}T&&ho(t,"set","$attrs")}function Zv(t,e,i,s){const[a,h]=t.propsOptions;let p=!1,c;if(e)for(let b in e){if(md(b))continue;const T=e[b];let P;a&&bi(a,P=Vs(b))?!h||!h.includes(P)?i[P]=T:(c||(c={}))[P]=T:ef(t.emitsOptions,b)||(!(b in s)||T!==s[b])&&(s[b]=T,p=!0)}if(h){const b=Ii(i),T=c||Yi;for(let P=0;P<h.length;P++){const k=h[P];i[k]=dm(a,b,k,T[k],t,!bi(T,k))}}return p}function dm(t,e,i,s,a,h){const p=t[i];if(p!=null){const c=bi(p,"default");if(c&&s===void 0){const b=p.default;if(p.type!==Function&&hi(b)){const{propsDefaults:T}=a;i in T?s=T[i]:($l(a),s=T[i]=b.call(null,e),Ua())}else s=b}p[0]&&(h&&!c?s=!1:p[1]&&(s===""||s===ec(i))&&(s=!0))}return s}function Xv(t,e,i=!1){const s=e.propsCache,a=s.get(t);if(a)return a;const h=t.props,p={},c=[];let b=!1;if(!hi(t)){const P=k=>{b=!0;const[C,H]=Xv(k,e,!0);vr(p,C),H&&c.push(...H)};!i&&e.mixins.length&&e.mixins.forEach(P),t.extends&&P(t.extends),t.mixins&&t.mixins.forEach(P)}if(!h&&!b)return an(t)&&s.set(t,zl),zl;if(ri(h))for(let P=0;P<h.length;P++){const k=Vs(h[P]);zy(k)&&(p[k]=Yi)}else if(h)for(const P in h){const k=Vs(P);if(zy(k)){const C=h[P],H=p[k]=ri(C)||hi(C)?{type:C}:C;if(H){const ee=By(Boolean,H.type),se=By(String,H.type);H[0]=ee>-1,H[1]=se<0||ee<se,(ee>-1||bi(H,"default"))&&c.push(k)}}}const T=[p,c];return an(t)&&s.set(t,T),T}function zy(t){return t[0]!=="$"}function Oy(t){const e=t&&t.toString().match(/^\s*function (\w+)/);return e?e[1]:t===null?"null":""}function Fy(t,e){return Oy(t)===Oy(e)}function By(t,e){return ri(e)?e.findIndex(i=>Fy(i,t)):hi(e)&&Fy(e,t)?0:-1}const Yv=t=>t[0]==="_"||t==="$stable",mg=t=>ri(t)?t.map(Os):[Os(t)],LT=(t,e,i)=>{if(e._n)return e;const s=iT((...a)=>mg(e(...a)),i);return s._c=!1,s},Kv=(t,e,i)=>{const s=t._ctx;for(const a in t){if(Yv(a))continue;const h=t[a];if(hi(h))e[a]=LT(a,h,s);else if(h!=null){const p=mg(h);e[a]=()=>p}}},Jv=(t,e)=>{const i=mg(e);t.slots.default=()=>i},kT=(t,e)=>{if(t.vnode.shapeFlag&32){const i=e._;i?(t.slots=Ii(e),Id(e,"_",i)):Kv(e,t.slots={})}else t.slots={},e&&Jv(t,e);Id(t.slots,of,1)},RT=(t,e,i)=>{const{vnode:s,slots:a}=t;let h=!0,p=Yi;if(s.shapeFlag&32){const c=e._;c?i&&c===1?h=!1:(vr(a,e),!i&&c===1&&delete a._):(h=!e.$stable,Kv(e,a)),p=e}else e&&(Jv(t,e),p={default:1});if(h)for(const c in a)!Yv(c)&&!(c in p)&&delete a[c]};function Qv(){return{app:null,config:{isNativeTag:lE,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let DT=0;function zT(t,e){return function(s,a=null){hi(s)||(s=Object.assign({},s)),a!=null&&!an(a)&&(a=null);const h=Qv(),p=new Set;let c=!1;const b=h.app={_uid:DT++,_component:s,_props:a,_container:null,_context:h,_instance:null,version:eA,get config(){return h.config},set config(T){},use(T,...P){return p.has(T)||(T&&hi(T.install)?(p.add(T),T.install(b,...P)):hi(T)&&(p.add(T),T(b,...P))),b},mixin(T){return h.mixins.includes(T)||h.mixins.push(T),b},component(T,P){return P?(h.components[T]=P,b):h.components[T]},directive(T,P){return P?(h.directives[T]=P,b):h.directives[T]},mount(T,P,k){if(!c){const C=Fi(s,a);return C.appContext=h,P&&e?e(C,T):t(C,T,k),c=!0,b._container=T,T.__vue_app__=b,vg(C.component)||C.component.proxy}},unmount(){c&&(t(null,b._container),delete b._container.__vue_app__)},provide(T,P){return h.provides[T]=P,b}};return b}}function fm(t,e,i,s,a=!1){if(ri(t)){t.forEach((C,H)=>fm(C,e&&(ri(e)?e[H]:e),i,s,a));return}if(_d(s)&&!a)return;const h=s.shapeFlag&4?vg(s.component)||s.component.proxy:s.el,p=a?null:h,{i:c,r:b}=t,T=e&&e.r,P=c.refs===Yi?c.refs={}:c.refs,k=c.setupState;if(T!=null&&T!==b&&(Nn(T)?(P[T]=null,bi(k,T)&&(k[T]=null)):vn(T)&&(T.value=null)),hi(b))Jo(b,c,12,[p,P]);else{const C=Nn(b),H=vn(b);if(C||H){const ee=()=>{if(t.f){const se=C?bi(k,b)?k[b]:P[b]:b.value;a?ri(se)&&eg(se,h):ri(se)?se.includes(h)||se.push(h):C?(P[b]=[h],bi(k,b)&&(k[b]=P[b])):(b.value=[h],t.k&&(P[t.k]=b.value))}else C?(P[b]=p,bi(k,b)&&(k[b]=p)):H&&(b.value=p,t.k&&(P[t.k]=p))};p?(ee.id=-1,Sr(ee,i)):ee()}}}const Sr=lT;function OT(t){return FT(t)}function FT(t,e){const i=mE();i.__VUE__=!0;const{insert:s,remove:a,patchProp:h,createElement:p,createText:c,createComment:b,setText:T,setElementText:P,parentNode:k,nextSibling:C,setScopeId:H=ps,insertStaticContent:ee}=t,se=(J,ce,Ce,Re=null,Fe=null,Ze=null,lt=!1,ze=null,Xe=!!ce.dynamicChildren)=>{if(J===ce)return;J&&!iu(J,ce)&&(Re=We(J),Ri(J,Fe,Ze,!0),J=null),ce.patchFlag===-2&&(Xe=!1,ce.dynamicChildren=null);const{type:Ve,ref:Ct,shapeFlag:Tt}=ce;switch(Ve){case gg:pe(J,ce,Ce,Re);break;case $a:fe(J,ce,Ce,Re);break;case pu:J==null&&ye(ce,Ce,Re,lt);break;case on:ei(J,ce,Ce,Re,Fe,Ze,lt,ze,Xe);break;default:Tt&1?$e(J,ce,Ce,Re,Fe,Ze,lt,ze,Xe):Tt&6?gi(J,ce,Ce,Re,Fe,Ze,lt,ze,Xe):(Tt&64||Tt&128)&&Ve.process(J,ce,Ce,Re,Fe,Ze,lt,ze,Xe,Et)}Ct!=null&&Fe&&fm(Ct,J&&J.ref,Ze,ce||J,!ce)},pe=(J,ce,Ce,Re)=>{if(J==null)s(ce.el=c(ce.children),Ce,Re);else{const Fe=ce.el=J.el;ce.children!==J.children&&T(Fe,ce.children)}},fe=(J,ce,Ce,Re)=>{J==null?s(ce.el=b(ce.children||""),Ce,Re):ce.el=J.el},ye=(J,ce,Ce,Re)=>{[J.el,J.anchor]=ee(J.children,ce,Ce,Re,J.el,J.anchor)},Se=({el:J,anchor:ce},Ce,Re)=>{let Fe;for(;J&&J!==ce;)Fe=C(J),s(J,Ce,Re),J=Fe;s(ce,Ce,Re)},Ue=({el:J,anchor:ce})=>{let Ce;for(;J&&J!==ce;)Ce=C(J),a(J),J=Ce;a(ce)},$e=(J,ce,Ce,Re,Fe,Ze,lt,ze,Xe)=>{lt=lt||ce.type==="svg",J==null?Ye(ce,Ce,Re,Fe,Ze,lt,ze,Xe):wt(J,ce,Fe,Ze,lt,ze,Xe)},Ye=(J,ce,Ce,Re,Fe,Ze,lt,ze)=>{let Xe,Ve;const{type:Ct,props:Tt,shapeFlag:Pt,transition:Bt,dirs:Zt}=J;if(Xe=J.el=p(J.type,Ze,Tt&&Tt.is,Tt),Pt&8?P(Xe,J.children):Pt&16&&at(J.children,Xe,null,Re,Fe,Ze&&Ct!=="foreignObject",lt,ze),Zt&&Ma(J,null,Re,"created"),Tt){for(const be in Tt)be!=="value"&&!md(be)&&h(Xe,be,null,Tt[be],Ze,J.children,Re,Fe,ht);"value"in Tt&&h(Xe,"value",null,Tt.value),(Ve=Tt.onVnodeBeforeMount)&&Ls(Ve,Re,J)}Qe(Xe,J,J.scopeId,lt,Re),Zt&&Ma(J,null,Re,"beforeMount");const ci=(!Fe||Fe&&!Fe.pendingBranch)&&Bt&&!Bt.persisted;ci&&Bt.beforeEnter(Xe),s(Xe,ce,Ce),((Ve=Tt&&Tt.onVnodeMounted)||ci||Zt)&&Sr(()=>{Ve&&Ls(Ve,Re,J),ci&&Bt.enter(Xe),Zt&&Ma(J,null,Re,"mounted")},Fe)},Qe=(J,ce,Ce,Re,Fe)=>{if(Ce&&H(J,Ce),Re)for(let Ze=0;Ze<Re.length;Ze++)H(J,Re[Ze]);if(Fe){let Ze=Fe.subTree;if(ce===Ze){const lt=Fe.vnode;Qe(J,lt,lt.scopeId,lt.slotScopeIds,Fe.parent)}}},at=(J,ce,Ce,Re,Fe,Ze,lt,ze,Xe=0)=>{for(let Ve=Xe;Ve<J.length;Ve++){const Ct=J[Ve]=ze?qo(J[Ve]):Os(J[Ve]);se(null,Ct,ce,Ce,Re,Fe,Ze,lt,ze)}},wt=(J,ce,Ce,Re,Fe,Ze,lt)=>{const ze=ce.el=J.el;let{patchFlag:Xe,dynamicChildren:Ve,dirs:Ct}=ce;Xe|=J.patchFlag&16;const Tt=J.props||Yi,Pt=ce.props||Yi;let Bt;Ce&&Ca(Ce,!1),(Bt=Pt.onVnodeBeforeUpdate)&&Ls(Bt,Ce,ce,J),Ct&&Ma(ce,J,Ce,"beforeUpdate"),Ce&&Ca(Ce,!0);const Zt=Fe&&ce.type!=="foreignObject";if(Ve?Mt(J.dynamicChildren,Ve,ze,Ce,Re,Zt,Ze):lt||si(J,ce,ze,null,Ce,Re,Zt,Ze,!1),Xe>0){if(Xe&16)Lt(ze,ce,Tt,Pt,Ce,Re,Fe);else if(Xe&2&&Tt.class!==Pt.class&&h(ze,"class",null,Pt.class,Fe),Xe&4&&h(ze,"style",Tt.style,Pt.style,Fe),Xe&8){const ci=ce.dynamicProps;for(let be=0;be<ci.length;be++){const je=ci[be],en=Tt[je],Ki=Pt[je];(Ki!==en||je==="value")&&h(ze,je,en,Ki,Fe,J.children,Ce,Re,ht)}}Xe&1&&J.children!==ce.children&&P(ze,ce.children)}else!lt&&Ve==null&&Lt(ze,ce,Tt,Pt,Ce,Re,Fe);((Bt=Pt.onVnodeUpdated)||Ct)&&Sr(()=>{Bt&&Ls(Bt,Ce,ce,J),Ct&&Ma(ce,J,Ce,"updated")},Re)},Mt=(J,ce,Ce,Re,Fe,Ze,lt)=>{for(let ze=0;ze<ce.length;ze++){const Xe=J[ze],Ve=ce[ze],Ct=Xe.el&&(Xe.type===on||!iu(Xe,Ve)||Xe.shapeFlag&70)?k(Xe.el):Ce;se(Xe,Ve,Ct,null,Re,Fe,Ze,lt,!0)}},Lt=(J,ce,Ce,Re,Fe,Ze,lt)=>{if(Ce!==Re){if(Ce!==Yi)for(const ze in Ce)!md(ze)&&!(ze in Re)&&h(J,ze,Ce[ze],null,lt,ce.children,Fe,Ze,ht);for(const ze in Re){if(md(ze))continue;const Xe=Re[ze],Ve=Ce[ze];Xe!==Ve&&ze!=="value"&&h(J,ze,Ve,Xe,lt,ce.children,Fe,Ze,ht)}"value"in Re&&h(J,"value",Ce.value,Re.value)}},ei=(J,ce,Ce,Re,Fe,Ze,lt,ze,Xe)=>{const Ve=ce.el=J?J.el:c(""),Ct=ce.anchor=J?J.anchor:c("");let{patchFlag:Tt,dynamicChildren:Pt,slotScopeIds:Bt}=ce;Bt&&(ze=ze?ze.concat(Bt):Bt),J==null?(s(Ve,Ce,Re),s(Ct,Ce,Re),at(ce.children,Ce,Ct,Fe,Ze,lt,ze,Xe)):Tt>0&&Tt&64&&Pt&&J.dynamicChildren?(Mt(J.dynamicChildren,Pt,Ce,Fe,Ze,lt,ze),(ce.key!=null||Fe&&ce===Fe.subTree)&&ex(J,ce,!0)):si(J,ce,Ce,Ct,Fe,Ze,lt,ze,Xe)},gi=(J,ce,Ce,Re,Fe,Ze,lt,ze,Xe)=>{ce.slotScopeIds=ze,J==null?ce.shapeFlag&512?Fe.ctx.activate(ce,Ce,Re,lt,Xe):Ut(ce,Ce,Re,Fe,Ze,lt,Xe):mi(J,ce,Xe)},Ut=(J,ce,Ce,Re,Fe,Ze,lt)=>{const ze=J.component=WT(J,Re,Fe);if(Gv(J)&&(ze.ctx.renderer=Et),ZT(ze),ze.asyncDep){if(Fe&&Fe.registerDep(ze,pt),!J.el){const Xe=ze.subTree=Fi($a);fe(null,Xe,ce,Ce)}return}pt(ze,J,ce,Ce,Fe,Ze,lt)},mi=(J,ce,Ce)=>{const Re=ce.component=J.component;if(sT(J,ce,Ce))if(Re.asyncDep&&!Re.asyncResolved){li(Re,ce,Ce);return}else Re.next=ce,JE(Re.update),Re.update();else ce.el=J.el,Re.vnode=ce},pt=(J,ce,Ce,Re,Fe,Ze,lt)=>{const ze=()=>{if(J.isMounted){let{next:Ct,bu:Tt,u:Pt,parent:Bt,vnode:Zt}=J,ci=Ct,be;Ca(J,!1),Ct?(Ct.el=Zt.el,li(J,Ct,lt)):Ct=Zt,Tt&&yp(Tt),(be=Ct.props&&Ct.props.onVnodeBeforeUpdate)&&Ls(be,Bt,Ct,Zt),Ca(J,!0);const je=vp(J),en=J.subTree;J.subTree=je,se(en,je,k(en.el),We(en),J,Fe,Ze),Ct.el=je.el,ci===null&&oT(J,je.el),Pt&&Sr(Pt,Fe),(be=Ct.props&&Ct.props.onVnodeUpdated)&&Sr(()=>Ls(be,Bt,Ct,Zt),Fe)}else{let Ct;const{el:Tt,props:Pt}=ce,{bm:Bt,m:Zt,parent:ci}=J,be=_d(ce);if(Ca(J,!1),Bt&&yp(Bt),!be&&(Ct=Pt&&Pt.onVnodeBeforeMount)&&Ls(Ct,ci,ce),Ca(J,!0),Tt&&Gt){const je=()=>{J.subTree=vp(J),Gt(Tt,J.subTree,J,Fe,null)};be?ce.type.__asyncLoader().then(()=>!J.isUnmounted&&je()):je()}else{const je=J.subTree=vp(J);se(null,je,Ce,Re,J,Fe,Ze),ce.el=je.el}if(Zt&&Sr(Zt,Fe),!be&&(Ct=Pt&&Pt.onVnodeMounted)){const je=ce;Sr(()=>Ls(Ct,ci,je),Fe)}(ce.shapeFlag&256||ci&&_d(ci.vnode)&&ci.vnode.shapeFlag&256)&&J.a&&Sr(J.a,Fe),J.isMounted=!0,ce=Ce=Re=null}},Xe=J.effect=new rg(ze,()=>dg(Ve),J.scope),Ve=J.update=()=>Xe.run();Ve.id=J.uid,Ca(J,!0),Ve()},li=(J,ce,Ce)=>{ce.component=J;const Re=J.vnode.props;J.vnode=ce,J.next=null,CT(J,ce.props,Re,Ce),RT(J,ce.children,Ce),tc(),My(),ic()},si=(J,ce,Ce,Re,Fe,Ze,lt,ze,Xe=!1)=>{const Ve=J&&J.children,Ct=J?J.shapeFlag:0,Tt=ce.children,{patchFlag:Pt,shapeFlag:Bt}=ce;if(Pt>0){if(Pt&128){ln(Ve,Tt,Ce,Re,Fe,Ze,lt,ze,Xe);return}else if(Pt&256){Bi(Ve,Tt,Ce,Re,Fe,Ze,lt,ze,Xe);return}}Bt&8?(Ct&16&&ht(Ve,Fe,Ze),Tt!==Ve&&P(Ce,Tt)):Ct&16?Bt&16?ln(Ve,Tt,Ce,Re,Fe,Ze,lt,ze,Xe):ht(Ve,Fe,Ze,!0):(Ct&8&&P(Ce,""),Bt&16&&at(Tt,Ce,Re,Fe,Ze,lt,ze,Xe))},Bi=(J,ce,Ce,Re,Fe,Ze,lt,ze,Xe)=>{J=J||zl,ce=ce||zl;const Ve=J.length,Ct=ce.length,Tt=Math.min(Ve,Ct);let Pt;for(Pt=0;Pt<Tt;Pt++){const Bt=ce[Pt]=Xe?qo(ce[Pt]):Os(ce[Pt]);se(J[Pt],Bt,Ce,null,Fe,Ze,lt,ze,Xe)}Ve>Ct?ht(J,Fe,Ze,!0,!1,Tt):at(ce,Ce,Re,Fe,Ze,lt,ze,Xe,Tt)},ln=(J,ce,Ce,Re,Fe,Ze,lt,ze,Xe)=>{let Ve=0;const Ct=ce.length;let Tt=J.length-1,Pt=Ct-1;for(;Ve<=Tt&&Ve<=Pt;){const Bt=J[Ve],Zt=ce[Ve]=Xe?qo(ce[Ve]):Os(ce[Ve]);if(iu(Bt,Zt))se(Bt,Zt,Ce,null,Fe,Ze,lt,ze,Xe);else break;Ve++}for(;Ve<=Tt&&Ve<=Pt;){const Bt=J[Tt],Zt=ce[Pt]=Xe?qo(ce[Pt]):Os(ce[Pt]);if(iu(Bt,Zt))se(Bt,Zt,Ce,null,Fe,Ze,lt,ze,Xe);else break;Tt--,Pt--}if(Ve>Tt){if(Ve<=Pt){const Bt=Pt+1,Zt=Bt<Ct?ce[Bt].el:Re;for(;Ve<=Pt;)se(null,ce[Ve]=Xe?qo(ce[Ve]):Os(ce[Ve]),Ce,Zt,Fe,Ze,lt,ze,Xe),Ve++}}else if(Ve>Pt)for(;Ve<=Tt;)Ri(J[Ve],Fe,Ze,!0),Ve++;else{const Bt=Ve,Zt=Ve,ci=new Map;for(Ve=Zt;Ve<=Pt;Ve++){const Pi=ce[Ve]=Xe?qo(ce[Ve]):Os(ce[Ve]);Pi.key!=null&&ci.set(Pi.key,Ve)}let be,je=0;const en=Pt-Zt+1;let Ki=!1,Xt=0;const fn=new Array(en);for(Ve=0;Ve<en;Ve++)fn[Ve]=0;for(Ve=Bt;Ve<=Tt;Ve++){const Pi=J[Ve];if(je>=en){Ri(Pi,Fe,Ze,!0);continue}let un;if(Pi.key!=null)un=ci.get(Pi.key);else for(be=Zt;be<=Pt;be++)if(fn[be-Zt]===0&&iu(Pi,ce[be])){un=be;break}un===void 0?Ri(Pi,Fe,Ze,!0):(fn[un-Zt]=Ve+1,un>=Xt?Xt=un:Ki=!0,se(Pi,ce[un],Ce,null,Fe,Ze,lt,ze,Xe),je++)}const An=Ki?BT(fn):zl;for(be=An.length-1,Ve=en-1;Ve>=0;Ve--){const Pi=Zt+Ve,un=ce[Pi],Ke=Pi+1<Ct?ce[Pi+1].el:Re;fn[Ve]===0?se(null,un,Ce,Ke,Fe,Ze,lt,ze,Xe):Ki&&(be<0||Ve!==An[be]?cn(un,Ce,Ke,2):be--)}}},cn=(J,ce,Ce,Re,Fe=null)=>{const{el:Ze,type:lt,transition:ze,children:Xe,shapeFlag:Ve}=J;if(Ve&6){cn(J.component.subTree,ce,Ce,Re);return}if(Ve&128){J.suspense.move(ce,Ce,Re);return}if(Ve&64){lt.move(J,ce,Ce,Et);return}if(lt===on){s(Ze,ce,Ce);for(let Tt=0;Tt<Xe.length;Tt++)cn(Xe[Tt],ce,Ce,Re);s(J.anchor,ce,Ce);return}if(lt===pu){Se(J,ce,Ce);return}if(Re!==2&&Ve&1&&ze)if(Re===0)ze.beforeEnter(Ze),s(Ze,ce,Ce),Sr(()=>ze.enter(Ze),Fe);else{const{leave:Tt,delayLeave:Pt,afterLeave:Bt}=ze,Zt=()=>s(Ze,ce,Ce),ci=()=>{Tt(Ze,()=>{Zt(),Bt&&Bt()})};Pt?Pt(Ze,Zt,ci):ci()}else s(Ze,ce,Ce)},Ri=(J,ce,Ce,Re=!1,Fe=!1)=>{const{type:Ze,props:lt,ref:ze,children:Xe,dynamicChildren:Ve,shapeFlag:Ct,patchFlag:Tt,dirs:Pt}=J;if(ze!=null&&fm(ze,null,Ce,J,!0),Ct&256){ce.ctx.deactivate(J);return}const Bt=Ct&1&&Pt,Zt=!_d(J);let ci;if(Zt&&(ci=lt&&lt.onVnodeBeforeUnmount)&&Ls(ci,ce,J),Ct&6)Ne(J.component,Ce,Re);else{if(Ct&128){J.suspense.unmount(Ce,Re);return}Bt&&Ma(J,null,ce,"beforeUnmount"),Ct&64?J.type.remove(J,ce,Ce,Fe,Et,Re):Ve&&(Ze!==on||Tt>0&&Tt&64)?ht(Ve,ce,Ce,!1,!0):(Ze===on&&Tt&384||!Fe&&Ct&16)&&ht(Xe,ce,Ce),Re&&Hn(J)}(Zt&&(ci=lt&&lt.onVnodeUnmounted)||Bt)&&Sr(()=>{ci&&Ls(ci,ce,J),Bt&&Ma(J,null,ce,"unmounted")},Ce)},Hn=J=>{const{type:ce,el:Ce,anchor:Re,transition:Fe}=J;if(ce===on){qn(Ce,Re);return}if(ce===pu){Ue(J);return}const Ze=()=>{a(Ce),Fe&&!Fe.persisted&&Fe.afterLeave&&Fe.afterLeave()};if(J.shapeFlag&1&&Fe&&!Fe.persisted){const{leave:lt,delayLeave:ze}=Fe,Xe=()=>lt(Ce,Ze);ze?ze(J.el,Ze,Xe):Xe()}else Ze()},qn=(J,ce)=>{let Ce;for(;J!==ce;)Ce=C(J),a(J),J=Ce;a(ce)},Ne=(J,ce,Ce)=>{const{bum:Re,scope:Fe,update:Ze,subTree:lt,um:ze}=J;Re&&yp(Re),Fe.stop(),Ze&&(Ze.active=!1,Ri(lt,J,ce,Ce)),ze&&Sr(ze,ce),Sr(()=>{J.isUnmounted=!0},ce),ce&&ce.pendingBranch&&!ce.isUnmounted&&J.asyncDep&&!J.asyncResolved&&J.suspenseId===ce.pendingId&&(ce.deps--,ce.deps===0&&ce.resolve())},ht=(J,ce,Ce,Re=!1,Fe=!1,Ze=0)=>{for(let lt=Ze;lt<J.length;lt++)Ri(J[lt],ce,Ce,Re,Fe)},We=J=>J.shapeFlag&6?We(J.component.subTree):J.shapeFlag&128?J.suspense.next():C(J.anchor||J.el),yt=(J,ce,Ce)=>{J==null?ce._vnode&&Ri(ce._vnode,null,null,!0):se(ce._vnode||null,J,ce,null,null,null,Ce),My(),Fv(),ce._vnode=J},Et={p:se,um:Ri,m:cn,r:Hn,mt:Ut,mc:at,pc:si,pbc:Mt,n:We,o:t};let Wt,Gt;return e&&([Wt,Gt]=e(Et)),{render:yt,hydrate:Wt,createApp:zT(yt,Wt)}}function Ca({effect:t,update:e},i){t.allowRecurse=e.allowRecurse=i}function ex(t,e,i=!1){const s=t.children,a=e.children;if(ri(s)&&ri(a))for(let h=0;h<s.length;h++){const p=s[h];let c=a[h];c.shapeFlag&1&&!c.dynamicChildren&&((c.patchFlag<=0||c.patchFlag===32)&&(c=a[h]=qo(a[h]),c.el=p.el),i||ex(p,c))}}function BT(t){const e=t.slice(),i=[0];let s,a,h,p,c;const b=t.length;for(s=0;s<b;s++){const T=t[s];if(T!==0){if(a=i[i.length-1],t[a]<T){e[s]=a,i.push(s);continue}for(h=0,p=i.length-1;h<p;)c=h+p>>1,t[i[c]]<T?h=c+1:p=c;T<t[i[h]]&&(h>0&&(e[s]=i[h-1]),i[h]=s)}}for(h=i.length,p=i[h-1];h-- >0;)i[h]=p,p=e[p];return i}const NT=t=>t.__isTeleport,on=Symbol(void 0),gg=Symbol(void 0),$a=Symbol(void 0),pu=Symbol(void 0),mu=[];let ds=null;function pi(t=!1){mu.push(ds=t?null:[])}function UT(){mu.pop(),ds=mu[mu.length-1]||null}let Su=1;function Ny(t){Su+=t}function tx(t){return t.dynamicChildren=Su>0?ds||zl:null,UT(),Su>0&&ds&&ds.push(t),t}function ki(t,e,i,s,a,h){return tx(ut(t,e,i,s,a,h,!0))}function ta(t,e,i,s,a){return tx(Fi(t,e,i,s,a,!0))}function pm(t){return t?t.__v_isVNode===!0:!1}function iu(t,e){return t.type===e.type&&t.key===e.key}const of="__vInternal",ix=({key:t})=>t!=null?t:null,yd=({ref:t,ref_key:e,ref_for:i})=>t!=null?Nn(t)||vn(t)||hi(t)?{i:hs,r:t,k:e,f:!!i}:t:null;function ut(t,e=null,i=null,s=0,a=null,h=t===on?0:1,p=!1,c=!1){const b={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&ix(e),ref:e&&yd(e),scopeId:tf,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:h,patchFlag:s,dynamicProps:a,dynamicChildren:null,appContext:null};return c?(_g(b,i),h&128&&t.normalize(b)):i&&(b.shapeFlag|=Nn(i)?8:16),Su>0&&!p&&ds&&(b.patchFlag>0||h&6)&&b.patchFlag!==32&&ds.push(b),b}const Fi=VT;function VT(t,e=null,i=null,s=0,a=null,h=!1){if((!t||t===qv)&&(t=$a),pm(t)){const c=Gl(t,e,!0);return i&&_g(c,i),Su>0&&!h&&ds&&(c.shapeFlag&6?ds[ds.indexOf(t)]=c:ds.push(c)),c.patchFlag|=-2,c}if(QT(t)&&(t=t.__vccOpts),e){e=jT(e);let{class:c,style:b}=e;c&&!Nn(c)&&(e.class=Ul(c)),an(b)&&(Pv(b)&&!ri(b)&&(b=vr({},b)),e.style=Jm(b))}const p=Nn(t)?1:aT(t)?128:NT(t)?64:an(t)?4:hi(t)?2:0;return ut(t,e,i,s,a,p,h,!0)}function jT(t){return t?Pv(t)||of in t?vr({},t):t:null}function Gl(t,e,i=!1){const{props:s,ref:a,patchFlag:h,children:p}=t,c=e?$T(s||{},e):s;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:c,key:c&&ix(c),ref:e&&e.ref?i&&a?ri(a)?a.concat(yd(e)):[a,yd(e)]:yd(e):a,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:p,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==on?h===-1?16:h|16:h,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Gl(t.ssContent),ssFallback:t.ssFallback&&Gl(t.ssFallback),el:t.el,anchor:t.anchor}}function mm(t=" ",e=0){return Fi(gg,null,t,e)}function GT(t,e){const i=Fi(pu,null,t);return i.staticCount=e,i}function nx(t="",e=!1){return e?(pi(),ta($a,null,t)):Fi($a,null,t)}function Os(t){return t==null||typeof t=="boolean"?Fi($a):ri(t)?Fi(on,null,t.slice()):typeof t=="object"?qo(t):Fi(gg,null,String(t))}function qo(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Gl(t)}function _g(t,e){let i=0;const{shapeFlag:s}=t;if(e==null)e=null;else if(ri(e))i=16;else if(typeof e=="object")if(s&65){const a=e.default;a&&(a._c&&(a._d=!1),_g(t,a()),a._c&&(a._d=!0));return}else{i=32;const a=e._;!a&&!(of in e)?e._ctx=hs:a===3&&hs&&(hs.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else hi(e)?(e={default:e,_ctx:hs},i=32):(e=String(e),s&64?(i=16,e=[mm(e)]):i=8);t.children=e,t.shapeFlag|=i}function $T(...t){const e={};for(let i=0;i<t.length;i++){const s=t[i];for(const a in s)if(a==="class")e.class!==s.class&&(e.class=Ul([e.class,s.class]));else if(a==="style")e.style=Jm([e.style,s.style]);else if(Zd(a)){const h=e[a],p=s[a];p&&h!==p&&!(ri(h)&&h.includes(p))&&(e[a]=h?[].concat(h,p):p)}else a!==""&&(e[a]=s[a])}return e}function Ls(t,e,i,s=null){ms(t,e,7,[i,s])}const HT=Qv();let qT=0;function WT(t,e,i){const s=t.type,a=(e?e.appContext:t.appContext)||HT,h={uid:qT++,vnode:t,type:s,parent:e,appContext:a,root:null,next:null,subTree:null,effect:null,update:null,scope:new mv(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(a.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Xv(s,a),emitsOptions:Nv(s,a),emit:null,emitted:null,propsDefaults:Yi,inheritAttrs:s.inheritAttrs,ctx:Yi,data:Yi,props:Yi,attrs:Yi,slots:Yi,refs:Yi,setupState:Yi,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return h.ctx={_:h},h.root=e?e.root:h,h.emit=tT.bind(null,h),t.ce&&t.ce(h),h}let $n=null;const yg=()=>$n||hs,$l=t=>{$n=t,t.scope.on()},Ua=()=>{$n&&$n.scope.off(),$n=null};function rx(t){return t.vnode.shapeFlag&4}let Iu=!1;function ZT(t,e=!1){Iu=e;const{props:i,children:s}=t.vnode,a=rx(t);MT(t,i,a,e),kT(t,s);const h=a?XT(t,e):void 0;return Iu=!1,h}function XT(t,e){const i=t.type;t.accessCache=Object.create(null),t.proxy=jl(new Proxy(t.ctx,ET));const{setup:s}=i;if(s){const a=t.setupContext=s.length>1?KT(t):null;$l(t),tc();const h=Jo(s,t,0,[t.props,a]);if(ic(),Ua(),dv(h)){if(h.then(Ua,Ua),e)return h.then(p=>{Uy(t,p,e)}).catch(p=>{Qd(p,t,0)});t.asyncDep=h}else Uy(t,h,e)}else sx(t,e)}function Uy(t,e,i){hi(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:an(e)&&(t.setupState=kv(e)),sx(t,i)}let Vy;function sx(t,e,i){const s=t.type;if(!t.render){if(!e&&Vy&&!s.render){const a=s.template||pg(t).template;if(a){const{isCustomElement:h,compilerOptions:p}=t.appContext.config,{delimiters:c,compilerOptions:b}=s,T=vr(vr({isCustomElement:h,delimiters:c},p),b);s.render=Vy(a,T)}}t.render=s.render||ps}$l(t),tc(),TT(t),ic(),Ua()}function YT(t){return new Proxy(t.attrs,{get(e,i){return Gr(t,"get","$attrs"),e[i]}})}function KT(t){const e=s=>{t.exposed=s||{}};let i;return{get attrs(){return i||(i=YT(t))},slots:t.slots,emit:t.emit,expose:e}}function vg(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(kv(jl(t.exposed)),{get(e,i){if(i in e)return e[i];if(i in Ld)return Ld[i](t)}}))}function JT(t,e=!0){return hi(t)?t.displayName||t.name:t.name||e&&t.__name}function QT(t){return hi(t)&&"__vccOpts"in t}const Qi=(t,e)=>XE(t,e,Iu);function ox(t,e,i){const s=arguments.length;return s===2?an(e)&&!ri(e)?pm(e)?Fi(t,null,[e]):Fi(t,e):Fi(t,null,e):(s>3?i=Array.prototype.slice.call(arguments,2):s===3&&pm(i)&&(i=[i]),Fi(t,e,i))}const eA="3.2.41",tA="http://www.w3.org/2000/svg",Fa=typeof document<"u"?document:null,jy=Fa&&Fa.createElement("template"),iA={insert:(t,e,i)=>{e.insertBefore(t,i||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,i,s)=>{const a=e?Fa.createElementNS(tA,t):Fa.createElement(t,i?{is:i}:void 0);return t==="select"&&s&&s.multiple!=null&&a.setAttribute("multiple",s.multiple),a},createText:t=>Fa.createTextNode(t),createComment:t=>Fa.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Fa.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,i,s,a,h){const p=i?i.previousSibling:e.lastChild;if(a&&(a===h||a.nextSibling))for(;e.insertBefore(a.cloneNode(!0),i),!(a===h||!(a=a.nextSibling)););else{jy.innerHTML=s?`<svg>${t}</svg>`:t;const c=jy.content;if(s){const b=c.firstChild;for(;b.firstChild;)c.appendChild(b.firstChild);c.removeChild(b)}e.insertBefore(c,i)}return[p?p.nextSibling:e.firstChild,i?i.previousSibling:e.lastChild]}};function nA(t,e,i){const s=t._vtc;s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?t.removeAttribute("class"):i?t.setAttribute("class",e):t.className=e}function rA(t,e,i){const s=t.style,a=Nn(i);if(i&&!a){for(const h in i)gm(s,h,i[h]);if(e&&!Nn(e))for(const h in e)i[h]==null&&gm(s,h,"")}else{const h=s.display;a?e!==i&&(s.cssText=i):e&&t.removeAttribute("style"),"_vod"in t&&(s.display=h)}}const Gy=/\s*!important$/;function gm(t,e,i){if(ri(i))i.forEach(s=>gm(t,e,s));else if(i==null&&(i=""),e.startsWith("--"))t.setProperty(e,i);else{const s=sA(t,e);Gy.test(i)?t.setProperty(ec(s),i.replace(Gy,""),"important"):t[s]=i}}const $y=["Webkit","Moz","ms"],xp={};function sA(t,e){const i=xp[e];if(i)return i;let s=Vs(e);if(s!=="filter"&&s in t)return xp[e]=s;s=Kd(s);for(let a=0;a<$y.length;a++){const h=$y[a]+s;if(h in t)return xp[e]=h}return e}const Hy="http://www.w3.org/1999/xlink";function oA(t,e,i,s,a){if(s&&e.startsWith("xlink:"))i==null?t.removeAttributeNS(Hy,e.slice(6,e.length)):t.setAttributeNS(Hy,e,i);else{const h=rE(e);i==null||h&&!cv(i)?t.removeAttribute(e):t.setAttribute(e,h?"":i)}}function aA(t,e,i,s,a,h,p){if(e==="innerHTML"||e==="textContent"){s&&p(s,a,h),t[e]=i==null?"":i;return}if(e==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=i;const b=i==null?"":i;(t.value!==b||t.tagName==="OPTION")&&(t.value=b),i==null&&t.removeAttribute(e);return}let c=!1;if(i===""||i==null){const b=typeof t[e];b==="boolean"?i=cv(i):i==null&&b==="string"?(i="",c=!0):b==="number"&&(i=0,c=!0)}try{t[e]=i}catch{}c&&t.removeAttribute(e)}function lA(t,e,i,s){t.addEventListener(e,i,s)}function cA(t,e,i,s){t.removeEventListener(e,i,s)}function uA(t,e,i,s,a=null){const h=t._vei||(t._vei={}),p=h[e];if(s&&p)p.value=s;else{const[c,b]=hA(e);if(s){const T=h[e]=pA(s,a);lA(t,c,T,b)}else p&&(cA(t,c,p,b),h[e]=void 0)}}const qy=/(?:Once|Passive|Capture)$/;function hA(t){let e;if(qy.test(t)){e={};let s;for(;s=t.match(qy);)t=t.slice(0,t.length-s[0].length),e[s[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):ec(t.slice(2)),e]}let bp=0;const dA=Promise.resolve(),fA=()=>bp||(dA.then(()=>bp=0),bp=Date.now());function pA(t,e){const i=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=i.attached)return;ms(mA(s,i.value),e,5,[s])};return i.value=t,i.attached=fA(),i}function mA(t,e){if(ri(e)){const i=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{i.call(t),t._stopped=!0},e.map(s=>a=>!a._stopped&&s&&s(a))}else return e}const Wy=/^on[a-z]/,gA=(t,e,i,s,a=!1,h,p,c,b)=>{e==="class"?nA(t,s,a):e==="style"?rA(t,i,s):Zd(e)?Qm(e)||uA(t,e,i,s,p):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):_A(t,e,s,a))?aA(t,e,s,h,p,c,b):(e==="true-value"?t._trueValue=s:e==="false-value"&&(t._falseValue=s),oA(t,e,s,a))};function _A(t,e,i,s){return s?!!(e==="innerHTML"||e==="textContent"||e in t&&Wy.test(e)&&hi(i)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA"||Wy.test(e)&&Nn(i)?!1:e in t}function xg(t){const e=yg();if(!e)return;const i=()=>_m(e.subTree,t(e.proxy));cT(i),rf(()=>{const s=new MutationObserver(i);s.observe(e.subTree.el.parentNode,{childList:!0}),sf(()=>s.disconnect())})}function _m(t,e){if(t.shapeFlag&128){const i=t.suspense;t=i.activeBranch,i.pendingBranch&&!i.isHydrating&&i.effects.push(()=>{_m(i.activeBranch,e)})}for(;t.component;)t=t.component.subTree;if(t.shapeFlag&1&&t.el)Zy(t.el,e);else if(t.type===on)t.children.forEach(i=>_m(i,e));else if(t.type===pu){let{el:i,anchor:s}=t;for(;i&&(Zy(i,e),i!==s);)i=i.nextSibling}}function Zy(t,e){if(t.nodeType===1){const i=t.style;for(const s in e)i.setProperty(`--${s}`,e[s])}}const yA=vr({patchProp:gA},iA);let Xy;function vA(){return Xy||(Xy=OT(yA))}const xA=(...t)=>{const e=vA().createApp(...t),{mount:i}=e;return e.mount=s=>{const a=bA(s);if(!a)return;const h=e._component;!hi(h)&&!h.render&&!h.template&&(h.template=a.innerHTML),a.innerHTML="";const p=i(a,!1,a instanceof SVGElement);return a instanceof Element&&(a.removeAttribute("v-cloak"),a.setAttribute("data-v-app","")),p},e};function bA(t){return Nn(t)?document.querySelector(t):t}var wA=!1;/*!
  * pinia v2.0.23
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */let ax;const af=t=>ax=t,lx=Symbol();function ym(t){return t&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&typeof t.toJSON!="function"}var gu;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(gu||(gu={}));function EA(){const t=gv(!0),e=t.run(()=>Uu({}));let i=[],s=[];const a=jl({install(h){af(a),a._a=h,h.provide(lx,a),h.config.globalProperties.$pinia=a,s.forEach(p=>i.push(p)),s=[]},use(h){return!this._a&&!wA?s.push(h):i.push(h),this},_p:i,_a:null,_e:t,_s:new Map,state:e});return a}const cx=()=>{};function Yy(t,e,i,s=cx){t.push(e);const a=()=>{const h=t.indexOf(e);h>-1&&(t.splice(h,1),s())};return!i&&yg()&&sf(a),a}function wl(t,...e){t.slice().forEach(i=>{i(...e)})}function vm(t,e){t instanceof Map&&e instanceof Map&&e.forEach((i,s)=>t.set(s,i)),t instanceof Set&&e instanceof Set&&e.forEach(t.add,t);for(const i in e){if(!e.hasOwnProperty(i))continue;const s=e[i],a=t[i];ym(a)&&ym(s)&&t.hasOwnProperty(i)&&!vn(s)&&!co(s)?t[i]=vm(a,s):t[i]=s}return t}const TA=Symbol();function AA(t){return!ym(t)||!t.hasOwnProperty(TA)}const{assign:Wo}=Object;function SA(t){return!!(vn(t)&&t.effect)}function IA(t,e,i,s){const{state:a,actions:h,getters:p}=e,c=i.state.value[t];let b;function T(){c||(i.state.value[t]=a?a():{});const P=qE(i.state.value[t]);return Wo(P,h,Object.keys(p||{}).reduce((k,C)=>(k[C]=jl(Qi(()=>{af(i);const H=i._s.get(t);return p[C].call(H,H)})),k),{}))}return b=ux(t,T,e,i,s,!0),b.$reset=function(){const k=a?a():{};this.$patch(C=>{Wo(C,k)})},b}function ux(t,e,i={},s,a,h){let p;const c=Wo({actions:{}},i),b={deep:!0};let T,P,k=jl([]),C=jl([]),H;const ee=s.state.value[t];!h&&!ee&&(s.state.value[t]={}),Uu({});let se;function pe(Qe){let at;T=P=!1,typeof Qe=="function"?(Qe(s.state.value[t]),at={type:gu.patchFunction,storeId:t,events:H}):(vm(s.state.value[t],Qe),at={type:gu.patchObject,payload:Qe,storeId:t,events:H});const wt=se=Symbol();hg().then(()=>{se===wt&&(T=!0)}),P=!0,wl(k,at,s.state.value[t])}const fe=cx;function ye(){p.stop(),k=[],C=[],s._s.delete(t)}function Se(Qe,at){return function(){af(s);const wt=Array.from(arguments),Mt=[],Lt=[];function ei(mi){Mt.push(mi)}function gi(mi){Lt.push(mi)}wl(C,{args:wt,name:Qe,store:$e,after:ei,onError:gi});let Ut;try{Ut=at.apply(this&&this.$id===t?this:$e,wt)}catch(mi){throw wl(Lt,mi),mi}return Ut instanceof Promise?Ut.then(mi=>(wl(Mt,mi),mi)).catch(mi=>(wl(Lt,mi),Promise.reject(mi))):(wl(Mt,Ut),Ut)}}const Ue={_p:s,$id:t,$onAction:Yy.bind(null,C),$patch:pe,$reset:fe,$subscribe(Qe,at={}){const wt=Yy(k,Qe,at.detached,()=>Mt()),Mt=p.run(()=>fu(()=>s.state.value[t],Lt=>{(at.flush==="sync"?P:T)&&Qe({storeId:t,type:gu.direct,events:H},Lt)},Wo({},b,at)));return wt},$dispose:ye},$e=nc(Ue);s._s.set(t,$e);const Ye=s._e.run(()=>(p=gv(),p.run(()=>e())));for(const Qe in Ye){const at=Ye[Qe];if(vn(at)&&!SA(at)||co(at))h||(ee&&AA(at)&&(vn(at)?at.value=ee[Qe]:vm(at,ee[Qe])),s.state.value[t][Qe]=at);else if(typeof at=="function"){const wt=Se(Qe,at);Ye[Qe]=wt,c.actions[Qe]=at}}return Wo($e,Ye),Wo(Ii($e),Ye),Object.defineProperty($e,"$state",{get:()=>s.state.value[t],set:Qe=>{pe(at=>{Wo(at,Qe)})}}),s._p.forEach(Qe=>{Wo($e,p.run(()=>Qe({store:$e,app:s._a,pinia:s,options:c})))}),ee&&h&&i.hydrate&&i.hydrate($e.$state,ee),T=!0,P=!0,$e}function PA(t,e,i){let s,a;const h=typeof e=="function";typeof t=="string"?(s=t,a=h?i:e):(a=t,s=t.id);function p(c,b){const T=yg();return c=c||T&&uo(lx),c&&af(c),c=ax,c._s.has(s)||(h?ux(s,e,a,c):IA(s,a,c)),c._s.get(s)}return p.$id=s,p}function rc(t){{t=Ii(t);const e={};for(const i in t){const s=t[i];(vn(s)||co(s))&&(e[i]=Rv(t,i))}return e}}/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const Cl=typeof window<"u";function MA(t){return t.__esModule||t[Symbol.toStringTag]==="Module"}const zi=Object.assign;function wp(t,e){const i={};for(const s in e){const a=e[s];i[s]=_s(a)?a.map(t):t(a)}return i}const _u=()=>{},_s=Array.isArray,CA=/\/$/,LA=t=>t.replace(CA,"");function Ep(t,e,i="/"){let s,a={},h="",p="";const c=e.indexOf("#");let b=e.indexOf("?");return c<b&&c>=0&&(b=-1),b>-1&&(s=e.slice(0,b),h=e.slice(b+1,c>-1?c:e.length),a=t(h)),c>-1&&(s=s||e.slice(0,c),p=e.slice(c,e.length)),s=zA(s!=null?s:e,i),{fullPath:s+(h&&"?")+h+p,path:s,query:a,hash:p}}function kA(t,e){const i=e.query?t(e.query):"";return e.path+(i&&"?")+i+(e.hash||"")}function Ky(t,e){return!e||!t.toLowerCase().startsWith(e.toLowerCase())?t:t.slice(e.length)||"/"}function RA(t,e,i){const s=e.matched.length-1,a=i.matched.length-1;return s>-1&&s===a&&Hl(e.matched[s],i.matched[a])&&hx(e.params,i.params)&&t(e.query)===t(i.query)&&e.hash===i.hash}function Hl(t,e){return(t.aliasOf||t)===(e.aliasOf||e)}function hx(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!DA(t[i],e[i]))return!1;return!0}function DA(t,e){return _s(t)?Jy(t,e):_s(e)?Jy(e,t):t===e}function Jy(t,e){return _s(e)?t.length===e.length&&t.every((i,s)=>i===e[s]):t.length===1&&t[0]===e}function zA(t,e){if(t.startsWith("/"))return t;if(!t)return e;const i=e.split("/"),s=t.split("/");let a=i.length-1,h,p;for(h=0;h<s.length;h++)if(p=s[h],p!==".")if(p==="..")a>1&&a--;else break;return i.slice(0,a).join("/")+"/"+s.slice(h-(h===s.length?1:0)).join("/")}var Pu;(function(t){t.pop="pop",t.push="push"})(Pu||(Pu={}));var yu;(function(t){t.back="back",t.forward="forward",t.unknown=""})(yu||(yu={}));function OA(t){if(!t)if(Cl){const e=document.querySelector("base");t=e&&e.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),LA(t)}const FA=/^[^#]+#/;function BA(t,e){return t.replace(FA,"#")+e}function NA(t,e){const i=document.documentElement.getBoundingClientRect(),s=t.getBoundingClientRect();return{behavior:e.behavior,left:s.left-i.left-(e.left||0),top:s.top-i.top-(e.top||0)}}const lf=()=>({left:window.pageXOffset,top:window.pageYOffset});function UA(t){let e;if("el"in t){const i=t.el,s=typeof i=="string"&&i.startsWith("#"),a=typeof i=="string"?s?document.getElementById(i.slice(1)):document.querySelector(i):i;if(!a)return;e=NA(a,t)}else e=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.pageXOffset,e.top!=null?e.top:window.pageYOffset)}function Qy(t,e){return(history.state?history.state.position-e:-1)+t}const xm=new Map;function VA(t,e){xm.set(t,e)}function jA(t){const e=xm.get(t);return xm.delete(t),e}let GA=()=>location.protocol+"//"+location.host;function dx(t,e){const{pathname:i,search:s,hash:a}=e,h=t.indexOf("#");if(h>-1){let c=a.includes(t.slice(h))?t.slice(h).length:1,b=a.slice(c);return b[0]!=="/"&&(b="/"+b),Ky(b,"")}return Ky(i,t)+s+a}function $A(t,e,i,s){let a=[],h=[],p=null;const c=({state:C})=>{const H=dx(t,location),ee=i.value,se=e.value;let pe=0;if(C){if(i.value=H,e.value=C,p&&p===ee){p=null;return}pe=se?C.position-se.position:0}else s(H);a.forEach(fe=>{fe(i.value,ee,{delta:pe,type:Pu.pop,direction:pe?pe>0?yu.forward:yu.back:yu.unknown})})};function b(){p=i.value}function T(C){a.push(C);const H=()=>{const ee=a.indexOf(C);ee>-1&&a.splice(ee,1)};return h.push(H),H}function P(){const{history:C}=window;!C.state||C.replaceState(zi({},C.state,{scroll:lf()}),"")}function k(){for(const C of h)C();h=[],window.removeEventListener("popstate",c),window.removeEventListener("beforeunload",P)}return window.addEventListener("popstate",c),window.addEventListener("beforeunload",P),{pauseListeners:b,listen:T,destroy:k}}function e0(t,e,i,s=!1,a=!1){return{back:t,current:e,forward:i,replaced:s,position:window.history.length,scroll:a?lf():null}}function HA(t){const{history:e,location:i}=window,s={value:dx(t,i)},a={value:e.state};a.value||h(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function h(b,T,P){const k=t.indexOf("#"),C=k>-1?(i.host&&document.querySelector("base")?t:t.slice(k))+b:GA()+t+b;try{e[P?"replaceState":"pushState"](T,"",C),a.value=T}catch(H){console.error(H),i[P?"replace":"assign"](C)}}function p(b,T){const P=zi({},e.state,e0(a.value.back,b,a.value.forward,!0),T,{position:a.value.position});h(b,P,!0),s.value=b}function c(b,T){const P=zi({},a.value,e.state,{forward:b,scroll:lf()});h(P.current,P,!0);const k=zi({},e0(s.value,b,null),{position:P.position+1},T);h(b,k,!1),s.value=b}return{location:s,state:a,push:c,replace:p}}function qA(t){t=OA(t);const e=HA(t),i=$A(t,e.state,e.location,e.replace);function s(h,p=!0){p||i.pauseListeners(),history.go(h)}const a=zi({location:"",base:t,go:s,createHref:BA.bind(null,t)},e,i);return Object.defineProperty(a,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(a,"state",{enumerable:!0,get:()=>e.state.value}),a}function WA(t){return typeof t=="string"||t&&typeof t=="object"}function fx(t){return typeof t=="string"||typeof t=="symbol"}const Uo={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},px=Symbol("");var t0;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(t0||(t0={}));function ql(t,e){return zi(new Error,{type:t,[px]:!0},e)}function so(t,e){return t instanceof Error&&px in t&&(e==null||!!(t.type&e))}const i0="[^/]+?",ZA={sensitive:!1,strict:!1,start:!0,end:!0},XA=/[.+*?^${}()[\]/\\]/g;function YA(t,e){const i=zi({},ZA,e),s=[];let a=i.start?"^":"";const h=[];for(const T of t){const P=T.length?[]:[90];i.strict&&!T.length&&(a+="/");for(let k=0;k<T.length;k++){const C=T[k];let H=40+(i.sensitive?.25:0);if(C.type===0)k||(a+="/"),a+=C.value.replace(XA,"\\$&"),H+=40;else if(C.type===1){const{value:ee,repeatable:se,optional:pe,regexp:fe}=C;h.push({name:ee,repeatable:se,optional:pe});const ye=fe||i0;if(ye!==i0){H+=10;try{new RegExp(`(${ye})`)}catch(Ue){throw new Error(`Invalid custom RegExp for param "${ee}" (${ye}): `+Ue.message)}}let Se=se?`((?:${ye})(?:/(?:${ye}))*)`:`(${ye})`;k||(Se=pe&&T.length<2?`(?:/${Se})`:"/"+Se),pe&&(Se+="?"),a+=Se,H+=20,pe&&(H+=-8),se&&(H+=-20),ye===".*"&&(H+=-50)}P.push(H)}s.push(P)}if(i.strict&&i.end){const T=s.length-1;s[T][s[T].length-1]+=.7000000000000001}i.strict||(a+="/?"),i.end?a+="$":i.strict&&(a+="(?:/|$)");const p=new RegExp(a,i.sensitive?"":"i");function c(T){const P=T.match(p),k={};if(!P)return null;for(let C=1;C<P.length;C++){const H=P[C]||"",ee=h[C-1];k[ee.name]=H&&ee.repeatable?H.split("/"):H}return k}function b(T){let P="",k=!1;for(const C of t){(!k||!P.endsWith("/"))&&(P+="/"),k=!1;for(const H of C)if(H.type===0)P+=H.value;else if(H.type===1){const{value:ee,repeatable:se,optional:pe}=H,fe=ee in T?T[ee]:"";if(_s(fe)&&!se)throw new Error(`Provided param "${ee}" is an array but it is not repeatable (* or + modifiers)`);const ye=_s(fe)?fe.join("/"):fe;if(!ye)if(pe)C.length<2&&(P.endsWith("/")?P=P.slice(0,-1):k=!0);else throw new Error(`Missing required param "${ee}"`);P+=ye}}return P||"/"}return{re:p,score:s,keys:h,parse:c,stringify:b}}function KA(t,e){let i=0;for(;i<t.length&&i<e.length;){const s=e[i]-t[i];if(s)return s;i++}return t.length<e.length?t.length===1&&t[0]===40+40?-1:1:t.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function JA(t,e){let i=0;const s=t.score,a=e.score;for(;i<s.length&&i<a.length;){const h=KA(s[i],a[i]);if(h)return h;i++}if(Math.abs(a.length-s.length)===1){if(n0(s))return 1;if(n0(a))return-1}return a.length-s.length}function n0(t){const e=t[t.length-1];return t.length>0&&e[e.length-1]<0}const QA={type:0,value:""},eS=/[a-zA-Z0-9_]/;function tS(t){if(!t)return[[]];if(t==="/")return[[QA]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function e(H){throw new Error(`ERR (${i})/"${T}": ${H}`)}let i=0,s=i;const a=[];let h;function p(){h&&a.push(h),h=[]}let c=0,b,T="",P="";function k(){!T||(i===0?h.push({type:0,value:T}):i===1||i===2||i===3?(h.length>1&&(b==="*"||b==="+")&&e(`A repeatable param (${T}) must be alone in its segment. eg: '/:ids+.`),h.push({type:1,value:T,regexp:P,repeatable:b==="*"||b==="+",optional:b==="*"||b==="?"})):e("Invalid state to consume buffer"),T="")}function C(){T+=b}for(;c<t.length;){if(b=t[c++],b==="\\"&&i!==2){s=i,i=4;continue}switch(i){case 0:b==="/"?(T&&k(),p()):b===":"?(k(),i=1):C();break;case 4:C(),i=s;break;case 1:b==="("?i=2:eS.test(b)?C():(k(),i=0,b!=="*"&&b!=="?"&&b!=="+"&&c--);break;case 2:b===")"?P[P.length-1]=="\\"?P=P.slice(0,-1)+b:i=3:P+=b;break;case 3:k(),i=0,b!=="*"&&b!=="?"&&b!=="+"&&c--,P="";break;default:e("Unknown state");break}}return i===2&&e(`Unfinished custom RegExp for param "${T}"`),k(),p(),a}function iS(t,e,i){const s=YA(tS(t.path),i),a=zi(s,{record:t,parent:e,children:[],alias:[]});return e&&!a.record.aliasOf==!e.record.aliasOf&&e.children.push(a),a}function nS(t,e){const i=[],s=new Map;e=o0({strict:!1,end:!0,sensitive:!1},e);function a(P){return s.get(P)}function h(P,k,C){const H=!C,ee=rS(P);ee.aliasOf=C&&C.record;const se=o0(e,P),pe=[ee];if("alias"in P){const Se=typeof P.alias=="string"?[P.alias]:P.alias;for(const Ue of Se)pe.push(zi({},ee,{components:C?C.record.components:ee.components,path:Ue,aliasOf:C?C.record:ee}))}let fe,ye;for(const Se of pe){const{path:Ue}=Se;if(k&&Ue[0]!=="/"){const $e=k.record.path,Ye=$e[$e.length-1]==="/"?"":"/";Se.path=k.record.path+(Ue&&Ye+Ue)}if(fe=iS(Se,k,se),C?C.alias.push(fe):(ye=ye||fe,ye!==fe&&ye.alias.push(fe),H&&P.name&&!s0(fe)&&p(P.name)),ee.children){const $e=ee.children;for(let Ye=0;Ye<$e.length;Ye++)h($e[Ye],fe,C&&C.children[Ye])}C=C||fe,(fe.record.components&&Object.keys(fe.record.components).length||fe.record.name||fe.record.redirect)&&b(fe)}return ye?()=>{p(ye)}:_u}function p(P){if(fx(P)){const k=s.get(P);k&&(s.delete(P),i.splice(i.indexOf(k),1),k.children.forEach(p),k.alias.forEach(p))}else{const k=i.indexOf(P);k>-1&&(i.splice(k,1),P.record.name&&s.delete(P.record.name),P.children.forEach(p),P.alias.forEach(p))}}function c(){return i}function b(P){let k=0;for(;k<i.length&&JA(P,i[k])>=0&&(P.record.path!==i[k].record.path||!mx(P,i[k]));)k++;i.splice(k,0,P),P.record.name&&!s0(P)&&s.set(P.record.name,P)}function T(P,k){let C,H={},ee,se;if("name"in P&&P.name){if(C=s.get(P.name),!C)throw ql(1,{location:P});se=C.record.name,H=zi(r0(k.params,C.keys.filter(ye=>!ye.optional).map(ye=>ye.name)),P.params&&r0(P.params,C.keys.map(ye=>ye.name))),ee=C.stringify(H)}else if("path"in P)ee=P.path,C=i.find(ye=>ye.re.test(ee)),C&&(H=C.parse(ee),se=C.record.name);else{if(C=k.name?s.get(k.name):i.find(ye=>ye.re.test(k.path)),!C)throw ql(1,{location:P,currentLocation:k});se=C.record.name,H=zi({},k.params,P.params),ee=C.stringify(H)}const pe=[];let fe=C;for(;fe;)pe.unshift(fe.record),fe=fe.parent;return{name:se,path:ee,params:H,matched:pe,meta:oS(pe)}}return t.forEach(P=>h(P)),{addRoute:h,resolve:T,removeRoute:p,getRoutes:c,getRecordMatcher:a}}function r0(t,e){const i={};for(const s of e)s in t&&(i[s]=t[s]);return i}function rS(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:sS(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function sS(t){const e={},i=t.props||!1;if("component"in t)e.default=i;else for(const s in t.components)e[s]=typeof i=="boolean"?i:i[s];return e}function s0(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function oS(t){return t.reduce((e,i)=>zi(e,i.meta),{})}function o0(t,e){const i={};for(const s in t)i[s]=s in e?e[s]:t[s];return i}function mx(t,e){return e.children.some(i=>i===t||mx(t,i))}const gx=/#/g,aS=/&/g,lS=/\//g,cS=/=/g,uS=/\?/g,_x=/\+/g,hS=/%5B/g,dS=/%5D/g,yx=/%5E/g,fS=/%60/g,vx=/%7B/g,pS=/%7C/g,xx=/%7D/g,mS=/%20/g;function bg(t){return encodeURI(""+t).replace(pS,"|").replace(hS,"[").replace(dS,"]")}function gS(t){return bg(t).replace(vx,"{").replace(xx,"}").replace(yx,"^")}function bm(t){return bg(t).replace(_x,"%2B").replace(mS,"+").replace(gx,"%23").replace(aS,"%26").replace(fS,"`").replace(vx,"{").replace(xx,"}").replace(yx,"^")}function _S(t){return bm(t).replace(cS,"%3D")}function yS(t){return bg(t).replace(gx,"%23").replace(uS,"%3F")}function vS(t){return t==null?"":yS(t).replace(lS,"%2F")}function Rd(t){try{return decodeURIComponent(""+t)}catch{}return""+t}function xS(t){const e={};if(t===""||t==="?")return e;const s=(t[0]==="?"?t.slice(1):t).split("&");for(let a=0;a<s.length;++a){const h=s[a].replace(_x," "),p=h.indexOf("="),c=Rd(p<0?h:h.slice(0,p)),b=p<0?null:Rd(h.slice(p+1));if(c in e){let T=e[c];_s(T)||(T=e[c]=[T]),T.push(b)}else e[c]=b}return e}function a0(t){let e="";for(let i in t){const s=t[i];if(i=_S(i),s==null){s!==void 0&&(e+=(e.length?"&":"")+i);continue}(_s(s)?s.map(h=>h&&bm(h)):[s&&bm(s)]).forEach(h=>{h!==void 0&&(e+=(e.length?"&":"")+i,h!=null&&(e+="="+h))})}return e}function bS(t){const e={};for(const i in t){const s=t[i];s!==void 0&&(e[i]=_s(s)?s.map(a=>a==null?null:""+a):s==null?s:""+s)}return e}const wS=Symbol(""),l0=Symbol(""),wg=Symbol(""),bx=Symbol(""),wm=Symbol("");function nu(){let t=[];function e(s){return t.push(s),()=>{const a=t.indexOf(s);a>-1&&t.splice(a,1)}}function i(){t=[]}return{add:e,list:()=>t,reset:i}}function Zo(t,e,i,s,a){const h=s&&(s.enterCallbacks[a]=s.enterCallbacks[a]||[]);return()=>new Promise((p,c)=>{const b=k=>{k===!1?c(ql(4,{from:i,to:e})):k instanceof Error?c(k):WA(k)?c(ql(2,{from:e,to:k})):(h&&s.enterCallbacks[a]===h&&typeof k=="function"&&h.push(k),p())},T=t.call(s&&s.instances[a],e,i,b);let P=Promise.resolve(T);t.length<3&&(P=P.then(b)),P.catch(k=>c(k))})}function Tp(t,e,i,s){const a=[];for(const h of t)for(const p in h.components){let c=h.components[p];if(!(e!=="beforeRouteEnter"&&!h.instances[p]))if(ES(c)){const T=(c.__vccOpts||c)[e];T&&a.push(Zo(T,i,s,h,p))}else{let b=c();a.push(()=>b.then(T=>{if(!T)return Promise.reject(new Error(`Couldn't resolve component "${p}" at "${h.path}"`));const P=MA(T)?T.default:T;h.components[p]=P;const C=(P.__vccOpts||P)[e];return C&&Zo(C,i,s,h,p)()}))}}return a}function ES(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function c0(t){const e=uo(wg),i=uo(bx),s=Qi(()=>e.resolve(zt(t.to))),a=Qi(()=>{const{matched:b}=s.value,{length:T}=b,P=b[T-1],k=i.matched;if(!P||!k.length)return-1;const C=k.findIndex(Hl.bind(null,P));if(C>-1)return C;const H=u0(b[T-2]);return T>1&&u0(P)===H&&k[k.length-1].path!==H?k.findIndex(Hl.bind(null,b[T-2])):C}),h=Qi(()=>a.value>-1&&IS(i.params,s.value.params)),p=Qi(()=>a.value>-1&&a.value===i.matched.length-1&&hx(i.params,s.value.params));function c(b={}){return SS(b)?e[zt(t.replace)?"replace":"push"](zt(t.to)).catch(_u):Promise.resolve()}return{route:s,href:Qi(()=>s.value.href),isActive:h,isExactActive:p,navigate:c}}const TS=sr({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:c0,setup(t,{slots:e}){const i=nc(c0(t)),{options:s}=uo(wg),a=Qi(()=>({[h0(t.activeClass,s.linkActiveClass,"router-link-active")]:i.isActive,[h0(t.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:i.isExactActive}));return()=>{const h=e.default&&e.default(i);return t.custom?h:ox("a",{"aria-current":i.isExactActive?t.ariaCurrentValue:null,href:i.href,onClick:i.navigate,class:a.value},h)}}}),AS=TS;function SS(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}function IS(t,e){for(const i in e){const s=e[i],a=t[i];if(typeof s=="string"){if(s!==a)return!1}else if(!_s(a)||a.length!==s.length||s.some((h,p)=>h!==a[p]))return!1}return!0}function u0(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const h0=(t,e,i)=>t!=null?t:e!=null?e:i,PS=sr({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:e,slots:i}){const s=uo(wm),a=Qi(()=>t.route||s.value),h=uo(l0,0),p=Qi(()=>{let T=zt(h);const{matched:P}=a.value;let k;for(;(k=P[T])&&!k.components;)T++;return T}),c=Qi(()=>a.value.matched[p.value]);gd(l0,Qi(()=>p.value+1)),gd(wS,c),gd(wm,a);const b=Uu();return fu(()=>[b.value,c.value,t.name],([T,P,k],[C,H,ee])=>{P&&(P.instances[k]=T,H&&H!==P&&T&&T===C&&(P.leaveGuards.size||(P.leaveGuards=H.leaveGuards),P.updateGuards.size||(P.updateGuards=H.updateGuards))),T&&P&&(!H||!Hl(P,H)||!C)&&(P.enterCallbacks[k]||[]).forEach(se=>se(T))},{flush:"post"}),()=>{const T=a.value,P=t.name,k=c.value,C=k&&k.components[P];if(!C)return d0(i.default,{Component:C,route:T});const H=k.props[P],ee=H?H===!0?T.params:typeof H=="function"?H(T):H:null,pe=ox(C,zi({},ee,e,{onVnodeUnmounted:fe=>{fe.component.isUnmounted&&(k.instances[P]=null)},ref:b}));return d0(i.default,{Component:pe,route:T})||pe}}});function d0(t,e){if(!t)return null;const i=t(e);return i.length===1?i[0]:i}const wx=PS;function MS(t){const e=nS(t.routes,t),i=t.parseQuery||xS,s=t.stringifyQuery||a0,a=t.history,h=nu(),p=nu(),c=nu(),b=GE(Uo);let T=Uo;Cl&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const P=wp.bind(null,Ne=>""+Ne),k=wp.bind(null,vS),C=wp.bind(null,Rd);function H(Ne,ht){let We,yt;return fx(Ne)?(We=e.getRecordMatcher(Ne),yt=ht):yt=Ne,e.addRoute(yt,We)}function ee(Ne){const ht=e.getRecordMatcher(Ne);ht&&e.removeRoute(ht)}function se(){return e.getRoutes().map(Ne=>Ne.record)}function pe(Ne){return!!e.getRecordMatcher(Ne)}function fe(Ne,ht){if(ht=zi({},ht||b.value),typeof Ne=="string"){const J=Ep(i,Ne,ht.path),ce=e.resolve({path:J.path},ht),Ce=a.createHref(J.fullPath);return zi(J,ce,{params:C(ce.params),hash:Rd(J.hash),redirectedFrom:void 0,href:Ce})}let We;if("path"in Ne)We=zi({},Ne,{path:Ep(i,Ne.path,ht.path).path});else{const J=zi({},Ne.params);for(const ce in J)J[ce]==null&&delete J[ce];We=zi({},Ne,{params:k(Ne.params)}),ht.params=k(ht.params)}const yt=e.resolve(We,ht),Et=Ne.hash||"";yt.params=P(C(yt.params));const Wt=kA(s,zi({},Ne,{hash:gS(Et),path:yt.path})),Gt=a.createHref(Wt);return zi({fullPath:Wt,hash:Et,query:s===a0?bS(Ne.query):Ne.query||{}},yt,{redirectedFrom:void 0,href:Gt})}function ye(Ne){return typeof Ne=="string"?Ep(i,Ne,b.value.path):zi({},Ne)}function Se(Ne,ht){if(T!==Ne)return ql(8,{from:ht,to:Ne})}function Ue(Ne){return Qe(Ne)}function $e(Ne){return Ue(zi(ye(Ne),{replace:!0}))}function Ye(Ne){const ht=Ne.matched[Ne.matched.length-1];if(ht&&ht.redirect){const{redirect:We}=ht;let yt=typeof We=="function"?We(Ne):We;return typeof yt=="string"&&(yt=yt.includes("?")||yt.includes("#")?yt=ye(yt):{path:yt},yt.params={}),zi({query:Ne.query,hash:Ne.hash,params:"path"in yt?{}:Ne.params},yt)}}function Qe(Ne,ht){const We=T=fe(Ne),yt=b.value,Et=Ne.state,Wt=Ne.force,Gt=Ne.replace===!0,J=Ye(We);if(J)return Qe(zi(ye(J),{state:typeof J=="object"?zi({},Et,J.state):Et,force:Wt,replace:Gt}),ht||We);const ce=We;ce.redirectedFrom=ht;let Ce;return!Wt&&RA(s,yt,We)&&(Ce=ql(16,{to:ce,from:yt}),ln(yt,yt,!0,!1)),(Ce?Promise.resolve(Ce):wt(ce,yt)).catch(Re=>so(Re)?so(Re,2)?Re:Bi(Re):li(Re,ce,yt)).then(Re=>{if(Re){if(so(Re,2))return Qe(zi({replace:Gt},ye(Re.to),{state:typeof Re.to=="object"?zi({},Et,Re.to.state):Et,force:Wt}),ht||ce)}else Re=Lt(ce,yt,!0,Gt,Et);return Mt(ce,yt,Re),Re})}function at(Ne,ht){const We=Se(Ne,ht);return We?Promise.reject(We):Promise.resolve()}function wt(Ne,ht){let We;const[yt,Et,Wt]=CS(Ne,ht);We=Tp(yt.reverse(),"beforeRouteLeave",Ne,ht);for(const J of yt)J.leaveGuards.forEach(ce=>{We.push(Zo(ce,Ne,ht))});const Gt=at.bind(null,Ne,ht);return We.push(Gt),El(We).then(()=>{We=[];for(const J of h.list())We.push(Zo(J,Ne,ht));return We.push(Gt),El(We)}).then(()=>{We=Tp(Et,"beforeRouteUpdate",Ne,ht);for(const J of Et)J.updateGuards.forEach(ce=>{We.push(Zo(ce,Ne,ht))});return We.push(Gt),El(We)}).then(()=>{We=[];for(const J of Ne.matched)if(J.beforeEnter&&!ht.matched.includes(J))if(_s(J.beforeEnter))for(const ce of J.beforeEnter)We.push(Zo(ce,Ne,ht));else We.push(Zo(J.beforeEnter,Ne,ht));return We.push(Gt),El(We)}).then(()=>(Ne.matched.forEach(J=>J.enterCallbacks={}),We=Tp(Wt,"beforeRouteEnter",Ne,ht),We.push(Gt),El(We))).then(()=>{We=[];for(const J of p.list())We.push(Zo(J,Ne,ht));return We.push(Gt),El(We)}).catch(J=>so(J,8)?J:Promise.reject(J))}function Mt(Ne,ht,We){for(const yt of c.list())yt(Ne,ht,We)}function Lt(Ne,ht,We,yt,Et){const Wt=Se(Ne,ht);if(Wt)return Wt;const Gt=ht===Uo,J=Cl?history.state:{};We&&(yt||Gt?a.replace(Ne.fullPath,zi({scroll:Gt&&J&&J.scroll},Et)):a.push(Ne.fullPath,Et)),b.value=Ne,ln(Ne,ht,We,Gt),Bi()}let ei;function gi(){ei||(ei=a.listen((Ne,ht,We)=>{if(!qn.listening)return;const yt=fe(Ne),Et=Ye(yt);if(Et){Qe(zi(Et,{replace:!0}),yt).catch(_u);return}T=yt;const Wt=b.value;Cl&&VA(Qy(Wt.fullPath,We.delta),lf()),wt(yt,Wt).catch(Gt=>so(Gt,12)?Gt:so(Gt,2)?(Qe(Gt.to,yt).then(J=>{so(J,20)&&!We.delta&&We.type===Pu.pop&&a.go(-1,!1)}).catch(_u),Promise.reject()):(We.delta&&a.go(-We.delta,!1),li(Gt,yt,Wt))).then(Gt=>{Gt=Gt||Lt(yt,Wt,!1),Gt&&(We.delta&&!so(Gt,8)?a.go(-We.delta,!1):We.type===Pu.pop&&so(Gt,20)&&a.go(-1,!1)),Mt(yt,Wt,Gt)}).catch(_u)}))}let Ut=nu(),mi=nu(),pt;function li(Ne,ht,We){Bi(Ne);const yt=mi.list();return yt.length?yt.forEach(Et=>Et(Ne,ht,We)):console.error(Ne),Promise.reject(Ne)}function si(){return pt&&b.value!==Uo?Promise.resolve():new Promise((Ne,ht)=>{Ut.add([Ne,ht])})}function Bi(Ne){return pt||(pt=!Ne,gi(),Ut.list().forEach(([ht,We])=>Ne?We(Ne):ht()),Ut.reset()),Ne}function ln(Ne,ht,We,yt){const{scrollBehavior:Et}=t;if(!Cl||!Et)return Promise.resolve();const Wt=!We&&jA(Qy(Ne.fullPath,0))||(yt||!We)&&history.state&&history.state.scroll||null;return hg().then(()=>Et(Ne,ht,Wt)).then(Gt=>Gt&&UA(Gt)).catch(Gt=>li(Gt,Ne,ht))}const cn=Ne=>a.go(Ne);let Ri;const Hn=new Set,qn={currentRoute:b,listening:!0,addRoute:H,removeRoute:ee,hasRoute:pe,getRoutes:se,resolve:fe,options:t,push:Ue,replace:$e,go:cn,back:()=>cn(-1),forward:()=>cn(1),beforeEach:h.add,beforeResolve:p.add,afterEach:c.add,onError:mi.add,isReady:si,install(Ne){const ht=this;Ne.component("RouterLink",AS),Ne.component("RouterView",wx),Ne.config.globalProperties.$router=ht,Object.defineProperty(Ne.config.globalProperties,"$route",{enumerable:!0,get:()=>zt(b)}),Cl&&!Ri&&b.value===Uo&&(Ri=!0,Ue(a.location).catch(Et=>{}));const We={};for(const Et in Uo)We[Et]=Qi(()=>b.value[Et]);Ne.provide(wg,ht),Ne.provide(bx,nc(We)),Ne.provide(wm,b);const yt=Ne.unmount;Hn.add(Ne),Ne.unmount=function(){Hn.delete(Ne),Hn.size<1&&(T=Uo,ei&&ei(),ei=null,b.value=Uo,Ri=!1,pt=!1),yt()}}};return qn}function El(t){return t.reduce((e,i)=>e.then(()=>i()),Promise.resolve())}function CS(t,e){const i=[],s=[],a=[],h=Math.max(e.matched.length,t.matched.length);for(let p=0;p<h;p++){const c=e.matched[p];c&&(t.matched.find(T=>Hl(T,c))?s.push(c):i.push(c));const b=t.matched[p];b&&(e.matched.find(T=>Hl(T,b))||a.push(b))}return[i,s,a]}const LS={class:"diamond-wrapper"},kS=sr({__name:"Diamond",props:{href:null,index:null,isHighlighted:{type:Boolean}},setup(t){const e=t;function i(){document.querySelector(`[href='${e.href}']`).scrollIntoView()}return(s,a)=>(pi(),ki("div",LS,[ut("div",{class:Ul("diamond "+(e.isHighlighted?"highlighted":"")),onClick:i},null,2)]))}});const Vu=(t,e)=>{const i=t.__vccOpts||t;for(const[s,a]of e)i[s]=a;return i},RS=Vu(kS,[["__scopeId","data-v-7c3f98b0"]]),DS={class:"pathfinder"},zS=sr({__name:"Pathfinder",setup(t){const e=["#welcome","#expertise","#experience","#work","#contact"],i=Uu(0);function s(){i.value=Math.floor((window.scrollY+window.innerHeight/2)/window.innerHeight),i.value>4&&(i.value=4),i.value<0&&(i.value=0)}return rf(()=>{window.addEventListener("scroll",s)}),(a,h)=>(pi(),ki("div",DS,[(pi(),ki(on,null,Ga(5,p=>Fi(zt(RS),{key:p,index:p,href:e[p-1],"is-highlighted":p-1===i.value},null,8,["index","href","is-highlighted"])),64))]))}});const OS=Vu(zS,[["__scopeId","data-v-629fff67"]]),FS="/assets/arrow-down.8fb1fa2c.svg",BS="/assets/desktop.78c253c5.svg",NS="/assets/english.f34d380d.svg",US="/assets/french.c739ff76.svg",VS="/assets/german.9ec49902.svg",jS="/assets/flutter.3a0e8824.svg",GS="/assets/github.7c0295c7.svg",$S="/assets/language.62ebed36.svg",HS="/assets/linkedin.6d12da72.svg",qS="/assets/location.1fedb3fa.svg",WS="/assets/react.b00aa51c.svg",sc=PA("language",{state:()=>({language:"en"}),actions:{setLanguage(t){this.language=t}}}),ZS=["src"],XS={class:"flags"},YS=["src","alt","onClick"],KS=sr({__name:"LanguageSelector",emits:["language-selected"],setup(t,{emit:e}){const i=[{name:"fr",icon:"flags/french.svg"},{name:"en",icon:"flags/english.svg"},{name:"de",icon:"flags/german.svg"}],s=Uu(!1),a=sc(),{language:h}=rc(a),p=T=>new URL(Object.assign({"/src/assets/icons/arrow-down.svg":FS,"/src/assets/icons/desktop.svg":BS,"/src/assets/icons/flags/english.svg":NS,"/src/assets/icons/flags/french.svg":US,"/src/assets/icons/flags/german.svg":VS,"/src/assets/icons/flutter.svg":jS,"/src/assets/icons/github.svg":GS,"/src/assets/icons/language.svg":$S,"/src/assets/icons/linkedin.svg":HS,"/src/assets/icons/location.svg":qS,"/src/assets/icons/react.svg":WS})[`/src/assets/icons/${T}`],self.location).href,c=()=>{s.value=!s.value},b=T=>{e("language-selected",T),c(),a.setLanguage(T)};return(T,P)=>(pi(),ki("div",{class:Ul("language-selector "+(s.value?"panel-open":""))},[ut("img",{src:p("language.svg"),alt:"select language",class:"icon",onClick:c},null,8,ZS),ut("div",XS,[(pi(),ki(on,null,Ga(i,(k,C)=>ut("img",{key:C,src:p(k.icon),alt:k.name,class:Ul("flag "+(zt(h)===k.name?"selected":"")),onClick:H=>b(k.name)},null,10,YS)),64))])],2))}});const JS=Vu(KS,[["__scopeId","data-v-7289c281"]]),QS=ut("div",{class:"day-line"},null,-1),eI=sr({__name:"App",setup(t){xg(b=>({"1d2dc97e":c}));function e(b,T){return new Date(b,T,0).getDate()}const i=new Date,s=i.getFullYear(),a=i.getMonth(),h=i.getDate(),c=71.428+100/85*(a+12*(s-2023))+100/85/e(s,a+1)*h+"%";return(b,T)=>(pi(),ki(on,null,[Fi(zt(wx)),QS,Fi(zt(OS)),Fi(zt(JS))],64))}});const tI={xmlns:"http://www.w3.org/2000/svg",height:"48",width:"48"},iI=ut("path",{d:"m24 30.75-12-12 2.15-2.15L24 26.5l9.85-9.85L36 18.8Z"},null,-1),nI=[iI];function rI(t,e){return pi(),ki("svg",tI,nI)}const sI={render:rI},oI={class:"scroll-down-button-wrapper"},aI=sr({__name:"ScrollDownButton",setup(t){function e(){document.querySelector("[href='#expertise']").scrollIntoView()}return(i,s)=>(pi(),ki("div",oI,[ut("div",{class:"scroll-down-button",onClick:e},[(pi(),ta(Cd(zt(sI)),{class:"arrow-down"}))])]))}});const lI={hi:"Hi!",i:"I'm ",profession:"web developer",description:"Software, front end & app developer"},cI={hi:"Salut !",i:"C'est ",profession:"d\xE9veloppeur web",description:"Web, logiciel & application"},uI={hi:"Hallo !",i:"Ich bin ",profession:"Web-Entwickler",description:"Software, Frontend & App Entwickler"},hI={en:lI,fr:cI,de:uI},dI=ut("a",{href:"#welcome"},null,-1),fI={class:"home"},pI={class:"welcome-text"},mI=ut("span",{class:"main-color"},"E",-1),gI={class:"one-line-description"},Ex=sr({__name:"WelcomeView",setup(t){const e=sc(),{language:i}=rc(e),s=Qi(()=>hI[i.value]);return(a,h)=>(pi(),ki(on,null,[dI,ut("div",fI,[ut("div",pI,[ut("span",null,Rn(zt(s).hi),1),ut("span",null,[mm(Rn(zt(s).i),1),mI,mm("rwan,")]),ut("span",null,Rn(zt(s).profession),1)]),ut("span",gI,Rn(zt(s).description),1),Fi(zt(aI))])],64))}});const _I={class:"expertise-item"},yI={class:"expertise-header"},vI={class:"title-wrapper"},xI={class:"title"},bI={class:"title underline"},wI={class:"expertise-body"},EI=ut("span",null,Rn("<h3>"),-1),TI={class:"expertise-text"},AI=ut("span",null,Rn("</h3>"),-1),Ap=sr({__name:"ExpertiseItem",props:{svg:null,title1:null,title2:null,text:null,color:null},setup(t){const e=t;return xg(i=>({"0a70d00f":e.color})),(i,s)=>(pi(),ki("div",_I,[ut("div",yI,[(pi(),ta(Cd(e.svg),{class:"icon"})),ut("div",vI,[ut("span",xI,Rn(e.title1),1),ut("span",bI,Rn(e.title2),1)])]),ut("div",wI,[EI,ut("span",TI,Rn(e.text),1),AI])]))}});const SI={xmlns:"http://www.w3.org/2000/svg",height:"48",width:"48"},II=ut("path",{d:"M18.3 40v-1.55h4.15V34H8.75q-1.15 0-1.95-.8T6 31.25v-20.5q0-1.15.8-1.95T8.75 8h30.5q1.15 0 1.95.8t.8 1.95v20.5q0 1.15-.8 1.95t-1.95.8h-13.7v4.45h4.15V40Zm-9.55-7.55h30.5q.45 0 .825-.375.375-.375.375-.825v-20.5q0-.45-.375-.825-.375-.375-.825-.375H8.75q-.45 0-.825.375-.375.375-.375.825v20.5q0 .45.375.825.375.375.825.375Zm-1.2 0V9.55v22.9Z"},null,-1),PI=[II];function MI(t,e){return pi(),ki("svg",SI,PI)}const CI={render:MI},LI={xmlns:"http://www.w3.org/2000/svg",width:"50",height:"50"},kI=ut("path",{d:"M34.555 3.984c-.78-.026-1.596.11-2.414.375-1.637.53-3.352 1.565-5.112 2.996a31.739 31.739 0 0 0-2.084 1.883A31.625 31.625 0 0 0 22.906 7.4c-1.758-1.43-3.468-2.462-5.101-2.992-1.633-.53-3.258-.546-4.592.225-1.334.77-2.132 2.184-2.49 3.863-.358 1.679-.32 3.678.039 5.916.125.778.305 1.593.508 2.424-.763.231-1.503.474-2.19.742-2.072.81-3.787 1.778-5.035 2.93-1.249 1.152-2.055 2.55-2.055 4.086 0 1.535.806 2.932 2.055 4.084C5.293 29.83 7.008 30.8 9.08 31.609c.734.287 1.53.545 2.35.79a32.188 32.188 0 0 0-.698 3.187c-.36 2.24-.397 4.24-.039 5.922.36 1.682 1.157 3.105 2.498 3.879 1.341.774 2.973.755 4.61.224 1.636-.53 3.35-1.562 5.11-2.994a31.643 31.643 0 0 0 2.066-1.863c.695.677 1.39 1.315 2.076 1.873 1.758 1.43 3.47 2.463 5.103 2.992 1.633.53 3.256.546 4.59-.224s2.132-2.185 2.49-3.864c.358-1.678.319-3.678-.04-5.916a32.131 32.131 0 0 0-.7-3.195c.848-.25 1.668-.515 2.424-.81 2.072-.81 3.787-1.78 5.035-2.932 1.249-1.152 2.055-2.549 2.055-4.084 0-1.536-.806-2.934-2.055-4.086-1.248-1.152-2.963-2.12-5.035-2.93a30.001 30.001 0 0 0-2.223-.752c.205-.836.386-1.657.512-2.44.36-2.24.398-4.24.039-5.923-.359-1.683-1.159-3.103-2.5-3.877-.67-.387-1.414-.575-2.193-.602zm-.092 2.036c.49.013.907.13 1.264.335.714.413 1.241 1.215 1.523 2.536.282 1.32.272 3.104-.06 5.173-.114.709-.28 1.46-.467 2.229a46.396 46.396 0 0 0-6.674-1.072 48.157 48.157 0 0 0-3.676-4.518 29.432 29.432 0 0 1 1.947-1.76c1.626-1.322 3.165-2.222 4.45-2.638.642-.209 1.204-.299 1.693-.285zm-18.977.005c.492-.013 1.055.077 1.7.286 1.288.417 2.83 1.317 4.457 2.64a29.326 29.326 0 0 1 1.906 1.72 48.309 48.309 0 0 0-3.701 4.56c-2.38.218-4.613.587-6.649 1.082a28.836 28.836 0 0 1-.463-2.22c-.332-2.07-.34-3.857-.058-5.18.282-1.325.814-2.132 1.535-2.548.36-.208.781-.326 1.273-.34zm9.49 6.118c.815.886 1.63 1.856 2.438 2.9A57.87 57.87 0 0 0 25 14.99c-.833 0-1.652.02-2.46.055a45.06 45.06 0 0 1 2.437-2.902zM25 17.01c1.36 0 2.685.056 3.975.15a56.84 56.84 0 0 1 2.58 4.057 57.157 57.157 0 0 1 1.98 3.752 57.171 57.171 0 0 1-2.008 3.802 57.142 57.142 0 0 1-2.011 3.215c-1.457.122-2.966.19-4.516.19a54.15 54.15 0 0 1-4.62-.2 57.237 57.237 0 0 1-1.978-3.167 57.122 57.122 0 0 1-2.002-3.793 57.037 57.037 0 0 1 2.012-3.817 56.736 56.736 0 0 1 2.568-4.035A54.3 54.3 0 0 1 25 17.01zm6.55.4c1.649.206 3.196.492 4.636.834a45.018 45.018 0 0 1-1.592 4.375c-.414-.798-.843-1.6-1.307-2.402a60.116 60.116 0 0 0-1.736-2.807zm-13.206.016c-.58.89-1.15 1.799-1.7 2.752-.469.813-.907 1.625-1.326 2.433a45 45 0 0 1-1.58-4.35 42.914 42.914 0 0 1 4.606-.835zm19.82 1.35c.709.214 1.394.438 2.022.683 1.91.746 3.42 1.63 4.4 2.533.98.904 1.404 1.766 1.404 2.602 0 .836-.425 1.698-1.404 2.601-.98.904-2.49 1.787-4.4 2.534-.698.272-1.465.52-2.262.753a49.523 49.523 0 0 0-2.158-5.466 48.431 48.431 0 0 0 2.398-6.24zm-26.361.01a48.328 48.328 0 0 0 2.367 6.177A49.526 49.526 0 0 0 12 30.46a27.8 27.8 0 0 1-2.186-.732c-1.91-.747-3.42-1.63-4.4-2.534-.98-.903-1.404-1.765-1.404-2.601 0-.836.425-1.698 1.404-2.602.98-.904 2.49-1.787 4.4-2.533a27.487 27.487 0 0 1 1.989-.674zM25 20c-2.75 0-5 2.25-5 5s2.25 5 5 5 5-2.25 5-5-2.25-5-5-5zm0 2c1.669 0 3 1.331 3 3s-1.331 3-3 3-3-1.331-3-3 1.331-3 3-3zm9.62 5.363c.524 1.241.98 2.456 1.362 3.627a42.87 42.87 0 0 1-3.83.7c.388-.62.771-1.25 1.145-1.897.469-.812.904-1.623 1.322-2.43zm-19.278.002c.42.812.858 1.627 1.33 2.444.37.64.746 1.263 1.129 1.875a42.765 42.765 0 0 1-3.819-.702c.382-1.167.838-2.38 1.36-3.617zm-1.936 5.559a45.9 45.9 0 0 0 5.852.972 49.298 49.298 0 0 0 4.29 5.391 29.372 29.372 0 0 1-1.927 1.744c-1.626 1.323-3.167 2.22-4.451 2.637-1.284.416-2.243.361-2.957-.05-.714-.413-1.24-1.215-1.522-2.536-.281-1.32-.273-3.103.059-5.172.15-.939.376-1.944.656-2.986zm23.155.008c.282 1.048.508 2.058.66 3.002.332 2.07.34 3.855.058 5.18-.282 1.324-.812 2.132-1.533 2.548-.72.416-1.686.472-2.975.055-1.288-.418-2.83-1.32-4.457-2.643a29.391 29.391 0 0 1-1.941-1.756 49.237 49.237 0 0 0 4.32-5.418 46 46 0 0 0 5.868-.968zm-14.694 1.17c1.027.056 2.067.093 3.133.093 1.03 0 2.037-.035 3.031-.088a46.038 46.038 0 0 1-3.084 3.74 46.198 46.198 0 0 1-3.08-3.745z"},null,-1),RI=[kI];function DI(t,e){return pi(),ki("svg",LI,RI)}const zI={render:DI},OI={xmlns:"http://www.w3.org/2000/svg",width:"50",height:"50"},FI=ut("path",{d:"M27 3a1 1 0 0 0-.707.293l-21 21a1 1 0 0 0 0 1.414l6 6a1 1 0 0 0 1.414 0l27-27A1 1 0 0 0 39 3H27zm.414 2h9.172L12 29.586 7.414 25l20-20zM28 22a1 1 0 0 0-.707.293l-12 12a1 1 0 0 0 0 1.414l6 6 6 6A1 1 0 0 0 28 48h12a1 1 0 0 0 .707-1.707L29.414 35l11.293-11.293A1 1 0 0 0 40 22H28zm.414 2h9.172L22 39.586 17.414 35l11-11zM28 36.414 37.586 46h-9.172l-5-5L28 36.414z"},null,-1),BI=[FI];function NI(t,e){return pi(),ki("svg",OI,BI)}const UI={render:NI},VI={title:"My expertise",expertises:[{title1:"Software",title2:"Development",text:"Experienced in OOP, especially with Python but also with Java. I also worked on back-end project using TypeScript."},{title1:"Frontend Dev.",title2:"Vue, React, Angular",text:"Passionate about UI/UX. With 3 years of experience, I worked on cross-platform projects (web, TV, mobile, ...) using different frameworks."},{title1:"Flutter Dev.",title2:"Android, iOS",text:"Curious about mobile app development, I\u2019m learning Flutter on my own project. I have also contributed to Android projects with Kotlin."}]},jI={title:"Mes comp\xE9tences",expertises:[{title1:"D\xE9veloppement de",title2:"logiciel",text:"Exp\xE9riment\xE9 en POO, surtout en Python mais \xE9galement en Java. J'ai \xE9galement travaill\xE9 sur des projets backend en TypeScript."},{title1:"Dev frontend.",title2:"Vue, React, Angular",text:"Passionn\xE9 d'UI/UX. Avec 3 ans d'exp\xE9rience, j'ai pu travailler sur des projets multiplateformes (web, TV, mobile, ...) avec diff\xE9rents frameworks."},{title1:"Flutter Dev.",title2:"Android, iOS",text:"Apr\xE8s quelques projets acad\xE9miques en Kotlin, j'affine mes connaissances en travaillant sur un projet personnel avec Flutter."}]},GI={title:"Mein Fachwissen",expertises:[{title1:"Software",title2:"Entwicklung",text:"Ich habe Erfahrung mit OOP, insbesondere mit Python, aber auch mit Java. Ich habe auch an Back-End-Projekten mit TypeScript gearbeitet."},{title1:"Frontend Entwicklung.",title2:"Vue, React, Angular",text:"Leidenschaftlich f\xFCr UI/UX. \xDCber 2 Jahre Erfahrung mit verschiedenen Frameworks und ein besonderes Augenmerk auf plattform\xFCbergreifende UI (Web, TV, Telefon, ...) "},{title1:"Flutter Entwicklung",title2:"Android, iOS",text:"Nach einigen akademischen Projekten in Kotlin verfeinere ich meine Kenntnisse, indem ich an einem pers\xF6nlichen Projekt mit Flutter arbeite."}]},f0={en:VI,fr:jI,de:GI},$I=ut("a",{href:"#expertise"},null,-1),HI={class:"expertise"},qI={class:"expertise-items-wrapper"},WI={class:"expertise-items"},Tx=sr({__name:"ExpertiseView",setup(t){const e=sc(),{language:i}=rc(e),s=Qi(()=>f0[i.value].expertises),a=Qi(()=>f0[i.value].title);return(h,p)=>(pi(),ki(on,null,[$I,ut("div",HI,[ut("h2",null,Rn(zt(a)),1),ut("div",qI,[ut("div",WI,[Fi(zt(Ap),{svg:zt(CI),title1:zt(s)[0].title1,title2:zt(s)[0].title2,text:zt(s)[0].text,color:"#DF058D"},null,8,["svg","title1","title2","text"]),Fi(zt(Ap),{svg:zt(zI),title1:zt(s)[1].title1,title2:zt(s)[1].title2,text:zt(s)[1].text,color:"#2C49D8"},null,8,["svg","title1","title2","text"]),Fi(zt(Ap),{svg:zt(UI),title1:zt(s)[2].title1,title2:zt(s)[2].title2,text:zt(s)[2].text,color:"#FF6B2B"},null,8,["svg","title1","title2","text"])])])])],64))}});const ZI={},Ax=t=>(Uv("data-v-4c5c24db"),t=t(),Vv(),t),XI={class:"timeline"},YI={class:"years"},KI={class:"year-text"},JI=Ax(()=>ut("div",{class:"vertical-year-line"},null,-1)),QI={class:"months"},eP=Ax(()=>ut("div",{class:"line"},null,-1));function tP(t,e){return pi(),ki("div",XI,[ut("div",YI,[(pi(),ki(on,null,Ga(6,i=>ut("div",{key:i,class:"year"},[ut("span",KI,Rn(2018+i),1),JI])),64))]),ut("div",QI,[(pi(),ki(on,null,Ga(83,i=>ut("div",{key:i,class:"month"})),64))]),eP])}const iP=Vu(ZI,[["render",tP],["__scopeId","data-v-4c5c24db"]]),nP={class:"experience-item"},rP=ut("div",{class:"experience-line"},null,-1),sP={class:"info"},oP={class:"subtitle"},p0=sr({__name:"ExperienceItem",props:{color:null,title:null,subtitle:null,start:null,end:null,isFirst:{type:Boolean}},setup(t){const e=t;xg(a=>({25237498:zt(i),fb4d03ba:zt(s),"0607e802":e.color}));const i=Qi(()=>e.isFirst?`${e.start*(100/85)}%`:"0%"),s=Qi(()=>`${(e.end-(e.isFirst?e.start:0))*(100/85)}%`);return(a,h)=>(pi(),ki("div",nP,[rP,ut("div",sP,[ut("span",null,Rn(e.title),1),ut("span",oP,Rn(e.subtitle),1)])]))}});const aP={title:"My experience",schoolExperiences:[{title:"2 years University Degree",subtitle:"IUT de Vannes",color:"#C7A700",start:8,end:33},{title:"Computer Science Engineering Degree ",subtitle:"ENSSAT Lannion",color:"#CA5E5E",start:0,end:36}],workExperiences:[{title:"Software developer",subtitle:"M\xE9t\xE9o France",color:"#229CAC",start:20,end:32},{title:"Frontend developer",subtitle:"Orange",color:"#ff6600",start:0,end:31},{title:"Frontend developer",subtitle:"Meteomatics",color:"#DEFD83",start:0,end:6}]},lP={title:"Mon exp\xE9rience",schoolExperiences:[{title:"DUT Informatique",subtitle:"IUT de Vannes",color:"#C7A700",start:8,end:33},{title:"Dipl\xF4me d'ing\xE9nieur en informatique",subtitle:"ENSSAT Lannion",color:"#CA5E5E",start:0,end:36}],workExperiences:[{title:"D\xE9veloppeur logiciel",subtitle:"M\xE9t\xE9o France",color:"#229CAC",start:20,end:32},{title:"D\xE9veloppeur frontend",subtitle:"Orange",color:"#ff6600",start:0,end:31}]},cP={title:"Meine Erfahrung",schoolExperiences:[{title:"Informatik zwei Jahre Universit\xE4tabschluss",subtitle:"IUT de Vannes",color:"#C7A700",start:8,end:33},{title:"Ingenieurdiplom in Informatik",subtitle:"ENSSAT Lannion",color:"#CA5E5E",start:0,end:36}],workExperiences:[{title:"Software-Entwickler",subtitle:"M\xE9t\xE9o France",color:"#229CAC",start:20,end:32},{title:"Frontend-Entwickler",subtitle:"Orange",color:"#ff6600",start:0,end:31}]},Sp={en:aP,fr:lP,de:cP},uP=t=>(Uv("data-v-a3630d1c"),t=t(),Vv(),t),hP=uP(()=>ut("a",{href:"#experience"},null,-1)),dP={class:"experience"},fP={class:"experience-title"},pP={class:"timeline-wrapper"},mP={class:"experiences"},gP={class:"school-experiences"},_P={class:"work-experiences"},yP=sr({__name:"ExperienceView",setup(t){const e=sc(),{language:i}=rc(e),s=Qi(()=>Sp[i.value].schoolExperiences),a=Qi(()=>Sp[i.value].workExperiences),h=Qi(()=>Sp[i.value].title);return(p,c)=>(pi(),ki(on,null,[hP,ut("div",dP,[ut("h2",fP,Rn(zt(h)),1),ut("div",pP,[Fi(zt(iP)),ut("div",mP,[ut("div",gP,[(pi(!0),ki(on,null,Ga(zt(s),(b,T)=>(pi(),ta(zt(p0),{key:T,color:b.color,title:b.title,subtitle:b.subtitle,start:b.start,end:b.end,"is-first":T===0},null,8,["color","title","subtitle","start","end","is-first"]))),128))]),ut("div",_P,[(pi(!0),ki(on,null,Ga(zt(a),(b,T)=>(pi(),ta(zt(p0),{key:T,color:b.color,title:b.title,subtitle:b.subtitle,start:b.start,end:b.end,"is-first":T===0},null,8,["color","title","subtitle","start","end","is-first"]))),128))])])])])],64))}});const Sx=Vu(yP,[["__scopeId","data-v-a3630d1c"]]),vP="/assets/boussole.1ebc1aaf.png",xP="/assets/map.910f79f5.png",bP="/assets/picture.50c613a9.jpg",wP="/assets/sweetch.0fe46ede.jpg",EP="/assets/sweetch.6ff90844.png",TP="/assets/youtongue.53632622.png",AP=["href"],SP={class:"project-image"},IP=["src"],PP={class:"project-info"},MP={class:"project-name"},CP={key:0,class:"coming-label"},LP={class:"project-type"},m0=sr({__name:"ProjectItem",props:{name:null,type:null,backgroundImage:null,url:null,coming:{type:Boolean}},setup(t){const e=t,i=new URL(Object.assign({"/src/assets/images/boussole.png":vP,"/src/assets/images/map.png":xP,"/src/assets/images/picture.jpg":bP,"/src/assets/images/sweetch.jpg":wP,"/src/assets/images/sweetch.png":EP,"/src/assets/images/youtongue.png":TP})[`/src/assets/images/${e.backgroundImage}`],self.location).href;return(s,a)=>(pi(),ki("a",{class:"project-item",href:e.url},[ut("div",SP,[ut("img",{src:zt(i),alt:""},null,8,IP)]),ut("div",PP,[ut("div",null,[ut("span",MP,Rn(e.name),1),e.coming?(pi(),ki("span",CP,"Coming soon")):nx("",!0)]),ut("span",LP,Rn(e.type),1)])],8,AP))}});const kP=[{name:"Sweetch",type:"Mobile app",backgroundImage:"sweetch.png",url:"javascript:;",coming:!0},{name:"Boussole",type:"JS/TS library",backgroundImage:"boussole.png",url:"/boussole/",coming:!1},{name:"YouTongue",type:"Website",backgroundImage:"youtongue.png",url:"/youtongue/",coming:!1}],RP={en:"My work",fr:"Mes projets",de:"Meine Projekte"},Jr={projects:kP,title:RP},DP=ut("a",{href:"#work"},null,-1),zP={class:"projects"},OP={class:"projects-list"},FP={class:"favorite-project"},BP={class:"other-projects"},Ix=sr({__name:"ProjectsView",setup(t){const e=sc(),{language:i}=rc(e),s=Qi(()=>Jr.title[i.value]);return(a,h)=>(pi(),ki(on,null,[DP,ut("div",zP,[ut("h2",null,Rn(zt(s)),1),ut("div",OP,[ut("div",FP,[Fi(zt(m0),{name:zt(Jr).projects[0].name,type:zt(Jr).projects[0].type,url:zt(Jr).projects[0].url,"background-image":zt(Jr).projects[0].backgroundImage,coming:zt(Jr).projects[0].coming},null,8,["name","type","url","background-image","coming"])]),ut("div",BP,[(pi(!0),ki(on,null,Ga(zt(Jr).projects,(p,c)=>(pi(),ki("div",{key:c},[c>0?(pi(),ta(zt(m0),{key:0,name:zt(Jr).projects[c].name,type:zt(Jr).projects[c].type,url:zt(Jr).projects[c].url,"background-image":zt(Jr).projects[c].backgroundImage,coming:zt(Jr).projects[c].coming},null,8,["name","type","url","background-image","coming"])):nx("",!0)]))),128))])])])],64))}});const NP="/assets/picture.50c613a9.jpg",UP={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24"},VP=ut("path",{d:"M0 0v24h24V0H0zm8 19H5V8h3v11zM6.5 6.732c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zM20 19h-3v-5.604c0-3.368-4-3.113-4 0V19h-3V8h3v1.765c1.397-2.586 7-2.777 7 2.476V19z"},null,-1),jP=[VP];function GP(t,e){return pi(),ki("svg",UP,jP)}const $P={render:GP},HP={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24"},qP=ut("path",{d:"M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"},null,-1),WP=[qP];function ZP(t,e){return pi(),ki("svg",HP,WP)}const XP={render:ZP},YP={title:"Contact me",text:"I am currently looking for a new opportunity in Geneva or in the surrounding area. For more information, feel free to contact me by email or by phone.",textButton:"Read my CV"},KP={title:"Me contacter",text:"Je suis actuellement \xE0 la recherche d'une opportunit\xE9 professionnelle \xE0 Gen\xE8ve ou dans les alentours. Pour plus d'information, n'h\xE9sitez pas \xE0 me contacter par mail ou par t\xE9l\xE9phone.",textButton:"Lire mon CV"},JP={title:"Kontakt",text:"Ich bin derzeit auf der Suche nach einer beruflichen Gelegenheit in Genf oder in der n\xE4heren Umgebung. F\xFCr weitere Informationen k\xF6nnen Sie mich gerne per E-Mail oder Telefon kontaktieren.",textButton:"Meinen Lebenslauf lesen"},Ip={en:YP,fr:KP,de:JP};function Mu(t){return Mu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mu(t)}function QP(t,e){if(Mu(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(Mu(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function eM(t){var e=QP(t,"string");return Mu(e)==="symbol"?e:String(e)}function U(t,e,i){return e=eM(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Dd(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Eg=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),g0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);g0&&parseFloat(g0[1]);const tM="3.3.3";function fo(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const vd=typeof process!="object"||String(process)!=="[object process]"||process.browser,iM=typeof window<"u"&&typeof window.orientation<"u",_0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);_0&&parseFloat(_0[1]);class nM{constructor(e,i){U(this,"name",void 0),U(this,"workerThread",void 0),U(this,"isRunning",!0),U(this,"result",void 0),U(this,"_resolve",()=>{}),U(this,"_reject",()=>{}),this.name=e,this.workerThread=i,this.result=new Promise((s,a)=>{this._resolve=s,this._reject=a})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){fo(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){fo(this.isRunning),this.isRunning=!1,this._reject(e)}}class Pp{terminate(){}}const Mp=new Map;function rM(t){fo(t.source&&!t.url||!t.source&&t.url);let e=Mp.get(t.source||t.url);return e||(t.url&&(e=sM(t.url),Mp.set(t.url,e)),t.source&&(e=Px(t.source),Mp.set(t.source,e))),fo(e),e}function sM(t){if(!t.startsWith("http"))return t;const e=oM(t);return Px(e)}function Px(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function oM(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function Mx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=arguments.length>2?arguments[2]:void 0;const s=i||new Set;if(t){if(y0(t))s.add(t);else if(y0(t.buffer))s.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const a in t)Mx(t[a],e,s)}}return i===void 0?Array.from(s):[]}function y0(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Cp=()=>{};class Em{static isSupported(){return typeof Worker<"u"&&vd||typeof Pp<"u"&&!vd}constructor(e){U(this,"name",void 0),U(this,"source",void 0),U(this,"url",void 0),U(this,"terminated",!1),U(this,"worker",void 0),U(this,"onMessage",void 0),U(this,"onError",void 0),U(this,"_loadableURL","");const{name:i,source:s,url:a}=e;fo(s||a),this.name=i,this.source=s,this.url=a,this.onMessage=Cp,this.onError=h=>console.log(h),this.worker=vd?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Cp,this.onError=Cp,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,i){i=i||Mx(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(i+="".concat(e.message," in ")),e.lineno&&(i+=":".concat(e.lineno,":").concat(e.colno)),new Error(i)}_createBrowserWorker(){this._loadableURL=rM({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Pp(s,{eval:!1})}else if(this.source)e=new Pp(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class aM{static isSupported(){return Em.isSupported()}constructor(e){U(this,"name","unnamed"),U(this,"source",void 0),U(this,"url",void 0),U(this,"maxConcurrency",1),U(this,"maxMobileConcurrency",1),U(this,"onDebug",()=>{}),U(this,"reuseWorkers",!0),U(this,"props",{}),U(this,"jobQueue",[]),U(this,"idleQueue",[]),U(this,"count",0),U(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(h,p,c)=>h.done(c),s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(h,p)=>h.error(p);const a=new Promise(h=>(this.jobQueue.push({name:e,onMessage:i,onError:s,onStart:h}),this));return this._startQueuedJob(),await a}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const s=new nM(i.name,e);e.onMessage=a=>i.onMessage(s,a.type,a.payload),e.onError=a=>i.onError(s,a),i.onStart(s);try{await s.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Em({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return iM?this.maxMobileConcurrency:this.maxConcurrency}}const lM={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class lo{static isSupported(){return Em.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return lo._workerFarm=lo._workerFarm||new lo({}),lo._workerFarm.setProps(e),lo._workerFarm}constructor(e){U(this,"props",void 0),U(this,"workerPools",new Map),this.props={...lM},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:s,url:a}=e;let h=this.workerPools.get(i);return h||(h=new aM({name:i,source:s,url:a}),h.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,h)),h}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}U(lo,"_workerFarm",void 0);const cM="latest";function uM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=e[t.id]||{},s="".concat(t.id,"-worker.js");let a=i.workerUrl;if(!a&&t.id==="compression"&&(a=e.workerUrl),e._workerType==="test"&&(a="modules/".concat(t.module,"/dist/").concat(s)),!a){let h=t.version;h==="latest"&&(h=cM);const p=h?"@".concat(h):"";a="https://unpkg.com/@loaders.gl/".concat(t.module).concat(p,"/dist/").concat(s)}return fo(a),a}function hM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:tM;fo(t,"no worker provided");const i=t.version;return!(!e||!i)}function dM(t,e){return!lo.isSupported()||!vd&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function fM(t,e,i,s,a){const h=t.id,p=uM(t,i),b=lo.getWorkerFarm(i).getWorkerPool({name:h,url:p});i=JSON.parse(JSON.stringify(i)),s=JSON.parse(JSON.stringify(s||{}));const T=await b.startJob("process-on-worker",pM.bind(null,a));return T.postMessage("process",{input:e,options:i,context:s}),await(await T.result).result}async function pM(t,e,i,s){switch(i){case"done":e.done(s);break;case"error":e.error(new Error(s.error));break;case"process":const{id:a,input:h,options:p}=s;try{const c=await t(h,p);e.postMessage("done",{id:a,result:c})}catch(c){const b=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:a,error:b})}break;default:console.warn("parse-with-worker unknown message ".concat(i))}}function mM(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const s=new Uint8Array(t),a=new Uint8Array(e);for(let h=0;h<s.length;++h)if(s[h]!==a[h])return!1;return!0}function gM(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const s=e.map(c=>c instanceof ArrayBuffer?new Uint8Array(c):c),a=s.reduce((c,b)=>c+b.byteLength,0),h=new Uint8Array(a);let p=0;for(const c of s)h.set(c,p),p+=c.byteLength;return h.buffer}async function _M(t){const e=[];for await(const i of t)e.push(i);return gM(...e)}function v0(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class x0{constructor(e,i){U(this,"name",void 0),U(this,"type",void 0),U(this,"sampleSize",1),U(this,"time",void 0),U(this,"count",void 0),U(this,"samples",void 0),U(this,"lastTiming",void 0),U(this,"lastSampleTime",void 0),U(this,"lastSampleCount",void 0),U(this,"_count",0),U(this,"_time",0),U(this,"_samples",0),U(this,"_startTime",0),U(this,"_timerPending",!1),this.name=e,this.type=i,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=v0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(v0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Tg{constructor(e){U(this,"id",void 0),U(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const i in this.stats)e(this.stats[i])}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(i=>this._getOrCreate(i))}_getOrCreate(e){if(!e||!e.name)return null;const{name:i,type:s}=e;return this.stats[i]||(e instanceof x0?this.stats[i]=e:this.stats[i]=new x0(i,s)),this.stats[i]}}let yM="";const b0={};function vM(t){for(const e in b0)if(t.startsWith(e)){const i=b0[e];t=t.replace(e,i)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(yM).concat(t)),t}function xM(t){return t&&typeof t=="object"&&t.isBuffer}function Cx(t){if(xM(t))return(void 0)(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function bM(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}const wM=t=>typeof t=="boolean",vu=t=>typeof t=="function",ju=t=>t!==null&&typeof t=="object",w0=t=>ju(t)&&t.constructor==={}.constructor,EM=t=>t&&typeof t[Symbol.iterator]=="function",TM=t=>t&&typeof t[Symbol.asyncIterator]=="function",oc=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ac=t=>typeof Blob<"u"&&t instanceof Blob,AM=t=>t&&typeof t=="object"&&t.isBuffer,SM=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||ju(t)&&vu(t.tee)&&vu(t.cancel)&&vu(t.getReader),IM=t=>ju(t)&&vu(t.read)&&vu(t.pipe)&&wM(t.readable),Lx=t=>SM(t)||IM(t),PM=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MM=/^([-\w.]+\/[-\w.+]+)/;function CM(t){const e=MM.exec(t);return e?e[1]:t}function E0(t){const e=PM.exec(t);return e?e[1]:""}const LM=/\?.*/;function cf(t){if(oc(t)){const e=Lp(t.url||""),i=t.headers.get("content-type")||"";return{url:e,type:CM(i)||E0(e)}}return ac(t)?{url:Lp(t.name||""),type:t.type||""}:typeof t=="string"?{url:Lp(t),type:E0(t)}:{url:"",type:""}}function kM(t){return oc(t)?t.headers["content-length"]||-1:ac(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function Lp(t){return t.replace(LM,"")}async function kx(t){if(oc(t))return t;const e={},i=kM(t);i>=0&&(e["content-length"]=String(i));const{url:s,type:a}=cf(t);a&&(e["content-type"]=a);const h=await zM(t);h&&(e["x-first-bytes"]=h),typeof t=="string"&&(t=new TextEncoder().encode(t));const p=new Response(t,{headers:e});return Object.defineProperty(p,"url",{value:s}),p}async function RM(t){if(!t.ok){const e=await DM(t);throw new Error(e)}}async function DM(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const i=t.headers.get("Content-Type");let s=t.statusText;i.includes("application/json")&&(s+=" ".concat(await t.text())),e+=s,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function zM(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const i=t.slice(0,5);return await new Promise(s=>{const a=new FileReader;a.onload=h=>{var p;return s(h==null||(p=h.target)===null||p===void 0?void 0:p.result)},a.readAsDataURL(i)})}if(t instanceof ArrayBuffer){const i=t.slice(0,5),s=OM(i);return"data:base64,".concat(s)}return null}function OM(t){let e="";const i=new Uint8Array(t);for(let s=0;s<i.byteLength;s++)e+=String.fromCharCode(i[s]);return btoa(e)}async function T0(t,e){if(typeof t=="string"){t=vM(t);let i=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(i=e.fetch),await fetch(t,i)}return await kx(t)}function Rx(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,i=t||e;return!!(i&&i.indexOf("Electron")>=0)}function _o(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Rx()}const xd={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},nd=xd.window||xd.self||xd.global,ru=xd.process||{},Dx=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";_o();const kp=globalThis;function zx(t){if(!t&&!_o())return"Node";if(Rx(t))return"Electron";const i=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(i.indexOf("Edge")>-1)return"Edge";const s=i.indexOf("MSIE ")!==-1,a=i.indexOf("Trident/")!==-1;return s||a?"IE":kp.chrome?"Chrome":kp.safari?"Safari":kp.mozInnerScreenX?"Firefox":"Unknown"}function FM(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class BM{constructor(e,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";U(this,"storage",void 0),U(this,"id",void 0),U(this,"config",void 0),this.storage=FM(s),this.id=e,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function NM(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function UM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const i=Math.max(e-t.length,0);return"".concat(" ".repeat(i)).concat(t)}function Rp(t,e,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const a=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>s&&(i=Math.min(i,s/t.width));const h=t.width*i,p=t.height*i,c=["font-size:1px;","padding:".concat(Math.floor(p/2),"px ").concat(Math.floor(h/2),"px;"),"line-height:".concat(p,"px;"),"background:url(".concat(a,");"),"background-size:".concat(h,"px ").concat(p,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),c]}let zd;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(zd||(zd={}));function A0(t){return typeof t=="string"?zd[t.toUpperCase()]||zd.WHITE:t}function VM(t,e,i){return!_o&&typeof t=="string"&&(e&&(e=A0(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),i&&(e=A0(i),t="\x1B[".concat(i+10,"m").concat(t,"\x1B[49m"))),t}function jM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const i=Object.getPrototypeOf(t),s=Object.getOwnPropertyNames(i);for(const a of s)typeof t[a]=="function"&&(e.find(h=>a===h)||(t[a]=t[a].bind(t)))}function Od(t,e){if(!t)throw new Error(e||"Assertion failed")}function Tl(){let t;if(_o&&"performance"in nd){var e,i;t=nd==null||(e=nd.performance)===null||e===void 0||(i=e.now)===null||i===void 0?void 0:i.call(e)}else if("hrtime"in ru){var s;const a=ru==null||(s=ru.hrtime)===null||s===void 0?void 0:s.call(ru);t=a[0]*1e3+a[1]/1e6}else t=Date.now();return t}const Al={debug:_o&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},GM={enabled:!0,level:0};function Qr(){}const S0={},I0={once:!0};class Gu{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};U(this,"id",void 0),U(this,"VERSION",Dx),U(this,"_startTs",Tl()),U(this,"_deltaTs",Tl()),U(this,"_storage",void 0),U(this,"userData",{}),U(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new BM("__probe-".concat(this.id,"__"),GM),this.timeStamp("".concat(this.id," started")),jM(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Tl()-this._startTs).toPrecision(10))}getDelta(){return Number((Tl()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.setConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){Od(e,i)}warn(e){return this._getLogFunction(0,e,Al.warn,arguments,I0)}error(e){return this._getLogFunction(0,e,Al.error,arguments)}deprecated(e,i){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(i,"` instead"))}removed(e,i){return this.error("`".concat(e,"` has been removed. Use `").concat(i,"` instead"))}probe(e,i){return this._getLogFunction(e,i,Al.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,Al.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){for(var s=arguments.length,a=new Array(s>2?s-2:0),h=2;h<s;h++)a[h-2]=arguments[h];return this._getLogFunction(e,i,Al.debug||Al.info,arguments,I0)}table(e,i,s){return i?this._getLogFunction(e,i,console.table||Qr,s&&[s],{tag:WM(i)}):Qr}image(e){let{logLevel:i,priority:s,image:a,message:h="",scale:p=1}=e;return this._shouldLog(i||s)?_o?qM({image:a,message:h,scale:p}):HM():Qr}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||Qr)}group(e,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const a=P0({logLevel:e,message:i,opts:s}),{collapsed:h}=s;return a.method=(h?console.groupCollapsed:console.group)||console.info,this._getLogFunction(a)}groupCollapsed(e,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,i,Object.assign({},s,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Qr)}withGroup(e,i,s){this.group(e,i)();try{s()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Ox(e)}_getLogFunction(e,i,s,a,h){if(this._shouldLog(e)){h=P0({logLevel:e,message:i,args:a,opts:h}),s=s||h.method,Od(s),h.total=this.getTotal(),h.delta=this.getDelta(),this._deltaTs=Tl();const p=h.tag||h.message;if(h.once)if(!S0[p])S0[p]=Tl();else return Qr;return i=$M(this.id,h.message,h),s.bind(console,i,...h.args)}return Qr}}U(Gu,"VERSION",Dx);function Ox(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Od(Number.isFinite(e)&&e>=0),e}function P0(t){const{logLevel:e,message:i}=t;t.logLevel=Ox(e);const s=t.args?Array.from(t.args):[];for(;s.length&&s.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&s.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const a=typeof t.message;return Od(a==="string"||a==="object"),Object.assign(t,{args:s},t.opts)}function $M(t,e,i){if(typeof e=="string"){const s=i.time?UM(NM(i.total)):"";e=i.time?"".concat(t,": ").concat(s,"  ").concat(e):"".concat(t,": ").concat(e),e=VM(e,i.color,i.background)}return e}function HM(t){return console.warn("removed"),Qr}function qM(t){let{image:e,message:i="",scale:s=1}=t;if(typeof e=="string"){const h=new Image;return h.onload=()=>{const p=Rp(h,i,s);console.log(...p)},h.src=e,Qr}const a=e.nodeName||"";if(a.toLowerCase()==="img")return console.log(...Rp(e,i,s)),Qr;if(a.toLowerCase()==="canvas"){const h=new Image;return h.onload=()=>console.log(...Rp(h,i,s)),h.src=e.toDataURL(),Qr}return Qr}function WM(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}const M0=new Gu({id:"loaders.gl"});class ZM{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class XM{constructor(){U(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return this.console.log.bind(this.console,...i)}info(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return this.console.info.bind(this.console,...i)}warn(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return this.console.warn.bind(this.console,...i)}error(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return this.console.error.bind(this.console,...i)}}const Fx={fetch:null,mimeType:void 0,nothrow:!1,log:new XM,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Eg,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},YM={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Bx(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const Nx=()=>{const t=Bx();return t.globalOptions=t.globalOptions||{...Fx},t.globalOptions};function KM(t,e,i,s){return i=i||[],i=Array.isArray(i)?i:[i],JM(t,i),eC(e,t,s)}function Ux(t,e){const i=Nx(),s=t||i;return typeof s.fetch=="function"?s.fetch:ju(s.fetch)?a=>T0(a,s):e!=null&&e.fetch?e==null?void 0:e.fetch:T0}function JM(t,e){C0(t,null,Fx,YM,e);for(const i of e){const s=t&&t[i.id]||{},a=i.options&&i.options[i.id]||{},h=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};C0(s,i.id,a,h,e)}}function C0(t,e,i,s,a){const h=e||"Top level",p=e?"".concat(e,"."):"";for(const c in t){const b=!e&&ju(t[c]),T=c==="baseUri"&&!e,P=c==="workerUrl"&&e;if(!(c in i)&&!T&&!P){if(c in s)M0.warn("".concat(h," loader option '").concat(p).concat(c,"' no longer supported, use '").concat(s[c],"'"))();else if(!b){const k=QM(c,a);M0.warn("".concat(h," loader option '").concat(p).concat(c,"' not recognized. ").concat(k))()}}}}function QM(t,e){const i=t.toLowerCase();let s="";for(const a of e)for(const h in a.options){if(t===h)return"Did you mean '".concat(a.id,".").concat(h,"'?");const p=h.toLowerCase();(i.startsWith(p)||p.startsWith(i))&&(s=s||"Did you mean '".concat(a.id,".").concat(h,"'?"))}return s}function eC(t,e,i){const a={...t.options||{}};return tC(a,i),a.log===null&&(a.log=new ZM),L0(a,Nx()),L0(a,e),a}function L0(t,e){for(const i in e)if(i in e){const s=e[i];w0(s)&&w0(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function tC(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Ag(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Sg(t){var e,i;Dd(t,"null loader"),Dd(Ag(t),"invalid loader");let s;return Array.isArray(t)&&(s=t[1],t=t[0],t={...t,options:{...t.options,...s}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(i=t)!==null&&i!==void 0&&i.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Vx=()=>{const t=Bx();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function iC(t){const e=Vx();t=Array.isArray(t)?t:[t];for(const i of t){const s=Sg(i);e.find(a=>s===a)||e.unshift(s)}}function nC(){return Vx()}const rC=new Gu({id:"loaders.gl"}),sC=/\.([^.]+)$/;async function oC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!jx(t))return null;let a=k0(t,e,{...i,nothrow:!0},s);if(a)return a;if(ac(t)&&(t=await t.slice(0,10).arrayBuffer(),a=k0(t,e,i,s)),!a&&!(i!=null&&i.nothrow))throw new Error(Gx(t));return a}function k0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!jx(t))return null;if(e&&!Array.isArray(e))return Sg(e);let a=[];e&&(a=a.concat(e)),i!=null&&i.ignoreRegisteredLoaders||a.push(...nC()),lC(a);const h=aC(t,a,i,s);if(!h&&!(i!=null&&i.nothrow))throw new Error(Gx(t));return h}function aC(t,e,i,s){const{url:a,type:h}=cf(t),p=a||(s==null?void 0:s.url);let c=null,b="";if(i!=null&&i.mimeType&&(c=Dp(e,i==null?void 0:i.mimeType),b="match forced by supplied MIME type ".concat(i==null?void 0:i.mimeType)),c=c||cC(e,p),b=b||(c?"matched url ".concat(p):""),c=c||Dp(e,h),b=b||(c?"matched MIME type ".concat(h):""),c=c||hC(e,t),b=b||(c?"matched initial data ".concat($x(t)):""),c=c||Dp(e,i==null?void 0:i.fallbackMimeType),b=b||(c?"matched fallback MIME type ".concat(h):""),b){var T;rC.log(1,"selectLoader selected ".concat((T=c)===null||T===void 0?void 0:T.name,": ").concat(b,"."))}return c}function jx(t){return!(t instanceof Response&&t.status===204)}function Gx(t){const{url:e,type:i}=cf(t);let s="No valid loader found (";s+=e?"".concat(bM(e),", "):"no url provided, ",s+="MIME type: ".concat(i?'"'.concat(i,'"'):"not provided",", ");const a=t?$x(t):"";return s+=a?' first bytes: "'.concat(a,'"'):"first bytes: not available",s+=")",s}function lC(t){for(const e of t)Sg(e)}function cC(t,e){const i=e&&sC.exec(e),s=i&&i[1];return s?uC(t,s):null}function uC(t,e){e=e.toLowerCase();for(const i of t)for(const s of i.extensions)if(s.toLowerCase()===e)return i;return null}function Dp(t,e){for(const i of t)if(i.mimeTypes&&i.mimeTypes.includes(e)||e==="application/x.".concat(i.id))return i;return null}function hC(t,e){if(!e)return null;for(const i of t)if(typeof e=="string"){if(dC(e,i))return i}else if(ArrayBuffer.isView(e)){if(R0(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&R0(e,0,i))return i;return null}function dC(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(s=>t.startsWith(s))}function R0(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(a=>fC(t,e,i,a))}function fC(t,e,i,s){if(s instanceof ArrayBuffer)return mM(s,t,s.byteLength);switch(typeof s){case"function":return s(t,i);case"string":const a=Tm(t,e,s.length);return s===a;default:return!1}}function $x(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Tm(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Tm(t,0,e):""}function Tm(t,e,i){if(t.byteLength<e+i)return"";const s=new DataView(t);let a="";for(let h=0;h<i;h++)a+=String.fromCharCode(s.getUint8(e+h));return a}const pC=256*1024;function*mC(t,e){const i=(e==null?void 0:e.chunkSize)||pC;let s=0;const a=new TextEncoder;for(;s<t.length;){const h=Math.min(t.length-s,i),p=t.slice(s,s+h);s+=h,yield a.encode(p)}}const gC=256*1024;function*_C(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{chunkSize:i=gC}=e;let s=0;for(;s<t.byteLength;){const a=Math.min(t.byteLength-s,i),h=new ArrayBuffer(a),p=new Uint8Array(t,s,a);new Uint8Array(h).set(p),s+=a,yield h}}const yC=1024*1024;async function*vC(t,e){const i=(e==null?void 0:e.chunkSize)||yC;let s=0;for(;s<t.size;){const a=s+i,h=await t.slice(s,a).arrayBuffer();s=a,yield h}}function D0(t,e){return Eg?xC(t,e):bC(t)}async function*xC(t,e){const i=t.getReader();let s;try{for(;;){const a=s||i.read();e!=null&&e._streamReadAhead&&(s=i.read());const{done:h,value:p}=await a;if(h)return;yield Cx(p)}}catch{i.releaseLock()}}async function*bC(t,e){for await(const i of t)yield Cx(i)}function wC(t,e){if(typeof t=="string")return mC(t,e);if(t instanceof ArrayBuffer)return _C(t,e);if(ac(t))return vC(t,e);if(Lx(t))return D0(t,e);if(oc(t))return D0(t.body,e);throw new Error("makeIterator")}const Hx="Cannot convert supplied data type";function EC(t,e,i){if(e.text&&typeof t=="string")return t;if(AM(t)&&(t=t.buffer),t instanceof ArrayBuffer){const s=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let s=t.buffer;const a=t.byteLength||t.length;return(t.byteOffset!==0||a!==s.byteLength)&&(s=s.slice(t.byteOffset,t.byteOffset+a)),s}throw new Error(Hx)}async function TC(t,e,i){const s=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||s)return EC(t,e);if(ac(t)&&(t=await kx(t)),oc(t)){const a=t;return await RM(a),e.binary?await a.arrayBuffer():await a.text()}if(Lx(t)&&(t=wC(t,i)),EM(t)||TM(t))return _M(t);throw new Error(Hx)}function AC(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(i)return i;const s={fetch:Ux(e,t),...t};return Array.isArray(s.loaders)||(s.loaders=null),s}function SC(t,e){if(!e&&t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const s=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...s]:s}return i&&i.length?i:null}async function Ig(t,e,i,s){fo(!s||typeof s=="object"),e&&!Array.isArray(e)&&!Ag(e)&&(s=void 0,i=e,e=void 0),t=await t,i=i||{};const{url:a}=cf(t),p=SC(e,s),c=await oC(t,p,i);return c?(i=KM(i,c,p,a),s=AC({url:a,parse:Ig,loaders:p},i,s),await IC(c,t,i,s)):null}async function IC(t,e,i,s){if(hM(t),oc(e)){const a=e,{ok:h,redirected:p,status:c,statusText:b,type:T,url:P}=a,k=Object.fromEntries(a.headers.entries());s.response={headers:k,ok:h,redirected:p,status:c,statusText:b,type:T,url:P}}if(e=await TC(e,t,i),t.parseTextSync&&typeof e=="string")return i.dataType="text",t.parseTextSync(e,i,s,t);if(dM(t,i))return await fM(t,e,i,s,Ig);if(t.parseText&&typeof e=="string")return await t.parseText(e,i,s,t);if(t.parse)return await t.parse(e,i,s,t);throw fo(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function Fd(t,e,i,s){!Array.isArray(e)&&!Ag(e)&&(i=e,e=void 0);const a=Ux(i);let h=t;return typeof t=="string"&&(h=await a(t)),ac(t)&&(h=await a(t)),await Ig(h,e,i)}const PC="3.3.3",{_parseImageNode:MC}=globalThis,Am=typeof Image<"u",Sm=typeof ImageBitmap<"u",CC=Boolean(MC),Im=Eg?!0:CC;function LC(t){switch(t){case"auto":return Sm||Am||Im;case"imagebitmap":return Sm;case"image":return Am;case"data":return Im;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function kC(){if(Sm)return"imagebitmap";if(Am)return"image";if(Im)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function RC(t){const e=zC(t);if(!e)throw new Error("Not an image");return e}function DC(t){switch(RC(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function zC(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const OC=/^data:image\/svg\+xml/,FC=/\.svg((\?|#).*)?$/;function Pg(t){return t&&(OC.test(t)||FC.test(t))}function BC(t,e){if(Pg(e)){let s=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(s=unescape(encodeURIComponent(s)))}catch(h){throw new Error(h.message)}return"data:image/svg+xml;base64,".concat(btoa(s))}return qx(t,e)}function qx(t,e){if(Pg(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Wx(t,e,i){const s=BC(t,i),a=self.URL||self.webkitURL,h=typeof s!="string"&&a.createObjectURL(s);try{return await NC(h||s,e)}finally{h&&a.revokeObjectURL(h)}}async function NC(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((s,a)=>{try{i.onload=()=>s(i),i.onerror=h=>a(new Error("Could not load image ".concat(t,": ").concat(h)))}catch(h){a(h)}})}const UC={};let z0=!0;async function VC(t,e,i){let s;Pg(i)?s=await Wx(t,e,i):s=qx(t,i);const a=e&&e.imagebitmap;return await jC(s,a)}async function jC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((GC(e)||!z0)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),z0=!1}return await createImageBitmap(t)}function GC(t){for(const e in t||UC)return!1;return!0}const Bs=!1,xu=!0;function Zx(t){const e=$u(t);return $C(e)||WC(e)||HC(e)||qC(e)}function $C(t){const e=$u(t);return e.byteLength>=24&&e.getUint32(0,Bs)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Bs),height:e.getUint32(20,Bs)}:null}function HC(t){const e=$u(t);return e.byteLength>=10&&e.getUint32(0,Bs)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,xu),height:e.getUint16(8,xu)}:null}function qC(t){const e=$u(t);return e.byteLength>=14&&e.getUint16(0,Bs)===16973&&e.getUint32(2,xu)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,xu),height:e.getUint32(22,xu)}:null}function WC(t){const e=$u(t);if(!(e.byteLength>=3&&e.getUint16(0,Bs)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:s,sofMarkers:a}=ZC();let h=2;for(;h+9<e.byteLength;){const p=e.getUint16(h,Bs);if(a.has(p))return{mimeType:"image/jpeg",height:e.getUint16(h+5,Bs),width:e.getUint16(h+7,Bs)};if(!s.has(p))return null;h+=2,h+=e.getUint16(h,Bs)}return null}function ZC(){const t=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)t.add(i);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function $u(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function XC(t,e){const{mimeType:i}=Zx(t)||{},s=globalThis._parseImageNode;return Dd(s),await s(t,i)}async function YC(t,e,i){e=e||{};const a=(e.image||{}).type||"auto",{url:h}=i||{},p=KC(a);let c;switch(p){case"imagebitmap":c=await VC(t,e,h);break;case"image":c=await Wx(t,e,h);break;case"data":c=await XC(t);break;default:Dd(!1)}return a==="data"&&(c=DC(c)),c}function KC(t){switch(t){case"auto":case"data":return kC();default:return LC(t),t}}const JC=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],QC=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],e3={image:{type:"auto",decode:!0}},t3={id:"image",module:"images",name:"Images",version:PC,mimeTypes:QC,extensions:JC,parse:YC,tests:[t=>Boolean(Zx(new DataView(t)))],options:e3},Vi=new Gu({id:"deck"});let Pm={};function i3(t){Pm=t}function _r(t,e,i,s){Vi.level>0&&Pm[t]&&Pm[t].call(null,e,i,s)}function n3(t){const e=t[0],i=t[t.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const r3={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:n3,parseTextSync:JSON.parse};function s3(){const t="8.9.7",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(Vi.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Vi,_registerLoggers:i3},iC([r3,[t3,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const o3=s3(),Oi={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Oi,"IDENTITY",{get:()=>(Vi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ns={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Mm={common:0,meters:1,pixels:2},O0={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Nt=new Gu({id:"luma.gl"});function yr(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const a3="Invalid WebGLRenderingContext",l3="Requires WebGL2";function uf(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function yi(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function c3(t){return yi(t)?t:null}function hf(t){return yr(uf(t),a3),t}function rr(t){return yr(yi(t),l3),t}const hu={};function u3(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function h3(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function d3(t,e){hu[t]=!0,e!==void 0&&u3(e)}function f3(t){const e=t.getError;t.getError=function(){let s;do s=e.apply(t),s!==0&&(hu[s]=!0);while(s!==0);for(s in hu)if(hu[s])return delete hu[s],parseInt(s,10);return 0}}const Hu=function t(e){const i=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let s=0;s<this.attribs.length;s++){const a=new t.VertexAttrib(i);this.attribs[s]=a}this.maxAttrib=0};Hu.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Hu.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Za=function(e){const i=this;this.gl=e,f3(e);const s=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(h){return h===i.VERTEX_ARRAY_BINDING_OES?i.currentVertexArrayObject===i.defaultVertexArrayObject?null:i.currentVertexArrayObject:s.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(h){const p=i.currentVertexArrayObject;p.maxAttrib=Math.max(p.maxAttrib,h);const c=p.attribs[h];return c.enabled=!0,s.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(h){const p=i.currentVertexArrayObject;p.maxAttrib=Math.max(p.maxAttrib,h);const c=p.attribs[h];return c.enabled=!1,s.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(h,p){switch(h){case 34962:i.currentArrayBuffer=p;break;case 34963:i.currentVertexArrayObject.elementArrayBuffer=p;break}return s.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(h,p){const b=i.currentVertexArrayObject.attribs[h];switch(p){case 34975:return b.buffer;case 34338:return b.enabled;case 34339:return b.size;case 34340:return b.stride;case 34341:return b.type;case 34922:return b.normalized;default:return s.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(h,p,c,b,T,P){const k=i.currentVertexArrayObject;k.maxAttrib=Math.max(k.maxAttrib,h);const C=k.attribs[h];return C.buffer=i.currentArrayBuffer,C.size=p,C.type=c,C.normalized=b,C.stride=T,C.offset=P,C.recache(),s.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{h3("OESVertexArrayObject emulation library context restored"),i.reset_()},!0),this.reset_()};Za.prototype.VERTEX_ARRAY_BINDING_OES=34229;Za.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let s=0;s<this.vertexArrayObjects.length;++s)this.vertexArrayObjects.isAlive=!1;const i=this.gl;this.maxVertexAttribs=i.getParameter(34921),this.defaultVertexArrayObject=new Hu(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Za.prototype.createVertexArrayOES=function(){const e=new Hu(this);return this.vertexArrayObjects.push(e),e};Za.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Za.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Hu&&e.hasBeenBound&&e.ext===this)};Za.prototype.bindVertexArrayOES=function(e){const i=this.gl;if(e&&!e.isAlive){d3(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const s=this.original,a=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const h=this.currentVertexArrayObject;if(a===h)return;(!a||h.elementArrayBuffer!==a.elementArrayBuffer)&&s.bindBuffer.call(i,34963,h.elementArrayBuffer);let p=this.currentArrayBuffer;const c=Math.max(a?a.maxAttrib:0,h.maxAttrib);for(let b=0;b<=c;b++){const T=h.attribs[b],P=a?a.attribs[b]:null;if((!a||T.enabled!==P.enabled)&&(T.enabled?s.enableVertexAttribArray.call(i,b):s.disableVertexAttribArray.call(i,b)),T.enabled){let k=!1;(!a||T.buffer!==P.buffer)&&(p!==T.buffer&&(s.bindBuffer.call(i,34962,T.buffer),p=T.buffer),k=!0),(k||T.cached!==P.cached)&&s.vertexAttribPointer.call(i,b,T.size,T.type,T.normalized,T.stride,T.offset)}}this.currentArrayBuffer!==p&&s.bindBuffer.call(i,34962,this.currentArrayBuffer)};function p3(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const a=e.call(this)||[];return a.indexOf("OES_vertex_array_object")<0&&a.push("OES_vertex_array_object"),a};const i=t.getExtension;t.getExtension=function(a){const h=i.call(this,a);return h||(a!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Za(this)),this.__OESVertexArrayObject))}}const F0="OES_element_index",B0="WEBGL_draw_buffers",m3="EXT_disjoint_timer_query",g3="EXT_disjoint_timer_query_webgl2",_3="EXT_texture_filter_anisotropic",N0="WEBGL_debug_renderer_info",y3=35723,v3=4352,x3=36795,b3=34047,w3=37445,E3=37446,Xi=t=>yi(t)?void 0:0,T3={[3074]:t=>yi(t)?void 0:36064,[y3]:t=>yi(t)?void 0:v3,[35977]:Xi,[32937]:Xi,[x3]:(t,e)=>{const i=yi(t)?t.getExtension(g3):t.getExtension(m3);return i&&i.GPU_DISJOINT_EXT?e(i.GPU_DISJOINT_EXT):0},[w3]:(t,e)=>{const i=t.getExtension(N0);return e(i&&i.UNMASKED_VENDOR_WEBGL||7936)},[E3]:(t,e)=>{const i=t.getExtension(N0);return e(i&&i.UNMASKED_RENDERER_WEBGL||7937)},[b3]:(t,e)=>{const i=t.luma.extensions[_3];return i?e(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:Xi,[35071]:Xi,[37447]:Xi,[36063]:(t,e)=>{if(!yi(t)){const i=t.getExtension(B0);return i?e(i.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:Xi,[35374]:Xi,[35377]:Xi,[34852]:t=>{if(!yi(t)){const e=t.getExtension(B0);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(F0)?2147483647:65535,[33001]:t=>t.getExtension(F0)?16777216:65535,[33e3]:t=>16777216,[37157]:Xi,[35373]:Xi,[35657]:Xi,[36183]:Xi,[37137]:Xi,[34045]:Xi,[35978]:Xi,[35979]:Xi,[35968]:Xi,[35376]:Xi,[35375]:Xi,[35659]:Xi,[37154]:Xi,[35371]:Xi,[35658]:Xi,[35076]:Xi,[35077]:Xi,[35380]:Xi};function A3(t,e,i){const s=T3[i],a=typeof s=="function"?s(t,e,i):s;return a!==void 0?a:e(i)}const S3="OES_vertex_array_object",Xx="ANGLE_instanced_arrays",I3="WEBGL_draw_buffers",P3="EXT_disjoint_timer_query",M3="EXT_texture_filter_anisotropic",C3="VertexArray requires WebGL2 or OES_vertex_array_object extension";function L3(t,e){return{webgl2:yi(t),ext:t.getExtension(e)}}const Yx={[S3]:{meta:{suffix:"OES"},createVertexArray:()=>{yr(!1,C3)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Xx]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){yr(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[I3]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{yr(!1)}},[P3]:{meta:{suffix:"EXT"},createQuery:()=>{yr(!1)},deleteQuery:()=>{yr(!1)},beginQuery:()=>{yr(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},zp={readBuffer:(t,e,i)=>{yi(t)&&e(i)},getVertexAttrib:(t,e,i,s)=>{const{webgl2:a,ext:h}=L3(t,Xx);let p;switch(s){case 35069:p=a?void 0:!1;break;case 35070:p=!a&&!h?0:void 0;break}return p!==void 0?p:e(i,s)},getProgramParameter:(t,e,i,s)=>{if(!yi(t))switch(s){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(i,s)},getInternalformatParameter:(t,e,i,s,a)=>{if(!yi(t))switch(a){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(i,s,a)},getTexParameter(t,e,i,s){switch(s){case 34046:const{extensions:a}=t.luma,h=a[M3];s=h&&h.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(i,s)},getParameter:A3,hint(t,e,i,s){return e(i,s)}};function k3(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(p3(t),R3(t),z3(t,Yx),D3(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=k3;function R3(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const i of e)t.luma[i]=t.getExtension(i)}function D3(t,e){let{target:i,target2:s}=e;Object.keys(zp).forEach(a=>{if(typeof zp[a]=="function"){const h=t[a]?t[a].bind(t):()=>{},p=zp[a].bind(null,t,h);i[a]=p,s[a]=p}})}function z3(t,e){for(const i of Object.getOwnPropertyNames(e))i!=="overrides"&&O3(t,{extension:i,target:t.luma,target2:t})}function O3(t,e){let{extension:i,target:s,target2:a}=e;const h=Yx[i];yr(h);const{meta:p={}}=h,{suffix:c=""}=p,b=t.getExtension(i);for(const T of Object.keys(h)){const P="".concat(T).concat(c);let k=null;T==="meta"||typeof t[T]=="function"||(b&&typeof b[P]=="function"?k=function(){return b[P](...arguments)}:typeof h[T]=="function"&&(k=h[T].bind(s))),k&&(s[T]=k,a[T]=k)}}const Mg={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Vo=(t,e,i)=>e?t.enable(i):t.disable(i),U0=(t,e,i)=>t.hint(i,e),Or=(t,e,i)=>t.pixelStorei(i,e),F3=(t,e)=>{const i=yi(t)?36009:36160;return t.bindFramebuffer(i,e)},B3=(t,e)=>t.bindFramebuffer(36008,e);function su(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const N3={[3042]:Vo,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:Vo,[2885]:(t,e)=>t.cullFace(e),[2929]:Vo,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:Vo,[35723]:U0,[36006]:F3,[2886]:(t,e)=>t.frontFace(e),[33170]:U0,[2849]:(t,e)=>t.lineWidth(e),[32823]:Vo,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Vo,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Vo,[3088]:(t,e)=>t.scissor(...e),[2960]:Vo,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:Or,[3317]:Or,[37440]:Or,[37441]:Or,[37443]:Or,[3330]:Or,[3332]:Or,[3331]:Or,[36010]:B3,[3314]:Or,[32878]:Or,[3316]:Or,[3315]:Or,[32877]:Or,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=su(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=su(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=su(e)?e:[e,e];const[i,s]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,s)},stencilFunc:(t,e)=>{e=su(e)&&e.length===3?[...e,...e]:e;const[i,s,a,h,p,c]=e;t.stencilFuncSeparate(1028,i,s,a),t.stencilFuncSeparate(1029,h,p,c)},stencilOp:(t,e)=>{e=su(e)&&e.length===3?[...e,...e]:e;const[i,s,a,h,p,c]=e;t.stencilOpSeparate(1028,i,s,a),t.stencilOpSeparate(1029,h,p,c)},viewport:(t,e)=>t.viewport(...e)};function yn(t,e,i){return e[t]!==void 0?e[t]:i[t]}const U3={blendEquation:(t,e,i)=>t.blendEquationSeparate(yn(32777,e,i),yn(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate(yn(32969,e,i),yn(32968,e,i),yn(32971,e,i),yn(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset(yn(32824,e,i),yn(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage(yn(32938,e,i),yn(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,yn(2962,e,i),yn(2967,e,i),yn(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,yn(34816,e,i),yn(36003,e,i),yn(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,yn(2964,e,i),yn(2965,e,i),yn(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,yn(34817,e,i),yn(34818,e,i),yn(34819,e,i))},V0={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({[36006]:i,[36010]:i});case 36009:return t({[36006]:i});case 36008:return t({[36010]:i});default:return null}},blendColor:(t,e,i,s,a)=>t({[32773]:new Float32Array([e,i,s,a])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,i)=>t({[32777]:e,[34877]:i}),blendFunc:(t,e,i)=>t({[32969]:e,[32968]:i,[32971]:e,[32970]:i}),blendFuncSeparate:(t,e,i,s,a)=>t({[32969]:e,[32968]:i,[32971]:s,[32970]:a}),clearColor:(t,e,i,s,a)=>t({[3106]:new Float32Array([e,i,s,a])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,i,s,a)=>t({[3107]:[e,i,s,a]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,i)=>t({[2928]:new Float32Array([e,i])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,i)=>t({[32824]:e,[10752]:i}),sampleCoverage:(t,e,i)=>t({[32938]:e,[32939]:i}),scissor:(t,e,i,s,a)=>t({[3088]:new Int32Array([e,i,s,a])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,i)=>t({[e===1028?2968:36005]:i}),stencilFunc:(t,e,i,s)=>t({[2962]:e,[2967]:i,[2963]:s,[34816]:e,[36003]:i,[36004]:s}),stencilFuncSeparate:(t,e,i,s,a)=>t({[e===1028?2962:34816]:i,[e===1028?2967:36003]:s,[e===1028?2963:36004]:a}),stencilOp:(t,e,i,s)=>t({[2964]:e,[2965]:i,[2966]:s,[34817]:e,[34818]:i,[34819]:s}),stencilOpSeparate:(t,e,i,s,a)=>t({[e===1028?2964:34817]:i,[e===1028?2965:34818]:s,[e===1028?2966:34819]:a}),viewport:(t,e,i,s,a)=>t({[2978]:[e,i,s,a]})},ks=(t,e)=>t.isEnabled(e),j0={[3042]:ks,[2884]:ks,[2929]:ks,[3024]:ks,[32823]:ks,[32926]:ks,[32928]:ks,[3089]:ks,[2960]:ks,[35977]:ks};function Kx(t){for(const e in t)return!1;return!0}function V3(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),s=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&s&&t.length===e.length){for(let a=0;a<t.length;++a)if(t[a]!==e[a])return!1;return!0}return!1}function G0(t,e){const i=t[e].bind(t);t[e]=function(){const a=arguments.length<=0?void 0:arguments[0];return a in t.state.cache?t.state.enable?t.state.cache[a]:i(...arguments):i(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function j3(t,e,i){const s=t[e].bind(t);t[e]=function(){for(var h=arguments.length,p=new Array(h),c=0;c<h;c++)p[c]=arguments[c];const{valueChanged:b,oldValue:T}=i(t.state._updateCache,...p);return b&&s(...p),T},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function G3(t){const e=t.useProgram.bind(t);t.useProgram=function(s){t.state.program!==s&&(e(s),t.state.program=s)}}class $3{constructor(e){let{copyState:i=!1,log:s=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=i?q3(e):Object.assign({},Mg),this.log=s,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){yr(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];po(this.gl,e),this.stateStack.pop()}_updateCache(e){let i=!1,s;const a=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const h in e){yr(h!==void 0);const p=e[h],c=this.cache[h];V3(p,c)||(i=!0,s=c,a&&!(h in a)&&(a[h]=c),this.cache[h]=p)}return{valueChanged:i,oldValue:s}}}function Jx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:i=!0,copyState:s}=e;if(yr(s!==void 0),!t.state){const{polyfillContext:a}=globalThis;a&&a(t),t.state=new $3(t,{copyState:s}),G3(t);for(const h in V0){const p=V0[h];j3(t,h,p)}G0(t,"getParameter"),G0(t,"isEnabled")}return t.state.enable=i,t}function H3(t){t.state||Jx(t,{copyState:!1}),t.state.push()}function $0(t){yr(t.state),t.state.pop()}function po(t,e){if(yr(uf(t),"setParameters requires a WebGL context"),Kx(e))return;const i={};for(const a in e){const h=Number(a),p=N3[a];p&&(typeof p=="string"?i[p]=!0:p(t,e[a],h))}const s=t.state&&t.state.cache;if(s)for(const a in i){const h=U3[a];h(t,e,s)}}function q3(t,e){if(e=e||Mg,typeof e=="number"){const a=e,h=j0[a];return h?h(t,a):t.getParameter(a)}const i=Array.isArray(e)?e:Object.keys(e),s={};for(const a of i){const h=j0[a];s[a]=h?h(t,Number(a)):t.getParameter(Number(a))}return s}function W3(t){po(t,Mg)}function gs(t,e,i){if(Kx(e))return i(t);const{nocatch:s=!0}=e;H3(t),po(t,e);let a;if(s)a=i(t),$0(t);else try{a=i(t)}finally{$0(t)}return a}function Wl(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:i}=e.canvasSizeInfo;return i?t.drawingBufferWidth/i:1}return 1}function Op(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const s=Wl(t),a=t.drawingBufferWidth,h=t.drawingBufferHeight;return X3(e,s,a,h,i)}function Z3(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function X3(t,e,i,s,a){const h=H0(t[0],e,i);let p=q0(t[1],e,s,a),c=H0(t[0]+1,e,i);const b=c===i-1?c:c-1;c=q0(t[1]+1,e,s,a);let T;return a?(c=c===0?c:c+1,T=p,p=c):T=c===s-1?c:c-1,{x:h,y:p,width:Math.max(b-h+1,1),height:Math.max(T-p+1,1)}}function H0(t,e,i){return Math.min(Math.round(t*e),i-1)}function q0(t,e,i,s){return s?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const Cg=_o(),Y3=Cg&&typeof document<"u",Qx={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function eb(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};yr(Cg,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},Qx,t);const{width:e,height:i}=t;function s(c){if(t.throwOnError)throw new Error(c);return console.error(c),null}t.onError=s;let a;const{canvas:h}=t,p=eL({canvas:h,width:e,height:i,onError:s});return a=Q3(p,t),a?(a=Lg(a,t),tL(a),a):null}function Lg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||iL(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},Qx,e);const{manageState:i,debug:s}=e;return i&&Jx(t,{copyState:!1,log:function(){for(var a=arguments.length,h=new Array(a),p=0;p<a;p++)h[p]=arguments[p];return Nt.log(1,...h)()}}),Cg&&s&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Nt.level=Math.max(Nt.level,1)):Nt.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function K3(t){const e=t.getParameter(7936),i=t.getParameter(7937),s=t.getExtension("WEBGL_debug_renderer_info"),a=s&&t.getParameter(s.UNMASKED_VENDOR_WEBGL||7936),h=s&&t.getParameter(s.UNMASKED_RENDERER_WEBGL||7937);return{vendor:a||e,renderer:h||i,vendorMasked:e,rendererMasked:i,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function J3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const s=Z3(e.useDevicePixels);nL(t,s,e);return}const i=t.getExtension("STACKGL_resize_drawingbuffer");i&&"width"in e&&"height"in e&&i.resize(e.width,e.height)}function Q3(t,e){const{onError:i}=e;let s=null;const a=b=>s=b.statusMessage||s;t.addEventListener("webglcontextcreationerror",a,!1);const{webgl1:h=!0,webgl2:p=!0}=e;let c=null;return p&&(c=c||t.getContext("webgl2",e),c=c||t.getContext("experimental-webgl2",e)),h&&(c=c||t.getContext("webgl",e),c=c||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",a,!1),c?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),c):i("Failed to create ".concat(p&&!h?"WebGL2":"WebGL"," context: ").concat(s||"Unknown error"))}function eL(t){let{canvas:e,width:i=800,height:s=600,onError:a}=t,h;return typeof e=="string"?(Y3&&document.readyState==="complete"||a("createGLContext called on canvas '".concat(e,"' before page was loaded")),h=document.getElementById(e)):e?h=e:(h=document.createElement("canvas"),h.id="lumagl-canvas",h.style.width=Number.isFinite(i)?"".concat(i,"px"):"100%",h.style.height=Number.isFinite(s)?"".concat(s,"px"):"100%",document.body.insertBefore(h,document.body.firstChild)),h}function tL(t){const e=yi(t)?"WebGL2":"WebGL1",i=K3(t),s=i?"(".concat(i.vendor,",").concat(i.renderer,")"):"",a=t.debug?" debug":"";Nt.info(1,"".concat(e).concat(a," context ").concat(s))()}function iL(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function nL(t,e,i){let s="width"in i?i.width:t.canvas.clientWidth,a="height"in i?i.height:t.canvas.clientHeight;(!s||!a)&&(Nt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,s=t.canvas.width||1,a=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const h=t.luma.canvasSizeInfo;if(h.clientWidth!==s||h.clientHeight!==a||h.devicePixelRatio!==e){let p=e;const c=Math.floor(s*p),b=Math.floor(a*p);t.canvas.width=c,t.canvas.height=b,(t.drawingBufferWidth!==c||t.drawingBufferHeight!==b)&&(Nt.warn("Device pixel ratio clamped")(),p=Math.min(t.drawingBufferWidth/s,t.drawingBufferHeight/a),t.canvas.width=Math.floor(s*p),t.canvas.height=Math.floor(a*p)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:s,clientHeight:a,devicePixelRatio:e})}}const bu="8.5.19",rL="set luma.log.level=1 (or higher) to trace rendering";class sL{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Tg({id:e})),this.stats.get(e)}}const Ba=new sL;if(globalThis.luma&&globalThis.luma.VERSION!==bu)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(bu));globalThis.luma||(_o()&&Nt.log(1,"luma.gl ".concat(bu," - ").concat(rL))(),globalThis.luma=globalThis.luma||{VERSION:bu,version:bu,log:Nt,stats:Ba,globals:{modules:{},nodeIO:{}}});function oL(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function aL(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function bt(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Fp(t,e){if(typeof e!="string")return e;const i=Number(e);if(!isNaN(i))return i;e=e.replace(/^.*\./,"");const s=t[e];return bt(s!==void 0,"Accessing undefined constant GL.".concat(e)),s}function Qo(t,e){e=Number(e);for(const i in t)if(t[i]===e)return"GL.".concat(i);return String(e)}const Bp={};function ia(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Bp[t]=Bp[t]||1;const e=Bp[t]++;return"".concat(t,"-").concat(e)}function W0(t){return bt(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Zl(t){let e=!0;for(const i in t){e=!1;break}return e}function tb(t,e,i,s){const a="See luma.gl ".concat(i," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),h=Object.getPrototypeOf(t);s.forEach(p=>{h.methodName||(h[p]=()=>{throw Nt.removed("Calling removed method ".concat(e,".").concat(p,": "),a)(),new Error(p)})})}const Sl="Resource subclass must define virtual methods";class yo{get[Symbol.toStringTag](){return"Resource"}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};hf(e);const{id:s,userData:a={}}=i;this.gl=e,this.gl2=e,this.id=s||ia(this[Symbol.toStringTag]),this.userData=a,this._bound=!1,this._handle=i.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,i&&e&&i.filter(Boolean).forEach(s=>s.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let i;return this._bound?i=e():(this._bindHandle(this.handle),this._bound=!0,i=e(),this._bound=!1,this._bindHandle(null)),i}unbind(){this.bind(null)}getParameter(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Fp(this.gl,e),bt(e);const a=(this.constructor.PARAMETERS||{})[e];if(a){const h=yi(this.gl);if(!((!("webgl2"in a)||h)&&(!("extension"in a)||this.gl.getExtension(a.extension)))){const c=a.webgl1,b="webgl2"in a?a.webgl2:a.webgl1;return h?b:c}}return this._getParameter(e,i)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:i,keys:s}=e,a=this.constructor.PARAMETERS||{},h=yi(this.gl),p={},c=i||Object.keys(a);for(const b of c){const T=a[b];if(T&&(!("webgl2"in T)||h)&&(!("extension"in T)||this.gl.getExtension(T.extension))){const k=s?Qo(this.gl,b):b;p[k]=this.getParameter(b,e),s&&T.type==="GLenum"&&(p[k]=Qo(this.gl,p[k]))}}return p}setParameter(e,i){e=Fp(this.gl,e),bt(e);const a=(this.constructor.PARAMETERS||{})[e];if(a){const h=yi(this.gl);if(!((!("webgl2"in a)||h)&&(!("extension"in a)||this.gl.getExtension(a.extension))))throw new Error("Parameter not available on this platform");a.type==="GLenum"&&(i=Fp(i))}return this._setParameter(e,i),this}setParameters(e){for(const i in e)this.setParameter(i,e[i]);return this}stubRemovedMethods(e,i,s){return tb(this,e,i,s)}initialize(e){}_createHandle(){throw new Error(Sl)}_deleteHandle(){throw new Error(Sl)}_bindHandle(e){throw new Error(Sl)}_getOptsFromHandle(){throw new Error(Sl)}_getParameter(e,i){throw new Error(Sl)}_setParameter(e,i){throw new Error(Sl)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],i=Ba.get("Resource Counts");i.get("Resources Created").incrementCount(),i.get("".concat(e,"s Created")).incrementCount(),i.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Ba.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,i),this._trackAllocatedMemoryForContext(e,i,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const a=Ba.get("Memory Usage".concat(s));a.get("GPU Memory").addCount(e),a.get("".concat(i," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=Ba.get("Memory Usage".concat(i));s.get("GPU Memory").subtractCount(this.byteLength),s.get("".concat(e," Memory")).subtractCount(this.byteLength)}}const lL="Failed to deduce GL constant from typed array";function Cm(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(lL)}}function Cu(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function cL(t){let{data:e,width:i,height:s,bytesPerPixel:a=4,temp:h}=t;const p=i*a;h=h||new Uint8Array(p);for(let c=0;c<s/2;++c){const b=c*p,T=(s-c-1)*p;h.set(e.subarray(b,b+p)),e.copyWithin(b,T,T+p),e.set(h,T)}}function uL(t){let{data:e,width:i,height:s}=t;const a=Math.round(i/2),h=Math.round(s/2),p=new Uint8Array(a*h*4);for(let c=0;c<h;c++)for(let b=0;b<a;b++)for(let T=0;T<4;T++)p[(c*a+b)*4+T]=e[(c*2*i+b*2)*4+T];return{data:p,width:a,height:h}}function Lm(t,e,i){const{removedProps:s={},deprecatedProps:a={},replacedProps:h={}}=i;for(const c in s)if(c in e){const T=s[c]?"".concat(t,".").concat(s[c]):"N/A";Nt.removed("".concat(t,".").concat(c),T)()}for(const c in a)if(c in e){const b=a[c];Nt.deprecated("".concat(t,".").concat(c),"".concat(t,".").concat(b))()}let p=null;for(const c in h)if(c in e){const b=h[c];Nt.deprecated("".concat(t,".").concat(c),"".concat(t,".").concat(b))(),p=p||Object.assign({},e),p[b]=e[c],delete p[c]}return p||e}const hL={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},dL={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Ur{static getBytesPerElement(e){return Cu(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return bt(e.size),Cu(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return new Ur(hL,...i)}constructor(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];i.forEach(a=>this._assign(a)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Ur.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Ur.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Lm("Accessor",e,dL),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const Z0=10,ib={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},fL={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:ib},pL={removedProps:ib};class qi extends yo{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,i),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=i.target||(this.gl.webgl2?36662:34962),this.initialize(i),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Ur.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Ur.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Lm("Buffer",e,fL),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Lm("Buffer",e,pL),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Ur(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:i,offset:s=0,srcOffset:a=0}=e,h=e.byteLength||e.length;bt(i);const p=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(p,this.handle),a!==0||h!==void 0?(rr(this.gl),this.gl.bufferSubData(this.target,s,i,a,h)):this.gl.bufferSubData(p,s,i),this.gl.bindBuffer(p,null),this.debugData=null,this._inferType(i),this}copyData(e){let{sourceBuffer:i,readOffset:s=0,writeOffset:a=0,size:h}=e;const{gl:p}=this;return rr(p),p.bindBuffer(36662,i.handle),p.bindBuffer(36663,this.handle),p.copyBufferSubData(36662,36663,s,a,h),p.bindBuffer(36662,null),p.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:i=0,dstOffset:s=0,length:a=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};rr(this.gl);const h=Cu(this.accessor.type||5126,{clamped:!1}),p=this._getAvailableElementCount(i),c=s;let b,T;e?(T=e.length,b=T-c):(b=Math.min(p,a||p),T=c+b);const P=Math.min(p,b);return a=a||P,bt(a<=P),e=e||new h(T),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,e,s,a),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:i=this.accessor&&this.accessor.index,offset:s=0,size:a}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?a!==void 0?this.gl.bindBufferRange(e,i,this.handle,s,a):(bt(s===0),this.gl.bindBufferBase(e,i,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:i=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,i,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Z0,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+i;bt(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const a=this._getTarget();this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,s,this.usage),this.gl.bufferSubData(a,i,e),this.gl.bindBuffer(a,null),this.debugData=e.slice(0,Z0),this.bytesUsed=s,this._trackAllocatedMemory(s);const h=Cm(e);return bt(h),this.setAccessor(new Ur(this.accessor,{type:h})),this}_setByteLength(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;bt(e>=0),this._trackDeallocatedMemory();let s=e;e===0&&(s=new Float32Array(0));const a=this._getTarget();return this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,s,i),this.gl.bindBuffer(a,null),this.usage=i,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const i=Cu(this.accessor.type||5126,{clamped:!1}),s=e/i.BYTES_PER_ELEMENT;return this.getElementCount()-s}_inferType(e){this.accessor.type||this.setAccessor(new Ur(this.accessor,{type:Cm(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const i=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),i}get type(){return Nt.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Nt.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Nt.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Nt.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Ur(this.accessor,e),this}}const kg={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},nb={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},rb={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function mL(t,e){const i=kg[e];if(!i)return!1;if(i.gl1===void 0&&i.gl2===void 0)return!0;const s=yi(t)&&i.gl2||i.gl1;return typeof s=="string"?t.getExtension(s):s}function gL(t,e){const i=kg[e];switch(i&&i.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const _L=[9729,9728],X0=globalThis.WebGLBuffer||function(){};class Ha extends yo{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:s,linearFiltering:a}=i;let h=!0;return s&&(h=h&&mL(e,s),h=h&&(!a||gL(e,s))),h}constructor(e,i){const{id:s=ia("texture"),handle:a,target:h}=i;super(e,{id:s,handle:a}),this.target=h,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=e.data;if(i instanceof Promise)return i.then(ye=>this.initialize(Object.assign({},e,{pixels:ye,data:ye}))),this;const s=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement;if(s&&i.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,i.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:a=null,format:h=6408,border:p=0,recreate:c=!1,parameters:b={},pixelStore:T={},textureUnit:P=void 0}=e;i||(i=a);let{width:k,height:C,dataFormat:H,type:ee,compressed:se=!1,mipmaps:pe=!0}=e;const{depth:fe=0}=e;return{width:k,height:C,compressed:se,dataFormat:H,type:ee}=this._deduceParameters({format:h,type:ee,dataFormat:H,compressed:se,data:i,width:k,height:C}),this.width=k,this.height=C,this.depth=fe,this.format=h,this.type=ee,this.dataFormat=H,this.border=p,this.textureUnit=P,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),pe&&this._isNPOT()&&(Nt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),pe=!1,this._updateForNPOT(b)),this.mipmaps=pe,this.setImageData({data:i,width:k,height:C,depth:fe,format:h,type:ee,dataFormat:H,border:p,mipmaps:pe,parameters:T,compressed:se}),pe&&this.generateMipmap(),this.setParameters(b),c&&(this.data=i),s&&(this._video={video:i,parameters:b,lastTime:i.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?i.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:i,lastTime:s}=this._video;if(s===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:i}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:i,width:s,mipmaps:a=!1}=e;return s!==this.width||i!==this.height?this.initialize({width:s,height:i,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:a}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Nt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),gs(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:i=this.target,pixels:s=null,level:a=0,format:h=this.format,border:p=this.border,offset:c=0,parameters:b={}}=e;let{data:T=null,type:P=this.type,width:k=this.width,height:C=this.height,dataFormat:H=this.dataFormat,compressed:ee=!1}=e;T||(T=s),{type:P,dataFormat:H,compressed:ee,width:k,height:C}=this._deduceParameters({format:h,type:P,dataFormat:H,compressed:ee,data:T,width:k,height:C});const{gl:se}=this;se.bindTexture(this.target,this.handle);let pe=null;({data:T,dataType:pe}=this._getDataType({data:T,compressed:ee}));let fe,ye=0;if(gs(this.gl,b,()=>{switch(pe){case"null":se.texImage2D(i,a,h,k,C,p,H,P,T);break;case"typed-array":se.texImage2D(i,a,h,k,C,p,H,P,T,c);break;case"buffer":fe=rr(se),fe.bindBuffer(35052,T.handle||T),fe.texImage2D(i,a,h,k,C,p,H,P,c),fe.bindBuffer(35052,null);break;case"browser-object":yi(se)?se.texImage2D(i,a,h,k,C,p,H,P,T):se.texImage2D(i,a,h,H,P,T);break;case"compressed":for(const[Se,Ue]of T.entries())se.compressedTexImage2D(i,Se,Ue.format,Ue.width,Ue.height,p,Ue.data),ye+=Ue.levelSize;break;default:bt(!1,"Unknown image data type")}}),pe==="compressed")this._trackAllocatedMemory(ye,"Texture");else if(T&&T.byteLength)this._trackAllocatedMemory(T.byteLength,"Texture");else{const Se=nb[this.dataFormat]||4,Ue=rb[this.type]||1;this._trackAllocatedMemory(this.width*this.height*Se*Ue,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:i=this.target,pixels:s=null,data:a=null,x:h=0,y:p=0,width:c=this.width,height:b=this.height,level:T=0,format:P=this.format,type:k=this.type,dataFormat:C=this.dataFormat,compressed:H=!1,offset:ee=0,border:se=this.border,parameters:pe={}}=e;if({type:k,dataFormat:C,compressed:H,width:c,height:b}=this._deduceParameters({format:P,type:k,dataFormat:C,compressed:H,data:a,width:c,height:b}),bt(this.depth===0,"texSubImage not supported for 3D textures"),a||(a=s),a&&a.data){const fe=a;a=fe.data,c=fe.shape[0],b=fe.shape[1]}a instanceof qi&&(a=a.handle),this.gl.bindTexture(this.target,this.handle),gs(this.gl,pe,()=>{if(H)this.gl.compressedTexSubImage2D(i,T,h,p,c,b,P,a);else if(a===null)this.gl.texSubImage2D(i,T,h,p,c,b,C,k,null);else if(ArrayBuffer.isView(a))this.gl.texSubImage2D(i,T,h,p,c,b,C,k,a,ee);else if(a instanceof X0){const fe=rr(this.gl);fe.bindBuffer(35052,a),fe.texSubImage2D(i,T,h,p,c,b,C,k,ee),fe.bindBuffer(35052,null)}else yi(this.gl)?rr(this.gl).texSubImage2D(i,T,h,p,c,b,C,k,a):this.gl.texSubImage2D(i,T,h,p,C,k,a)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Nt.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:i}=this;return e!==void 0&&(this.textureUnit=e,i.activeTexture(33984+e)),i.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:i}=this;return e!==void 0&&(this.textureUnit=e,i.activeTexture(33984+e)),i.bindTexture(this.target,null),e}_getDataType(e){let{data:i,compressed:s=!1}=e;return s?{data:i,dataType:"compressed"}:i===null?{data:i,dataType:"null"}:ArrayBuffer.isView(i)?{data:i,dataType:"typed-array"}:i instanceof qi?{data:i.handle,dataType:"buffer"}:i instanceof X0?{data:i,dataType:"buffer"}:{data:i,dataType:"browser-object"}}_deduceParameters(e){const{format:i,data:s}=e;let{width:a,height:h,dataFormat:p,type:c,compressed:b}=e;const T=kg[i];return p=p||T&&T.dataFormat,c=c||T&&T.types[0],b=b||T&&T.compressed,{width:a,height:h}=this._deduceImageSize(s,a,h),{dataFormat:p,type:c,compressed:b,width:a,height:h,format:i,data:s}}_deduceImageSize(e,i,s){let a;return typeof ImageData<"u"&&e instanceof ImageData?a={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?a={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?a={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?a={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?a={width:e.videoWidth,height:e.videoHeight}:e?a={width:i,height:s}:a={width:i>=0?i:1,height:s>=0?s:1},bt(a,"Could not deduced texture size"),bt(i===void 0||a.width===i,"Deduced texture width does not match supplied width"),bt(s===void 0||a.height===s,"Deduced texture height does not match supplied height"),a}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const i=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),i}}_setParameter(e,i){switch(this.gl.bindTexture(this.target,this.handle),i=this._getNPOTParam(e,i),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,i);break;case 4096:case 4097:bt(!1);break;default:this.gl.texParameteri(this.target,e,i);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return yi(this.gl)||!this.width||!this.height?!1:!W0(this.width)||!W0(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,i){if(this._isNPOT())switch(e){case 10241:_L.indexOf(i)===-1&&(i=9729);break;case 10242:case 10243:i!==33071&&(i=33071);break}return i}}let yL="";function vL(t,e){return bt(typeof t=="string"),t=yL+t,new Promise((i,s)=>{try{const a=new Image;a.onload=()=>i(a),a.onerror=()=>s(new Error("Could not load image ".concat(t,"."))),a.crossOrigin=e&&e.crossOrigin||"anonymous",a.src=t}catch(a){s(a)}})}class $r extends Ha{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,i){return Ha.isSupported(e,i)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};hf(e),(i instanceof Promise||typeof i=="string")&&(i={data:i}),typeof i.data=="string"&&(i=Object.assign({},i,{data:vL(i.data)})),super(e,Object.assign({},i,{target:3553})),this.initialize(i),Object.seal(this)}}const km=[34069,34070,34071,34072,34073,34074];class sb extends Ha{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};hf(e),super(e,Object.assign({},i,{target:34067})),this.initialize(i),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:i=!0,parameters:s={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,i&&this.generateMipmap(e),this.setParameters(s)}),this}subImage(e){let{face:i,data:s,x:a=0,y:h=0,mipmapLevel:p=0}=e;return this._subImage({target:i,data:s,x:a,y:h,mipmapLevel:p})}async setCubeMapImageData(e){let{width:i,height:s,pixels:a,data:h,border:p=0,format:c=6408,type:b=5121}=e;const{gl:T}=this,P=a||h,k=await Promise.all(km.map(C=>{const H=P[C];return Promise.all(Array.isArray(H)?H:[H])}));this.bind(),km.forEach((C,H)=>{k[H].length>1&&this.opts.mipmaps!==!1&&Nt.warn("".concat(this.id," has mipmap and multiple LODs."))(),k[H].forEach((ee,se)=>{i&&s?T.texImage2D(C,se,c,i,s,p,c,b,ee):T.texImage2D(C,se,c,c,b,ee)})}),this.unbind()}setImageDataForFace(e){const{face:i,width:s,height:a,pixels:h,data:p,border:c=0,format:b=6408,type:T=5121}=e,{gl:P}=this,k=h||p;return this.bind(),k instanceof Promise?k.then(C=>this.setImageDataForFace(Object.assign({},e,{face:i,data:C,pixels:C}))):this.width||this.height?P.texImage2D(i,0,b,s,a,c,b,T,k):P.texImage2D(i,0,b,b,T,k),this}}sb.FACES=km;class xL extends Ha{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return yi(e)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};rr(e),i=Object.assign({depth:1},i,{target:32879,unpackFlipY:!1}),super(e,i),this.initialize(i),Object.seal(this)}setImageData(e){let{level:i=0,dataFormat:s=6408,width:a,height:h,depth:p=1,border:c=0,format:b,type:T=5121,offset:P=0,data:k,parameters:C={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),gs(this.gl,C,()=>{ArrayBuffer.isView(k)&&this.gl.texImage3D(this.target,i,s,a,h,p,c,b,T,k),k instanceof qi&&(this.gl.bindBuffer(35052,k.handle),this.gl.texImage3D(this.target,i,s,a,h,p,c,b,T,P))}),k&&k.byteLength)this._trackAllocatedMemory(k.byteLength,"Texture");else{const H=nb[this.dataFormat]||4,ee=rb[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*H*ee,"Texture")}return this.loaded=!0,this}}const La="EXT_color_buffer_float",Y0={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:La,bpp:2},[33327]:{gl2:La,bpp:4},[34842]:{gl2:La,bpp:8},[33326]:{gl2:La,bpp:4},[33328]:{gl2:La,bpp:8},[34836]:{gl2:La,bpp:16},[35898]:{gl2:La,bpp:4}};function bL(t,e,i){const s=i[e];if(!s)return!1;const a=yi(t)&&s.gl2||s.gl1;return typeof a=="string"?t.getExtension(a):a}class Rl extends yo{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!i||bL(e,i,Y0)}static getSamplesForFormat(e,i){let{format:s}=i;return e.getInternalformatParameter(36161,s,32937)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,i),this.initialize(i),Object.seal(this)}initialize(e){let{format:i,width:s=1,height:a=1,samples:h=0}=e;return bt(i,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),h!==0&&yi(this.gl)?this.gl.renderbufferStorageMultisample(36161,h,i,s,a):this.gl.renderbufferStorage(36161,i,s,a),this.format=i,this.width=s,this.height=a,this.samples=h,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Y0[this.format].bpp),this}resize(e){let{width:i,height:s}=e;return i!==this.width||s!==this.height?this.initialize({width:i,height:s,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const wL=256,EL=1024,TL=16384,K0=6144,J0=6145,Q0=6146,e1=34041,ob="clear: bad arguments";function Rg(t){let{framebuffer:e=null,color:i=null,depth:s=null,stencil:a=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const h={};e&&(h.framebuffer=e);let p=0;i&&(p|=TL,i!==!0&&(h.clearColor=i)),s&&(p|=wL,s!==!0&&(h.clearDepth=s)),a&&(p|=EL,s!==!0&&(h.clearStencil=s)),bt(p!==0,ob),gs(t,h,()=>{t.clear(p)})}function AL(t){let{framebuffer:e=null,buffer:i=K0,drawBuffer:s=0,value:a=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};rr(t),gs(t,{framebuffer:e},()=>{switch(i){case K0:switch(a.constructor){case Int32Array:t.clearBufferiv(i,s,a);break;case Uint32Array:t.clearBufferuiv(i,s,a);break;case Float32Array:default:t.clearBufferfv(i,s,a)}break;case J0:t.clearBufferfv(J0,0,[a]);break;case Q0:t.clearBufferiv(Q0,0,[a]);break;case e1:const[h,p]=a;t.clearBufferfi(e1,0,h,p);break;default:bt(!1,ob)}})}function SL(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return bt(!1),0}}function df(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:i=0,sourceY:s=0,sourceFormat:a=6408}=e;let{sourceAttachment:h=36064,target:p=null,sourceWidth:c,sourceHeight:b,sourceType:T}=e;const{framebuffer:P,deleteFramebuffer:k}=ab(t);bt(P);const{gl:C,handle:H,attachments:ee}=P;c=c||P.width,b=b||P.height,h===36064&&H===null&&(h=1028),bt(ee[h]),T=T||ee[h].type,p=PL(p,T,a,c,b),T=T||Cm(p);const se=C.bindFramebuffer(36160,H);return C.readPixels(i,s,c,b,a,T,p),C.bindFramebuffer(36160,se||null),k&&P.delete(),p}function t1(t){let{sourceAttachment:e=36064,targetMaxHeight:i=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=df(t,{sourceAttachment:e}),{width:a,height:h}=t;for(;h>i;)({data:s,width:a,height:h}=uL({data:s,width:a,height:h}));cL({data:s,width:a,height:h});const p=document.createElement("canvas");p.width=a,p.height=h;const c=p.getContext("2d"),b=c.createImageData(a,h);return b.data.set(s),c.putImageData(b,0,0),p.toDataURL()}function IL(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:s=0,sourceY:a=0,targetMipmaplevel:h=0,targetInternalFormat:p=6408}=i;let{targetX:c,targetY:b,targetZ:T,width:P,height:k}=i;const{framebuffer:C,deleteFramebuffer:H}=ab(t);bt(C);const{gl:ee,handle:se}=C,pe=typeof c<"u"||typeof b<"u"||typeof T<"u";c=c||0,b=b||0,T=T||0;const fe=ee.bindFramebuffer(36160,se);bt(e);let ye=null;if(e instanceof Ha&&(ye=e,P=Number.isFinite(P)?P:ye.width,k=Number.isFinite(k)?k:ye.height,ye.bind(0),e=ye.target),!pe)ee.copyTexImage2D(e,h,p,s,a,P,k,0);else switch(e){case 3553:case 34067:ee.copyTexSubImage2D(e,h,c,b,s,a,P,k);break;case 35866:case 32879:rr(ee).copyTexSubImage3D(e,h,c,b,T,s,a,P,k);break}return ye&&ye.unbind(),ee.bindFramebuffer(36160,fe||null),H&&C.delete(),ye}function ab(t){return t instanceof Bn?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:BL(t),deleteFramebuffer:!0}}function PL(t,e,i,s,a){if(t)return t;e=e||5121;const h=Cu(e,{clamped:!1}),p=SL(i);return new h(s*a*p)}const sn={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function ML(t){const e=new $r(t,{format:6408,type:5126,dataFormat:6408}),i=new Bn(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),s=i.getStatus();return e.delete(),i.delete(),s===36053}const lb={[sn.WEBGL2]:[!1,!0],[sn.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[sn.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[sn.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[sn.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[sn.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[sn.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[sn.FLOAT_BLEND]:["EXT_float_blend"],[sn.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[sn.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[sn.TEXTURE_FLOAT]:["OES_texture_float",!0],[sn.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[sn.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[sn.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[sn.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[sn.COLOR_ATTACHMENT_RGBA32F]:[ML,"EXT_color_buffer_float"],[sn.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[sn.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[sn.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[sn.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[sn.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[sn.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},CL=2;function LL(t,e){return cb(t,e)}function cb(t,e){return e=Array.isArray(e)?e:[e],e.every(i=>ub(t,i))}function kL(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in lb)t.luma.caps[e]===void 0&&(t.luma.caps[e]=ub(t,e));return t.luma.caps}function ub(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=RL(t,e)),t.luma.caps[e]||Nt.log(CL,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function RL(t,e){const i=lb[e];bt(i,e);let s;const a=yi(t)&&i[1]||i[0];if(typeof a=="function")s=a(t);else if(Array.isArray(a)){s=!0;for(const h of a)s=s&&Boolean(t.getExtension(h))}else typeof a=="string"?s=Boolean(t.getExtension(a)):typeof a=="boolean"?s=a:bt(!1);return s}const i1="Multiple render targets not supported";class Bn extends yo{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:s,colorBufferHalfFloat:a}=i;let h=!0;return s&&(h=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),a&&(h=h&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),h}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Bn(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=rr(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=rr(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,i),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(i),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:i=1,height:s=1,attachments:a=null,color:h=!0,depth:p=!0,stencil:c=!1,check:b=!0,readBuffer:T=void 0,drawBuffers:P=void 0}=e;if(bt(i>=0&&s>=0,"Width and height need to be integers"),this.width=i,this.height=s,a)for(const k in a){const C=a[k];(Array.isArray(C)?C[0]:C).resize({width:i,height:s})}else a=this._createDefaultAttachments(h,p,c,i,s);this.update({clearAttachments:!0,attachments:a,readBuffer:T,drawBuffers:P}),a&&b&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:i={},readBuffer:s,drawBuffers:a,clearAttachments:h=!1,resizeAttachments:p=!0}=e;this.attach(i,{clearAttachments:h,resizeAttachments:p});const{gl:c}=this,b=c.bindFramebuffer(36160,this.handle);return s&&this._setReadBuffer(s),a&&this._setDrawBuffers(a),c.bindFramebuffer(36160,b||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:i,height:s}=e;if(this.handle===null)return bt(i===void 0&&s===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;i===void 0&&(i=this.gl.drawingBufferWidth),s===void 0&&(s=this.gl.drawingBufferHeight),i!==this.width&&s!==this.height&&Nt.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(i,"x").concat(s))();for(const a in this.attachments)this.attachments[a].resize({width:i,height:s});return this.width=i,this.height=s,this}attach(e){let{clearAttachments:i=!1,resizeAttachments:s=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a={};i&&Object.keys(this.attachments).forEach(p=>{a[p]=null}),Object.assign(a,e);const h=this.gl.bindFramebuffer(36160,this.handle);for(const p in a){bt(p!==void 0,"Misspelled framebuffer binding point?");const c=Number(p),b=a[c];let T=b;if(!T)this._unattach(c);else if(T instanceof Rl)this._attachRenderbuffer({attachment:c,renderbuffer:T});else if(Array.isArray(b)){const[P,k=0,C=0]=b;T=P,this._attachTexture({attachment:c,texture:P,layer:k,level:C})}else this._attachTexture({attachment:c,texture:T,layer:0,level:0});s&&T&&T.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,h||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(p=>!this.attachments[p]).forEach(p=>{delete this.attachments[p]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(zL(e));return this}getStatus(){const{gl:e}=this,i=e.bindFramebuffer(36160,this.handle),s=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,i||null),s}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:i,depth:s,stencil:a,drawBuffers:h=[]}=e,p=this.gl.bindFramebuffer(36160,this.handle);return(i||s||a)&&Rg(this.gl,{color:i,depth:s,stencil:a}),h.forEach((c,b)=>{AL(this.gl,{drawBuffer:b,value:c})}),this.gl.bindFramebuffer(36160,p||null),this}readPixels(){return Nt.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Nt.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Nt.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Nt.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Nt.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Nt.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:i=[],x:s=0,y:a=0,width:h,height:p}=e;const c=rr(this.gl),b=c.bindFramebuffer(36008,this.handle);return s===0&&a===0&&h===void 0&&p===void 0?c.invalidateFramebuffer(36008,i):c.invalidateFramebuffer(36008,i,s,a,h,p),c.bindFramebuffer(36008,b),this}getAttachmentParameter(e,i,s){let a=this._getAttachmentParameterFallback(i);return a===null&&(this.gl.bindFramebuffer(36160,this.handle),a=this.gl.getFramebufferAttachmentParameter(36160,e,i),this.gl.bindFramebuffer(36160,null)),s&&a>1e3&&(a=Qo(this.gl,a)),a}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,i=arguments.length>1?arguments[1]:void 0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const a={};for(const h of s){const p=i?Qo(this.gl,h):h;a[p]=this.getAttachmentParameter(e,h,i)}return a}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const i=Object.keys(this.attachments),s={};for(const a of i){const h=Number(a),p=e?Qo(this.gl,h):h;s[p]=this.getAttachmentParameters(h,e)}return s}show(){return typeof window<"u"&&window.open(t1(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Nt.level||typeof window>"u")return this;i=i||"Framebuffer ".concat(this.id);const s=t1(this,{targetMaxHeight:100});return Nt.image({logLevel:e,message:i,image:s},i)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,i,s,a,h){let p=null;return e&&(p=p||{},p[36064]=new $r(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:a,height:h,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(p[36064])),i&&s?(p=p||{},p[33306]=new Rl(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:a,height:111}),this.ownResources.push(p[33306])):i?(p=p||{},p[36096]=new Rl(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:a,height:h}),this.ownResources.push(p[36096])):s&&bt(!1),p}_unattach(e){const i=this.attachments[e];!i||(i instanceof Rl?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:i=36064,renderbuffer:s}=e;const{gl:a}=this;a.framebufferRenderbuffer(36160,i,36161,s.handle),this.attachments[i]=s}_attachTexture(e){let{attachment:i=36064,texture:s,layer:a,level:h}=e;const{gl:p}=this;switch(p.bindTexture(s.target,s.handle),s.target){case 35866:case 32879:rr(p).framebufferTextureLayer(36160,i,s.target,h,a);break;case 34067:const b=DL(a);p.framebufferTexture2D(36160,i,b,s.handle,h);break;case 3553:p.framebufferTexture2D(36160,i,3553,s.handle,h);break;default:bt(!1,"Illegal texture type")}p.bindTexture(s.target,null),this.attachments[i]=s}_setReadBuffer(e){const i=c3(this.gl);i?i.readBuffer(e):bt(e===36064||e===1029,i1),this.readBuffer=e}_setDrawBuffers(e){const{gl:i}=this,s=rr(i);if(s)s.drawBuffers(e);else{const a=i.getExtension("WEBGL_draw_buffers");a?a.drawBuffersWEBGL(e):bt(e.length===1&&(e[0]===36064||e[0]===1029),i1)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const i=kL(this.gl);switch(e){case 36052:return i.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return i.WEBGL2?null:8;case 33297:return i.WEBGL2?null:5125;case 33296:return!i.WEBGL2&&!i.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function DL(t){return t<34069?t+34069:t}function zL(t){return(Bn.STATUS||{})[t]||"Framebuffer error ".concat(t)}const OL=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Bn.ATTACHMENT_PARAMETERS=OL;function FL(t,e){bt(t instanceof $r||t instanceof sb||t instanceof xL);const i=t.constructor,{gl:s,width:a,height:h,format:p,type:c,dataFormat:b,border:T,mipmaps:P}=t,k=Object.assign({width:a,height:h,format:p,type:c,dataFormat:b,border:T,mipmaps:P},e);return new i(s,k)}function BL(t,e){const{gl:i,width:s,height:a,id:h}=t;return new Bn(i,Object.assign({},e,{id:"framebuffer-for-".concat(h),width:s,height:a,attachments:{[36064]:t}}))}function bd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,s=t.match(i);return s?s[1]:e}const NL=35632,UL=35633;function VL(t){switch(t){case NL:return"fragment";case UL:return"vertex";default:return"unknown type"}}function jL(t,e,i,s){const a=t.split(/\r?\n/),h={},p={},c=s||bd(e)||"(unnamed)",b="".concat(VL(i)," shader ").concat(c);for(let P=0;P<a.length;P++){const k=a[P];if(k.length<=1)continue;const C=k.split(":"),H=C[0],ee=parseInt(C[2],10);if(isNaN(ee))throw new Error("GLSL compilation error in ".concat(b,": ").concat(t));H!=="WARNING"?h[ee]=k:p[ee]=k}const T=GL(e);return{shaderName:b,errors:n1(h,T),warnings:n1(p,T)}}function n1(t,e){let i="";for(let s=0;s<e.length;s++){const a=e[s];if(!(!t[s+3]&&!t[s+2]&&!t[s+1])&&(i+="".concat(a,`
`),t[s+1])){const h=t[s+1],p=h.split(":",3),c=p[0],b=parseInt(p[1],10)||0,T=h.substring(p.join(":").length+1).trim();i+=hb("^^^ ".concat(c,": ").concat(T,`

`),b)}}return i}function GL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const s=t.split(/\r?\n/),a=String(s.length+e-1).length;return s.map((h,p)=>{const c=String(p+e),b=c.length;return hb(c,a-b)+i+h})}function hb(t,e){let i="";for(let s=0;s<e;++s)i+=" ";return"".concat(i).concat(t)}function db(t){let e=100;const i=t.match(/[^\s]+/g);if(i.length>=2&&i[0]==="#version"){const s=parseInt(i[1],10);Number.isFinite(s)&&(e=s)}return e}const $L="Shader: GLSL source code must be a JavaScript string";class Lu extends yo{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return bt(!1),"unknown"}}constructor(e,i){hf(e),bt(typeof i.source=="string",$L);const s=bd(i.source,null)||i.id||ia("unnamed ".concat(Lu.getTypeName(i.shaderType)));super(e,{id:s}),this.shaderType=i.shaderType,this.source=i.source,this.initialize(i)}initialize(e){let{source:i}=e;const s=bd(i,null);s&&(this.id=ia(s)),this._compile(i)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Lu.getTypeName(this.shaderType),":").concat(this.id)}getName(){return bd(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const s=this.gl.getShaderInfoLog(this.handle),{shaderName:a,errors:h,warnings:p}=jL(s,this.source,this.shaderType,this.id);throw Nt.error("GLSL compilation errors in ".concat(a,`
`).concat(h))(),Nt.warn("GLSL compilation warnings in ".concat(a,`
`).concat(p))(),new Error("GLSL compilation errors in ".concat(a))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Np extends Lu{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,i){typeof i=="string"&&(i={source:i}),super(e,Object.assign({},i,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class Up extends Lu{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,i){typeof i=="string"&&(i={source:i}),super(e,Object.assign({},i,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const HL={[5126]:Ji.bind(null,"uniform1fv",Fr,1,ir),[35664]:Ji.bind(null,"uniform2fv",Fr,2,ir),[35665]:Ji.bind(null,"uniform3fv",Fr,3,ir),[35666]:Ji.bind(null,"uniform4fv",Fr,4,ir),[5124]:Ji.bind(null,"uniform1iv",jo,1,ir),[35667]:Ji.bind(null,"uniform2iv",jo,2,ir),[35668]:Ji.bind(null,"uniform3iv",jo,3,ir),[35669]:Ji.bind(null,"uniform4iv",jo,4,ir),[35670]:Ji.bind(null,"uniform1iv",jo,1,ir),[35671]:Ji.bind(null,"uniform2iv",jo,2,ir),[35672]:Ji.bind(null,"uniform3iv",jo,3,ir),[35673]:Ji.bind(null,"uniform4iv",jo,4,ir),[35674]:Ji.bind(null,"uniformMatrix2fv",Fr,4,oo),[35675]:Ji.bind(null,"uniformMatrix3fv",Fr,9,oo),[35676]:Ji.bind(null,"uniformMatrix4fv",Fr,16,oo),[35678]:Yn,[35680]:Yn,[5125]:Ji.bind(null,"uniform1uiv",rd,1,ir),[36294]:Ji.bind(null,"uniform2uiv",rd,2,ir),[36295]:Ji.bind(null,"uniform3uiv",rd,3,ir),[36296]:Ji.bind(null,"uniform4uiv",rd,4,ir),[35685]:Ji.bind(null,"uniformMatrix2x3fv",Fr,6,oo),[35686]:Ji.bind(null,"uniformMatrix2x4fv",Fr,8,oo),[35687]:Ji.bind(null,"uniformMatrix3x2fv",Fr,6,oo),[35688]:Ji.bind(null,"uniformMatrix3x4fv",Fr,12,oo),[35689]:Ji.bind(null,"uniformMatrix4x2fv",Fr,8,oo),[35690]:Ji.bind(null,"uniformMatrix4x3fv",Fr,12,oo),[35678]:Yn,[35680]:Yn,[35679]:Yn,[35682]:Yn,[36289]:Yn,[36292]:Yn,[36293]:Yn,[36298]:Yn,[36299]:Yn,[36300]:Yn,[36303]:Yn,[36306]:Yn,[36307]:Yn,[36308]:Yn,[36311]:Yn},qL={},WL={},ZL={},r1=[0];function Dg(t,e,i,s){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(r1[0]=t,t=r1);const a=t.length;if(a%e&&Nt.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof i)return t;let h=s[a];h||(h=new i(a),s[a]=h);for(let p=0;p<a;p++)h[p]=t[p];return h}function Fr(t,e){return Dg(t,e,Float32Array,qL)}function jo(t,e){return Dg(t,e,Int32Array,WL)}function rd(t,e){return Dg(t,e,Uint32Array,ZL)}function s1(t,e,i){const s=HL[i.type];if(!s)throw new Error("Unknown GLSL uniform type ".concat(i.type));return s().bind(null,t,e)}function XL(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,i=t.match(e);if(!i||i.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:i[1],length:i[2]||1,isArray:Boolean(i[2])}}function YL(t,e,i){for(const s in t){const a=t[s];if((!i||Boolean(i[s]))&&!KL(a))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(s),a),new Error("".concat(e," Bad uniform ").concat(s))}return!0}function KL(t){return Array.isArray(t)||ArrayBuffer.isView(t)?QL(t):isFinite(t)||t===!0||t===!1||t instanceof Ha||t instanceof Rl?!0:t instanceof Bn?Boolean(t.texture):!1}function JL(t,e,i){if(Array.isArray(i)||ArrayBuffer.isView(i))if(t[e]){const s=t[e];for(let a=0,h=i.length;a<h;++a)s[a]=i[a]}else t[e]=i.slice();else t[e]=i}function QL(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let i=0;i<e;++i)if(!Number.isFinite(t[i]))return!1;return!0}function Yn(){let t=null;return(e,i,s)=>{const a=t!==s;return a&&(e.uniform1i(i,s),t=s),a}}function Ji(t,e,i,s){let a=null,h=null;return(p,c,b)=>{const T=e(b,i),P=T.length;let k=!1;if(a===null)a=new Float32Array(P),h=P,k=!0;else{bt(h===P,"Uniform length cannot change.");for(let C=0;C<P;++C)if(T[C]!==a[C]){k=!0;break}}return k&&(s(p,t,c,T),a.set(T)),k}}function ir(t,e,i,s){t[e](i,s)}function oo(t,e,i,s){t[e](i,!1,s)}const ek=5120,tk=5121,ik=5122,nk=5123,o1=0,sd=1,rk=2,sk=3,od=4,ok=5,ak=6,Fn=5126,lk=35664,ck=35665,uk=35666,ou=5124,hk=35667,dk=35668,fk=35669,au=5125,pk=36294,mk=36295,gk=36296,_k=35670,yk=35671,vk=35672,xk=35673,bk=35674,wk=35675,Ek=35676,Tk=35685,Ak=35686,Sk=35687,Ik=35688,Pk=35689,Mk=35690,Rm={[Fn]:[Fn,1,"float"],[lk]:[Fn,2,"vec2"],[ck]:[Fn,3,"vec3"],[uk]:[Fn,4,"vec4"],[ou]:[ou,1,"int"],[hk]:[ou,2,"ivec2"],[dk]:[ou,3,"ivec3"],[fk]:[ou,4,"ivec4"],[au]:[au,1,"uint"],[pk]:[au,2,"uvec2"],[mk]:[au,3,"uvec3"],[gk]:[au,4,"uvec4"],[_k]:[Fn,1,"bool"],[yk]:[Fn,2,"bvec2"],[vk]:[Fn,3,"bvec3"],[xk]:[Fn,4,"bvec4"],[bk]:[Fn,8,"mat2"],[Tk]:[Fn,8,"mat2x3"],[Ak]:[Fn,8,"mat2x4"],[wk]:[Fn,12,"mat3"],[Sk]:[Fn,12,"mat3x2"],[Ik]:[Fn,12,"mat3x4"],[Ek]:[Fn,16,"mat4"],[Pk]:[Fn,16,"mat4x2"],[Mk]:[Fn,16,"mat4x3"]};function Ck(t){switch(t){case o1:return o1;case sd:return sd;case sk:return sd;case rk:return sd;case od:return od;case ok:return od;case ak:return od;default:return bt(!1),0}}function a1(t){const e=Rm[t];if(!e)return null;const[i,s]=e;return{type:i,components:s}}function fb(t,e){switch(t){case ek:case tk:case ik:case nk:t=Fn;break}for(const i in Rm){const[s,a,h]=Rm[i];if(s===t&&a===e)return{glType:i,name:h}}return null}class Lk{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const i=Number(e);return Number.isFinite(i)?this.attributeInfosByLocation[i]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const i=this.getAttributeInfo(e);return i?i.location:-1}getAttributeAccessor(e){const i=this.getAttributeInfo(e);return i?i.accessor:null}getVaryingInfo(e){const i=Number(e);return Number.isFinite(i)?this.varyingInfos[i]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const i=this.getVaryingInfo();return i?i.location:-1}getVaryingAccessor(e){const i=this.getVaryingInfo();return i?i.accessor:null}_readAttributesFromProgram(e){const{gl:i}=e,s=i.getProgramParameter(e.handle,35721);for(let a=0;a<s;a++){const{name:h,type:p,size:c}=i.getActiveAttrib(e.handle,a),b=i.getAttribLocation(e.handle,h);b>=0&&this._addAttribute(b,h,p,c)}this.attributeInfos.sort((a,h)=>a.location-h.location)}_readVaryingsFromProgram(e){const{gl:i}=e;if(!yi(i))return;const s=i.getProgramParameter(e.handle,35971);for(let a=0;a<s;a++){const{name:h,type:p,size:c}=i.getTransformFeedbackVarying(e.handle,a);this._addVarying(a,h,p,c)}this.varyingInfos.sort((a,h)=>a.location-h.location)}_addAttribute(e,i,s,a){const{type:h,components:p}=a1(s),c={type:h,size:a*p};this._inferProperties(e,i,c);const b={location:e,name:i,accessor:new Ur(c)};this.attributeInfos.push(b),this.attributeInfosByLocation[e]=b,this.attributeInfosByName[b.name]=b}_inferProperties(e,i,s){/instance/i.test(i)&&(s.divisor=1)}_addVarying(e,i,s,a){const{type:h,components:p}=a1(s),c=new Ur({type:h,size:a*p}),b={location:e,name:i,accessor:c};this.varyingInfos.push(b),this.varyingInfosByName[b.name]=b}}const l1=4,kk=35981,Rk=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class pb extends yo{get[Symbol.toStringTag](){return"Program"}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,i),this.stubRemovedMethods("Program","v6.0",Rk),this._isCached=!1,this.initialize(i),Object.seal(this),this._setId(i.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:i,vs:s,fs:a,varyings:h,bufferMode:p=kk}=e;return this.hash=i||"",this.vs=typeof s=="string"?new Np(this.gl,{id:"".concat(e.id,"-vs"),source:s}):s,this.fs=typeof a=="string"?new Up(this.gl,{id:"".concat(e.id,"-fs"),source:a}):a,bt(this.vs instanceof Np),bt(this.fs instanceof Up),this.uniforms={},this._textureUniforms={},h&&h.length>0&&(rr(this.gl),this.varyings=h,this.gl2.transformFeedbackVaryings(this.handle,h,p)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new Lk(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:i,drawMode:s=4,vertexCount:a,offset:h=0,start:p,end:c,isIndexed:b=!1,indexType:T=5123,instanceCount:P=0,isInstanced:k=P>0,vertexArray:C=null,transformFeedback:H,framebuffer:ee,parameters:se={},uniforms:pe,samplers:fe}=e;if((pe||fe)&&(Nt.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(pe||{})),Nt.priority>=i){const ye=ee?ee.id:"default",Se="mode=".concat(Qo(this.gl,s)," verts=").concat(a," ")+"instances=".concat(P," indexType=").concat(Qo(this.gl,T)," ")+"isInstanced=".concat(k," isIndexed=").concat(b," ")+"Framebuffer=".concat(ye);Nt.log(i,Se)()}return bt(C),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||a===0||k&&P===0?!1:(C.bindForDraw(a,P,()=>{if(ee!==void 0&&(se=Object.assign({},se,{framebuffer:ee})),H){const ye=Ck(s);H.begin(ye)}this._bindTextures(),gs(this.gl,se,()=>{b&&k?this.gl2.drawElementsInstanced(s,a,T,h,P):b&&yi(this.gl)&&!isNaN(p)&&!isNaN(c)?this.gl2.drawRangeElements(s,p,c,a,T,h):b?this.gl.drawElements(s,a,T,h):k?this.gl2.drawArraysInstanced(s,h,a,P):this.gl.drawArrays(s,h,a)}),H&&H.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Nt.priority>=2&&YL(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const i in e){const s=e[i],a=this._uniformSetters[i];if(a){let h=s,p=!1;if(h instanceof Bn&&(h=h.texture),h instanceof Ha)if(p=this.uniforms[i]!==s,p){a.textureIndex===void 0&&(a.textureIndex=this._textureIndexCounter++);const c=h,{textureIndex:b}=a;c.bind(b),h=b,this._textureUniforms[i]=c}else h=a.textureIndex;else this._textureUniforms[i]&&delete this._textureUniforms[i];(a(h)||p)&&JL(this.uniforms,i,s)}}return this}_areTexturesRenderable(){let e=!0;for(const i in this._textureUniforms){const s=this._textureUniforms[i];s.update(),e=e&&s.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const i=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(i)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const i=this.gl.getAttachedShaders(e),s={};for(const a of i)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:s.vs=new Np({handle:a});break;case 35632:s.fs=new Up({handle:a});break}return s}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const i=this._getName();this.id=ia(i)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Nt.time(l1,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Nt.timeEnd(l1,"linkProgram for ".concat(this._getName()))(),e.debug||Nt.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let i=0;i<this._uniformCount;i++){const s=this.gl.getActiveUniform(this.handle,i),{name:a}=XL(s.name);let h=e.getUniformLocation(this.handle,a);if(this._uniformSetters[a]=s1(e,h,s),s.size>1)for(let p=0;p<s.size;p++)h=e.getUniformLocation(this.handle,"".concat(a,"[").concat(p,"]")),this._uniformSetters["".concat(a,"[").concat(p,"]")]=s1(e,h,s)}this._textureIndexCounter=0}getActiveUniforms(e,i){return this.gl2.getActiveUniforms(this.handle,e,i)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,i){return this.gl2.getActiveUniformBlockParameter(this.handle,e,i)}uniformBlockBinding(e,i){this.gl2.uniformBlockBinding(this.handle,e,i)}}const Dk=34918,zk=34919,Ok=35007,Fk=36795,Bk=35976,Nk=35887,Uk=36202;class Bd extends yo{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const s=yi(e),a=cb(e,sn.TIMER_QUERY);let h=s||a;for(const p of i)switch(p){case"queries":h=h&&s;break;case"timers":h=h&&a;break;default:bt(!1)}return h}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,i),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(Ok)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?Uk:Nk)}beginTransformFeedbackQuery(){return this.begin(Bk)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,zk);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(Fk)}getResult(){return this.gl2.getQueryParameter(this.handle,Dk)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((s,a)=>{const h=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):i++>e?(a("Timed out"),this._pollingPromise=null):requestAnimationFrame(h)};requestAnimationFrame(h)}),this._pollingPromise}_createHandle(){return Bd.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class mb extends yo{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return yi(e)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};rr(e),super(e,i),this.initialize(i),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Zl(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const i in e)this.setBuffer(i,e[i])}),this}setBuffer(e,i){const s=this._getVaryingIndex(e),{buffer:a,byteSize:h,byteOffset:p}=this._getBufferParams(i);return s<0?(this.unused[e]=a,Nt.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[s]=i,this.bindOnUse||this._bindBuffer(s,a,p,h),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let i,s,a;return e instanceof qi?a=e:(a=e.buffer,s=e.byteSize,i=e.byteOffset),(i!==void 0||s!==void 0)&&(i=i||0,s=s||a.byteLength-i),{buffer:a,byteOffset:i,byteSize:s}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const i=Number(e);return Number.isFinite(i)?i:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:i,byteSize:s,byteOffset:a}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,i,a,s)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;const h=i&&i.handle;return!h||a===void 0?this.gl.bindBufferBase(35982,e,h):this.gl.bindBufferRange(35982,e,h,s,a),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let ad=null;function Vk(t){return(!ad||ad.byteLength<t)&&(ad=new ArrayBuffer(t)),ad}function jk(t,e){const i=Vk(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}function Gk(t){let{target:e,source:i,start:s=0,count:a=1}=t;const h=i.length,p=a*h;let c=0;for(let b=s;c<h;c++)e[b++]=i[c];for(;c<p;)c<p-c?(e.copyWithin(s+c,s,s+c),c*=2):(e.copyWithin(s+c,s,s+p-c),c=p);return e}const $k="elements must be GL.ELEMENT_ARRAY_BUFFER";class Br extends yo{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?yi(e)||zx()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Br(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Br.MAX_ATTRIBUTES=Br.MAX_ATTRIBUTES||e.getParameter(34921),Br.MAX_ATTRIBUTES}static setConstant(e,i,s){switch(s.constructor){case Float32Array:Br._setConstantFloatArray(e,i,s);break;case Int32Array:Br._setConstantIntArray(e,i,s);break;case Uint32Array:Br._setConstantUintArray(e,i,s);break;default:bt(!1)}}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=i.id||i.program&&i.program.id;super(e,Object.assign({},i,{id:s})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=i.isDefaultArray||!1,this.gl2=e,this.initialize(i),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Br.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return bt(!e||e.target===34963,$k),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,i,s){if(i.target===34963)return this.setElementBuffer(i,s);const{size:a,type:h,stride:p,offset:c,normalized:b,integer:T,divisor:P}=s,{gl:k,gl2:C}=this;return e=Number(e),this.bind(()=>{k.bindBuffer(34962,i.handle),T?(bt(yi(k)),C.vertexAttribIPointer(e,a,h,p,c)):k.vertexAttribPointer(e,a,h,b,p,c),k.enableVertexAttribArray(e),C.vertexAttribDivisor(e,P||0)}),this}enable(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!i&&e===0&&!Br.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>i?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,i){const s=this._normalizeConstantArrayValue(i),a=s.byteLength*e,h=s.length*e;let p=!this.buffer;if(this.buffer=this.buffer||new qi(this.gl,a),p=p||this.buffer.reallocate(a),p=p||!this._compareConstantArrayValues(s,this.bufferValue),p){const c=jk(i.constructor,h);Gk({target:c,source:s,start:0,count:h}),this.buffer.subData(c),this.bufferValue=i}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,i){if(!e||!i||e.length!==i.length||e.constructor!==i.constructor)return!1;for(let s=0;s<e.length;++s)if(e[s]!==i[s])return!1;return!0}static _setConstantFloatArray(e,i,s){switch(s.length){case 1:e.vertexAttrib1fv(i,s);break;case 2:e.vertexAttrib2fv(i,s);break;case 3:e.vertexAttrib3fv(i,s);break;case 4:e.vertexAttrib4fv(i,s);break;default:bt(!1)}}static _setConstantIntArray(e,i,s){switch(bt(yi(e)),s.length){case 1:e.vertexAttribI1iv(i,s);break;case 2:e.vertexAttribI2iv(i,s);break;case 3:e.vertexAttribI3iv(i,s);break;case 4:e.vertexAttribI4iv(i,s);break;default:bt(!1)}}static _setConstantUintArray(e,i,s){switch(bt(yi(e)),s.length){case 1:e.vertexAttribI1uiv(i,s);break;case 2:e.vertexAttribI2uiv(i,s);break;case 3:e.vertexAttribI3uiv(i,s);break;case 4:e.vertexAttribI4uiv(i,s);break;default:bt(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,i){let{location:s}=i;return bt(Number.isFinite(s)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(s,e);default:return this.gl.getVertexAttrib(s,e)}})}}const Hk="VertexArray: attributes must be Buffers or constants (i.e. typed array)",qk=/^(.+)__LOCATION_([0-9]+)$/,Wk=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class Zk{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=i.id||i.program&&i.program.id;this.id=s,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Br(e),tb(this,"VertexArray","v6.0",Wk),this.initialize(i),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const i in e){const s=e[i];this._setAttribute(i,s)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=i,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,i),this}setBuffer(e,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(i.target===34963)return this.setElementBuffer(i,s);const{location:a,accessor:h}=this._resolveLocationAndAccessor(e,i,i.accessor,s);return a>=0&&(this.values[a]=i,this.accessors[a]=h,this.clearDrawParams(),this.vertexArrayObject.setBuffer(a,i,h)),this}setConstant(e,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:a,accessor:h}=this._resolveLocationAndAccessor(e,i,Object.assign({size:i.length},s));return a>=0&&(i=this.vertexArrayObject._normalizeConstantArrayValue(i),this.values[a]=i,this.accessors[a]=h,this.clearDrawParams(),this.vertexArrayObject.enable(a,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new qi(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof qi&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const i=this.values[e];i instanceof qi&&this.setBuffer(e,i)}}),this}bindForDraw(e,i,s){let a;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,i),a=s()}),a}_resolveLocationAndAccessor(e,i,s,a){const h={location:-1,accessor:null},{location:p,name:c}=this._getAttributeIndex(e);if(!Number.isFinite(p)||p<0)return this.unused[e]=i,Nt.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),h;const b=this._getAttributeInfo(c||p);if(!b)return h;const T=this.accessors[p]||{},P=Ur.resolve(b.accessor,T,s,a),{size:k,type:C}=P;return bt(Number.isFinite(k)&&Number.isFinite(C)),{location:p,accessor:P}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const i=Number(e);if(Number.isFinite(i))return{location:i};const s=qk.exec(e),a=s?s[1]:e,h=s?Number(s[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(a)+h,name:a}:{location:-1}}_setAttribute(e,i){if(i instanceof qi)this.setBuffer(e,i);else if(Array.isArray(i)&&i.length&&i[0]instanceof qi){const s=i[0],a=i[1];this.setBuffer(e,s,a)}else if(ArrayBuffer.isView(i)||Array.isArray(i)){const s=i;this.setConstant(e,s)}else if(i.buffer instanceof qi){const s=i;this.setBuffer(e,s.buffer,s)}else throw new Error(Hk)}_setConstantAttributes(e,i){const s=Math.max(e|0,i|0);let a=this.values[0];ArrayBuffer.isView(a)&&this._setConstantAttributeZero(a,s);for(let h=1;h<this.vertexArrayObject.MAX_ATTRIBUTES;h++)a=this.values[h],ArrayBuffer.isView(a)&&this._setConstantAttribute(h,a)}_setConstantAttributeZero(e,i){if(Br.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const s=this.vertexArrayObject.getConstantBuffer(i,e);this.vertexArrayObject.setBuffer(0,s,this.accessors[0])}_setConstantAttribute(e,i){Br.setConstant(this.gl,e,i)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let i=0;i<this.vertexArrayObject.MAX_ATTRIBUTES;i++)this._updateDrawParamsForLocation(e,i);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,i){const s=this.values[i],a=this.accessors[i];if(!s)return;const{divisor:h}=a,p=h>0;if(e.isInstanced=e.isInstanced||p,s instanceof qi){const c=s;if(p){const b=c.getVertexCount(a);e.instanceCount=Math.min(e.instanceCount,b)}else{const b=c.getVertexCount(a);e.vertexCount=Math.min(e.vertexCount,b)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Nt.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,i)}}function Xk(t,e){const{maxElts:i=16,size:s=1}=e;let a="[";for(let p=0;p<t.length&&p<i;++p)p>0&&(a+=",".concat(p%s===0?" ":"")),a+=ku(t[p],e);const h=t.length>i?"...":"]";return"".concat(a).concat(h)}function ku(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=1e-16,{isInteger:s=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return Xk(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<i)return s?"0":"0.";if(s||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const a=t.toPrecision(2);return a.indexOf(".0")===a.length-2?a.slice(0,-1):a}function c1(t){let{header:e="Uniforms",program:i,uniforms:s,undefinedOnly:a=!1}=t;bt(i);const h=".*_.*",p=".*Matrix",c=i._uniformSetters,b={},T=Object.keys(c).sort();let P=0;for(const H of T)!H.match(h)&&!H.match(p)&&Vp({table:b,header:e,uniforms:s,uniformName:H,undefinedOnly:a})&&P++;for(const H of T)H.match(p)&&Vp({table:b,header:e,uniforms:s,uniformName:H,undefinedOnly:a})&&P++;for(const H of T)b[H]||Vp({table:b,header:e,uniforms:s,uniformName:H,undefinedOnly:a})&&P++;let k=0;const C={};if(!a)for(const H in s){const ee=s[H];b[H]||(k++,C[H]={Type:"NOT USED: ".concat(ee),[e]:ku(ee)})}return{table:b,count:P,unusedTable:C,unusedCount:k}}function Vp(t){let{table:e,header:i,uniforms:s,uniformName:a,undefinedOnly:h}=t;const p=s[a],c=Yk(p);return!h||!c?(e[a]={[i]:c?ku(p):"N/A","Uniform Type":c?p:"NOT PROVIDED"},!0):!1}function Yk(t){return t!=null}function Kk(t){let{vertexArray:e,header:i="Attributes"}=t;if(!e.configuration)return{};const s={};e.elements&&(s.ELEMENT_ARRAY_BUFFER=u1(e,e.elements,null,i));const a=e.values;for(const h in a){const p=e._getAttributeInfo(h);if(p){let c="".concat(h,": ").concat(p.name);const b=e.accessors[p.location];b&&(c="".concat(h,": ").concat(Jk(p.name,b))),s[c]=u1(e,a[h],b,i)}}return s}function u1(t,e,i,s){const{gl:a}=t;if(!e)return{[s]:"null","Format ":"N/A"};let h="NOT PROVIDED",p=1,c=0,b=0,T,P,k;if(i&&(h=i.type,p=i.size,h=String(h).replace("Array",""),T=h.indexOf("nt")!==-1),e instanceof qi){const C=e,{data:H,changed:ee}=C.getDebugData();P=ee?"*":"",k=H,b=C.byteLength,c=b/H.BYTES_PER_ELEMENT/p;let se;if(i){const pe=i.divisor>0;se="".concat(pe?"I ":"P "," ").concat(c," (x").concat(p,"=").concat(b," bytes ").concat(Qo(a,h),")")}else T=!0,se="".concat(b," bytes");return{[s]:"".concat(P).concat(ku(k,{size:p,isInteger:T})),"Format ":se}}return k=e,p=e.length,h=String(e.constructor.name).replace("Array",""),T=h.indexOf("nt")!==-1,{[s]:"".concat(ku(k,{size:p,isInteger:T})," (constant)"),"Format ":"".concat(p,"x").concat(h," (constant)")}}function Jk(t,e){const{type:i,size:s}=e,a=fb(i,s);return a?"".concat(t," (").concat(a.name,")"):t}function Qk(t){const e={},i="Accessors for ".concat(t.id);for(const s of t.attributeInfos)if(s){const a=h1(s);e["in ".concat(a)]={[i]:JSON.stringify(s.accessor)}}for(const s of t.varyingInfos)if(s){const a=h1(s);e["out ".concat(a)]={[i]:JSON.stringify(s.accessor)}}return e}function h1(t){const{type:e,size:i}=t.accessor,s=fb(e,i);return s?"".concat(s.name," ").concat(t.name):t.name}const d1=_o()&&typeof document<"u";let eR=0;class tR{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:i=pe=>eb(pe),onAddHTML:s=null,onInitialize:a=()=>{},onRender:h=()=>{},onFinalize:p=()=>{},onError:c,gl:b=null,glOptions:T={},debug:P=!1,createFramebuffer:k=!1,autoResizeViewport:C=!0,autoResizeDrawingBuffer:H=!0,stats:ee=Ba.get("animation-loop-".concat(eR++))}=e;let{useDevicePixels:se=!0}=e;"useDevicePixelRatio"in e&&(Nt.deprecated("useDevicePixelRatio","useDevicePixels")(),se=e.useDevicePixelRatio),this.props={onCreateContext:i,onAddHTML:s,onInitialize:a,onRender:h,onFinalize:p,onError:c,gl:b,glOptions:T,debug:P,createFramebuffer:k},this.gl=b,this.needsRedraw=null,this.timeline=null,this.stats=ee,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:C,autoResizeDrawingBuffer:H,useDevicePixels:se}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return bt(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const i=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Bd.isSupported(this.gl,["timers"])?new Bd(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(s=>{this._running&&(this._addCallbackData(s||{}),s!==!1&&this._startLoop())});return this.props.onError&&i.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=document.getElementById(e);return s?Number(s.value):i}setViewParameters(){return Nt.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=d1?new Promise((e,i)=>{if(d1&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):aL(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):oL(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:i,aspect:s}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),s!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=s,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Lg(this.props.gl,e):this.onCreateContext(e),!uf(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");W3(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(i);const s=this.props.onAddHTML(i);s&&(i.innerHTML=s)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,i=this.gl.drawingBufferHeight;let s=1;const{canvas:a}=this.gl;return a&&a.clientHeight?s=a.clientWidth/a.clientHeight:e>0&&i>0&&(s=e/i),{width:e,height:i,aspect:s}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&J3(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Bn(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const qu="vs",zg="fs";function jr(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const jp={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function iR(t){const e={};for(const i in t){const s=t[i],a=nR(s);e[i]=a}return e}function nR(t){let e=f1(t);return e==="object"?t?"type"in t?Object.assign({},t,jp[t.type]):"value"in t?(e=f1(t.value),Object.assign({type:e},t,jp[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},jp[e])}function f1(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const rR="vs",sR="fs";class p1{constructor(e){let{name:i,vs:s,fs:a,dependencies:h=[],uniforms:p,getUniforms:c,deprecations:b=[],defines:T={},inject:P={},vertexShader:k,fragmentShader:C}=e;jr(typeof i=="string"),this.name=i,this.vs=s||k,this.fs=a||C,this.getModuleUniforms=c,this.dependencies=h,this.deprecations=this._parseDeprecationDefinitions(b),this.defines=T,this.injections=oR(P),p&&(this.uniforms=iR(p))}getModuleSource(e){let i;switch(e){case rR:i=this.vs||"";break;case sR:i=this.fs||"";break;default:jr(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(i,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,i){return this.getModuleUniforms?this.getModuleUniforms(e,i):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,i){this.deprecations.forEach(s=>{s.regex.test(e)&&(s.deprecated?i.deprecated(s.old,s.new)():i.removed(s.old,s.new)())})}_parseDeprecationDefinitions(e){return e.forEach(i=>{switch(i.type){case"function":i.regex=new RegExp("\\b".concat(i.old,"\\("));break;default:i.regex=new RegExp("".concat(i.type," ").concat(i.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={},s=this.uniforms;for(const a in s){const h=s[a];a in e&&!h.private?(h.validate&&jr(h.validate(e[a],h),"".concat(this.name,": invalid ").concat(a)),i[a]=e[a]):i[a]=h.value}return i}}function oR(t){const e={vs:{},fs:{}};for(const i in t){let s=t[i];const a=i.slice(0,2);typeof s=="string"&&(s={order:0,injection:s}),e[a][i]=s}return e}function aR(t){return lR(_b(t))}function lR(t){const e={},i={};return gb({modules:t,level:0,moduleMap:e,moduleDepth:i}),Object.keys(i).sort((s,a)=>i[a]-i[s]).map(s=>e[s])}function gb(t){let{modules:e,level:i,moduleMap:s,moduleDepth:a}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const h of e)s[h.name]=h,(a[h.name]===void 0||a[h.name]<i)&&(a[h.name]=i);for(const h of e)h.dependencies&&gb({modules:h.dependencies,level:i+1,moduleMap:s,moduleDepth:a})}function _b(t,e){return t.map(i=>(i instanceof p1||(jr(typeof i!="string","Shader module use by name is deprecated. Import shader module '".concat(i,"' and use it directly.")),jr(i.name,"shader module has no name"),i=new p1(i),i.dependencies=_b(i.dependencies)),i))}function cR(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},i=t.userAgent||e.userAgent||"",s=i.indexOf("MSIE ")!==-1,a=i.indexOf("Trident/")!==-1;return s||a}const uR=7936,hR=7937,dR=7938,fR=35724,Og={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},za={};Object.keys(Og).forEach(t=>{za[t]=t});function pR(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function mR(t){const e=t.getExtension("WEBGL_debug_renderer_info"),i=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||uR),s=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||hR);return{gpuVendor:gR(i,s),vendor:i,renderer:s,version:t.getParameter(dR),shadingLanguageVersion:t.getParameter(fR)}}function gR(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const Gp={};function m1(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=Og[e];if(jr(s,e),!cR(i))return!0;if(e in Gp)return Gp[e];const a=s[0],h=i.behavior||"enable",p="#extension GL_".concat(a," : ").concat(h,`
void main(void) {}`),c=t.createShader(35633);t.shaderSource(c,p),t.compileShader(c);const b=t.getShaderParameter(c,35713);return t.deleteShader(c),Gp[e]=b,b}function _R(t,e){const i=Og[e];jr(i,e);const s=pR(t)&&i[1]||i[0],a=typeof s=="string"?Boolean(t.getExtension(s)):s;return jr(a===!1||a===!0),a}function ld(t,e){return e=Array.isArray(e)?e:[e],e.every(i=>_R(t,i))}function yR(t){switch(mR(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function vR(t,e,i){let s=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return ld(t,za.GLSL_FRAG_DEPTH)&&(s+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),ld(t,za.GLSL_DERIVATIVES)&&m1(t,za.GLSL_DERIVATIVES)&&(s+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),ld(t,za.GLSL_FRAG_DATA)&&m1(t,za.GLSL_FRAG_DATA,{behavior:"require"})&&(s+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),ld(t,za.GLSL_TEXTURE_LOD)&&(s+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),s}const xR=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,bR=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,wR={[qu]:xR,[zg]:bR},wd="__LUMA_INJECT_DECLARATIONS__",g1=/void\s+main\s*\([^)]*\)\s*\{\n?/,_1=/}\n?[^{}]*$/,$p=[];function y1(t,e,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const a=e===qu;for(const h in i){const p=i[h];p.sort((b,T)=>b.order-T.order),$p.length=p.length;for(let b=0,T=p.length;b<T;++b)$p[b]=p[b].injection;const c="".concat($p.join(`
`),`
`);switch(h){case"vs:#decl":a&&(t=t.replace(wd,c));break;case"vs:#main-start":a&&(t=t.replace(g1,b=>b+c));break;case"vs:#main-end":a&&(t=t.replace(_1,b=>c+b));break;case"fs:#decl":a||(t=t.replace(wd,c));break;case"fs:#main-start":a||(t=t.replace(g1,b=>b+c));break;case"fs:#main-end":a||(t=t.replace(_1,b=>c+b));break;default:t=t.replace(h,b=>b+c)}}return t=t.replace(wd,""),s&&(t=t.replace(/\}\s*$/,h=>h+wR[e])),t}function Dm(t){const e={};return jr(Array.isArray(t)&&t.length>1),t.forEach(i=>{for(const s in i)e[s]=e[s]?"".concat(e[s],`
`).concat(i[s]):i[s]}),e}function Xl(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const yb=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],ER=[...yb,[Xl("attribute"),"in $1"],[Xl("varying"),"out $1"]],TR=[...yb,[Xl("varying"),"in $1"]],vb=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],AR=[...vb,[Xl("in"),"attribute $1"],[Xl("out"),"varying $1"]],SR=[...vb,[Xl("in"),"varying $1"]],zm="gl_FragColor",Om=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,IR=/void\s+main\s*\([^)]*\)\s*\{\n?/;function PR(t,e,i){switch(e){case 300:return i?Nd(t,ER):MR(t);case 100:return i?Nd(t,AR):CR(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Nd(t,e){for(const[i,s]of e)t=t.replace(i,s);return t}function MR(t){t=Nd(t,TR);const e=t.match(Om);if(e){const i=e[1];t=t.replace(new RegExp("\\b".concat(zm,"\\b"),"g"),i)}else{const i="fragmentColor";t=t.replace(IR,s=>"out vec4 ".concat(i,`;
`).concat(s)).replace(new RegExp("\\b".concat(zm,"\\b"),"g"),i)}return t}function CR(t){t=Nd(t,SR);const e=t.match(Om);if(e){const i=e[1];t=t.replace(Om,"").replace(new RegExp("\\b".concat(i,"\\b"),"g"),zm)}return t}const LR=`

`.concat(wd,`

`),xb={[qu]:"vertex",[zg]:"fragment"},kR=`precision highp float;

`;function RR(t,e){const{vs:i,fs:s}=e,a=aR(e.modules||[]);return{gl:t,vs:v1(t,Object.assign({},e,{source:i,type:qu,modules:a})),fs:v1(t,Object.assign({},e,{source:s,type:zg,modules:a})),getUniforms:DR(a)}}function v1(t,e){let{id:i,source:s,type:a,modules:h,defines:p={},hookFunctions:c=[],inject:b={},transpileToGLSL100:T=!1,prologue:P=!0,log:k}=e;jr(typeof s=="string","shader source must be a string");const C=a===qu,H=s.split(`
`);let ee=100,se="",pe=s;H[0].indexOf("#version ")===0?(ee=300,se=H[0],pe=H.slice(1).join(`
`)):se="#version ".concat(ee);const fe={};h.forEach(Qe=>{Object.assign(fe,Qe.getDefines())}),Object.assign(fe,p);let ye=P?"".concat(se,`
`).concat(OR({id:i,source:s,type:a}),`
`).concat(zR({type:a}),`
`).concat(yR(t),`
`).concat(vR(t),`
`).concat(FR(fe),`
`).concat(C?"":kR,`
`):"".concat(se,`
`);const Se=NR(c),Ue={},$e={},Ye={};for(const Qe in b){const at=typeof b[Qe]=="string"?{injection:b[Qe],order:0}:b[Qe],wt=Qe.match(/^(v|f)s:(#)?([\w-]+)$/);if(wt){const Mt=wt[2],Lt=wt[3];Mt?Lt==="decl"?$e[Qe]=[at]:Ye[Qe]=[at]:Ue[Qe]=[at]}else Ye[Qe]=[at]}for(const Qe of h){k&&Qe.checkDeprecations(pe,k);const at=Qe.getModuleSource(a,ee);ye+=at;const wt=Qe.injections[a];for(const Mt in wt){const Lt=Mt.match(/^(v|f)s:#([\w-]+)$/);if(Lt){const gi=Lt[2]==="decl"?$e:Ye;gi[Mt]=gi[Mt]||[],gi[Mt].push(wt[Mt])}else Ue[Mt]=Ue[Mt]||[],Ue[Mt].push(wt[Mt])}}return ye+=LR,ye=y1(ye,a,$e),ye+=BR(Se[a],Ue),ye+=pe,ye=y1(ye,a,Ye),ye=PR(ye,T?100:ee,C),ye}function DR(t){return function(i){const s={};for(const a of t){const h=a.getUniforms(i,s);Object.assign(s,h)}return s}}function zR(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(xb[e].toUpperCase(),`
`)}function OR(t){let{id:e,source:i,type:s}=t;return e&&typeof e=="string"&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(xb[s],`

`):""}function FR(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,i="";for(const s in t){e===0&&(i+=`
// APPLICATION DEFINES
`),e++;const a=t[s];(a||Number.isFinite(a))&&(i+="#define ".concat(s.toUpperCase()," ").concat(t[s],`
`))}return e===0&&(i+=`
`),i}function BR(t,e){let i="";for(const s in t){const a=t[s];if(i+="void ".concat(a.signature,` {
`),a.header&&(i+="  ".concat(a.header)),e[s]){const h=e[s];h.sort((p,c)=>p.order-c.order);for(const p of h)i+="  ".concat(p.injection,`
`)}a.footer&&(i+="  ".concat(a.footer)),i+=`}
`}return i}function NR(t){const e={vs:{},fs:{}};return t.forEach(i=>{let s;typeof i!="string"?(s=i,i=s.hook):s={},i=i.trim();const[a,h]=i.split(":"),p=i.replace(/\(.+/,"");e[a][p]=Object.assign(s,{signature:h})}),e}const UR="void main() {gl_FragColor = vec4(0);}",bb=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,VR=`#version 300 es
`.concat(bb);function wb(t,e){e=Array.isArray(e)?e:[e];const i=t.replace(/^\s+/,"").split(/\s+/),[s,a,h]=i;if(!e.includes(s)||!a||!h)return null;const p=h.split(";")[0];return{qualifier:s,type:a,name:p}}function Eb(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:i,inputType:s,output:a}=t;if(!i)return e===300?VR:e>300?"#version ".concat(e,`
`).concat(bb):UR;const h=$R(i,s);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(s," ").concat(i,`;
out vec4 `).concat(a,`;
void main() {
  `).concat(a," = ").concat(h,`;
}`):"varying ".concat(s," ").concat(i,`;
void main() {
  gl_FragColor = `).concat(h,`;
}`)}function jR(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return jr(!1),null}}function GR(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return jr(!1),null}}function $R(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return jr(!1),null}}const HR=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,qR={name:"fp32",vs:HR,fs:null};function x1(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Vr={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function WR(t,{precision:e=Vr.precision}={}){return t=ZR(t),"".concat(parseFloat(t.toPrecision(e)))}function Yl(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Xo(t,e,i){return YR(t,s=>Math.max(e,Math.min(i,s)))}function Ud(t,e,i){return Yl(t)?t.map((s,a)=>Ud(s,e[a],i)):i*e+(1-i)*t}function Ru(t,e,i){const s=Vr.EPSILON;i&&(Vr.EPSILON=i);try{if(t===e)return!0;if(Yl(t)&&Yl(e)){if(t.length!==e.length)return!1;for(let a=0;a<t.length;++a)if(!Ru(t[a],e[a]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Vr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Vr.EPSILON=s}}function ZR(t){return Math.round(t/Vr.EPSILON)*Vr.EPSILON}function XR(t){return t.clone?t.clone():new Array(t.length)}function YR(t,e,i){if(Yl(t)){const s=t;i=i||XR(s);for(let a=0;a<i.length&&a<s.length;++a)i[a]=e(t[a],a,i);return i}return e(t)}function KR(t){function e(){var i=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(i,Object.getPrototypeOf(this)),i}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class Tb extends KR(Array){clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=e[s+i];return this.check()}toArray(e=[],i=0){for(let s=0;s<this.ELEMENTS;++s)e[i+s]=this[s];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Yl(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Vr)}formatString(e){let i="";for(let s=0;s<this.ELEMENTS;++s)i+=(s>0?", ":"")+WR(this[s],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(i,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!Ru(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,s){if(s===void 0)return this.lerp(this,e,i);for(let a=0;a<this.ELEMENTS;++a){const h=e[a];this[a]=h+s*(i[a]-h)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e[s]),i[s]);return this.check()}add(...e){for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(...e){for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(Vr.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e),i);return this.check()}get elements(){return this}}function JR(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function Nr(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Hp(t,e,i=""){if(Vr.debug&&!JR(t,e))throw new Error("math.gl: ".concat(i," some fields set to invalid numbers'"));return t}class QR extends Tb{get x(){return this[0]}set x(e){this[0]=Nr(e)}get y(){return this[1]}set y(e){this[1]=Nr(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let s=0;s<this.ELEMENTS;++s){const a=this[s]-e[s];i+=a*a}return Nr(i)}dot(e){let i=0;for(let s=0;s<this.ELEMENTS;++s)i+=this[s]*e[s];return Nr(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(...e){for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return x1(e>=0&&e<this.ELEMENTS,"index is out of range"),Nr(this[e])}setComponent(e,i){return x1(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}var Ed=1e-6,Kl=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function eD(){var t=new Kl(2);return Kl!=Float32Array&&(t[0]=0,t[1]=0),t}function b1(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function tD(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Ab(t,e,i,s){var a=e[0],h=e[1];return t[0]=a+s*(i[0]-a),t[1]=h+s*(i[1]-h),t}function iD(t,e,i){var s=e[0],a=e[1];return t[0]=i[0]*s+i[4]*a+i[12],t[1]=i[1]*s+i[5]*a+i[13],t}(function(){var t=eD();return function(e,i,s,a,h,p){var c,b;for(i||(i=2),s||(s=0),a?b=Math.min(a*i+s,e.length):b=e.length,c=s;c<b;c+=i)t[0]=e[c],t[1]=e[c+1],h(t,t,p),e[c]=t[0],e[c+1]=t[1];return e}})();function nD(t,e,i){const s=e[0],a=e[1],h=i[3]*s+i[7]*a||1;return t[0]=(i[0]*s+i[4]*a)/h,t[1]=(i[1]*s+i[5]*a)/h,t}function Sb(t,e,i){const s=e[0],a=e[1],h=e[2],p=i[3]*s+i[7]*a+i[11]*h||1;return t[0]=(i[0]*s+i[4]*a+i[8]*h)/p,t[1]=(i[1]*s+i[5]*a+i[9]*h)/p,t[2]=(i[2]*s+i[6]*a+i[10]*h)/p,t}function rD(t,e,i){const s=e[0],a=e[1];return t[0]=i[0]*s+i[2]*a,t[1]=i[1]*s+i[3]*a,t[2]=e[2],t}function sD(){var t=new Kl(3);return Kl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function oD(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function aD(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function lD(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function cD(t,e,i){var s=e[0],a=e[1],h=e[2],p=i[0],c=i[1],b=i[2];return t[0]=a*b-h*c,t[1]=h*p-s*b,t[2]=s*c-a*p,t}function Ib(t,e,i){var s=e[0],a=e[1],h=e[2],p=i[3]*s+i[7]*a+i[11]*h+i[15];return p=p||1,t[0]=(i[0]*s+i[4]*a+i[8]*h+i[12])/p,t[1]=(i[1]*s+i[5]*a+i[9]*h+i[13])/p,t[2]=(i[2]*s+i[6]*a+i[10]*h+i[14])/p,t}function uD(t,e,i){var s=e[0],a=e[1],h=e[2];return t[0]=s*i[0]+a*i[3]+h*i[6],t[1]=s*i[1]+a*i[4]+h*i[7],t[2]=s*i[2]+a*i[5]+h*i[8],t}function hD(t,e,i){var s=i[0],a=i[1],h=i[2],p=i[3],c=e[0],b=e[1],T=e[2],P=a*T-h*b,k=h*c-s*T,C=s*b-a*c,H=a*C-h*k,ee=h*P-s*C,se=s*k-a*P,pe=p*2;return P*=pe,k*=pe,C*=pe,H*=2,ee*=2,se*=2,t[0]=c+P+H,t[1]=b+k+ee,t[2]=T+C+se,t}function dD(t,e,i,s){var a=[],h=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],h[0]=a[0],h[1]=a[1]*Math.cos(s)-a[2]*Math.sin(s),h[2]=a[1]*Math.sin(s)+a[2]*Math.cos(s),t[0]=h[0]+i[0],t[1]=h[1]+i[1],t[2]=h[2]+i[2],t}function fD(t,e,i,s){var a=[],h=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],h[0]=a[2]*Math.sin(s)+a[0]*Math.cos(s),h[1]=a[1],h[2]=a[2]*Math.cos(s)-a[0]*Math.sin(s),t[0]=h[0]+i[0],t[1]=h[1]+i[1],t[2]=h[2]+i[2],t}function pD(t,e,i,s){var a=[],h=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],h[0]=a[0]*Math.cos(s)-a[1]*Math.sin(s),h[1]=a[0]*Math.sin(s)+a[1]*Math.cos(s),h[2]=a[2],t[0]=h[0]+i[0],t[1]=h[1]+i[1],t[2]=h[2]+i[2],t}function mD(t,e){var i=t[0],s=t[1],a=t[2],h=e[0],p=e[1],c=e[2],b=Math.sqrt(i*i+s*s+a*a),T=Math.sqrt(h*h+p*p+c*c),P=b*T,k=P&&lD(t,e)/P;return Math.acos(Math.min(Math.max(k,-1),1))}var gD=oD;(function(){var t=sD();return function(e,i,s,a,h,p){var c,b;for(i||(i=3),s||(s=0),a?b=Math.min(a*i+s,e.length):b=e.length,c=s;c<b;c+=i)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],h(t,t,p),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2];return e}})();const qp=[0,0,0];let cd;class js extends QR{static get ZERO(){return cd||(cd=new js(0,0,0),Object.freeze(cd)),cd}constructor(e=0,i=0,s=0){super(-0,-0,-0),arguments.length===1&&Yl(e)?this.copy(e):(Vr.debug&&(Nr(e),Nr(i),Nr(s)),this[0]=e,this[1]=i,this[2]=s)}set(e,i,s){return this[0]=e,this[1]=i,this[2]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Vr.debug&&(Nr(e.x),Nr(e.y),Nr(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Nr(e)}angle(e){return mD(this,e)}cross(e){return cD(this,this,e),this.check()}rotateX({radians:e,origin:i=qp}){return dD(this,this,i,e),this.check()}rotateY({radians:e,origin:i=qp}){return fD(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=qp}){return pD(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Ib(this,this,e),this.check()}transformAsVector(e){return Sb(this,this,e),this.check()}transformByMatrix3(e){return uD(this,this,e),this.check()}transformByMatrix2(e){return rD(this,this,e),this.check()}transformByQuaternion(e){return hD(this,this,e),this.check()}}class _D extends Tb{toString(){let e="[";if(Vr.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let s=0;s<this.RANK;++s)e+=" ".concat(this[s*this.RANK+i])}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=" ".concat(this[i])}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,s){return this[i*this.RANK+e]=Nr(s),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const s=e*this.RANK;for(let a=0;a<this.RANK;++a)i[a]=this[s+a];return i}setColumn(e,i){const s=e*this.RANK;for(let a=0;a<this.RANK;++a)this[s+a]=i[a];return this}}function yD(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vD(t,e){if(t===e){var i=e[1],s=e[2],a=e[3],h=e[6],p=e[7],c=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=h,t[11]=e[14],t[12]=a,t[13]=p,t[14]=c}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Fm(t,e){var i=e[0],s=e[1],a=e[2],h=e[3],p=e[4],c=e[5],b=e[6],T=e[7],P=e[8],k=e[9],C=e[10],H=e[11],ee=e[12],se=e[13],pe=e[14],fe=e[15],ye=i*c-s*p,Se=i*b-a*p,Ue=i*T-h*p,$e=s*b-a*c,Ye=s*T-h*c,Qe=a*T-h*b,at=P*se-k*ee,wt=P*pe-C*ee,Mt=P*fe-H*ee,Lt=k*pe-C*se,ei=k*fe-H*se,gi=C*fe-H*pe,Ut=ye*gi-Se*ei+Ue*Lt+$e*Mt-Ye*wt+Qe*at;return Ut?(Ut=1/Ut,t[0]=(c*gi-b*ei+T*Lt)*Ut,t[1]=(a*ei-s*gi-h*Lt)*Ut,t[2]=(se*Qe-pe*Ye+fe*$e)*Ut,t[3]=(C*Ye-k*Qe-H*$e)*Ut,t[4]=(b*Mt-p*gi-T*wt)*Ut,t[5]=(i*gi-a*Mt+h*wt)*Ut,t[6]=(pe*Ue-ee*Qe-fe*Se)*Ut,t[7]=(P*Qe-C*Ue+H*Se)*Ut,t[8]=(p*ei-c*Mt+T*at)*Ut,t[9]=(s*Mt-i*ei-h*at)*Ut,t[10]=(ee*Ye-se*Ue+fe*ye)*Ut,t[11]=(k*Ue-P*Ye-H*ye)*Ut,t[12]=(c*wt-p*Lt-b*at)*Ut,t[13]=(i*Lt-s*wt+a*at)*Ut,t[14]=(se*Se-ee*$e-pe*ye)*Ut,t[15]=(P*$e-k*Se+C*ye)*Ut,t):null}function xD(t){var e=t[0],i=t[1],s=t[2],a=t[3],h=t[4],p=t[5],c=t[6],b=t[7],T=t[8],P=t[9],k=t[10],C=t[11],H=t[12],ee=t[13],se=t[14],pe=t[15],fe=e*p-i*h,ye=e*c-s*h,Se=e*b-a*h,Ue=i*c-s*p,$e=i*b-a*p,Ye=s*b-a*c,Qe=T*ee-P*H,at=T*se-k*H,wt=T*pe-C*H,Mt=P*se-k*ee,Lt=P*pe-C*ee,ei=k*pe-C*se;return fe*ei-ye*Lt+Se*Mt+Ue*wt-$e*at+Ye*Qe}function Va(t,e,i){var s=e[0],a=e[1],h=e[2],p=e[3],c=e[4],b=e[5],T=e[6],P=e[7],k=e[8],C=e[9],H=e[10],ee=e[11],se=e[12],pe=e[13],fe=e[14],ye=e[15],Se=i[0],Ue=i[1],$e=i[2],Ye=i[3];return t[0]=Se*s+Ue*c+$e*k+Ye*se,t[1]=Se*a+Ue*b+$e*C+Ye*pe,t[2]=Se*h+Ue*T+$e*H+Ye*fe,t[3]=Se*p+Ue*P+$e*ee+Ye*ye,Se=i[4],Ue=i[5],$e=i[6],Ye=i[7],t[4]=Se*s+Ue*c+$e*k+Ye*se,t[5]=Se*a+Ue*b+$e*C+Ye*pe,t[6]=Se*h+Ue*T+$e*H+Ye*fe,t[7]=Se*p+Ue*P+$e*ee+Ye*ye,Se=i[8],Ue=i[9],$e=i[10],Ye=i[11],t[8]=Se*s+Ue*c+$e*k+Ye*se,t[9]=Se*a+Ue*b+$e*C+Ye*pe,t[10]=Se*h+Ue*T+$e*H+Ye*fe,t[11]=Se*p+Ue*P+$e*ee+Ye*ye,Se=i[12],Ue=i[13],$e=i[14],Ye=i[15],t[12]=Se*s+Ue*c+$e*k+Ye*se,t[13]=Se*a+Ue*b+$e*C+Ye*pe,t[14]=Se*h+Ue*T+$e*H+Ye*fe,t[15]=Se*p+Ue*P+$e*ee+Ye*ye,t}function Vd(t,e,i){var s=i[0],a=i[1],h=i[2],p,c,b,T,P,k,C,H,ee,se,pe,fe;return e===t?(t[12]=e[0]*s+e[4]*a+e[8]*h+e[12],t[13]=e[1]*s+e[5]*a+e[9]*h+e[13],t[14]=e[2]*s+e[6]*a+e[10]*h+e[14],t[15]=e[3]*s+e[7]*a+e[11]*h+e[15]):(p=e[0],c=e[1],b=e[2],T=e[3],P=e[4],k=e[5],C=e[6],H=e[7],ee=e[8],se=e[9],pe=e[10],fe=e[11],t[0]=p,t[1]=c,t[2]=b,t[3]=T,t[4]=P,t[5]=k,t[6]=C,t[7]=H,t[8]=ee,t[9]=se,t[10]=pe,t[11]=fe,t[12]=p*s+P*a+ee*h+e[12],t[13]=c*s+k*a+se*h+e[13],t[14]=b*s+C*a+pe*h+e[14],t[15]=T*s+H*a+fe*h+e[15]),t}function Fg(t,e,i){var s=i[0],a=i[1],h=i[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*h,t[9]=e[9]*h,t[10]=e[10]*h,t[11]=e[11]*h,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function bD(t,e,i,s){var a=s[0],h=s[1],p=s[2],c=Math.hypot(a,h,p),b,T,P,k,C,H,ee,se,pe,fe,ye,Se,Ue,$e,Ye,Qe,at,wt,Mt,Lt,ei,gi,Ut,mi;return c<Ed?null:(c=1/c,a*=c,h*=c,p*=c,b=Math.sin(i),T=Math.cos(i),P=1-T,k=e[0],C=e[1],H=e[2],ee=e[3],se=e[4],pe=e[5],fe=e[6],ye=e[7],Se=e[8],Ue=e[9],$e=e[10],Ye=e[11],Qe=a*a*P+T,at=h*a*P+p*b,wt=p*a*P-h*b,Mt=a*h*P-p*b,Lt=h*h*P+T,ei=p*h*P+a*b,gi=a*p*P+h*b,Ut=h*p*P-a*b,mi=p*p*P+T,t[0]=k*Qe+se*at+Se*wt,t[1]=C*Qe+pe*at+Ue*wt,t[2]=H*Qe+fe*at+$e*wt,t[3]=ee*Qe+ye*at+Ye*wt,t[4]=k*Mt+se*Lt+Se*ei,t[5]=C*Mt+pe*Lt+Ue*ei,t[6]=H*Mt+fe*Lt+$e*ei,t[7]=ee*Mt+ye*Lt+Ye*ei,t[8]=k*gi+se*Ut+Se*mi,t[9]=C*gi+pe*Ut+Ue*mi,t[10]=H*gi+fe*Ut+$e*mi,t[11]=ee*gi+ye*Ut+Ye*mi,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Pb(t,e,i){var s=Math.sin(i),a=Math.cos(i),h=e[4],p=e[5],c=e[6],b=e[7],T=e[8],P=e[9],k=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=h*a+T*s,t[5]=p*a+P*s,t[6]=c*a+k*s,t[7]=b*a+C*s,t[8]=T*a-h*s,t[9]=P*a-p*s,t[10]=k*a-c*s,t[11]=C*a-b*s,t}function wD(t,e,i){var s=Math.sin(i),a=Math.cos(i),h=e[0],p=e[1],c=e[2],b=e[3],T=e[8],P=e[9],k=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*a-T*s,t[1]=p*a-P*s,t[2]=c*a-k*s,t[3]=b*a-C*s,t[8]=h*s+T*a,t[9]=p*s+P*a,t[10]=c*s+k*a,t[11]=b*s+C*a,t}function Mb(t,e,i){var s=Math.sin(i),a=Math.cos(i),h=e[0],p=e[1],c=e[2],b=e[3],T=e[4],P=e[5],k=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*a+T*s,t[1]=p*a+P*s,t[2]=c*a+k*s,t[3]=b*a+C*s,t[4]=T*a-h*s,t[5]=P*a-p*s,t[6]=k*a-c*s,t[7]=C*a-b*s,t}function ED(t,e){var i=e[0],s=e[1],a=e[2],h=e[3],p=i+i,c=s+s,b=a+a,T=i*p,P=s*p,k=s*c,C=a*p,H=a*c,ee=a*b,se=h*p,pe=h*c,fe=h*b;return t[0]=1-k-ee,t[1]=P+fe,t[2]=C-pe,t[3]=0,t[4]=P-fe,t[5]=1-T-ee,t[6]=H+se,t[7]=0,t[8]=C+pe,t[9]=H-se,t[10]=1-T-k,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function TD(t,e,i,s,a,h,p){var c=1/(i-e),b=1/(a-s),T=1/(h-p);return t[0]=h*2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h*2*b,t[6]=0,t[7]=0,t[8]=(i+e)*c,t[9]=(a+s)*b,t[10]=(p+h)*T,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*h*2*T,t[15]=0,t}function AD(t,e,i,s,a){var h=1/Math.tan(e/2),p;return t[0]=h/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(p=1/(s-a),t[10]=(a+s)*p,t[14]=2*a*s*p):(t[10]=-1,t[14]=-2*s),t}var SD=AD;function ID(t,e,i,s,a,h,p){var c=1/(e-i),b=1/(s-a),T=1/(h-p);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*T,t[11]=0,t[12]=(e+i)*c,t[13]=(a+s)*b,t[14]=(p+h)*T,t[15]=1,t}var PD=ID;function MD(t,e,i,s){var a,h,p,c,b,T,P,k,C,H,ee=e[0],se=e[1],pe=e[2],fe=s[0],ye=s[1],Se=s[2],Ue=i[0],$e=i[1],Ye=i[2];return Math.abs(ee-Ue)<Ed&&Math.abs(se-$e)<Ed&&Math.abs(pe-Ye)<Ed?yD(t):(P=ee-Ue,k=se-$e,C=pe-Ye,H=1/Math.hypot(P,k,C),P*=H,k*=H,C*=H,a=ye*C-Se*k,h=Se*P-fe*C,p=fe*k-ye*P,H=Math.hypot(a,h,p),H?(H=1/H,a*=H,h*=H,p*=H):(a=0,h=0,p=0),c=k*p-C*h,b=C*a-P*p,T=P*h-k*a,H=Math.hypot(c,b,T),H?(H=1/H,c*=H,b*=H,T*=H):(c=0,b=0,T=0),t[0]=a,t[1]=c,t[2]=P,t[3]=0,t[4]=h,t[5]=b,t[6]=k,t[7]=0,t[8]=p,t[9]=T,t[10]=C,t[11]=0,t[12]=-(a*ee+h*se+p*pe),t[13]=-(c*ee+b*se+T*pe),t[14]=-(P*ee+k*se+C*pe),t[15]=1,t)}function CD(){var t=new Kl(4);return Kl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function LD(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Wu(t,e,i){var s=e[0],a=e[1],h=e[2],p=e[3];return t[0]=i[0]*s+i[4]*a+i[8]*h+i[12]*p,t[1]=i[1]*s+i[5]*a+i[9]*h+i[13]*p,t[2]=i[2]*s+i[6]*a+i[10]*h+i[14]*p,t[3]=i[3]*s+i[7]*a+i[11]*h+i[15]*p,t}(function(){var t=CD();return function(e,i,s,a,h,p){var c,b;for(i||(i=4),s||(s=0),a?b=Math.min(a*i+s,e.length):b=e.length,c=s;c<b;c+=i)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],t[3]=e[c+3],h(t,t,p),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2],e[c+3]=t[3];return e}})();var Bm;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Bm||(Bm={}));const kD=45*Math.PI/180,RD=1,Wp=.1,Zp=500,DD=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Gs extends _D{static get IDENTITY(){return OD()}static get ZERO(){return zD()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Bm}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,s,a,h,p,c,b,T,P,k,C,H,ee,se,pe){return this[0]=e,this[1]=i,this[2]=s,this[3]=a,this[4]=h,this[5]=p,this[6]=c,this[7]=b,this[8]=T,this[9]=P,this[10]=k,this[11]=C,this[12]=H,this[13]=ee,this[14]=se,this[15]=pe,this.check()}setRowMajor(e,i,s,a,h,p,c,b,T,P,k,C,H,ee,se,pe){return this[0]=e,this[1]=h,this[2]=T,this[3]=H,this[4]=i,this[5]=p,this[6]=P,this[7]=ee,this[8]=s,this[9]=c,this[10]=k,this[11]=se,this[12]=a,this[13]=b,this[14]=C,this[15]=pe,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(DD)}fromObject(e){return this.check()}fromQuaternion(e){return ED(this,e),this.check()}frustum(e){const{left:i,right:s,bottom:a,top:h,near:p=Wp,far:c=Zp}=e;return c===1/0?FD(this,i,s,a,h,p):TD(this,i,s,a,h,p,c),this.check()}lookAt(e){const{eye:i,center:s=[0,0,0],up:a=[0,1,0]}=e;return MD(this,i,s,a),this.check()}ortho(e){const{left:i,right:s,bottom:a,top:h,near:p=Wp,far:c=Zp}=e;return PD(this,i,s,a,h,p,c),this.check()}orthographic(e){const{fovy:i=kD,aspect:s=RD,focalDistance:a=1,near:h=Wp,far:p=Zp}=e;w1(i);const c=i/2,b=a*Math.tan(c),T=b*s;return this.ortho({left:-T,right:T,bottom:-b,top:b,near:h,far:p})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:s=1,near:a=.1,far:h=500}=e;return w1(i),SD(this,i,s,a,h),this.check()}determinant(){return xD(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const s=this.getScale(i),a=1/s[0],h=1/s[1],p=1/s[2];return e[0]=this[0]*a,e[1]=this[1]*h,e[2]=this[2]*p,e[3]=0,e[4]=this[4]*a,e[5]=this[5]*h,e[6]=this[6]*p,e[7]=0,e[8]=this[8]*a,e[9]=this[9]*h,e[10]=this[10]*p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const s=this.getScale(i),a=1/s[0],h=1/s[1],p=1/s[2];return e[0]=this[0]*a,e[1]=this[1]*h,e[2]=this[2]*p,e[3]=this[4]*a,e[4]=this[5]*h,e[5]=this[6]*p,e[6]=this[8]*a,e[7]=this[9]*h,e[8]=this[10]*p,e}transpose(){return vD(this,this),this.check()}invert(){return Fm(this,this),this.check()}multiplyLeft(e){return Va(this,e,this),this.check()}multiplyRight(e){return Va(this,this,e),this.check()}rotateX(e){return Pb(this,this,e),this.check()}rotateY(e){return wD(this,this,e),this.check()}rotateZ(e){return Mb(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return bD(this,this,e,i),this.check()}scale(e){return Fg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Vd(this,this,e),this.check()}transform(e,i){return e.length===4?(i=Wu(i||[-0,-0,-0,-0],e,this),Hp(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:s}=e;let a;switch(s){case 2:a=iD(i||[-0,-0],e,this);break;case 3:a=Ib(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Hp(a,e.length),a}transformAsVector(e,i){let s;switch(e.length){case 2:s=nD(i||[-0,-0],e,this);break;case 3:s=Sb(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Hp(s,e.length),s}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,s){return this.identity().translate([e,i,s])}}let ud,hd;function zD(){return ud||(ud=new Gs([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ud)),ud}function OD(){return hd||(hd=new Gs,Object.freeze(hd)),hd}function w1(t){if(t>Math.PI*2)throw Error("expected radians")}function FD(t,e,i,s,a,h){const p=2*h/(i-e),c=2*h/(a-s),b=(i+e)/(i-e),T=(a+s)/(a-s),P=-1,k=-1,C=-2*h;return t[0]=p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=b,t[9]=T,t[10]=P,t[11]=k,t[12]=0,t[13]=0,t[14]=C,t[15]=0,t}const BD=new Uint8Array([0,255,255,255]),ND={pickingSelectedColor:null,pickingHighlightColor:BD,pickingActive:!1,pickingAttribute:!1};function UD(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ND;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const i=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=i}if(t.pickingHighlightColor){const i=Array.from(t.pickingHighlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),e.picking_uHighlightColor=i}return t.pickingActive!==void 0&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const VD=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,jD=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,GD={name:"picking",vs:VD,fs:jD,getUniforms:UD},$D=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,HD={name:"transform",vs:$D,fs:null};class Zu{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Zu(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(i=>i.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(s=>s.name!==i),this.stateHash++}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:i="",fs:s="",defines:a={},inject:h={},varyings:p=[],bufferMode:c=35981,transpileToGLSL100:b=!1}=e,T=this._getModuleList(e.modules),P=this._getHash(i),k=this._getHash(s),C=T.map(Se=>this._getHash(Se.name)).sort(),H=p.map(Se=>this._getHash(Se)),ee=Object.keys(a).sort(),se=Object.keys(h).sort(),pe=[],fe=[];for(const Se of ee)pe.push(this._getHash(Se)),pe.push(this._getHash(a[Se]));for(const Se of se)fe.push(this._getHash(Se)),fe.push(this._getHash(h[Se]));const ye="".concat(P,"/").concat(k,"D").concat(pe.join("/"),"M").concat(C.join("/"),"I").concat(fe.join("/"),"V").concat(H.join("/"),"H").concat(this.stateHash,"B").concat(c).concat(b?"T":"");if(!this._programCache[ye]){const Se=RR(this.gl,{vs:i,fs:s,modules:T,inject:h,defines:a,hookFunctions:this._hookFunctions,transpileToGLSL100:b});this._programCache[ye]=new pb(this.gl,{hash:ye,vs:Se.vs,fs:Se.fs,varyings:p,bufferMode:c}),this._getUniforms[ye]=Se.getUniforms||(Ue=>{}),this._useCounts[ye]=0}return this._useCounts[ye]++,this._programCache[ye]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const i=e.hash;this._useCounts[i]--,this._useCounts[i]===0&&(this._programCache[i].delete(),delete this._programCache[i],delete this._getUniforms[i],delete this._useCounts[i])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const i=new Array(this._defaultModules.length+e.length),s={};let a=0;for(let h=0,p=this._defaultModules.length;h<p;++h){const c=this._defaultModules[h],b=c.name;i[a++]=c,s[b]=!0}for(let h=0,p=e.length;h<p;++h){const c=e[h],b=c.name;s[b]||(i[a++]=c,s[b]=!0)}return i.length=a,i}}const qD={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function WD(t,e,i){const s={};let a=e.indices;for(const h in e.attributes){const p=e.attributes[h],c=ZD(h,i);if(h==="indices")a=p;else if(p.constant)s[c]=p.value;else{const b=p.value,T={...p};delete T.value,s[c]=[new qi(t,b),T],XD(h,T)}}if(a){const h=a.value||a;bt(h instanceof Uint16Array||h instanceof Uint32Array,'attribute array for "indices" must be of integer type');const p={size:1,isIndexed:a.isIndexed===void 0?!0:a.isIndexed};s.indices=[new qi(t,{data:h,target:34963}),p]}return s}function ZD(t,e){const{attributeMap:i=qD}=e||{};return i&&i[t]||t}function XD(t,e){let i;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":i="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":i="vectors";break}switch(i){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}bt(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Il=2,YD=1e4,KD="Model needs drawMode and vertexCount",E1=()=>{},JD={};class Cb{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:s=ia("model")}=i;bt(uf(e)),this.id=s,this.gl=e,this.id=i.id||ia("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(i)}initialize(e){this.props={},this.programManager=e.programManager||Zu.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:i=null,vs:s,fs:a,modules:h,defines:p,inject:c,varyings:b,bufferMode:T,transpileToGLSL100:P}=e;this.programProps={program:i,vs:s,fs:a,modules:h,defines:p,inject:c,varyings:b,bufferMode:T,transpileToGLSL100:P},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},bt(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),KD)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:i,vs:s,fs:a,modules:h,defines:p,inject:c,varyings:b,bufferMode:T,transpileToGLSL100:P}=e;this.programProps={program:i,vs:s,fs:a,modules:h,defines:p,inject:c,varyings:b,bufferMode:T,transpileToGLSL100:P},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return bt(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return bt(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=WD(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Zl(e))return this;const i={};for(const s in e){const a=e[s];i[s]=a.getValue?a.getValue():a}return this.vertexArray.setAttributes(i),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const i=this.programManager.getUniforms(this.program);return i?i(e):{}}updateModuleSettings(e){const i=this.getModuleUniforms(e||{});return this.setUniforms(i)}clear(e){return Rg(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:i=null,framebuffer:s,uniforms:a={},attributes:h={},transformFeedback:p=this.transformFeedback,parameters:c={},vertexArray:b=this.vertexArray}=e;this.setAttributes(h),this.updateModuleSettings(i),this.setUniforms(a);let T;Nt.priority>=Il&&(T=this._logDrawCallStart(Il));const P=this.vertexArray.getDrawParams(),{isIndexed:k=P.isIndexed,indexType:C=P.indexType,indexOffset:H=P.indexOffset,vertexArrayInstanced:ee=P.isInstanced}=this.props;ee&&!this.isInstanced&&Nt.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:se,instanceCount:pe}=this,{onBeforeRender:fe=E1,onAfterRender:ye=E1}=this.props;fe(),this.program.setUniforms(this.uniforms);const Se=this.program.draw(Object.assign(JD,e,{logPriority:T,uniforms:null,framebuffer:s,parameters:c,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:b,transformFeedback:p,isIndexed:k,indexType:C,isInstanced:se,instanceCount:pe,offset:k?H:0}));return ye(),Nt.priority>=Il&&this._logDrawCallEnd(T,b,s),Se}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:i=!0,feedbackBuffers:s,unbindModels:a=[]}=e;let{parameters:h}=e;s&&this._setFeedbackBuffers(s),i&&(h=Object.assign({},h,{[35977]:i})),a.forEach(p=>p.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:h}))}finally{a.forEach(p=>p.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Nt.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:i}=this.programProps;if(i)this._managedProgram=!1;else{const{vs:s,fs:a,modules:h,inject:p,defines:c,varyings:b,bufferMode:T,transpileToGLSL100:P}=this.programProps;i=this.programManager.get({vs:s,fs:a,modules:h,inject:p,defines:c,varyings:b,bufferMode:T,transpileToGLSL100:P}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}bt(i instanceof pb,"Model needs a program"),this._programDirty=!1,i!==this.program&&(this.program=i,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new Zk(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const i=this.geometryBuffers[e][0]||this.geometryBuffers[e];i instanceof qi&&i.delete()}}_setAnimationProps(e){this.animated&&bt(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Zl(e))return this;const{gl:i}=this.program;return this.transformFeedback=this.transformFeedback||new mb(i,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const i=e>3?0:YD;if(!(Date.now()-this.lastLogTime<i))return this.lastLogTime=Date.now(),Nt.group(Il,">>> DRAWING MODEL ".concat(this.id),{collapsed:Nt.level<=2})(),e}_logDrawCallEnd(e,i,s,a){if(e===void 0)return;const h=Kk({vertexArray:i,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:p,unusedTable:c,unusedCount:b}=c1({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,s)}),{table:T,count:P}=c1({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,s),undefinedOnly:!0});P>0&&Nt.log("MISSING UNIFORMS",Object.keys(T))(),b>0&&Nt.log("UNUSED UNIFORMS",Object.keys(c))();const k=Qk(this.vertexArray.configuration);Nt.table(e,h)(),Nt.table(e,p)(),Nt.table(e+1,k)(),a&&a.log({logLevel:Il,message:"Rendered to ".concat(a.id)}),Nt.groupEnd(Il)()}}class QD{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(i),Object.seal(this)}setupResources(e){for(const i of this.bindings)this._setupTransformFeedback(i,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:i}=this;return i.length>0&&(e=Object.assign({},e,{varyings:i})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=this.bindings[this.currentIndex],{sourceBuffers:s,transformFeedback:a}=i;return{attributes:Object.assign({},s,e.attributes),transformFeedback:a}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:i}=this.bindings[this.currentIndex],s=e?i[e]:null;return s?s instanceof qi?s:s.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:i}=e,s=this.getBuffer(i);return s?s.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&bt(yi(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:i={}}=e,s={};if(this.bindings[this.currentIndex]&&Object.assign(s,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const a in this.feedbackMap){const h=this.feedbackMap[a];a in i&&(s[h]=a)}Object.assign(s,e.feedbackBuffers);for(const a in s){const h=s[a];if(typeof h=="string"){const p=i[h],{byteLength:c,usage:b,accessor:T}=p;s[a]=this._createNewBuffer(a,{byteLength:c,usage:b,accessor:T})}}return s}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:i=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const s=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:i,feedbackBuffers:s})}_setupTransformFeedback(e,i){let{model:s}=i;const{program:a}=s;e.transformFeedback=new mb(this.gl,{program:a,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:i,feedbackBuffers:s}=this._swapBuffers(this.bindings[this.currentIndex]),a=this._getNextIndex();this.bindings[a]=this._updateBinding(this.bindings[a],{sourceBuffers:i,feedbackBuffers:s})}}_updateBinding(e,i){return e?(Object.assign(e.sourceBuffers,i.sourceBuffers),Object.assign(e.feedbackBuffers,i.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},i.sourceBuffers),feedbackBuffers:Object.assign({},i.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const i=Object.assign({},e.sourceBuffers),s=Object.assign({},e.feedbackBuffers);for(const a in this.feedbackMap){const h=this.feedbackMap[a];i[a]=e.feedbackBuffers[h],s[h]=e.sourceBuffers[a],bt(s[h]instanceof qi)}return{sourceBuffers:i,feedbackBuffers:s}}_createNewBuffer(e,i){const s=new qi(this.gl,i);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=s,s}_getNextIndex(){return(this.currentIndex+1)%2}}const ez="transform_uSampler_",jd="transform_uSize_",T1="transform_position";function tz(t){let{vs:e,sourceTextureMap:i,targetTextureVarying:s,targetTexture:a}=t,p=Object.keys(i).length,c=null;const b={};let T=e,P={};if(p>0||s){const k=T.split(`
`),C=k.slice();if(k.forEach((H,ee,se)=>{if(p>0){const pe=oz(H,i);if(pe){const{updatedLine:fe,inject:ye}=pe;C[ee]=fe,P=Dm([P,ye]),Object.assign(b,pe.samplerTextureMap),p--}}s&&!c&&(c=sz(H,s))}),s){bt(a);const H="".concat(jd).concat(s),ee="uniform vec2 ".concat(H,`;
`),se="     vec2 ".concat(T1," = transform_getPos(").concat(H,`);
     gl_Position = vec4(`).concat(T1,`, 0, 1.);
`);P=Dm([P,{"vs:#decl":ee,"vs:#main-start":se}])}T=C.join(`
`)}return{vs:T,targetTextureType:c,inject:P,samplerTextureMap:b}}function iz(t){let{sourceTextureMap:e,targetTextureVarying:i,targetTexture:s}=t;const a={};let h,p;i&&({width:h,height:p}=s,a["".concat(jd).concat(i)]=[h,p]);for(const c in e)({width:h,height:p}=e[c]),a["".concat(jd).concat(c)]=[h,p];return a}function nz(t){return wb(t,["attribute","in"])}function rz(t){const e="".concat(ez).concat(t),i="".concat(jd).concat(t),s="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(i,";");return{samplerName:e,sizeName:i,uniformDeclerations:s}}function sz(t,e){const i=wb(t,["varying","out"]);return i&&i.name===e?i.type:null}function oz(t,e){const i={},s=nz(t);if(!s)return null;const{type:a,name:h}=s;if(h&&e[h]){const p="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:c,sizeName:b,uniformDeclerations:T}=rz(h),P=jR(a),k="  ".concat(a," ").concat(h," = transform_getInput(").concat(c,", ").concat(b,").").concat(P,`;
`);return i[c]=h,{updatedLine:p,inject:{"vs:#decl":T,"vs:#main-start":k},samplerTextureMap:i}}return null}const az={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},lz="transform_output";class cz{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(i),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=this._processVertexShader(e);return Object.assign({},e,i)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:i,sourceTextures:s,framebuffer:a,targetTexture:h}=this.bindings[this.currentIndex],p=Object.assign({},i,e.attributes),c=Object.assign({},e.uniforms),b=Object.assign({},e.parameters);let T=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){p.transform_elementID=this.elementIDBuffer;for(const k in this.samplerTextureMap){const C=this.samplerTextureMap[k];c[k]=s[C]}this._setSourceTextureParameters();const P=iz({sourceTextureMap:s,targetTextureVarying:this.targetTextureVarying,targetTexture:h});Object.assign(c,P)}return this.hasTargetTexture&&(T=!1,b.viewport=[0,0,a.width,a.height]),{attributes:p,framebuffer:a,uniforms:c,discard:T,parameters:b}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:i}=this.bindings[this.currentIndex],s=df(i);if(!e)return s;const a=s.constructor,h=GR(this.targetTextureType),p=new a(s.length*h/4);let c=0;for(let b=0;b<s.length;b+=4)for(let T=0;T<h;T++)p[c++]=s[b+T];return p}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:i,_swapTexture:s}=e;this._swapTexture=s,this.targetTextureVarying=i,this.hasTargetTexture=i,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:i,textureOrReference:s}=e;if(s instanceof $r)return s;const a=i[s];return a?(this._targetRefTexName=s,this._createNewTexture(a)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:i,_sourceTextures:s={},_targetTexture:a}=e,h=this._createTargetTexture({sourceTextures:s,textureOrReference:a});this.hasSourceTextures=this.hasSourceTextures||s&&Object.keys(s).length>0,this._updateBindings({sourceBuffers:i,sourceTextures:s,targetTexture:h}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const i=new Float32Array(e);i.forEach((s,a,h)=>{h[a]=a}),this.elementIDBuffer?this.elementIDBuffer.setData({data:i}):this.elementIDBuffer=new qi(this.gl,{data:i,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:i,targetTexture:s}=this._swapTextures(this.bindings[this.currentIndex]),a=this._getNextIndex();this.bindings[a]=this._updateBinding(this.bindings[a],{sourceTextures:i,targetTexture:s})}}_updateBinding(e,i){const{sourceBuffers:s,sourceTextures:a,targetTexture:h}=i;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,a),Object.assign(e.sourceBuffers,s),h){e.targetTexture=h;const{width:p,height:c}=h,{framebuffer:b}=e;b?(b.update({attachments:{[36064]:h},resizeAttachments:!1}),b.resize({width:p,height:c})):e.framebuffer=new Bn(this.gl,{id:"transform-framebuffer",width:p,height:c,attachments:{[36064]:h}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:i}=this.bindings[e];for(const s in i)i[s].setParameters(az)}_swapTextures(e){if(!this._swapTexture)return null;const i=Object.assign({},e.sourceTextures);i[this._swapTexture]=e.targetTexture;const s=e.sourceTextures[this._swapTexture];return{sourceTextures:i,targetTexture:s}}_createNewTexture(e){const i=FL(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=i,i}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:i,targetTexture:s}=this.bindings[this.currentIndex],{vs:a,uniforms:h,targetTextureType:p,inject:c,samplerTextureMap:b}=tz({vs:e.vs,sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s}),T=Dm([e.inject||{},c]);this.targetTextureType=p,this.samplerTextureMap=b;const P=e._fs||Eb({version:db(a),input:this.targetTextureVarying,inputType:p,output:lz}),k=this.hasSourceTextures||this.targetTextureVarying?[HD].concat(e.modules||[]):e.modules;return{vs:a,fs:P,modules:k,uniforms:h,inject:T}}}class Bg{static isSupported(e){return yi(e)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(i),Object.seal(this)}delete(){const{model:e,bufferTransform:i,textureTransform:s}=this;e&&e.delete(),i&&i.delete(),s&&s.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:i=!0}=e,s=this._updateDrawOptions(e);i&&s.framebuffer&&s.framebuffer.clear({color:!0}),this.model.transform(s)}swap(){let e=!1;const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of i)e=e||s.swap();bt(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of i){const a=s.getData(e);if(a)return a}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of i)s.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:i}=this;this._buildResourceTransforms(i,e),e=this._updateModelProps(e),this.model=new Cb(i,Object.assign({},e,{fs:e.fs||Eb({version:db(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let i=Object.assign({},e);const s=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const a of s)i=a.updateModelProps(i);return i}_buildResourceTransforms(e,i){uz(i)&&(this.bufferTransform=new QD(e,i)),hz(i)&&(this.textureTransform=new cz(e,i)),bt(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let i=Object.assign({},e);const s=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const a of s)i=Object.assign(i,a.getDrawOptions(i));return i}}function uz(t){return!!(!Zl(t.feedbackBuffers)||!Zl(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function hz(t){return!!(!Zl(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const A1={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class dz{static get DRAW_MODE(){return A1}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:i=ia("geometry"),drawMode:s=A1.TRIANGLES,attributes:a={},indices:h=null,vertexCount:p=null}=e;this.id=i,this.drawMode=s|0,this.attributes={},this.userData={},this._setAttributes(a,h),this.vertexCount=p||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,i){i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i);for(const s in e){let a=e[s];a=ArrayBuffer.isView(a)?{value:a}:a,bt(ArrayBuffer.isView(a.value),"".concat(this._print(s),": must be typed array or object with value as typed array")),(s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"?(bt(!this.indices),this.indices=a):this.attributes[s]=a}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,i){if(i)return i.value.length;let s=1/0;for(const a in e){const h=e[a],{value:p,size:c,constant:b}=h;!b&&p&&c>=1&&(s=Math.min(s,p.length/c))}return bt(Number.isFinite(s)),s}}let fz=1,pz=1;class Lb{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:i=0,duration:s=Number.POSITIVE_INFINITY,rate:a=1,repeat:h=1}=e,p=fz++,c={time:0,delay:i,duration:s,rate:a,repeat:h};return this._setChannelTime(c,this.time),this.channels.set(p,c),p}removeChannel(e){this.channels.delete(e);for(const[i,s]of this.animations)s.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const a of i)this._setChannelTime(a,this.time);const s=this.animations.values();for(const a of s){const{animation:h,channel:p}=a;h.setTime(this.getTime(p))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const s=pz++;return this.animations.set(s,{animation:e,channel:i}),e.setTime(this.getTime(i)),s}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const s=i-e.delay,a=e.duration*e.repeat;s>=a?e.time=e.duration*e.rate:(e.time=Math.max(0,s)%e.duration,e.time*=e.rate)}}const mz=[255,255,255],gz=1;let _z=0;class yz{constructor(e={}){U(this,"id",void 0),U(this,"color",void 0),U(this,"intensity",void 0),U(this,"type","ambient");const{color:i=mz}=e,{intensity:s=gz}=e;this.id=e.id||"ambient-".concat(_z++),this.color=i,this.intensity=s}}const vz=[255,255,255],xz=1,bz=[0,0,-1];let wz=0;class S1{constructor(e={}){U(this,"id",void 0),U(this,"color",void 0),U(this,"intensity",void 0),U(this,"type","directional"),U(this,"direction",void 0),U(this,"shadow",void 0);const{color:i=vz}=e,{intensity:s=xz}=e,{direction:a=bz}=e,{_shadow:h=!1}=e;this.id=e.id||"directional-".concat(wz++),this.color=i,this.intensity=s,this.type="directional",this.direction=new js(a).normalize().toArray(),this.shadow=h}getProjectedLight(e){return this}}class Ez{constructor(e,i={id:"pass"}){U(this,"id",void 0),U(this,"gl",void 0),U(this,"props",void 0);const{id:s}=i;this.id=s,this.gl=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Ng extends Ez{constructor(...e){super(...e),U(this,"_lastRenderIndex",-1)}render(e){const i=this.gl;return po(i,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:i,moduleParameters:s,viewports:a,views:h,onViewportActive:p,clearStack:c=!0,clearCanvas:b=!0}=e;e.pass=e.pass||"unknown";const T=this.gl;b&&Az(T,i),c&&(this._lastRenderIndex=-1);const P=[];for(const k of a){const C=h&&h[k.id];p==null||p(k);const H=this._getDrawLayerParams(k,e),ee=k.subViewports||[k];for(const se of ee){const pe=this._drawLayersInViewport(T,{target:i,moduleParameters:s,viewport:se,view:C,pass:e.pass,layers:e.layers},H);P.push(pe)}}return P}_getDrawLayerParams(e,{layers:i,pass:s,isPicking:a=!1,layerFilter:h,cullRect:p,effects:c,moduleParameters:b},T=!1){const P=[],k=kb(this._lastRenderIndex+1),C={layer:i[0],viewport:e,isPicking:a,renderPass:s,cullRect:p},H={};for(let ee=0;ee<i.length;ee++){const se=i[ee],pe=this._shouldDrawLayer(se,C,h,H),fe={shouldDrawLayer:pe};pe&&!T&&(fe.layerRenderIndex=k(se,pe),fe.moduleParameters=this._getModuleParameters(se,c,s,b),fe.layerParameters=this.getLayerParameters(se,ee,e)),P[ee]=fe}return P}_drawLayersInViewport(e,{layers:i,moduleParameters:s,pass:a,target:h,viewport:p,view:c},b){const T=Tz(e,{moduleParameters:s,target:h,viewport:p});if(c&&c.props.clear){const k=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;gs(e,{scissorTest:!0,scissor:T},()=>Rg(e,k))}const P={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};po(e,{viewport:T});for(let k=0;k<i.length;k++){const C=i[k],{shouldDrawLayer:H,layerRenderIndex:ee,moduleParameters:se,layerParameters:pe}=b[k];if(H&&C.props.pickable&&P.pickableCount++,C.isComposite)P.compositeCount++;else if(H){P.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,ee),se.viewport=p;try{C._drawLayer({moduleParameters:se,uniforms:{layerIndex:ee},parameters:pe})}catch(fe){C.raiseError(fe,"drawing ".concat(C," to ").concat(a))}}}return P}shouldDrawLayer(e){return!0}getModuleParameters(e,i){return null}getLayerParameters(e,i,s){return e.props.parameters}_shouldDrawLayer(e,i,s,a){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let p=e.parent;for(;p;){if(!p.props.visible||!p.filterSubLayer(i))return!1;i.layer=p,p=p.parent}if(s){const c=i.layer.id;if(c in a||(a[c]=s(i)),!a[c])return!1}return e.activateViewport(i.viewport),!0}_getModuleParameters(e,i,s,a){var h;const p=Object.assign(Object.create(((h=e.internalState)===null||h===void 0?void 0:h.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Wl(this.gl)});if(i)for(const b of i){var c;Object.assign(p,(c=b.getModuleParameters)===null||c===void 0?void 0:c.call(b,e))}return Object.assign(p,this.getModuleParameters(e,i),a)}}function kb(t=0,e={}){const i={},s=(a,h)=>{const p=a.props._offset,c=a.id,b=a.parent&&a.parent.id;let T;if(b&&!(b in e)&&s(a.parent,!1),b in i){const P=i[b]=i[b]||kb(e[b],e);T=P(a,h),i[c]=P}else Number.isFinite(p)?(T=p+(e[b]||0),i[c]=null):T=t;return h&&T>=t&&(t=T+1),e[c]=T,T};return s}function Tz(t,{moduleParameters:e,target:i,viewport:s}){const a=i&&i.id!=="default-framebuffer",h=e&&e.devicePixelRatio||Wl(t),p=a?i.height:t.drawingBufferHeight,c=s;return[c.x*h,p-(c.y+c.height)*h,c.width*h,c.height*h]}function Az(t,e){const i=e?e.width:t.drawingBufferWidth,s=e?e.height:t.drawingBufferHeight;po(t,{viewport:[0,0,i,s]}),t.clear(16640)}class Sz extends Ng{constructor(e,i){super(e,i),U(this,"shadowMap",void 0),U(this,"depthBuffer",void 0),U(this,"fbo",void 0),this.shadowMap=new $r(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new Rl(e,{format:33189,width:1,height:1}),this.fbo=new Bn(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const i=this.fbo;gs(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const s=e.viewports[0],a=Wl(this.gl),h=s.width*a,p=s.height*a;(h!==i.width||p!==i.height)&&i.resize({width:h,height:p}),super.render({...e,target:i,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const Rb="#define SMOOTH_EDGE_RADIUS 0.5",Iz=`
`.concat(Rb,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),Pz=`
`.concat(Rb,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),Mz={name:"geometry",vs:Iz,fs:Pz},Cz=Object.keys(Oi).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Oi[t],";")).join(""),Lz=Object.keys(Ns).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(Ns[t],";")).join(""),kz=Object.keys(Mm).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Mm[t],";")).join(""),Rz="".concat(Cz,`
`).concat(Lz,`
`).concat(kz,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function Dz(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let s=0;s<i;s++)if(t[s]!==e[s])return!1;return!0}return!1}function Xu(t){let e={},i;return s=>{for(const a in s)if(!Dz(s[a],e[a])){i=t(s),e=s;break}return i}}const I1=[0,0,0,0],zz=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Db=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Oz=[0,0,0],zb=[0,0,0],Fz=Xu(Uz);function Ob(t,e,i=zb){i.length<3&&(i=[i[0],i[1],0]);let s=i,a,h=!0;switch(e===Oi.LNGLAT_OFFSETS||e===Oi.METER_OFFSETS?a=i:a=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Ns.WEB_MERCATOR:(e===Oi.LNGLAT||e===Oi.CARTESIAN)&&(a=[0,0,0],h=!1);break;case Ns.WEB_MERCATOR_AUTO_OFFSET:e===Oi.LNGLAT?s=a:e===Oi.CARTESIAN&&(s=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],a=t.unprojectPosition(s),s[0]-=i[0],s[1]-=i[1],s[2]-=i[2]);break;case Ns.IDENTITY:s=t.position.map(Math.fround),s[2]=s[2]||0;break;case Ns.GLOBE:h=!1,a=null;break;default:h=!1}return{geospatialOrigin:a,shaderCoordinateOrigin:s,offsetMode:h}}function Bz(t,e,i){const{viewMatrixUncentered:s,projectionMatrix:a}=t;let{viewMatrix:h,viewProjectionMatrix:p}=t,c=I1,b=I1,T=t.cameraPosition;const{geospatialOrigin:P,shaderCoordinateOrigin:k,offsetMode:C}=Ob(t,e,i);return C&&(b=t.projectPosition(P||k),T=[T[0]-b[0],T[1]-b[1],T[2]-b[2]],b[3]=1,c=Wu([],b,p),h=s||h,p=Va([],a,h),p=Va([],p,zz)),{viewMatrix:h,viewProjectionMatrix:p,projectionCenter:c,originCommon:b,cameraPosCommon:T,shaderCoordinateOrigin:k,geospatialOrigin:P}}function Nz({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:s=Oi.DEFAULT,coordinateOrigin:a=zb,autoWrapLongitude:h=!1}){s===Oi.DEFAULT&&(s=t.isGeospatial?Oi.LNGLAT:Oi.CARTESIAN);const p=Fz({viewport:t,devicePixelRatio:e,coordinateSystem:s,coordinateOrigin:a});return p.project_uWrapLongitude=h,p.project_uModelMatrix=i||Db,p}function Uz({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s}){const{projectionCenter:a,viewProjectionMatrix:h,originCommon:p,cameraPosCommon:c,shaderCoordinateOrigin:b,geospatialOrigin:T}=Bz(t,i,s),P=t.getDistanceScales(),k=[t.width*e,t.height*e],C=Wu([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,H={project_uCoordinateSystem:i,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:b,project_uCommonOrigin:p.slice(0,3),project_uCenter:a,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:k,project_uDevicePixelRatio:e,project_uFocalDistance:C,project_uCommonUnitsPerMeter:P.unitsPerMeter,project_uCommonUnitsPerWorldUnit:P.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Oz,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:h,project_uModelMatrix:Db,project_uCameraPosition:c};if(T){const ee=t.getDistanceScales(T);switch(i){case Oi.METER_OFFSETS:H.project_uCommonUnitsPerWorldUnit=ee.unitsPerMeter,H.project_uCommonUnitsPerWorldUnit2=ee.unitsPerMeter2;break;case Oi.LNGLAT:case Oi.LNGLAT_OFFSETS:t._pseudoMeters||(H.project_uCommonUnitsPerMeter=ee.unitsPerMeter),H.project_uCommonUnitsPerWorldUnit=ee.unitsPerDegree,H.project_uCommonUnitsPerWorldUnit2=ee.unitsPerDegree2;break;case Oi.CARTESIAN:H.project_uCommonUnitsPerWorldUnit=[1,1,ee.unitsPerMeter[2]],H.project_uCommonUnitsPerWorldUnit2=[0,0,ee.unitsPerMeter2[2]];break}}return H}const Vz={};function jz(t=Vz){return"viewport"in t?Nz(t):{}}const Ug={name:"project",dependencies:[qR,Mz],vs:Rz,getUniforms:jz};function Gz(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Bl(t,e){const i=Wu([],e,t);return LD(i,i,1/i[3]),i}function P1(t,e){const i=t%e;return i<0?e+i:i}function Nm(t,e,i){return t<e?e:t>i?i:t}function $z(t){return Math.log(t)*Math.LOG2E}const Vg=Math.log2||$z;function mo(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const fs=Math.PI,Fb=fs/4,es=fs/180,Um=180/fs,Jl=512,Gd=4003e4,dd=85.051129,Hz=1.5;function qz(t){return Vg(t)}function Du(t){const[e,i]=t;mo(Number.isFinite(e)),mo(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const s=e*es,a=i*es,h=Jl*(s+fs)/(2*fs),p=Jl*(fs+Math.log(Math.tan(Fb+a*.5)))/(2*fs);return[h,p]}function Ql(t){const[e,i]=t,s=e/Jl*(2*fs)-fs,a=2*(Math.atan(Math.exp(i/Jl*(2*fs)-fs))-Fb);return[s*Um,a*Um]}function Wz(t){const{latitude:e}=t;mo(Number.isFinite(e));const i=Math.cos(e*es);return qz(Gd*i)-9}function Td(t){const e=Math.cos(t*es);return Jl/Gd/e}function Vm(t){const{latitude:e,longitude:i,highPrecision:s=!1}=t;mo(Number.isFinite(e)&&Number.isFinite(i));const a=Jl,h=Math.cos(e*es),p=a/360,c=p/h,b=a/Gd/h,T={unitsPerMeter:[b,b,b],metersPerUnit:[1/b,1/b,1/b],unitsPerDegree:[p,c,b],degreesPerUnit:[1/p,1/c,1/b]};if(s){const P=es*Math.tan(e*es)/h,k=p*P/2,C=a/Gd*P,H=C/c*b;T.unitsPerDegree2=[0,k,C],T.unitsPerMeter2=[H,0,H]}return T}function Bb(t,e){const[i,s,a]=t,[h,p,c]=e,{unitsPerMeter:b,unitsPerMeter2:T}=Vm({longitude:i,latitude:s,highPrecision:!0}),P=Du(t);P[0]+=h*(b[0]+T[0]*p),P[1]+=p*(b[1]+T[1]*p);const k=Ql(P),C=(a||0)+(c||0);return Number.isFinite(a)||Number.isFinite(c)?[k[0],k[1],C]:k}function Zz(t){const{height:e,pitch:i,bearing:s,altitude:a,scale:h,center:p}=t,c=Gz();Vd(c,c,[0,0,-a]),Pb(c,c,-i*es),Mb(c,c,s*es);const b=h/e;return Fg(c,c,[b,b,b]),p&&Vd(c,c,aD([],p)),c}function Xz(t){const{width:e,height:i,altitude:s,pitch:a=0,offset:h,center:p,scale:c,nearZMultiplier:b=1,farZMultiplier:T=1}=t;let{fovy:P=$d(Hz)}=t;s!==void 0&&(P=$d(s));const k=P*es,C=a*es,H=Nb(P);let ee=H;p&&(ee+=p[2]*c/Math.cos(C)/i);const se=k*(.5+(h?h[1]:0)/i),pe=Math.sin(se)*ee/Math.sin(Nm(Math.PI/2-C-se,.01,Math.PI-.01)),fe=Math.sin(C)*pe+ee,ye=ee*10,Se=Math.min(fe*T,ye);return{fov:k,aspect:e/i,focalDistance:H,near:b,far:Se}}function $d(t){return 2*Math.atan(.5/t)*Um}function Nb(t){return .5/Math.tan(.5*t*es)}function Ub(t,e){const[i,s,a=0]=t;return mo(Number.isFinite(i)&&Number.isFinite(s)&&Number.isFinite(a)),Bl(e,[i,s,a,1])}function jg(t,e,i=0){const[s,a,h]=t;if(mo(Number.isFinite(s)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(h))return Bl(e,[s,a,h,1]);const p=Bl(e,[s,a,0,1]),c=Bl(e,[s,a,1,1]),b=p[2],T=c[2],P=b===T?0:((i||0)-b)/(T-b);return Ab([],p,c,P)}function Yz(t){const{width:e,height:i,bounds:s,minExtent:a=0,maxZoom:h=24,offset:p=[0,0]}=t,[[c,b],[T,P]]=s,k=Kz(t.padding),C=Du([c,Nm(P,-dd,dd)]),H=Du([T,Nm(b,-dd,dd)]),ee=[Math.max(Math.abs(H[0]-C[0]),a),Math.max(Math.abs(H[1]-C[1]),a)],se=[e-k.left-k.right-Math.abs(p[0])*2,i-k.top-k.bottom-Math.abs(p[1])*2];mo(se[0]>0&&se[1]>0);const pe=se[0]/ee[0],fe=se[1]/ee[1],ye=(k.right-k.left)/2/pe,Se=(k.top-k.bottom)/2/fe,Ue=[(H[0]+C[0])/2+ye,(H[1]+C[1])/2+Se],$e=Ql(Ue),Ye=Math.min(h,Vg(Math.abs(Math.min(pe,fe))));return mo(Number.isFinite(Ye)),{longitude:$e[0],latitude:$e[1],zoom:Ye}}function Kz(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(mo(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const M1=Math.PI/180;function Jz(t,e=0){const{width:i,height:s,unproject:a}=t,h={targetZ:e},p=a([0,s],h),c=a([i,s],h);let b,T;const P=t.fovy?.5*t.fovy*M1:Math.atan(.5/t.altitude),k=(90-t.pitch)*M1;return P>k-.01?(b=C1(t,0,e),T=C1(t,i,e)):(b=a([0,0],h),T=a([i,0],h)),[p,c,T,b]}function C1(t,e,i){const{pixelUnprojectionMatrix:s}=t,a=Bl(s,[e,0,1,1]),h=Bl(s,[e,t.height,1,1]),c=(i*t.distanceScales.unitsPerMeter[2]-a[2])/(h[2]-a[2]),b=Ab([],a,h,c),T=Ql(b);return T.push(i),T}const L1=512;function Qz(t){const{width:e,height:i,pitch:s=0}=t;let{longitude:a,latitude:h,zoom:p,bearing:c=0}=t;(a<-180||a>180)&&(a=P1(a+180,360)-180),(c<-180||c>180)&&(c=P1(c+180,360)-180);const b=Vg(i/L1);if(p<=b)p=b,h=0;else{const T=i/2/Math.pow(2,p),P=Ql([0,T])[1];if(h<P)h=P;else{const k=Ql([0,L1-T])[1];h>k&&(h=k)}}return{width:e,height:i,longitude:a,latitude:h,zoom:p,pitch:s,bearing:c}}const eO=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,tO=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,iO=Xu(aO),nO=Xu(lO),rO=[0,0,0,1],sO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function oO(t,e){const[i,s,a]=t,h=jg([i,s,a],e);return Number.isFinite(a)?h:[h[0],h[1],0]}function aO({viewport:t,center:e}){return new Gs(t.viewProjectionMatrix).invert().transform(e)}function lO({viewport:t,shadowMatrices:e}){const i=[],s=t.pixelUnprojectionMatrix,a=t.isGeospatial?void 0:1,h=[[0,0,a],[t.width,0,a],[0,t.height,a],[t.width,t.height,a],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(p=>oO(p,s));for(const p of e){const c=p.clone().translate(new js(t.center).negate()),b=h.map(P=>c.transform(P)),T=new Gs().ortho({left:Math.min(...b.map(P=>P[0])),right:Math.max(...b.map(P=>P[0])),bottom:Math.min(...b.map(P=>P[1])),top:Math.max(...b.map(P=>P[1])),near:Math.min(...b.map(P=>-P[2])),far:Math.max(...b.map(P=>-P[2]))});i.push(T.multiplyRight(p))}return i}function cO(t,e){const{shadowEnabled:i=!0}=t;if(!i||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const s={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||rO,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},a=iO({viewport:t.viewport,center:e.project_uCenter}),h=[],p=nO({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let c=0;c<t.shadowMatrices.length;c++){const b=p[c],T=b.clone().translate(new js(t.viewport.center).negate());e.project_uCoordinateSystem===Oi.LNGLAT&&e.project_uProjectionMode===Ns.WEB_MERCATOR?(p[c]=T,h[c]=a):(p[c]=b.clone().multiplyRight(sO),h[c]=T.transform(a))}for(let c=0;c<p.length;c++)s["shadow_uViewProjectionMatrices[".concat(c,"]")]=p[c],s["shadow_uProjectCenters[".concat(c,"]")]=h[c],t.shadowMaps&&t.shadowMaps.length>0?s["shadow_uShadowMap".concat(c)]=t.shadowMaps[c]:s["shadow_uShadowMap".concat(c)]=t.dummyShadowMap;return s}const Xp={name:"shadow",dependencies:[Ug],vs:eO,fs:tO,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?cO(t,e):{}},uO={color:[255,255,255],intensity:1},k1=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],hO=[0,0,0,200/255];class Vb{constructor(e={}){U(this,"id","lighting-effect"),U(this,"props",void 0),U(this,"shadowColor",hO),U(this,"shadow",void 0),U(this,"ambientLight",void 0),U(this,"directionalLights",void 0),U(this,"pointLights",void 0),U(this,"shadowPasses",[]),U(this,"shadowMaps",[]),U(this,"dummyShadowMap",null),U(this,"programManager",void 0),U(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const i in e){const s=e[i];switch(s.type){case"ambient":this.ambientLight=s;break;case"directional":this.directionalLights.push(s);break;case"point":this.pointLights.push(s);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.props=e}preRender(e,{layers:i,layerFilter:s,viewports:a,onViewportActive:h,views:p}){if(!!this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Zu.getDefaultProgramManager(e),Xp&&this.programManager.addDefaultModule(Xp)),this.dummyShadowMap||(this.dummyShadowMap=new $r(e,{width:1,height:1}));for(let c=0;c<this.shadowPasses.length;c++)this.shadowPasses[c].render({layers:i,layerFilter:s,viewports:a,onViewportActive:h,views:p,moduleParameters:{shadowLightId:c,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const i=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return i.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(s=>s.getProjectedLight({layer:e})),pointLights:this.pointLights.map(s=>s.getProjectedLight({layer:e}))},i}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Xp),this.programManager=null)}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const s=new Gs().lookAt({eye:new js(i.direction).negate()});e.push(s)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const s=new Sz(e);this.shadowPasses[i]=s,this.shadowMaps[i]=s.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:s}=this;!e&&i.length===0&&s.length===0&&(this.ambientLight=new yz(uO),this.directionalLights.push(new S1(k1[0]),new S1(k1[1])))}}class dO{constructor(e={}){U(this,"_pool",[]),U(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:s=1,type:a,padding:h=0,copy:p=!1,initialize:c=!1,maxCount:b}){const T=a||e&&e.constructor||Float32Array,P=i*s+h;if(ArrayBuffer.isView(e)){if(P<=e.length)return e;if(P*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new T(e.buffer,0,P)}let k=1/0;b&&(k=b*s+h);const C=this._allocate(T,P,c,k);return e&&p?C.set(e):c||C.fill(0,0,4),this._release(e),C}release(e){this._release(e)}_allocate(e,i,s,a){let h=Math.max(Math.ceil(i*this.opts.overAlloc),1);h>a&&(h=a);const p=this._pool,c=e.BYTES_PER_ELEMENT*h,b=p.findIndex(T=>T.byteLength>=c);if(b>=0){const T=new e(p.splice(b,1)[0],0,h);return s&&T.fill(0),T}return new e(h)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:s}=e,{byteLength:a}=s,h=i.findIndex(p=>p.byteLength>=a);h<0?i.push(s):(h>0||i.length<this.opts.poolSize)&&i.splice(h,0,s),i.length>this.opts.poolSize&&i.shift()}}const zu=new dO;function du(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fO(t){return[t[12],t[13],t[14]]}function pO(t){return{left:Pl(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Pl(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Pl(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Pl(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Pl(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Pl(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const R1=new js;function Pl(t,e,i,s){R1.set(t,e,i);const a=R1.len();return{distance:s/a,normal:new js(-t/a,-e/a,-i/a)}}function mO(t){return t-Math.fround(t)}let lu;function Yp(t,e){const{size:i=1,startIndex:s=0}=e,a=e.endIndex!==void 0?e.endIndex:t.length,h=(a-s)/i;lu=zu.allocate(lu,h,{type:Float32Array,size:i*2});let p=s,c=0;for(;p<a;){for(let b=0;b<i;b++){const T=t[p++];lu[c+b]=T,lu[c+b+i]=mO(T)}c+=i*2}return lu.subarray(0,h*i*2)}function gO(t){let e=null,i=!1;for(const s of t)!s||(e?(i||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],i=!0),e[0][0]=Math.min(e[0][0],s[0][0]),e[0][1]=Math.min(e[0][1],s[0][1]),e[1][0]=Math.max(e[1][0],s[1][0]),e[1][1]=Math.max(e[1][1],s[1][1])):e=s);return e}const _O=Math.PI/180,yO=du(),D1=[0,0,0],vO={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function xO({width:t,height:e,orthographic:i,fovyRadians:s,focalDistance:a,padding:h,near:p,far:c}){const b=t/e,T=i?new Gs().orthographic({fovy:s,aspect:b,focalDistance:a,near:p,far:c}):new Gs().perspective({fovy:s,aspect:b,near:p,far:c});if(h){const{left:P=0,right:k=0,top:C=0,bottom:H=0}=h,ee=Xo((P+t-k)/2,0,t)-t/2,se=Xo((C+e-H)/2,0,e)-e/2;T[8]-=ee*2/t,T[9]+=se*2/e}return T}class lc{constructor(e={}){U(this,"id",void 0),U(this,"x",void 0),U(this,"y",void 0),U(this,"width",void 0),U(this,"height",void 0),U(this,"padding",void 0),U(this,"isGeospatial",void 0),U(this,"zoom",void 0),U(this,"focalDistance",void 0),U(this,"position",void 0),U(this,"modelMatrix",void 0),U(this,"distanceScales",void 0),U(this,"scale",void 0),U(this,"center",void 0),U(this,"cameraPosition",void 0),U(this,"projectionMatrix",void 0),U(this,"viewMatrix",void 0),U(this,"viewMatrixUncentered",void 0),U(this,"viewMatrixInverse",void 0),U(this,"viewProjectionMatrix",void 0),U(this,"pixelProjectionMatrix",void 0),U(this,"pixelUnprojectionMatrix",void 0),U(this,"resolution",void 0),U(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||vO,this.focalDistance=e.focalDistance||1,this.position=e.position||D1,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:s}=e;this.isGeospatial=Number.isFinite(s)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ns.WEB_MERCATOR:Ns.WEB_MERCATOR_AUTO_OFFSET:Ns.IDENTITY}equals(e){return e instanceof lc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ru(e.projectionMatrix,this.projectionMatrix)&&Ru(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const s=this.projectPosition(e),a=Ub(s,this.pixelProjectionMatrix),[h,p]=a,c=i?p:this.height-p;return e.length===2?[h,c]:[h,c,a[2]]}unproject(e,{topLeft:i=!0,targetZ:s}={}){const[a,h,p]=e,c=i?h:this.height-h,b=s&&s*this.distanceScales.unitsPerMeter[2],T=jg([a,c,p],this.pixelUnprojectionMatrix,b),[P,k,C]=this.unprojectPosition(T);return Number.isFinite(p)?[P,k,C]:Number.isFinite(s)?[P,k,s]:[P,k]}projectPosition(e){const[i,s]=this.projectFlat(e),a=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,s,a]}unprojectPosition(e){const[i,s]=this.unprojectFlat(e),a=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,s,a]}projectFlat(e){if(this.isGeospatial){const i=Du(e);return i[1]=Xo(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?Ql(e):e}getBounds(e={}){const i={targetZ:e.z||0},s=this.unproject([0,0],i),a=this.unproject([this.width,0],i),h=this.unproject([0,this.height],i),p=this.unproject([this.width,this.height],i);return[Math.min(s[0],a[0],h[0],p[0]),Math.min(s[1],a[1],h[1],p[1]),Math.max(s[0],a[0],h[0],p[0]),Math.max(s[1],a[1],h[1],p[1])]}getDistanceScales(e){return e?Vm({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:s=1,height:a=1}){return e<this.x+this.width&&this.x<e+s&&i<this.y+this.height&&this.y<i+a}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,pO(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,s=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Wz({latitude:s})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Vm({latitude:s,longitude:i}));const a=Math.pow(2,this.zoom);this.scale=a;const{position:h,modelMatrix:p}=e;let c=D1;if(h&&(c=p?new Gs(p).transformAsVector(h,[]):h),this.isGeospatial){const b=this.projectPosition([i,s,0]);this.center=new js(c).scale(this.distanceScales.unitsPerMeter).add(b)}else this.center=this.projectPosition(c)}_initMatrices(e){const{viewMatrix:i=yO,projectionMatrix:s=null,orthographic:a=!1,fovyRadians:h,fovy:p=75,near:c=.1,far:b=1e3,padding:T=null,focalDistance:P=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new Gs().multiplyRight(i).translate(new js(this.center).negate()),this.projectionMatrix=s||xO({width:this.width,height:this.height,orthographic:a,fovyRadians:h||p*_O,focalDistance:P,padding:T,near:c,far:b});const k=du();Va(k,k,this.projectionMatrix),Va(k,k,this.viewMatrix),this.viewProjectionMatrix=k,this.viewMatrixInverse=Fm([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=fO(this.viewMatrixInverse);const C=du(),H=du();Fg(C,C,[this.width/2,-this.height/2,1]),Vd(C,C,[1,-1,0]),Va(H,C,this.viewProjectionMatrix),this.pixelProjectionMatrix=H,this.pixelUnprojectionMatrix=Fm(du(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Vi.warn("Pixel project matrix not invertible")()}}U(lc,"displayName","Viewport");class qa extends lc{constructor(e={}){const{latitude:i=0,longitude:s=0,zoom:a=0,pitch:h=0,bearing:p=0,nearZMultiplier:c=.1,farZMultiplier:b=1.01,orthographic:T=!1,projectionMatrix:P,repeat:k=!1,worldOffset:C=0,position:H,padding:ee,legacyMeterSizes:se=!1}=e;let{width:pe,height:fe,altitude:ye=1.5}=e;const Se=Math.pow(2,a);pe=pe||1,fe=fe||1;let Ue,$e=null;if(P)ye=P[5]/2,Ue=$d(ye);else{e.fovy?(Ue=e.fovy,ye=Nb(Ue)):Ue=$d(ye);let Qe;if(ee){const{top:at=0,bottom:wt=0}=ee;Qe=[0,Xo((at+fe-wt)/2,0,fe)-fe/2]}$e=Xz({width:pe,height:fe,scale:Se,center:H&&[0,0,H[2]*Td(i)],offset:Qe,pitch:h,fovy:Ue,nearZMultiplier:c,farZMultiplier:b})}let Ye=Zz({height:fe,pitch:h,bearing:p,scale:Se,altitude:ye});C&&(Ye=new Gs().translate([512*C,0,0]).multiplyLeft(Ye)),super({...e,width:pe,height:fe,viewMatrix:Ye,longitude:s,latitude:i,zoom:a,...$e,fovy:Ue,focalDistance:ye}),U(this,"longitude",void 0),U(this,"latitude",void 0),U(this,"pitch",void 0),U(this,"bearing",void 0),U(this,"altitude",void 0),U(this,"fovy",void 0),U(this,"orthographic",void 0),U(this,"_subViewports",void 0),U(this,"_pseudoMeters",void 0),this.latitude=i,this.longitude=s,this.zoom=a,this.pitch=h,this.bearing=p,this.altitude=ye,this.fovy=Ue,this.orthographic=T,this._subViewports=k?[]:null,this._pseudoMeters=se,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),s=Math.ceil((e[2]-180)/360);for(let a=i;a<=s;a++){const h=a?new qa({...this,worldOffset:a}):this;this._subViewports.push(h)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,s]=this.projectFlat(e),a=(e[2]||0)*Td(e[1]);return[i,s,a]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,s]=this.unprojectFlat(e),a=(e[2]||0)/Td(s);return[i,s,a]}addMetersToLngLat(e,i){return Bb(e,i)}panByPosition(e,i){const s=jg(i,this.pixelUnprojectionMatrix),a=this.projectFlat(e),h=b1([],a,tD([],s)),p=b1([],this.center,h),[c,b]=this.unprojectFlat(p);return{longitude:c,latitude:b}}getBounds(e={}){const i=Jz(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:s,height:a}=this,{longitude:h,latitude:p,zoom:c}=Yz({width:s,height:a,bounds:e,...i});return new qa({width:s,height:a,longitude:h,latitude:p,zoom:c})}}U(qa,"displayName","WebMercatorViewport");const z1=[0,0,0];function Kp(t,e,i=!1){const s=e.projectPosition(t);if(i&&e instanceof qa){const[a,h,p=0]=t,c=e.getDistanceScales([a,h]);s[2]=p*c.unitsPerMeter[2]}return s}function bO(t){const{viewport:e,modelMatrix:i,coordinateOrigin:s}=t;let{coordinateSystem:a,fromCoordinateSystem:h,fromCoordinateOrigin:p}=t;return a===Oi.DEFAULT&&(a=e.isGeospatial?Oi.LNGLAT:Oi.CARTESIAN),h===void 0&&(h=a),p===void 0&&(p=s),{viewport:e,coordinateSystem:a,coordinateOrigin:s,modelMatrix:i,fromCoordinateSystem:h,fromCoordinateOrigin:p}}function jb(t,{viewport:e,modelMatrix:i,coordinateSystem:s,coordinateOrigin:a,offsetMode:h}){let[p,c,b=0]=t;switch(i&&([p,c,b]=Wu([],[p,c,b,1],i)),s){case Oi.LNGLAT:return Kp([p,c,b],e,h);case Oi.LNGLAT_OFFSETS:return Kp([p+a[0],c+a[1],b+(a[2]||0)],e,h);case Oi.METER_OFFSETS:return Kp(Bb(a,[p,c,b]),e,h);case Oi.CARTESIAN:default:return e.isGeospatial?[p+a[0],c+a[1],b+a[2]]:e.projectPosition([p,c,b])}}function wO(t,e){const{viewport:i,coordinateSystem:s,coordinateOrigin:a,modelMatrix:h,fromCoordinateSystem:p,fromCoordinateOrigin:c}=bO(e),{autoOffset:b=!0}=e,{geospatialOrigin:T=z1,shaderCoordinateOrigin:P=z1,offsetMode:k=!1}=b?Ob(i,s,a):{},C=jb(t,{viewport:i,modelMatrix:h,coordinateSystem:p,coordinateOrigin:c,offsetMode:k});if(k){const H=i.projectPosition(T||P);gD(C,C,H)}return C}const O1={blendFunc:[1,0,32771,0],blendEquation:32774};class Gb extends Ng{constructor(...e){super(...e),U(this,"pickZ",void 0),U(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:s,viewports:a,onViewportActive:h,pickingFBO:p,deviceRect:{x:c,y:b,width:T,height:P},cullRect:k,effects:C,pass:H="picking",pickZ:ee,moduleParameters:se}){const pe=this.gl;this.pickZ=ee;const fe=this._resetColorEncoder(ee),ye=gs(pe,{scissorTest:!0,scissor:[c,b,T,P],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...O1,blend:!ee},()=>super.render({target:p,layers:e,layerFilter:i,views:s,viewports:a,onViewportActive:h,cullRect:k,effects:C==null?void 0:C.filter(Ue=>Ue.useInPicking),pass:H,isPicking:!0,moduleParameters:se}));return this._colorEncoderState=null,{decodePickingColor:fe&&TO.bind(null,fe),stats:ye}}shouldDrawLayer(e){const{pickable:i,operation:s}=e.props;return i&&s.includes("draw")||s.includes("terrain")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,i,s){const a={...e.props.parameters},{pickable:h,operation:p}=e.props;return this._colorEncoderState?h&&p.includes("draw")&&(Object.assign(a,O1),a.blend=!0,a.blendColor=EO(this._colorEncoderState,e,s)):a.blend=!1,p.includes("terrain")&&(a.blend=!1),a}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function EO(t,e,i){const{byLayer:s,byAlpha:a}=t;let h,p=s.get(e);return p?(p.viewports.push(i),h=p.a):(h=s.size+1,h<=255?(p={a:h,layer:e,viewports:[i]},s.set(e,p),a[h]=p):(Vi.warn("Too many pickable layers, only picking the first 255")(),h=0)),[0,0,0,h/255]}function TO(t,e){const i=t.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const Ll={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Hd=Symbol.for("component"),ja=Symbol.for("propTypes"),Jp=Symbol.for("deprecatedProps"),Nl=Symbol.for("asyncPropDefaults"),Wa=Symbol.for("asyncPropOriginal"),Yo=Symbol.for("asyncPropResolved");function Ou(t,e=()=>!0){return Array.isArray(t)?$b(t,e,[]):e(t)?[t]:[]}function $b(t,e,i){let s=-1;for(;++s<t.length;){const a=t[s];Array.isArray(a)?$b(a,e,i):e(a)&&i.push(a)}return i}function AO({target:t,source:e,start:i=0,count:s=1}){const a=e.length,h=s*a;let p=0;for(let c=i;p<a;p++)t[c++]=e[p];for(;p<h;)p<h-p?(t.copyWithin(i+p,i,i+p),p*=2):(t.copyWithin(i+p,i,i+h-p),p=h);return t}class SO{constructor(e,i,s){U(this,"id",void 0),U(this,"context",void 0),U(this,"isLoaded",void 0),U(this,"persistent",void 0),U(this,"_loadCount",0),U(this,"_subscribers",new Set),U(this,"_data",void 0),U(this,"_loader",void 0),U(this,"_error",void 0),U(this,"_content",void 0),this.id=e,this.context=s,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const s=++this._loadCount;let a=e;typeof e=="string"&&(a=Fd(e)),a instanceof Promise?(this.isLoaded=!1,this._loader=a.then(h=>{this._loadCount===s&&(this.isLoaded=!0,this._error=void 0,this._content=h)}).catch(h=>{this._loadCount===s&&(this.isLoaded=!0,this._error=h||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const h of this._subscribers)h.onChange(this.getData())}}class IO{constructor({gl:e,protocol:i}){U(this,"protocol",void 0),U(this,"_context",void 0),U(this,"_resources",void 0),U(this,"_consumers",void 0),U(this,"_pruneRequest",void 0),this.protocol=i||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:s=!1,persistent:a=!0}){let h=this._resources[e];h?h.setData(i,s):(h=new SO(e,i,this._context),this._resources[e]=h),h.persistent=a}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const s in i){const a=i[s],h=this._resources[a.resourceId];h&&h.unsubscribe(a)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:s,requestId:a="default"}){const{_resources:h,protocol:p}=this;e.startsWith(p)&&(e=e.replace(p,""),h[e]||this.add({resourceId:e,data:null,persistent:!1}));const c=h[e];if(this._track(s,a,c,i),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,s,a){const h=this._consumers,p=h[e]=h[e]||{},c=p[i]||{},b=c.resourceId&&this._resources[c.resourceId];b&&(b.unsubscribe(c),this.prune()),s&&(p[i]=c,c.onChange=a,c.resourceId=s.id,s.subscribe(c))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const PO=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,MO={name:"project32",dependencies:[Ug],vs:PO},CO={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...GD},LO=[Ug],kO=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function RO(t){const e=Zu.getDefaultProgramManager(t);for(const i of LO)e.addDefaultModule(i);for(const i of kO)e.addShaderHook(i);return e}const DO="layerManager.setLayers",zO="layerManager.activateViewport";class OO{constructor(e,{deck:i,stats:s,viewport:a,timeline:h}={}){U(this,"layers",void 0),U(this,"context",void 0),U(this,"resourceManager",void 0),U(this,"_lastRenderedLayers",[]),U(this,"_needsRedraw",!1),U(this,"_needsUpdate",!1),U(this,"_nextLayers",null),U(this,"_debug",!1),U(this,"activateViewport",p=>{_r(zO,this,p),p&&(this.context.viewport=p)}),this.layers=[],this.resourceManager=new IO({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:i,programManager:e&&RO(e),stats:s||new Tg({id:"deck.gl"}),viewport:a||new lc({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:h||new Lb,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const s of this.layers){const a=s.getNeedsRedraw(e);i=i||a}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(s=>i.id.indexOf(s)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){_r(DO,this,i,e),this._lastRenderedLayers=e;const s=Ou(e,Boolean);for(const a of s)a.context=this.context;this._updateLayers(this.layers,s)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,i,s){s.raiseError(i,"".concat(e," of ").concat(s))}_updateLayers(e,i){const s={};for(const p of e)s[p.id]?Vi.warn("Multiple old layers with same id ".concat(p.id))():s[p.id]=p;const a=[];this._updateSublayersRecursively(i,s,a),this._finalizeOldLayers(s);let h=!1;for(const p of a)if(p.hasUniformTransition()){h="Uniform transition in ".concat(p);break}this._needsUpdate=h,this.layers=a}_updateSublayersRecursively(e,i,s){for(const a of e){a.context=this.context;const h=i[a.id];h===null&&Vi.warn("Multiple new layers with same id ".concat(a.id))(),i[a.id]=null;let p=null;try{this._debug&&h!==a&&a.validateProps(),h?(this._transferLayerState(h,a),this._updateLayer(a)):this._initializeLayer(a),s.push(a),p=a.isComposite?a.getSubLayers():null}catch(c){this._handleError("matching",c,a)}p&&this._updateSublayersRecursively(p,i,s)}}_finalizeOldLayers(e){for(const i in e){const s=e[i];s&&this._finalizeLayer(s)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Ll.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=Ll.MATCHED,i!==e&&(e.lifecycle=Ll.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Ll.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Ll.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function Us(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!Us(t[s],e[s],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const s=Object.keys(t),a=Object.keys(e);if(s.length!==a.length)return!1;for(const h of s)if(!e.hasOwnProperty(h)||!Us(t[h],e[h],i-1))return!1;return!0}return!1}class FO{constructor(e){U(this,"width",void 0),U(this,"height",void 0),U(this,"views",void 0),U(this,"viewState",void 0),U(this,"controllers",void 0),U(this,"timeline",void 0),U(this,"_viewports",void 0),U(this,"_viewportMap",void 0),U(this,"_isUpdating",void 0),U(this,"_needsRedraw",void 0),U(this,"_needsUpdate",void 0),U(this,"_eventManager",void 0),U(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,s=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(s):s}getViewport(e){return this._viewportMap[e]}unproject(e,i){const s=this.getViewports(),a={x:e[0],y:e[1]};for(let h=s.length-1;h>=0;--h){const p=s[h];if(p.containsPixel(a)){const c=e.slice();return c[0]-=p.x,c[1]-=p.y,p.unproject(c,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Ou(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Us(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Vi.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,i){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...i,viewId:e})}_createController(e,i){const s=i.type;return new s({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,i.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:h=>{var p;return(p=this.getView(e.id))===null||p===void 0?void 0:p.makeViewport({viewState:h,width:this.width,height:this.height})}})}_updateController(e,i,s,a){const h=e.controller;if(h){const p={...i,...h,id:e.id,x:s.x,y:s.y,width:s.width,height:s.height};return a||(a=this._createController(e,p)),a&&a.setProps(p),a}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let s=!1;for(let a=e.length;a--;){const h=e[a],p=this.getViewState(h),c=h.makeViewport({viewState:p,width:this.width,height:this.height});let b=i[h.id];const T=Boolean(h.controller);T&&!b&&(s=!0),(s||!T)&&b&&(b.finalize(),b=null),this.controllers[h.id]=this._updateController(h,p,c,b),this._viewports.unshift(c)}for(const a in i){const h=i[a];h&&!this.controllers[a]&&h.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((s,a)=>!e[a].equals(i[a]))}}const BO=/([0-9]+\.?[0-9]*)(%|px)/;function Go(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=BO.exec(t);if(e&&e.length>=3){const i=e[2]==="%",s=parseFloat(e[1]);return{position:i?s/100:s,relative:i}}default:throw new Error("Could not parse position string ".concat(t))}}function $o(t,e){return t.relative?Math.round(t.position*e):t.position}function kn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class NO{constructor(e){U(this,"id",void 0),U(this,"viewportInstance",void 0),U(this,"_x",void 0),U(this,"_y",void 0),U(this,"_width",void 0),U(this,"_height",void 0),U(this,"_padding",void 0),U(this,"props",void 0);const{id:i,x:s=0,y:a=0,width:h="100%",height:p="100%",padding:c=null,viewportInstance:b}=e||{};kn(!b||b instanceof lc),this.viewportInstance=b,this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Go(s),this._y=Go(a),this._width=Go(h),this._height=Go(p),this._padding=c&&{left:Go(c.left||0),right:Go(c.right||0),top:Go(c.top||0),bottom:Go(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Us(this.props,e.props,2)}makeViewport({width:e,height:i,viewState:s}){if(this.viewportInstance)return this.viewportInstance;s=this.filterViewState(s);const a=this.getDimensions({width:e,height:i});return new this.ViewportType({...s,...this.props,...a})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const s in this.props.viewState)s!=="id"&&(i[s]=this.props.viewState[s]);return i}return e}getDimensions({width:e,height:i}){const s={x:$o(this._x,e),y:$o(this._y,i),width:$o(this._width,e),height:$o(this._height,i)};return this._padding&&(s.padding={left:$o(this._padding.left,e),top:$o(this._padding.top,i),right:$o(this._padding.right,e),bottom:$o(this._padding.bottom,i)}),s}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Yu{constructor(e){U(this,"_inProgress",void 0),U(this,"_handle",void 0),U(this,"_timeline",void 0),U(this,"time",void 0),U(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var i,s;this.cancel(),this.settings=e,this._inProgress=!0,(i=(s=this.settings).onStart)===null||i===void 0||i.call(s,this)}end(){if(this._inProgress){var e,i;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(i=this.settings).onEnd)===null||e===void 0||e.call(i,this)}}cancel(){if(this._inProgress){var e,i;(e=(i=this.settings).onInterrupt)===null||e===void 0||e.call(i,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:s,settings:a}=this;this._handle=s.addChannel({delay:s.getTime(),duration:a.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(i=this.settings).onUpdate)===null||e===void 0||e.call(i,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const F1=()=>{},jm={BREAK:1,SNAP_TO_END:2,IGNORE:3},UO=t=>t,VO=jm.BREAK;class jO{constructor(e){U(this,"getControllerState",void 0),U(this,"props",void 0),U(this,"propsInTransition",void 0),U(this,"transition",void 0),U(this,"onViewStateChange",void 0),U(this,"onStateChange",void 0),U(this,"_onTransitionUpdate",i=>{const{time:s,settings:{interpolator:a,startProps:h,endProps:p,duration:c,easing:b}}=i,T=b(s/c),P=a.interpolateProps(h,p,T);this.propsInTransition=this.getControllerState({...this.props,...P}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Yu(e.timeline),this.onViewStateChange=e.onViewStateChange||F1,this.onStateChange=e.onStateChange||F1}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const s=this.props;if(this.props=e,!s||this._shouldIgnoreViewportChange(s,e))return!1;if(this._isTransitionEnabled(e)){let a=s;if(this.transition.inProgress){const{interruption:h,endProps:p}=this.transition.settings;a={...s,...h===jm.SNAP_TO_END?p:this.propsInTransition||s}}this._triggerTransition(a,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:s}=e;return(i>0||i==="auto")&&Boolean(s)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===jm.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const s=this.getControllerState(e),a=this.getControllerState(i).shortestPathFrom(s),h=i.transitionInterpolator,p=h.getDuration?h.getDuration(e,i):i.transitionDuration;if(p===0)return;const c=h.initializeProps(e,a);this.propsInTransition={};const b={duration:p,easing:i.transitionEasing||UO,interpolator:h,interruption:i.transitionInterruption||VO,startProps:c.start,endProps:c.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(b),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(i)}}}class GO{constructor(e){U(this,"_propsToCompare",void 0),U(this,"_propsToExtract",void 0),U(this,"_requiredProps",void 0);const{compare:i,extract:s,required:a}=e;this._propsToCompare=i,this._propsToExtract=s||i,this._requiredProps=a}arePropsEqual(e,i){for(const s of this._propsToCompare)if(!(s in e)||!(s in i)||!Ru(e[s],i[s]))return!1;return!0}initializeProps(e,i){const s={},a={};for(const h of this._propsToExtract)(h in e||h in i)&&(s[h]=e[h],a[h]=i[h]);return this._checkRequiredProps(s),this._checkRequiredProps(a),{start:s,end:a}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){!this._requiredProps||this._requiredProps.forEach(i=>{const s=e[i];kn(Number.isFinite(s)||Array.isArray(s),"".concat(i," is required for transition"))})}}const $O=["longitude","latitude","zoom","bearing","pitch"],HO=["longitude","latitude","zoom"];class Hb extends GO{constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,s=Array.isArray(e)?{}:e;s.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:$O,required:HO},super(s.transitionProps),U(this,"opts",void 0),this.opts=s}initializeProps(e,i){const s=super.initializeProps(e,i),{makeViewport:a,around:h}=this.opts;if(a&&h){const p=a(e),c=a(i),b=p.unproject(h);s.start.around=h,Object.assign(s.end,{around:c.project(b),aroundPosition:b,width:i.width,height:i.height})}return s}interpolateProps(e,i,s){const a={};for(const h of this._propsToExtract)a[h]=Ud(e[h]||0,i[h]||0,s);if(i.aroundPosition&&this.opts.makeViewport){const h=this.opts.makeViewport({...i,...a});Object.assign(a,h.panByPosition(i.aroundPosition,Ud(e.around,i.around,s)))}return a}}const Ho={transitionDuration:0},qO=300,fd=t=>1-(1-t)*(1-t),Ml={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ka={};class WO{constructor(e){U(this,"props",void 0),U(this,"state",{}),U(this,"transitionManager",void 0),U(this,"eventManager",void 0),U(this,"onViewStateChange",void 0),U(this,"onStateChange",void 0),U(this,"makeViewport",void 0),U(this,"_controllerState",void 0),U(this,"_events",{}),U(this,"_interactionState",{isDragging:!1}),U(this,"_customEvents",[]),U(this,"_eventStartBlocked",null),U(this,"_panMove",!1),U(this,"invertPan",!1),U(this,"dragMode","rotate"),U(this,"inertia",0),U(this,"scrollZoom",!0),U(this,"dragPan",!0),U(this,"dragRotate",!0),U(this,"doubleClickZoom",!0),U(this,"touchZoom",!0),U(this,"touchRotate",!1),U(this,"keyboard",!0),this.transitionManager=new jO({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const i in this._events)if(this._events[i]){var e;(e=this.eventManager)===null||e===void 0||e.off(i,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return i?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:s}=this.props,{offsetCenter:a}=e;return[a.x-i,a.y-s]}isPointInBounds(e,i){const{width:s,height:a}=this.props;if(i&&i.handled)return!1;const h=e[0]>=0&&e[0]<=s&&e[1]>=0&&e[1]<=a;return h&&i&&i.stopPropagation(),h}isFunctionKeyPressed(e){const{srcEvent:i}=e;return Boolean(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?qO:0;const{scrollZoom:s=!0,dragPan:a=!0,dragRotate:h=!0,doubleClickZoom:p=!0,touchZoom:c=!0,touchRotate:b=!1,keyboard:T=!0}=e,P=Boolean(this.onViewStateChange);this.toggleEvents(Ml.WHEEL,P&&s),this.toggleEvents(Ml.PAN,P&&(a||h)),this.toggleEvents(Ml.PINCH,P&&(c||b)),this.toggleEvents(Ml.TRIPLE_PAN,P&&b),this.toggleEvents(Ml.DOUBLE_TAP,P&&p),this.toggleEvents(Ml.KEYBOARD,P&&T),this.scrollZoom=s,this.dragPan=a,this.dragRotate=h,this.doubleClickZoom=p,this.touchZoom=c,this.touchRotate=b,this.keyboard=T}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(s=>{this._events[s]!==i&&(this._events[s]=i,i?this.eventManager.on(s,this.handleEvent):this.eventManager.off(s,this.handleEvent))})}updateViewport(e,i=null,s={}){const a={...e.getViewportProps(),...i},h=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(s),h){const p=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:a,interactionState:this._interactionState,oldViewState:p})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let s=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(s=!s);const a=this.controllerState[s?"panStart":"rotateStart"]({pos:i});return this._panMove=s,this.updateViewport(a,Ho,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),s=this.controllerState.pan({pos:i});return this.updateViewport(s,Ho,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const s=this.getCenter(e),a=[s[0]+e.velocityX*i/2,s[1]+e.velocityY*i/2],h=this.controllerState.pan({pos:a}).panEnd();this.updateViewport(h,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:fd},{isDragging:!1,isPanning:!0})}else{const s=this.controllerState.panEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),s=this.controllerState.rotate({pos:i});return this.updateViewport(s,Ho,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const s=this.getCenter(e),a=[s[0]+e.velocityX*i/2,s[1]+e.velocityY*i/2],h=this.controllerState.rotate({pos:a}).rotateEnd();this.updateViewport(h,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:fd},{isDragging:!1,isRotating:!0})}else{const s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const{speed:s=.01,smooth:a=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:h}=e;let p=2/(1+Math.exp(-Math.abs(h*s)));h<0&&p!==0&&(p=1/p);const c=this.controllerState.zoom({pos:i,scale:p});return this.updateViewport(c,{...this._getTransitionProps({around:i}),transitionDuration:a?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const s=this.controllerState.rotateStart({pos:i});return this.updateViewport(s,Ho,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const s=this.controllerState.rotate({pos:i});return this.updateViewport(s,Ho,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const s=this.getCenter(e),a=[s[0],s[1]+=e.velocityY*i/2],h=this.controllerState.rotate({pos:a});this.updateViewport(h,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:fd},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const s=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return ka._startPinchRotation=e.rotation,ka._lastPinchEvent=e,this.updateViewport(s,Ho,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:s}=e,a=this.getCenter(e);i=i.zoom({pos:a,scale:s})}if(this.touchRotate){const{rotation:s}=e;i=i.rotate({deltaAngleX:ka._startPinchRotation-s})}return this.updateViewport(i,Ho,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ka._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:s}=ka;if(this.touchZoom&&i&&s&&e.scale!==s.scale){const a=this.getCenter(e);let h=this.controllerState.rotateEnd();const p=Math.log2(e.scale),c=(p-Math.log2(s.scale))/(e.deltaTime-s.deltaTime),b=Math.pow(2,p+c*i/2);h=h.zoom({pos:a,scale:b}).zoomEnd(),this.updateViewport(h,{...this._getTransitionProps({around:a}),transitionDuration:i,transitionEasing:fd},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const a=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(a,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ka._startPinchRotation=null,ka._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const s=this.isFunctionKeyPressed(e),a=this.controllerState.zoom({pos:i,scale:s?.5:2});return this.updateViewport(a,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:s,moveSpeed:a,rotateSpeedX:h,rotateSpeedY:p}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this;let b;const T={};switch(e.srcEvent.code){case"Minus":b=i?c.zoomOut(s).zoomOut(s):c.zoomOut(s),T.isZooming=!0;break;case"Equal":b=i?c.zoomIn(s).zoomIn(s):c.zoomIn(s),T.isZooming=!0;break;case"ArrowLeft":i?(b=c.rotateLeft(h),T.isRotating=!0):(b=c.moveLeft(a),T.isPanning=!0);break;case"ArrowRight":i?(b=c.rotateRight(h),T.isRotating=!0):(b=c.moveRight(a),T.isPanning=!0);break;case"ArrowUp":i?(b=c.rotateUp(p),T.isRotating=!0):(b=c.moveUp(a),T.isPanning=!0);break;case"ArrowDown":i?(b=c.rotateDown(p),T.isRotating=!0):(b=c.moveDown(a),T.isPanning=!0);break;default:return!1}return this.updateViewport(b,this._getTransitionProps(),T),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?Ho:e?{...i,transitionInterpolator:new Hb({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class ZO{constructor(e,i){U(this,"_viewportProps",void 0),U(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const B1=5,XO=1.2;class YO extends ZO{constructor(e){const{width:i,height:s,latitude:a,longitude:h,zoom:p,bearing:c=0,pitch:b=0,altitude:T=1.5,position:P=[0,0,0],maxZoom:k=20,minZoom:C=0,maxPitch:H=60,minPitch:ee=0,startPanLngLat:se,startZoomLngLat:pe,startRotatePos:fe,startBearing:ye,startPitch:Se,startZoom:Ue,normalize:$e=!0}=e;kn(Number.isFinite(h)),kn(Number.isFinite(a)),kn(Number.isFinite(p)),super({width:i,height:s,latitude:a,longitude:h,zoom:p,bearing:c,pitch:b,altitude:T,maxZoom:k,minZoom:C,maxPitch:H,minPitch:ee,normalize:$e,position:P},{startPanLngLat:se,startZoomLngLat:pe,startRotatePos:fe,startBearing:ye,startPitch:Se,startZoom:Ue}),U(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const s=this.getState().startPanLngLat||this._unproject(i);if(!s)return this;const h=this.makeViewport(this.getViewportProps()).panByPosition(s,e);return this._getUpdatedState(h)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:s=0}){const{startRotatePos:a,startBearing:h,startPitch:p}=this.getState();if(!a||h===void 0||p===void 0)return this;let c;return e?c=this._getNewRotation(e,a,p,h):c={bearing:h+i,pitch:p+s},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:s}){let{startZoom:a,startZoomLngLat:h}=this.getState();if(h||(a=this.getViewportProps().zoom,h=this._unproject(i)||this._unproject(e)),!h)return this;const{maxZoom:p,minZoom:c}=this.getViewportProps();let b=a+Math.log2(s);b=Xo(b,c,p);const T=this.makeViewport({...this.getViewportProps(),zoom:b});return this._getUpdatedState({zoom:b,...T.panByPosition(h,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),s={...this.getViewportProps()},{bearing:a,longitude:h}=s;return Math.abs(a-i.bearing)>180&&(s.bearing=a<0?a+360:a-360),Math.abs(h-i.longitude)>180&&(s.longitude=h<0?h+360:h-360),s}applyConstraints(e){const{maxZoom:i,minZoom:s,zoom:a}=e;e.zoom=Xo(a,s,i);const{maxPitch:h,minPitch:p,pitch:c}=e;e.pitch=Xo(c,p,h);const{normalize:b=!0}=e;return b&&Object.assign(e,Qz(e)),e}_zoomFromCenter(e){const{width:i,height:s}=this.getViewportProps();return this.zoom({pos:[i/2,s/2],scale:e})}_panFromCenter(e){const{width:i,height:s}=this.getViewportProps();return this.pan({startPos:[i/2,s/2],pos:[i/2+e[0],s/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,s,a){const h=e[0]-i[0],p=e[1]-i[1],c=e[1],b=i[1],{width:T,height:P}=this.getViewportProps(),k=h/T;let C=0;p>0?Math.abs(P-b)>B1&&(C=p/(b-P)*XO):p<0&&b>B1&&(C=1-c/b),C=Xo(C,-1,1);const{minPitch:H,maxPitch:ee}=this.getViewportProps(),se=a+180*k;let pe=s;return C>0?pe=s+C*(ee-s):C<0&&(pe=s-C*(H-s)),{pitch:pe,bearing:se}}}class KO extends WO{constructor(...e){super(...e),U(this,"ControllerState",YO),U(this,"transition",{transitionDuration:300,transitionInterpolator:new Hb({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),U(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Gg extends NO{get ViewportType(){return qa}get ControllerType(){return KO}}U(Gg,"displayName","MapView");const JO=new Vb;function QO(t,e){var i,s;const a=(i=t.order)!==null&&i!==void 0?i:1/0,h=(s=e.order)!==null&&s!==void 0?s:1/0;return a-h}class e4{constructor(){U(this,"effects",void 0),U(this,"_resolvedEffects",[]),U(this,"_defaultEffects",[]),U(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const i=this._defaultEffects;if(!i.find(s=>s.id===e.id)){const s=i.findIndex(a=>QO(a,e)>0);s<0?i.push(e):i.splice(s,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Us(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(e){const i={};for(const a of this.effects)i[a.id]=a;const s=[];for(const a of e){const h=i[a.id];h&&h!==a?h.setProps?(h.setProps(a.props),s.push(h)):(h.cleanup(),s.push(a)):s.push(a),delete i[a.id]}for(const a in i)i[a].cleanup();this.effects=s,this._resolvedEffects=s.concat(this._defaultEffects),e.some(a=>a instanceof Vb)||this._resolvedEffects.push(JO),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class t4 extends Ng{shouldDrawLayer(e){const{operation:i}=e.props;return i.includes("draw")||i.includes("terrain")}}const i4="deckRenderer.renderLayers";class n4{constructor(e){U(this,"gl",void 0),U(this,"layerFilter",void 0),U(this,"drawPickingColors",void 0),U(this,"drawLayersPass",void 0),U(this,"pickLayersPass",void 0),U(this,"renderCount",void 0),U(this,"_needsRedraw",void 0),U(this,"renderBuffers",void 0),U(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new t4(e),this.pickLayersPass=new Gb(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,s={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Bn.getDefaultFramebuffer(this.gl)};s.effects&&this._preRender(s.effects,s);const a=this.lastPostProcessEffect?this.renderBuffers[0]:s.target,h=i.render({...s,target:a});s.effects&&this._postRender(s.effects,s),this.renderCount++,_r(i4,this,h,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const s of e)i.preRenderStats[s.id]=s.preRender(this.gl,i),s.postRender&&(this.lastPostProcessEffect=s.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Bn(this.gl),new Bn(this.gl));for(const i of e)i.resize()}_postRender(e,i){const{renderBuffers:s}=this,a={...i,inputBuffer:s[0],swapBuffer:s[1],target:null};for(const h of e)if(h.postRender){if(h.id===this.lastPostProcessEffect){a.target=i.target,h.postRender(this.gl,a);break}const p=h.postRender(this.gl,a);a.inputBuffer=p,a.swapBuffer=p===s[0]?s[1]:s[0]}}}const r4={pickedColor:null,pickedObjectIndex:-1};function s4({pickedColors:t,decodePickingColor:e,deviceX:i,deviceY:s,deviceRadius:a,deviceRect:h}){const{x:p,y:c,width:b,height:T}=h;let P=a*a,k=-1,C=0;for(let H=0;H<T;H++){const ee=H+c-s,se=ee*ee;if(se>P)C+=4*b;else for(let pe=0;pe<b;pe++){if(t[C+3]-1>=0){const ye=pe+p-i,Se=ye*ye+se;Se<=P&&(P=Se,k=C)}C+=4}}if(k>=0){const H=t.slice(k,k+4),ee=e(H);if(ee){const se=Math.floor(k/4/b),pe=k/4-se*b;return{...ee,pickedColor:H,pickedX:p+pe,pickedY:c+se}}Vi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return r4}function o4({pickedColors:t,decodePickingColor:e}){const i=new Map;if(t){for(let s=0;s<t.length;s+=4)if(t[s+3]-1>=0){const h=t.slice(s,s+4),p=h.join(",");if(!i.has(p)){const c=e(h);c?i.set(p,{...c,color:h}):Vi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function qb({pickInfo:t,viewports:e,pixelRatio:i,x:s,y:a,z:h}){let p=e[0];e.length>1&&(p=l4((t==null?void 0:t.pickedViewports)||e,{x:s,y:a}));let c;if(p){const b=[s-p.x,a-p.y];h!==void 0&&(b[2]=h),c=p.unproject(b)}return{color:null,layer:null,viewport:p,index:-1,picked:!1,x:s,y:a,pixel:[s,a],coordinate:c,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function a4(t){const{pickInfo:e,lastPickedInfo:i,mode:s,layers:a}=t,{pickedColor:h,pickedLayer:p,pickedObjectIndex:c}=e,b=p?[p]:[];if(s==="hover"){const k=i.index,C=i.layerId,H=p?p.props.id:null;if(H!==C||c!==k){if(H!==C){const ee=a.find(se=>se.props.id===C);ee&&b.unshift(ee)}i.layerId=H,i.index=c,i.info=null}}const T=qb(t),P=new Map;return P.set(null,T),b.forEach(k=>{let C={...T};k===p&&(C.color=h,C.index=c,C.picked=!0),C=Wb({layer:k,info:C,mode:s});const H=C.layer;k===p&&s==="hover"&&(i.info=C),P.set(H.id,C),s==="hover"&&H.updateAutoHighlight(C)}),P}function Wb({layer:t,info:e,mode:i}){for(;t&&e;){const s=e.layer||null;e.sourceLayer=s,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:s}),t=t.parent}return e}function l4(t,e){for(let i=t.length-1;i>=0;i--){const s=t[i];if(s.containsPixel(e))return s}return t[0]}class c4{constructor(e){U(this,"gl",void 0),U(this,"pickingFBO",void 0),U(this,"depthFBO",void 0),U(this,"pickLayersPass",void 0),U(this,"layerFilter",void 0),U(this,"lastPickedInfo",void 0),U(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new Gb(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:s,viewports:a},h=this.lastPickedInfo.info){const p=h&&h.layer&&h.layer.id,c=h&&h.viewport&&h.viewport.id,b=p?s.find(C=>C.id===p):null,T=c&&a.find(C=>C.id===c)||a[0],P=T&&T.unproject([e-T.x,i-T.y]);return{...h,...{x:e,y:i,viewport:T,coordinate:P,layer:b}}}_resizeBuffer(){var e,i;const{gl:s}=this;if(!this.pickingFBO&&(this.pickingFBO=new Bn(s),Bn.isSupported(s,{colorBufferFloat:!0}))){const a=new Bn(s);a.attach({[36064]:new $r(s,{format:yi(s)?34836:6408,type:5126})}),this.depthFBO=a}(e=this.pickingFBO)===null||e===void 0||e.resize({width:s.canvas.width,height:s.canvas.height}),(i=this.depthFBO)===null||i===void 0||i.resize({width:s.canvas.width,height:s.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(s=>this.pickLayersPass.shouldDrawLayer(s)&&!s.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:s,x:a,y:h,radius:p=0,depth:c=1,mode:b="query",unproject3D:T,onViewportActive:P,effects:k}){const C=this._getPickable(e),H=Wl(this.gl);if(!C)return{result:[],emptyInfo:qb({viewports:s,x:a,y:h,pixelRatio:H})};this._resizeBuffer();const ee=Op(this.gl,[a,h],!0),se=[ee.x+Math.floor(ee.width/2),ee.y+Math.floor(ee.height/2)],pe=Math.round(p*H),{width:fe,height:ye}=this.pickingFBO,Se=this._getPickingRect({deviceX:se[0],deviceY:se[1],deviceRadius:pe,deviceWidth:fe,deviceHeight:ye}),Ue={x:a-p,y:h-p,width:p*2+1,height:p*2+1};let $e;const Ye=[],Qe=new Set;for(let at=0;at<c;at++){let wt;if(Se){const Lt=this._drawAndSample({layers:C,views:i,viewports:s,onViewportActive:P,deviceRect:Se,cullRect:Ue,effects:k,pass:"picking:".concat(b)});wt=s4({...Lt,deviceX:se[0],deviceY:se[1],deviceRadius:pe,deviceRect:Se})}else wt={pickedColor:null,pickedObjectIndex:-1};let Mt;if(wt.pickedLayer&&T&&this.depthFBO){const{pickedColors:Lt}=this._drawAndSample({layers:[wt.pickedLayer],views:i,viewports:s,onViewportActive:P,deviceRect:{x:wt.pickedX,y:wt.pickedY,width:1,height:1},cullRect:Ue,effects:k,pass:"picking:".concat(b,":z")},!0);Lt[3]&&(Mt=Lt[0])}wt.pickedLayer&&at+1<c&&(Qe.add(wt.pickedLayer),wt.pickedLayer.disablePickingIndex(wt.pickedObjectIndex)),$e=a4({pickInfo:wt,lastPickedInfo:this.lastPickedInfo,mode:b,layers:C,viewports:s,x:a,y:h,z:Mt,pixelRatio:H});for(const Lt of $e.values())Lt.layer&&Ye.push(Lt);if(!wt.pickedColor)break}for(const at of Qe)at.restorePickingColors();return{result:Ye,emptyInfo:$e.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:s,x:a,y:h,width:p=1,height:c=1,mode:b="query",maxObjects:T=null,onViewportActive:P,effects:k}){const C=this._getPickable(e);if(!C)return[];this._resizeBuffer();const H=Wl(this.gl),ee=Op(this.gl,[a,h],!0),se=ee.x,pe=ee.y+ee.height,fe=Op(this.gl,[a+p,h+c],!0),ye=fe.x+fe.width,Se=fe.y,Ue={x:se,y:Se,width:ye-se,height:pe-Se},$e=this._drawAndSample({layers:C,views:i,viewports:s,onViewportActive:P,deviceRect:Ue,cullRect:{x:a,y:h,width:p,height:c},effects:k,pass:"picking:".concat(b)}),Ye=o4($e),Qe=new Map,at=Number.isFinite(T);for(let wt=0;wt<Ye.length&&!(at&&T&&Qe.size>=T);wt++){const Mt=Ye[wt];let Lt={color:Mt.pickedColor,layer:null,index:Mt.pickedObjectIndex,picked:!0,x:a,y:h,pixelRatio:H};Lt=Wb({layer:Mt.pickedLayer,info:Lt,mode:b}),Qe.has(Lt.object)||Qe.set(Lt.object,Lt)}return Array.from(Qe.values())}_drawAndSample({layers:e,views:i,viewports:s,onViewportActive:a,deviceRect:h,cullRect:p,effects:c,pass:b},T=!1){const P=T?this.depthFBO:this.pickingFBO,k={layers:e,layerFilter:this.layerFilter,views:i,viewports:s,onViewportActive:a,pickingFBO:P,deviceRect:h,cullRect:p,effects:c,pass:b,pickZ:T,preRenderStats:{}};for(const ye of c)ye.useInPicking&&(k.preRenderStats[ye.id]=ye.preRender(this.gl,k));const{decodePickingColor:C}=this.pickLayersPass.render(k),{x:H,y:ee,width:se,height:pe}=h,fe=new(T?Float32Array:Uint8Array)(se*pe*4);return df(P,{sourceX:H,sourceY:ee,sourceWidth:se,sourceHeight:pe,target:fe}),{pickedColors:fe,decodePickingColor:C}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:s,deviceWidth:a,deviceHeight:h}){const p=Math.max(0,e-s),c=Math.max(0,i-s),b=Math.min(a,e+s+1)-p,T=Math.min(h,i+s+1)-c;return b<=0||T<=0?null:{x:p,y:c,width:b,height:T}}}const u4={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class h4{constructor(e){U(this,"el",null),U(this,"isVisible",!1);const i=e.parentElement;i&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,u4),i.appendChild(this.el))}setTooltip(e,i,s){const a=this.el;if(!!a){if(typeof e=="string")a.innerText=e;else if(e)e.text&&(a.innerText=e.text),e.html&&(a.innerHTML=e.html),e.className&&(a.className=e.className),Object.assign(a.style,e.style);else{this.isVisible=!1,a.style.display="none";return}this.isVisible=!0,a.style.display="block",a.style.transform="translate(".concat(i,"px, ").concat(s,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var d4=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},cc={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,i,s,a){var h=["","webkit","Moz","MS","ms","o"],p=i.createElement("div"),c="function",b=Math.round,T=Math.abs,P=Date.now;function k(j,Z,ae){return setTimeout(Se(j,ae),Z)}function C(j,Z,ae){return Array.isArray(j)?(H(j,ae[Z],ae),!0):!1}function H(j,Z,ae){var Ae;if(!!j)if(j.forEach)j.forEach(Z,ae);else if(j.length!==a)for(Ae=0;Ae<j.length;)Z.call(ae,j[Ae],Ae,j),Ae++;else for(Ae in j)j.hasOwnProperty(Ae)&&Z.call(ae,j[Ae],Ae,j)}function ee(j,Z,ae){var Ae="DEPRECATED METHOD: "+Z+`
`+ae+` AT 
`;return function(){var He=new Error("get-stack-trace"),_t=He&&He.stack?He.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ii=e.console&&(e.console.warn||e.console.log);return ii&&ii.call(e.console,Ae,_t),j.apply(this,arguments)}}var se;typeof Object.assign!="function"?se=function(Z){if(Z===a||Z===null)throw new TypeError("Cannot convert undefined or null to object");for(var ae=Object(Z),Ae=1;Ae<arguments.length;Ae++){var He=arguments[Ae];if(He!==a&&He!==null)for(var _t in He)He.hasOwnProperty(_t)&&(ae[_t]=He[_t])}return ae}:se=Object.assign;var pe=ee(function(Z,ae,Ae){for(var He=Object.keys(ae),_t=0;_t<He.length;)(!Ae||Ae&&Z[He[_t]]===a)&&(Z[He[_t]]=ae[He[_t]]),_t++;return Z},"extend","Use `assign`."),fe=ee(function(Z,ae){return pe(Z,ae,!0)},"merge","Use `assign`.");function ye(j,Z,ae){var Ae=Z.prototype,He;He=j.prototype=Object.create(Ae),He.constructor=j,He._super=Ae,ae&&se(He,ae)}function Se(j,Z){return function(){return j.apply(Z,arguments)}}function Ue(j,Z){return typeof j==c?j.apply(Z&&Z[0]||a,Z):j}function $e(j,Z){return j===a?Z:j}function Ye(j,Z,ae){H(Mt(Z),function(Ae){j.addEventListener(Ae,ae,!1)})}function Qe(j,Z,ae){H(Mt(Z),function(Ae){j.removeEventListener(Ae,ae,!1)})}function at(j,Z){for(;j;){if(j==Z)return!0;j=j.parentNode}return!1}function wt(j,Z){return j.indexOf(Z)>-1}function Mt(j){return j.trim().split(/\s+/g)}function Lt(j,Z,ae){if(j.indexOf&&!ae)return j.indexOf(Z);for(var Ae=0;Ae<j.length;){if(ae&&j[Ae][ae]==Z||!ae&&j[Ae]===Z)return Ae;Ae++}return-1}function ei(j){return Array.prototype.slice.call(j,0)}function gi(j,Z,ae){for(var Ae=[],He=[],_t=0;_t<j.length;){var ii=Z?j[_t][Z]:j[_t];Lt(He,ii)<0&&Ae.push(j[_t]),He[_t]=ii,_t++}return ae&&(Z?Ae=Ae.sort(function(Kt,hn){return Kt[Z]>hn[Z]}):Ae=Ae.sort()),Ae}function Ut(j,Z){for(var ae,Ae,He=Z[0].toUpperCase()+Z.slice(1),_t=0;_t<h.length;){if(ae=h[_t],Ae=ae?ae+He:Z,Ae in j)return Ae;_t++}return a}var mi=1;function pt(){return mi++}function li(j){var Z=j.ownerDocument||j;return Z.defaultView||Z.parentWindow||e}var si=/mobile|tablet|ip(ad|hone|od)|android/i,Bi="ontouchstart"in e,ln=Ut(e,"PointerEvent")!==a,cn=Bi&&si.test(navigator.userAgent),Ri="touch",Hn="pen",qn="mouse",Ne="kinect",ht=25,We=1,yt=2,Et=4,Wt=8,Gt=1,J=2,ce=4,Ce=8,Re=16,Fe=J|ce,Ze=Ce|Re,lt=Fe|Ze,ze=["x","y"],Xe=["clientX","clientY"];function Ve(j,Z){var ae=this;this.manager=j,this.callback=Z,this.element=j.element,this.target=j.options.inputTarget,this.domHandler=function(Ae){Ue(j.options.enable,[j])&&ae.handler(Ae)},this.init()}Ve.prototype={handler:function(){},init:function(){this.evEl&&Ye(this.element,this.evEl,this.domHandler),this.evTarget&&Ye(this.target,this.evTarget,this.domHandler),this.evWin&&Ye(li(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Qe(this.element,this.evEl,this.domHandler),this.evTarget&&Qe(this.target,this.evTarget,this.domHandler),this.evWin&&Qe(li(this.element),this.evWin,this.domHandler)}};function Ct(j){var Z,ae=j.options.inputClass;return ae?Z=ae:ln?Z=or:cn?Z=br:Bi?Z=X:Z=Ht,new Z(j,Tt)}function Tt(j,Z,ae){var Ae=ae.pointers.length,He=ae.changedPointers.length,_t=Z&We&&Ae-He===0,ii=Z&(Et|Wt)&&Ae-He===0;ae.isFirst=!!_t,ae.isFinal=!!ii,_t&&(j.session={}),ae.eventType=Z,Pt(j,ae),j.emit("hammer.input",ae),j.recognize(ae),j.session.prevInput=ae}function Pt(j,Z){var ae=j.session,Ae=Z.pointers,He=Ae.length;ae.firstInput||(ae.firstInput=ci(Z)),He>1&&!ae.firstMultiple?ae.firstMultiple=ci(Z):He===1&&(ae.firstMultiple=!1);var _t=ae.firstInput,ii=ae.firstMultiple,Wi=ii?ii.center:_t.center,Kt=Z.center=be(Ae);Z.timeStamp=P(),Z.deltaTime=Z.timeStamp-_t.timeStamp,Z.angle=Xt(Wi,Kt),Z.distance=Ki(Wi,Kt),Bt(ae,Z),Z.offsetDirection=en(Z.deltaX,Z.deltaY);var hn=je(Z.deltaTime,Z.deltaX,Z.deltaY);Z.overallVelocityX=hn.x,Z.overallVelocityY=hn.y,Z.overallVelocity=T(hn.x)>T(hn.y)?hn.x:hn.y,Z.scale=ii?An(ii.pointers,Ae):1,Z.rotation=ii?fn(ii.pointers,Ae):0,Z.maxPointers=ae.prevInput?Z.pointers.length>ae.prevInput.maxPointers?Z.pointers.length:ae.prevInput.maxPointers:Z.pointers.length,Zt(ae,Z);var ar=j.element;at(Z.srcEvent.target,ar)&&(ar=Z.srcEvent.target),Z.target=ar}function Bt(j,Z){var ae=Z.center,Ae=j.offsetDelta||{},He=j.prevDelta||{},_t=j.prevInput||{};(Z.eventType===We||_t.eventType===Et)&&(He=j.prevDelta={x:_t.deltaX||0,y:_t.deltaY||0},Ae=j.offsetDelta={x:ae.x,y:ae.y}),Z.deltaX=He.x+(ae.x-Ae.x),Z.deltaY=He.y+(ae.y-Ae.y)}function Zt(j,Z){var ae=j.lastInterval||Z,Ae=Z.timeStamp-ae.timeStamp,He,_t,ii,Wi;if(Z.eventType!=Wt&&(Ae>ht||ae.velocity===a)){var Kt=Z.deltaX-ae.deltaX,hn=Z.deltaY-ae.deltaY,ar=je(Ae,Kt,hn);_t=ar.x,ii=ar.y,He=T(ar.x)>T(ar.y)?ar.x:ar.y,Wi=en(Kt,hn),j.lastInterval=Z}else He=ae.velocity,_t=ae.velocityX,ii=ae.velocityY,Wi=ae.direction;Z.velocity=He,Z.velocityX=_t,Z.velocityY=ii,Z.direction=Wi}function ci(j){for(var Z=[],ae=0;ae<j.pointers.length;)Z[ae]={clientX:b(j.pointers[ae].clientX),clientY:b(j.pointers[ae].clientY)},ae++;return{timeStamp:P(),pointers:Z,center:be(Z),deltaX:j.deltaX,deltaY:j.deltaY}}function be(j){var Z=j.length;if(Z===1)return{x:b(j[0].clientX),y:b(j[0].clientY)};for(var ae=0,Ae=0,He=0;He<Z;)ae+=j[He].clientX,Ae+=j[He].clientY,He++;return{x:b(ae/Z),y:b(Ae/Z)}}function je(j,Z,ae){return{x:Z/j||0,y:ae/j||0}}function en(j,Z){return j===Z?Gt:T(j)>=T(Z)?j<0?J:ce:Z<0?Ce:Re}function Ki(j,Z,ae){ae||(ae=ze);var Ae=Z[ae[0]]-j[ae[0]],He=Z[ae[1]]-j[ae[1]];return Math.sqrt(Ae*Ae+He*He)}function Xt(j,Z,ae){ae||(ae=ze);var Ae=Z[ae[0]]-j[ae[0]],He=Z[ae[1]]-j[ae[1]];return Math.atan2(He,Ae)*180/Math.PI}function fn(j,Z){return Xt(Z[1],Z[0],Xe)+Xt(j[1],j[0],Xe)}function An(j,Z){return Ki(Z[0],Z[1],Xe)/Ki(j[0],j[1],Xe)}var Pi={mousedown:We,mousemove:yt,mouseup:Et},un="mousedown",Ke="mousemove mouseup";function Ht(){this.evEl=un,this.evWin=Ke,this.pressed=!1,Ve.apply(this,arguments)}ye(Ht,Ve,{handler:function(Z){var ae=Pi[Z.type];ae&We&&Z.button===0&&(this.pressed=!0),ae&yt&&Z.which!==1&&(ae=Et),this.pressed&&(ae&Et&&(this.pressed=!1),this.callback(this.manager,ae,{pointers:[Z],changedPointers:[Z],pointerType:qn,srcEvent:Z}))}});var $t={pointerdown:We,pointermove:yt,pointerup:Et,pointercancel:Wt,pointerout:Wt},xn={2:Ri,3:Hn,4:qn,5:Ne},Ir="pointerdown",jt="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ir="MSPointerDown",jt="MSPointerMove MSPointerUp MSPointerCancel");function or(){this.evEl=Ir,this.evWin=jt,Ve.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}ye(or,Ve,{handler:function(Z){var ae=this.store,Ae=!1,He=Z.type.toLowerCase().replace("ms",""),_t=$t[He],ii=xn[Z.pointerType]||Z.pointerType,Wi=ii==Ri,Kt=Lt(ae,Z.pointerId,"pointerId");_t&We&&(Z.button===0||Wi)?Kt<0&&(ae.push(Z),Kt=ae.length-1):_t&(Et|Wt)&&(Ae=!0),!(Kt<0)&&(ae[Kt]=Z,this.callback(this.manager,_t,{pointers:ae,changedPointers:[Z],pointerType:ii,srcEvent:Z}),Ae&&ae.splice(Kt,1))}});var pn={touchstart:We,touchmove:yt,touchend:Et,touchcancel:Wt},ys="touchstart",tn="touchstart touchmove touchend touchcancel";function Sn(){this.evTarget=ys,this.evWin=tn,this.started=!1,Ve.apply(this,arguments)}ye(Sn,Ve,{handler:function(Z){var ae=pn[Z.type];if(ae===We&&(this.started=!0),!!this.started){var Ae=wi.call(this,Z,ae);ae&(Et|Wt)&&Ae[0].length-Ae[1].length===0&&(this.started=!1),this.callback(this.manager,ae,{pointers:Ae[0],changedPointers:Ae[1],pointerType:Ri,srcEvent:Z})}}});function wi(j,Z){var ae=ei(j.touches),Ae=ei(j.changedTouches);return Z&(Et|Wt)&&(ae=gi(ae.concat(Ae),"identifier",!0)),[ae,Ae]}var vs={touchstart:We,touchmove:yt,touchend:Et,touchcancel:Wt},xr="touchstart touchmove touchend touchcancel";function br(){this.evTarget=xr,this.targetIds={},Ve.apply(this,arguments)}ye(br,Ve,{handler:function(Z){var ae=vs[Z.type],Ae=ts.call(this,Z,ae);!Ae||this.callback(this.manager,ae,{pointers:Ae[0],changedPointers:Ae[1],pointerType:Ri,srcEvent:Z})}});function ts(j,Z){var ae=ei(j.touches),Ae=this.targetIds;if(Z&(We|yt)&&ae.length===1)return Ae[ae[0].identifier]=!0,[ae,ae];var He,_t,ii=ei(j.changedTouches),Wi=[],Kt=this.target;if(_t=ae.filter(function(hn){return at(hn.target,Kt)}),Z===We)for(He=0;He<_t.length;)Ae[_t[He].identifier]=!0,He++;for(He=0;He<ii.length;)Ae[ii[He].identifier]&&Wi.push(ii[He]),Z&(Et|Wt)&&delete Ae[ii[He].identifier],He++;if(!!Wi.length)return[gi(_t.concat(Wi),"identifier",!0),Wi]}var xs=2500,Hr=25;function X(){Ve.apply(this,arguments);var j=Se(this.handler,this);this.touch=new br(this.manager,j),this.mouse=new Ht(this.manager,j),this.primaryTouch=null,this.lastTouches=[]}ye(X,Ve,{handler:function(Z,ae,Ae){var He=Ae.pointerType==Ri,_t=Ae.pointerType==qn;if(!(_t&&Ae.sourceCapabilities&&Ae.sourceCapabilities.firesTouchEvents)){if(He)R.call(this,ae,Ae);else if(_t&&q.call(this,Ae))return;this.callback(Z,ae,Ae)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function R(j,Z){j&We?(this.primaryTouch=Z.changedPointers[0].identifier,F.call(this,Z)):j&(Et|Wt)&&F.call(this,Z)}function F(j){var Z=j.changedPointers[0];if(Z.identifier===this.primaryTouch){var ae={x:Z.clientX,y:Z.clientY};this.lastTouches.push(ae);var Ae=this.lastTouches,He=function(){var _t=Ae.indexOf(ae);_t>-1&&Ae.splice(_t,1)};setTimeout(He,xs)}}function q(j){for(var Z=j.srcEvent.clientX,ae=j.srcEvent.clientY,Ae=0;Ae<this.lastTouches.length;Ae++){var He=this.lastTouches[Ae],_t=Math.abs(Z-He.x),ii=Math.abs(ae-He.y);if(_t<=Hr&&ii<=Hr)return!0}return!1}var W=Ut(p.style,"touchAction"),oe=W!==a,he="compute",le="auto",re="manipulation",de="none",Pe="pan-x",Be="pan-y",Ie=nt();function mt(j,Z){this.manager=j,this.set(Z)}mt.prototype={set:function(j){j==he&&(j=this.compute()),oe&&this.manager.element.style&&Ie[j]&&(this.manager.element.style[W]=j),this.actions=j.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var j=[];return H(this.manager.recognizers,function(Z){Ue(Z.options.enable,[Z])&&(j=j.concat(Z.getTouchAction()))}),vt(j.join(" "))},preventDefaults:function(j){var Z=j.srcEvent,ae=j.offsetDirection;if(this.manager.session.prevented){Z.preventDefault();return}var Ae=this.actions,He=wt(Ae,de)&&!Ie[de],_t=wt(Ae,Be)&&!Ie[Be],ii=wt(Ae,Pe)&&!Ie[Pe];if(He){var Wi=j.pointers.length===1,Kt=j.distance<2,hn=j.deltaTime<250;if(Wi&&Kt&&hn)return}if(!(ii&&_t)&&(He||_t&&ae&Fe||ii&&ae&Ze))return this.preventSrc(Z)},preventSrc:function(j){this.manager.session.prevented=!0,j.preventDefault()}};function vt(j){if(wt(j,de))return de;var Z=wt(j,Pe),ae=wt(j,Be);return Z&&ae?de:Z||ae?Z?Pe:Be:wt(j,re)?re:le}function nt(){if(!oe)return!1;var j={},Z=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ae){j[ae]=Z?e.CSS.supports("touch-action",ae):!0}),j}var kt=1,St=2,Yt=4,Ot=8,Vt=Ot,ti=16,oi=32;function Ci(j){this.options=se({},this.defaults,j||{}),this.id=pt(),this.manager=null,this.options.enable=$e(this.options.enable,!0),this.state=kt,this.simultaneous={},this.requireFail=[]}Ci.prototype={defaults:{},set:function(j){return se(this.options,j),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(j){if(C(j,"recognizeWith",this))return this;var Z=this.simultaneous;return j=Pr(j,this),Z[j.id]||(Z[j.id]=j,j.recognizeWith(this)),this},dropRecognizeWith:function(j){return C(j,"dropRecognizeWith",this)?this:(j=Pr(j,this),delete this.simultaneous[j.id],this)},requireFailure:function(j){if(C(j,"requireFailure",this))return this;var Z=this.requireFail;return j=Pr(j,this),Lt(Z,j)===-1&&(Z.push(j),j.requireFailure(this)),this},dropRequireFailure:function(j){if(C(j,"dropRequireFailure",this))return this;j=Pr(j,this);var Z=Lt(this.requireFail,j);return Z>-1&&this.requireFail.splice(Z,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(j){return!!this.simultaneous[j.id]},emit:function(j){var Z=this,ae=this.state;function Ae(He){Z.manager.emit(He,j)}ae<Ot&&Ae(Z.options.event+Li(ae)),Ae(Z.options.event),j.additionalEvent&&Ae(j.additionalEvent),ae>=Ot&&Ae(Z.options.event+Li(ae))},tryEmit:function(j){if(this.canEmit())return this.emit(j);this.state=oi},canEmit:function(){for(var j=0;j<this.requireFail.length;){if(!(this.requireFail[j].state&(oi|kt)))return!1;j++}return!0},recognize:function(j){var Z=se({},j);if(!Ue(this.options.enable,[this,Z])){this.reset(),this.state=oi;return}this.state&(Vt|ti|oi)&&(this.state=kt),this.state=this.process(Z),this.state&(St|Yt|Ot|ti)&&this.tryEmit(Z)},process:function(j){},getTouchAction:function(){},reset:function(){}};function Li(j){return j&ti?"cancel":j&Ot?"end":j&Yt?"move":j&St?"start":""}function bn(j){return j==Re?"down":j==Ce?"up":j==J?"left":j==ce?"right":""}function Pr(j,Z){var ae=Z.manager;return ae?ae.get(j):j}function Dn(){Ci.apply(this,arguments)}ye(Dn,Ci,{defaults:{pointers:1},attrTest:function(j){var Z=this.options.pointers;return Z===0||j.pointers.length===Z},process:function(j){var Z=this.state,ae=j.eventType,Ae=Z&(St|Yt),He=this.attrTest(j);return Ae&&(ae&Wt||!He)?Z|ti:Ae||He?ae&Et?Z|Ot:Z&St?Z|Yt:St:oi}});function _i(){Dn.apply(this,arguments),this.pX=null,this.pY=null}ye(_i,Dn,{defaults:{event:"pan",threshold:10,pointers:1,direction:lt},getTouchAction:function(){var j=this.options.direction,Z=[];return j&Fe&&Z.push(Be),j&Ze&&Z.push(Pe),Z},directionTest:function(j){var Z=this.options,ae=!0,Ae=j.distance,He=j.direction,_t=j.deltaX,ii=j.deltaY;return He&Z.direction||(Z.direction&Fe?(He=_t===0?Gt:_t<0?J:ce,ae=_t!=this.pX,Ae=Math.abs(j.deltaX)):(He=ii===0?Gt:ii<0?Ce:Re,ae=ii!=this.pY,Ae=Math.abs(j.deltaY))),j.direction=He,ae&&Ae>Z.threshold&&He&Z.direction},attrTest:function(j){return Dn.prototype.attrTest.call(this,j)&&(this.state&St||!(this.state&St)&&this.directionTest(j))},emit:function(j){this.pX=j.deltaX,this.pY=j.deltaY;var Z=bn(j.direction);Z&&(j.additionalEvent=this.options.event+Z),this._super.emit.call(this,j)}});function $s(){Dn.apply(this,arguments)}ye($s,Dn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[de]},attrTest:function(j){return this._super.attrTest.call(this,j)&&(Math.abs(j.scale-1)>this.options.threshold||this.state&St)},emit:function(j){if(j.scale!==1){var Z=j.scale<1?"in":"out";j.additionalEvent=this.options.event+Z}this._super.emit.call(this,j)}});function Hs(){Ci.apply(this,arguments),this._timer=null,this._input=null}ye(Hs,Ci,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[le]},process:function(j){var Z=this.options,ae=j.pointers.length===Z.pointers,Ae=j.distance<Z.threshold,He=j.deltaTime>Z.time;if(this._input=j,!Ae||!ae||j.eventType&(Et|Wt)&&!He)this.reset();else if(j.eventType&We)this.reset(),this._timer=k(function(){this.state=Vt,this.tryEmit()},Z.time,this);else if(j.eventType&Et)return Vt;return oi},reset:function(){clearTimeout(this._timer)},emit:function(j){this.state===Vt&&(j&&j.eventType&Et?this.manager.emit(this.options.event+"up",j):(this._input.timeStamp=P(),this.manager.emit(this.options.event,this._input)))}});function vo(){Dn.apply(this,arguments)}ye(vo,Dn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[de]},attrTest:function(j){return this._super.attrTest.call(this,j)&&(Math.abs(j.rotation)>this.options.threshold||this.state&St)}});function xo(){Dn.apply(this,arguments)}ye(xo,Dn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Fe|Ze,pointers:1},getTouchAction:function(){return _i.prototype.getTouchAction.call(this)},attrTest:function(j){var Z=this.options.direction,ae;return Z&(Fe|Ze)?ae=j.overallVelocity:Z&Fe?ae=j.overallVelocityX:Z&Ze&&(ae=j.overallVelocityY),this._super.attrTest.call(this,j)&&Z&j.offsetDirection&&j.distance>this.options.threshold&&j.maxPointers==this.options.pointers&&T(ae)>this.options.velocity&&j.eventType&Et},emit:function(j){var Z=bn(j.offsetDirection);Z&&this.manager.emit(this.options.event+Z,j),this.manager.emit(this.options.event,j)}});function bs(){Ci.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}ye(bs,Ci,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[re]},process:function(j){var Z=this.options,ae=j.pointers.length===Z.pointers,Ae=j.distance<Z.threshold,He=j.deltaTime<Z.time;if(this.reset(),j.eventType&We&&this.count===0)return this.failTimeout();if(Ae&&He&&ae){if(j.eventType!=Et)return this.failTimeout();var _t=this.pTime?j.timeStamp-this.pTime<Z.interval:!0,ii=!this.pCenter||Ki(this.pCenter,j.center)<Z.posThreshold;this.pTime=j.timeStamp,this.pCenter=j.center,!ii||!_t?this.count=1:this.count+=1,this._input=j;var Wi=this.count%Z.taps;if(Wi===0)return this.hasRequireFailures()?(this._timer=k(function(){this.state=Vt,this.tryEmit()},Z.interval,this),St):Vt}return oi},failTimeout:function(){return this._timer=k(function(){this.state=oi},this.options.interval,this),oi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Vt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Mr(j,Z){return Z=Z||{},Z.recognizers=$e(Z.recognizers,Mr.defaults.preset),new Eo(j,Z)}Mr.VERSION="2.0.7",Mr.defaults={domEvents:!1,touchAction:he,enable:!0,inputTarget:null,inputClass:null,preset:[[vo,{enable:!1}],[$s,{enable:!1},["rotate"]],[xo,{direction:Fe}],[_i,{direction:Fe},["swipe"]],[bs],[bs,{event:"doubletap",taps:2},["tap"]],[Hs]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var bo=1,wo=2;function Eo(j,Z){this.options=se({},Mr.defaults,Z||{}),this.options.inputTarget=this.options.inputTarget||j,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=j,this.input=Ct(this),this.touchAction=new mt(this,this.options.touchAction),na(this,!0),H(this.options.recognizers,function(ae){var Ae=this.add(new ae[0](ae[1]));ae[2]&&Ae.recognizeWith(ae[2]),ae[3]&&Ae.requireFailure(ae[3])},this)}Eo.prototype={set:function(j){return se(this.options,j),j.touchAction&&this.touchAction.update(),j.inputTarget&&(this.input.destroy(),this.input.target=j.inputTarget,this.input.init()),this},stop:function(j){this.session.stopped=j?wo:bo},recognize:function(j){var Z=this.session;if(!Z.stopped){this.touchAction.preventDefaults(j);var ae,Ae=this.recognizers,He=Z.curRecognizer;(!He||He&&He.state&Vt)&&(He=Z.curRecognizer=null);for(var _t=0;_t<Ae.length;)ae=Ae[_t],Z.stopped!==wo&&(!He||ae==He||ae.canRecognizeWith(He))?ae.recognize(j):ae.reset(),!He&&ae.state&(St|Yt|Ot)&&(He=Z.curRecognizer=ae),_t++}},get:function(j){if(j instanceof Ci)return j;for(var Z=this.recognizers,ae=0;ae<Z.length;ae++)if(Z[ae].options.event==j)return Z[ae];return null},add:function(j){if(C(j,"add",this))return this;var Z=this.get(j.options.event);return Z&&this.remove(Z),this.recognizers.push(j),j.manager=this,this.touchAction.update(),j},remove:function(j){if(C(j,"remove",this))return this;if(j=this.get(j),j){var Z=this.recognizers,ae=Lt(Z,j);ae!==-1&&(Z.splice(ae,1),this.touchAction.update())}return this},on:function(j,Z){if(j!==a&&Z!==a){var ae=this.handlers;return H(Mt(j),function(Ae){ae[Ae]=ae[Ae]||[],ae[Ae].push(Z)}),this}},off:function(j,Z){if(j!==a){var ae=this.handlers;return H(Mt(j),function(Ae){Z?ae[Ae]&&ae[Ae].splice(Lt(ae[Ae],Z),1):delete ae[Ae]}),this}},emit:function(j,Z){this.options.domEvents&&Xa(j,Z);var ae=this.handlers[j]&&this.handlers[j].slice();if(!(!ae||!ae.length)){Z.type=j,Z.preventDefault=function(){Z.srcEvent.preventDefault()};for(var Ae=0;Ae<ae.length;)ae[Ae](Z),Ae++}},destroy:function(){this.element&&na(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function na(j,Z){var ae=j.element;if(!!ae.style){var Ae;H(j.options.cssProps,function(He,_t){Ae=Ut(ae.style,_t),Z?(j.oldCssProps[Ae]=ae.style[Ae],ae.style[Ae]=He):ae.style[Ae]=j.oldCssProps[Ae]||""}),Z||(j.oldCssProps={})}}function Xa(j,Z){var ae=i.createEvent("Event");ae.initEvent(j,!0,!0),ae.gesture=Z,Z.target.dispatchEvent(ae)}se(Mr,{INPUT_START:We,INPUT_MOVE:yt,INPUT_END:Et,INPUT_CANCEL:Wt,STATE_POSSIBLE:kt,STATE_BEGAN:St,STATE_CHANGED:Yt,STATE_ENDED:Ot,STATE_RECOGNIZED:Vt,STATE_CANCELLED:ti,STATE_FAILED:oi,DIRECTION_NONE:Gt,DIRECTION_LEFT:J,DIRECTION_RIGHT:ce,DIRECTION_UP:Ce,DIRECTION_DOWN:Re,DIRECTION_HORIZONTAL:Fe,DIRECTION_VERTICAL:Ze,DIRECTION_ALL:lt,Manager:Eo,Input:Ve,TouchAction:mt,TouchInput:br,MouseInput:Ht,PointerEventInput:or,TouchMouseInput:X,SingleTouchInput:Sn,Recognizer:Ci,AttrRecognizer:Dn,Tap:bs,Pan:_i,Swipe:xo,Pinch:$s,Rotate:vo,Press:Hs,on:Ye,off:Qe,each:H,merge:fe,extend:pe,assign:se,inherit:ye,bindFn:Se,prefixed:Ut});var is=typeof e<"u"?e:typeof self<"u"?self:{};is.Hammer=Mr,typeof a=="function"&&a.amd?a(function(){return Mr}):t.exports?t.exports=Mr:e[s]=Mr})(window,document,"Hammer")})(cc);const f4=cc.exports,Rs=iE({__proto__:null,default:f4},[cc.exports]),Zb=1,Xb=2,Gm=4,p4={mousedown:Zb,mousemove:Xb,mouseup:Gm};function m4(t,e){for(let i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}function g4(t){const e=t.prototype.handler;t.prototype.handler=function(s){const a=this.store;s.button>0&&s.type==="pointerdown"&&(m4(a,h=>h.pointerId===s.pointerId)||a.push(s)),e.call(this,s)}}function _4(t){t.prototype.handler=function(i){let s=p4[i.type];s&Zb&&i.button>=0&&(this.pressed=!0),s&Xb&&i.which===0&&(s=Gm),this.pressed&&(s&Gm&&(this.pressed=!1),this.callback(this.manager,s,{pointers:[i],changedPointers:[i],pointerType:"mouse",srcEvent:i}))}}g4(cc.exports.PointerEventInput);_4(cc.exports.MouseInput);const y4=cc.exports.Manager;class ff{constructor(e,i,s){this.element=e,this.callback=i,this.options={enable:!0,...s}}}const v4=Rs?[[Rs.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Rs.Rotate,{enable:!1}],[Rs.Pinch,{enable:!1}],[Rs.Swipe,{enable:!1}],[Rs.Pan,{threshold:0,enable:!1}],[Rs.Press,{enable:!1}],[Rs.Tap,{event:"doubletap",taps:2,enable:!1}],[Rs.Tap,{event:"anytap",enable:!1}],[Rs.Tap,{enable:!1}]]:null,N1={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},x4={doubletap:["tap"]},b4={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},$g={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},w4={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},U1={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},E4=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Dl=typeof window<"u"?window:global;let $m=!1;try{const t={get passive(){return $m=!0,!0}};Dl.addEventListener("test",null,t),Dl.removeEventListener("test",null)}catch{$m=!1}const T4=E4.indexOf("firefox")!==-1,{WHEEL_EVENTS:A4}=$g,V1="wheel",j1=4.000244140625,S4=40,I4=.25;class P4 extends ff{constructor(e,i,s){super(e,i,s),this.handleEvent=a=>{if(!this.options.enable)return;let h=a.deltaY;Dl.WheelEvent&&(T4&&a.deltaMode===Dl.WheelEvent.DOM_DELTA_PIXEL&&(h/=Dl.devicePixelRatio),a.deltaMode===Dl.WheelEvent.DOM_DELTA_LINE&&(h*=S4)),h!==0&&h%j1===0&&(h=Math.floor(h/j1)),a.shiftKey&&h&&(h=h*I4),this.callback({type:V1,center:{x:a.clientX,y:a.clientY},delta:-h,srcEvent:a,pointerType:"mouse",target:a.target})},this.events=(this.options.events||[]).concat(A4),this.events.forEach(a=>e.addEventListener(a,this.handleEvent,$m?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===V1&&(this.options.enable=i)}}const{MOUSE_EVENTS:M4}=$g,G1="pointermove",$1="pointerover",H1="pointerout",q1="pointerenter",W1="pointerleave";class C4 extends ff{constructor(e,i,s){super(e,i,s),this.handleEvent=h=>{this.handleOverEvent(h),this.handleOutEvent(h),this.handleEnterEvent(h),this.handleLeaveEvent(h),this.handleMoveEvent(h)},this.pressed=!1;const{enable:a}=this.options;this.enableMoveEvent=a,this.enableLeaveEvent=a,this.enableEnterEvent=a,this.enableOutEvent=a,this.enableOverEvent=a,this.events=(this.options.events||[]).concat(M4),this.events.forEach(h=>e.addEventListener(h,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===G1&&(this.enableMoveEvent=i),e===$1&&(this.enableOverEvent=i),e===H1&&(this.enableOutEvent=i),e===q1&&(this.enableEnterEvent=i),e===W1&&(this.enableLeaveEvent=i)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit($1,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(H1,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(q1,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(W1,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(G1,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:L4}=$g,Z1="keydown",X1="keyup";class k4 extends ff{constructor(e,i,s){super(e,i,s),this.handleEvent=a=>{const h=a.target||a.srcElement;h.tagName==="INPUT"&&h.type==="text"||h.tagName==="TEXTAREA"||(this.enableDownEvent&&a.type==="keydown"&&this.callback({type:Z1,srcEvent:a,key:a.key,target:a.target}),this.enableUpEvent&&a.type==="keyup"&&this.callback({type:X1,srcEvent:a,key:a.key,target:a.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(L4),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===Z1&&(this.enableDownEvent=i),e===X1&&(this.enableUpEvent=i)}}const Y1="contextmenu";class R4 extends ff{constructor(e,i,s){super(e,i,s),this.handleEvent=a=>{!this.options.enable||this.callback({type:Y1,center:{x:a.clientX,y:a.clientY},srcEvent:a,pointerType:"mouse",target:a.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e===Y1&&(this.options.enable=i)}}const Hm=1,qd=2,qm=4,D4={pointerdown:Hm,pointermove:qd,pointerup:qm,mousedown:Hm,mousemove:qd,mouseup:qm},z4=1,O4=2,F4=3,B4=0,N4=1,U4=2,V4=1,j4=2,G4=4;function $4(t){const e=D4[t.srcEvent.type];if(!e)return null;const{buttons:i,button:s,which:a}=t.srcEvent;let h=!1,p=!1,c=!1;return e===qm||e===qd&&!Number.isFinite(i)?(h=a===z4,p=a===O4,c=a===F4):e===qd?(h=Boolean(i&V4),p=Boolean(i&G4),c=Boolean(i&j4)):e===Hm&&(h=s===B4,p=s===N4,c=s===U4),{leftButton:h,middleButton:p,rightButton:c}}function H4(t,e){const i=t.center;if(!i)return null;const s=e.getBoundingClientRect(),a=s.width/e.offsetWidth||1,h=s.height/e.offsetHeight||1,p={x:(i.x-s.left-e.clientLeft)/a,y:(i.y-s.top-e.clientTop)/h};return{center:i,offsetCenter:p}}const Qp={srcElement:"root",priority:0};class q4{constructor(e){this.handleEvent=i=>{if(this.isEmpty())return;const s=this._normalizeEvent(i);let a=i.srcEvent.target;for(;a&&a!==s.rootElement;){if(this._emit(s,a),s.handled)return;a=a.parentNode}this._emit(s,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,s,a=!1,h=!1){const{handlers:p,handlersByElement:c}=this;let b=Qp;typeof s=="string"||s&&s.addEventListener?b={...Qp,srcElement:s}:s&&(b={...Qp,...s});let T=c.get(b.srcElement);T||(T=[],c.set(b.srcElement,T));const P={type:e,handler:i,srcElement:b.srcElement,priority:b.priority};a&&(P.once=!0),h&&(P.passive=!0),p.push(P),this._active=this._active||!P.passive;let k=T.length-1;for(;k>=0&&!(T[k].priority>=P.priority);)k--;T.splice(k+1,0,P)}remove(e,i){const{handlers:s,handlersByElement:a}=this;for(let h=s.length-1;h>=0;h--){const p=s[h];if(p.type===e&&p.handler===i){s.splice(h,1);const c=a.get(p.srcElement);c.splice(c.indexOf(p),1),c.length===0&&a.delete(p.srcElement)}}this._active=s.some(h=>!h.passive)}_emit(e,i){const s=this.handlersByElement.get(i);if(s){let a=!1;const h=()=>{e.handled=!0},p=()=>{e.handled=!0,a=!0},c=[];for(let b=0;b<s.length;b++){const{type:T,handler:P,once:k}=s[b];if(P({...e,type:T,stopPropagation:h,stopImmediatePropagation:p}),k&&c.push(s[b]),a)break}for(let b=0;b<c.length;b++){const{type:T,handler:P}=c[b];this.remove(T,P)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...$4(e),...H4(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const W4={events:null,recognizers:null,recognizerOptions:{},Manager:y4,touchAction:"none",tabIndex:0};class Z4{constructor(e=null,i){this._onBasicInput=a=>{const{srcEvent:h}=a,p=b4[h.type];p&&this.manager.emit(p,a)},this._onOtherEvent=a=>{this.manager.emit(a.type,a)},this.options={...W4,...i},this.events=new Map,this.setElement(e);const{events:s}=this.options;s&&this.on(s)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:i}=this,s=i.Manager;this.manager=new s(e,{touchAction:i.touchAction,recognizers:i.recognizers||v4}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(N1).forEach(a=>{const h=this.manager.get(a);h&&N1[a].forEach(p=>{h.recognizeWith(p)})});for(const a in i.recognizerOptions){const h=this.manager.get(a);if(h){const p=i.recognizerOptions[a];delete p.enable,h.set(p)}}this.wheelInput=new P4(e,this._onOtherEvent,{enable:!1}),this.moveInput=new C4(e,this._onOtherEvent,{enable:!1}),this.keyInput=new k4(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new R4(e,this._onOtherEvent,{enable:!1});for(const[a,h]of this.events)h.isEmpty()||(this._toggleRecognizer(h.recognizerName,!0),this.manager.on(a,h.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,i,s){this._addEventHandler(e,i,s,!1)}once(e,i,s){this._addEventHandler(e,i,s,!0)}watch(e,i,s){this._addEventHandler(e,i,s,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){const{manager:s}=this;if(!s)return;const a=s.get(e);if(a&&a.options.enable!==i){a.set({enable:i});const h=x4[e];h&&!this.options.recognizers&&h.forEach(p=>{const c=s.get(p);i?(c.requireFailure(e),a.dropRequireFailure(p)):c.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,i),this.moveInput.enableEventType(e,i),this.keyInput.enableEventType(e,i),this.contextmenuInput.enableEventType(e,i)}_addEventHandler(e,i,s,a,h){if(typeof e!="string"){s=i;for(const P in e)this._addEventHandler(P,e[P],s,a,h);return}const{manager:p,events:c}=this,b=U1[e]||e;let T=c.get(b);T||(T=new q4(this),c.set(b,T),T.recognizerName=w4[b]||b,p&&p.on(b,T.handleEvent)),T.add(e,i,s,a,h),T.isEmpty()||this._toggleRecognizer(T.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const p in e)this._removeEventHandler(p,e[p]);return}const{events:s}=this,a=U1[e]||e,h=s.get(a);if(!!h&&(h.remove(e,i),h.isEmpty())){const{recognizerName:p}=h;let c=!1;for(const b of s.values())if(b.recognizerName===p&&!b.isEmpty()){c=!0;break}c||this._toggleRecognizer(p,!1)}}}function Ra(){}const X4=({isDragging:t})=>t?"grabbing":"grab",Yb={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Ra,onResize:Ra,onViewStateChange:Ra,onInteractionStateChange:Ra,onBeforeRender:Ra,onAfterRender:Ra,onLoad:Ra,onError:t=>Vi.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:X4,getTooltip:null,debug:!1,drawPickingColors:!1};class Fu{constructor(e){U(this,"props",void 0),U(this,"width",0),U(this,"height",0),U(this,"userData",{}),U(this,"canvas",null),U(this,"viewManager",null),U(this,"layerManager",null),U(this,"effectManager",null),U(this,"deckRenderer",null),U(this,"deckPicker",null),U(this,"eventManager",null),U(this,"tooltip",null),U(this,"metrics",void 0),U(this,"animationLoop",void 0),U(this,"stats",void 0),U(this,"viewState",void 0),U(this,"cursorState",void 0),U(this,"_needsRedraw",void 0),U(this,"_pickRequest",void 0),U(this,"_lastPointerDownInfo",null),U(this,"_metricsCounter",void 0),U(this,"_onPointerMove",i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const a=i.offsetCenter;if(!a)return;s.x=a.x,s.y=a.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i}),U(this,"_onEvent",i=>{const s=O0[i.type],a=i.offsetCenter;if(!s||!a||!this.layerManager)return;const h=this.layerManager.getLayers(),p=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:h,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:c}=p,b=c&&(c[s.handler]||c.props[s.handler]),T=this.props[s.handler];let P=!1;b&&(P=b.call(c,p,i)),!P&&T&&T(p,i)}),U(this,"_onPointerDown",i=>{const s=i.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo}),this.props={...Yb,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Vi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),zx()==="IE"&&Vi.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Tg({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&zu.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,s,a,h,p,c;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(s=this.effectManager)===null||s===void 0||s.finalize(),this.effectManager=null,(a=this.deckRenderer)===null||a===void 0||a.finalize(),this.deckRenderer=null,(h=this.deckPicker)===null||h===void 0||h.finalize(),this.deckPicker=null,(p=this.eventManager)===null||p===void 0||p.destroy(),this.eventManager=null,(c=this.tooltip)===null||c===void 0||c.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var b;(b=this.canvas.parentElement)===null||b===void 0||b.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Vi.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Vi.removed("onLayerClick","onClick")(),e.initialViewState&&!Us(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const s=this.viewManager.needsRedraw(e),a=this.layerManager.needsRedraw(e),h=this.effectManager.needsRedraw(e),p=this.deckRenderer.needsRedraw(e);return i=i||s||a||h||p,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return kn(this.viewManager),this.viewManager.views}getViewports(e){return kn(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const s in e)this.layerManager.resourceManager.add({resourceId:s,data:e[s],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,i,s){kn(this.deckPicker);const{stats:a}=this;a.get("Pick Count").incrementCount(),a.get(i).timeStart();const h=this.deckPicker[e]({layers:this.layerManager.getLayers(s),views:this.viewManager.getViews(),viewports:this.getViewports(s),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...s});return a.get(i).timeEnd(),h}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),kn(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){if(!this.canvas)return;const{width:i,height:s}=e;if(i||i===0){const h=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.width=h}if(s||s===0){var a;const h=Number.isFinite(s)?"".concat(s,"px"):s;this.canvas.style.position=((a=e.style)===null||a===void 0?void 0:a.position)||"absolute",this.canvas.style.height=h}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const i=e.clientWidth||e.width,s=e.clientHeight||e.height;if(i!==this.width||s!==this.height){var a;this.width=i,this.height=s,(a=this.viewManager)===null||a===void 0||a.setProps({width:i,height:s}),this.props.onResize({width:i,height:s})}}_createAnimationLoop(e){const{width:i,height:s,gl:a,glOptions:h,debug:p,onError:c,onBeforeRender:b,onAfterRender:T,useDevicePixels:P}=e;return new tR({width:i,height:s,useDevicePixels:P,autoResizeViewport:!1,gl:a,onCreateContext:k=>eb({...h,...k,canvas:this.canvas,debug:p,onContextLost:()=>this._onContextLost()}),onInitialize:k=>this._setGLContext(k.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:b,onAfterRender:T,onError:c})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new Gg({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:a}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let h=a,p=!1;for(const c of s){var i;h=c,p=((i=c.layer)===null||i===void 0?void 0:i.onHover(c,e.event))||p}if(!p&&this.props.onHover&&this.props.onHover(h,e.event),this.props.getTooltip&&this.tooltip){const c=this.props.getTooltip(h);this.tooltip.setTooltip(c,h.x,h.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Lg(e,{enable:!0,copyState:!0})),this.tooltip=new h4(this.canvas),po(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const i=new Lb;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new Z4(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const a in O0)this.eventManager.on(a,this._onEvent);this.viewManager=new FO({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const s=this.viewManager.getViewports()[0];this.layerManager=new OO(e,{deck:this,stats:this.stats,viewport:s,timeline:i}),this.effectManager=new e4,this.deckRenderer=new n4(e),this.deckPicker=new c4(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){const{gl:s}=this.layerManager.context;po(s,this.props.parameters),this.props.onBeforeRender({gl:s}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i}),this.props.onAfterRender({gl:s})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Vi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const s=Ba.get("Memory Usage");e.bufferMemory=s.get("Buffer Memory").count,e.textureMemory=s.get("Texture Memory").count,e.renderbufferMemory=s.get("Renderbuffer Memory").count,e.gpuMemory=s.get("GPU Memory").count}}U(Fu,"defaultProps",Yb);U(Fu,"VERSION",o3);class em{constructor(e,i){U(this,"opts",void 0),U(this,"source",void 0),this.opts=i,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),i=this.getAccessor();if(e)return[e,i];const{value:s}=this.source,{size:a}=i;let h=s;if(s&&s.length!==a){h=new Float32Array(a);const p=i.elementOffset||0;for(let c=0;c<a;++c)h[c]=s[p+c]}return h}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function Y4(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Ad(t){return t.stride||t.size*t.bytesPerElement}function Kb(t,e){e.offset&&Vi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=Ad(t),s=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,a=e.elementOffset||0,h=s*i+a*t.bytesPerElement+(t.offset||0);return{...e,offset:h,stride:i}}function K4(t,e){const i=Kb(t,e);return{high:i,low:{...i,offset:i.offset+t.size*4}}}class J4{constructor(e,i,s){U(this,"gl",void 0),U(this,"id",void 0),U(this,"size",void 0),U(this,"settings",void 0),U(this,"value",void 0),U(this,"doublePrecision",void 0),U(this,"_buffer",void 0),U(this,"state",void 0),this.gl=e,this.id=i.id||"",this.size=i.size||1;const a=i.logicalType||i.type,h=a===5130;let{defaultValue:p}=i;p=Number.isFinite(p)?[p]:p||new Array(this.size).fill(0);let c;h?c=5126:!a&&i.isIndexed?c=e&&LL(e,sn.ELEMENT_INDEX_UINT32)?5125:5123:c=a||5126;let b=Y4(a||c||5126);this.doublePrecision=h,h&&i.fp64===!1&&(b=Float32Array),this.value=null,this.settings={...i,defaultType:b,defaultValue:p,logicalType:a,type:c,size:this.size,bytesPerElement:b.BYTES_PER_ELEMENT},this.state={...s,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:i}=this.settings;this._buffer=new qi(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:i}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ad(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),zu.release(this.state.allocatedValue)}getShaderAttributes(e,i){if(this.doublePrecision){const s={},a=this.value instanceof Float64Array,h=K4(this.getAccessor(),i||{});return s[e]=new em(this,h.high),s["".concat(e,"64Low")]=a?new em(this,h.low):new Float32Array(this.size),s}if(i){const s=Kb(this.getAccessor(),i);return{[e]:new em(this,s)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const i=Array.from(this.value);e=[i,i]}else{const{value:i,numInstances:s,size:a}=this,h=s*a;if(i&&h&&i.length>=h){const p=new Array(a).fill(1/0),c=new Array(a).fill(-1/0);for(let b=0;b<h;)for(let T=0;T<a;T++){const P=i[b++];P<p[T]&&(p[T]=P),P>c[T]&&(c[T]=P)}e=[p,c]}}return this.state.bounds=e,e}setData(e){const{state:i}=this;let s;ArrayBuffer.isView(e)?s={value:e}:e instanceof qi?s={buffer:e}:s=e;const a={...this.settings,...s};if(i.bufferAccessor=a,i.bounds=null,s.constant){let h=s.value;if(h=this._normalizeValue(h,[],0),this.settings.normalized&&(h=this.normalizeConstant(h)),!(!i.constant||!this._areValuesEqual(h,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=h}else if(s.buffer){const h=s.buffer;i.externalBuffer=h,i.constant=!1,this.value=s.value||null;const p=s.value instanceof Float64Array;a.type=s.type||h.accessor.type,a.bytesPerElement=h.accessor.BYTES_PER_ELEMENT*(p?2:1),a.stride=Ad(a)}else if(s.value){this._checkExternalBuffer(s);let h=s.value;i.externalBuffer=null,i.constant=!1,this.value=h,a.bytesPerElement=h.BYTES_PER_ELEMENT,a.stride=Ad(a);const{buffer:p,byteOffset:c}=this;this.doublePrecision&&h instanceof Float64Array&&(h=Yp(h,a));const b=h.byteLength+c+a.stride*2;p.byteLength<b&&p.reallocate(b),p.setAccessor(null),p.subData({data:h,offset:c}),a.type=s.type||p.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const i=this.value,{startOffset:s=0,endOffset:a}=e;this.buffer.subData({data:this.doublePrecision&&i instanceof Float64Array?Yp(i,{size:this.size,startIndex:s,endIndex:a}):i.subarray(s,a),offset:s*i.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,i=!1){const{state:s}=this,a=s.allocatedValue,h=zu.allocate(a,e+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=h;const{buffer:p,byteOffset:c}=this;return p.byteLength<h.byteLength+c&&(p.reallocate(h.byteLength+c),i&&a&&p.subData({data:a instanceof Float64Array?Yp(a,this):a,offset:c})),s.allocatedValue=h,s.constant=!1,s.externalBuffer=null,s.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:i}=e;if(!ArrayBuffer.isView(i))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const s=this.settings.defaultType;let a=!1;if(this.doublePrecision&&(a=i.BYTES_PER_ELEMENT<4),a)throw new Error("Attribute ".concat(this.id," does not support ").concat(i.constructor.name));!(i instanceof s)&&this.settings.normalized&&!("normalized"in e)&&Vi.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(i=>(i+128)/255*2-1);case 5122:return new Float32Array(e).map(i=>(i+32768)/65535*2-1);case 5121:return new Float32Array(e).map(i=>i/255);case 5123:return new Float32Array(e).map(i=>i/65535);default:return e}}_normalizeValue(e,i,s){const{defaultValue:a,size:h}=this.settings;if(Number.isFinite(e))return i[s]=e,i;if(!e){let p=h;for(;--p>=0;)i[s+p]=a[p];return i}switch(h){case 4:i[s+3]=Number.isFinite(e[3])?e[3]:a[3];case 3:i[s+2]=Number.isFinite(e[2])?e[2]:a[2];case 2:i[s+1]=Number.isFinite(e[1])?e[1]:a[1];case 1:i[s+0]=Number.isFinite(e[0])?e[0]:a[0];break;default:let p=h;for(;--p>=0;)i[s+p]=Number.isFinite(e[p])?e[p]:a[p]}return i}_areValuesEqual(e,i){if(!e||!i)return!1;const{size:s}=this;for(let a=0;a<s;a++)if(e[a]!==i[a])return!1;return!0}}const K1=[],J1=[];function Jb(t,e=0,i=1/0){let s=K1;const a={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?s=t:t.length>0&&(J1.length=t.length,s=J1):s=K1,(e>0||Number.isFinite(i))&&(s=(Array.isArray(s)?s:Array.from(s)).slice(e,i),a.index=e-1),{iterable:s,objectInfo:a}}function Qb(t){return t&&t[Symbol.asyncIterator]}function Q4(t,e){const{size:i,stride:s,offset:a,startIndices:h,nested:p}=e,c=t.BYTES_PER_ELEMENT,b=s?s/c:i,T=a?a/c:0,P=Math.floor((t.length-T)/b);return(k,{index:C,target:H})=>{if(!h){const fe=C*b+T;for(let ye=0;ye<i;ye++)H[ye]=t[fe+ye];return H}const ee=h[C],se=h[C+1]||P;let pe;if(p){pe=new Array(se-ee);for(let fe=ee;fe<se;fe++){const ye=fe*b+T;H=new Array(i);for(let Se=0;Se<i;Se++)H[Se]=t[ye+Se];pe[fe-ee]=H}}else if(b===i)pe=t.subarray(ee*i+T,se*i+T);else{pe=new t.constructor((se-ee)*i);let fe=0;for(let ye=ee;ye<se;ye++){const Se=ye*b+T;for(let Ue=0;Ue<i;Ue++)pe[fe++]=t[Se+Ue]}}return pe}}const e5=[],Sd=[[0,1/0]];function t5(t,e){if(t===Sd||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const i=[],s=t.length;let a=0;for(let h=0;h<s;h++){const p=t[h];p[1]<e[0]?(i.push(p),a=h+1):p[0]>e[1]?i.push(p):e=[Math.min(p[0],e[0]),Math.max(p[1],e[1])]}return i.splice(a,0,e),i}function tm(t){const{source:e,target:i,start:s=0,size:a,getData:h}=t,p=t.end||i.length,c=e.length,b=p-s;if(c>b){i.set(e.subarray(0,b),s);return}if(i.set(e,s),!h)return;let T=c;for(;T<b;){const P=h(T,e);for(let k=0;k<a;k++)i[s+T]=P[k]||0,T++}}function i5({source:t,target:e,size:i,getData:s,sourceStartIndices:a,targetStartIndices:h}){if(!Array.isArray(h))return tm({source:t,target:e,size:i,getData:s}),e;let p=0,c=0;const b=s&&((P,k)=>s(P+c,k)),T=Math.min(a.length,h.length);for(let P=1;P<T;P++){const k=a[P]*i,C=h[P]*i;tm({source:t.subarray(p,k),target:e,start:c,end:C,size:i,getData:b}),p=k,c=C}return c<e.length&&tm({source:[],target:e,start:c,size:i,getData:b}),e}const n5={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function ew(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const i=t.type||"interpolation";return{...n5[i],...e,...t,type:i}}function tw(t,e){const i=e.getBuffer();return i?[i,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function iw(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function nw(t){t.push(t.shift())}function Hg(t,e){const{doublePrecision:i,settings:s,value:a,size:h}=t,p=i&&a instanceof Float64Array?2:1;return(s.noAlloc?a.length:e*h)*p}function rw({buffer:t,numInstances:e,attribute:i,fromLength:s,fromStartIndices:a,getData:h=p=>p}){const p=i.doublePrecision&&i.value instanceof Float64Array?2:1,c=i.size*p,b=i.byteOffset,T=i.startIndices,P=a&&T,k=Hg(i,e),C=i.isConstant;if(!P&&s>=k)return;const H=C?i.value:i.getBuffer().getData({srcByteOffset:b});if(i.settings.normalized&&!C){const fe=h;h=(ye,Se)=>i.normalizeConstant(fe(ye,Se))}const ee=C?(fe,ye)=>h(H,ye):(fe,ye)=>h(H.subarray(fe,fe+c),ye),se=t.getData({length:s}),pe=new Float32Array(k);i5({source:se,target:pe,sourceStartIndices:a,targetStartIndices:T,size:c,getData:ee}),t.byteLength<pe.byteLength+b&&t.reallocate(pe.byteLength+b),t.subData({data:pe,offset:b})}class qg extends J4{constructor(e,i){super(e,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Sd}),U(this,"constant",!1),this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!e,i}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:i}=this.settings,s=this.settings.transition,a=Array.isArray(i)?e[i.find(h=>e[h])]:e[i];return ew(a,s)}setNeedsUpdate(e=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),i){const{startRow:s=0,endRow:a=1/0}=i;this.state.updateRanges=t5(this.state.updateRanges,[s,a])}else this.state.updateRanges=Sd}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=e5}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:i,settings:s}=this;return s.noAlloc?!1:s.update?(super.allocate(e,i.updateRanges!==Sd),!0):!1}updateBuffer({numInstances:e,data:i,props:s,context:a}){if(!this.needsUpdate())return!1;const{state:{updateRanges:h},settings:{update:p,noAlloc:c}}=this;let b=!0;if(p){for(const[T,P]of h)p.call(a,this,{data:i,startRow:T,endRow:P,props:s,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[T,P]of h){const k=Number.isFinite(T)?this.getVertexOffset(T):0,C=Number.isFinite(P)?this.getVertexOffset(P):c||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:k,endOffset:C})}this._checkAttributeArray()}else b=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),b}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:i}=this;return e?(this.clearNeedsUpdate(),i.lastExternalBuffer===e||(i.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(e,i=null){const{state:s,settings:a}=this;if(!e)return s.binaryValue=null,s.binaryAccessor=null,!1;if(a.noAlloc)return!1;if(s.binaryValue===e)return this.clearNeedsUpdate(),!0;if(s.binaryValue=e,this.setNeedsRedraw(),a.transform||i!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const p=e;kn(ArrayBuffer.isView(p.value),"invalid ".concat(a.accessor));const c=Boolean(p.size)&&p.size!==this.size;return s.binaryAccessor=Q4(p.value,{size:p.size||this.size,stride:p.stride,offset:p.offset,startIndices:i,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:i}=this;return(i?e<i.length?i[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},i={};for(const s in e)Object.assign(i,super.getShaderAttributes(s,e[s]));return i}_autoUpdater(e,{data:i,startRow:s,endRow:a,props:h,numInstances:p}){if(e.constant)return;const{settings:c,state:b,value:T,size:P,startIndices:k}=e,{accessor:C,transform:H}=c,ee=b.binaryAccessor||(typeof C=="function"?C:h[C]);kn(typeof ee=="function",'accessor "'.concat(C,'" is not a function'));let se=e.getVertexOffset(s);const{iterable:pe,objectInfo:fe}=Jb(i,s,a);for(const ye of pe){fe.index++;let Se=ee(ye,fe);if(H&&(Se=H.call(this,Se)),k){const Ue=(fe.index<k.length-1?k[fe.index+1]:p)-k[fe.index];if(Se&&Array.isArray(Se[0])){let $e=se;for(const Ye of Se)e._normalizeValue(Ye,T,$e),$e+=P}else Se&&Se.length>P?T.set(Se,se):(e._normalizeValue(Se,fe.target,0),AO({target:T,source:fe.target,start:se,count:Ue}));se+=Ue*P}else e._normalizeValue(Se,T,se),se+=P}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,i=Math.min(4,this.size);if(e&&e.length>=i){let s=!0;switch(i){case 4:s=s&&Number.isFinite(e[3]);case 3:s=s&&Number.isFinite(e[2]);case 2:s=s&&Number.isFinite(e[1]);case 1:s=s&&Number.isFinite(e[0]);break;default:s=!1}if(!s)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class r5{constructor({gl:e,attribute:i,timeline:s}){U(this,"gl",void 0),U(this,"type","interpolation"),U(this,"attributeInTransition",void 0),U(this,"settings",void 0),U(this,"attribute",void 0),U(this,"transition",void 0),U(this,"currentStartIndices",void 0),U(this,"currentLength",void 0),U(this,"transform",void 0),U(this,"buffers",void 0),this.gl=e,this.transition=new Yu(s),this.attribute=i,this.attributeInTransition=new qg(e,i.settings),this.currentStartIndices=i.startIndices,this.currentLength=0,this.transform=o5(e,i);const a={byteLength:0,usage:35050};this.buffers=[new qi(e,a),new qi(e,a)]}get inProgress(){return this.transition.inProgress}start(e,i){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:s,buffers:a,attribute:h}=this;nw(a);const p={numInstances:i,attribute:h,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const c of a)rw({buffer:c,...p});this.currentStartIndices=h.startIndices,this.currentLength=Hg(h,i),this.attributeInTransition.setData({buffer:a[1],value:h.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/h.size),sourceBuffers:{aFrom:a[0],aTo:tw(s,h)},feedbackBuffers:{vCurrent:a[1]}})}update(){const e=this.transition.update();if(e){const{duration:i,easing:s}=this.settings,{time:a}=this.transition;let h=a/i;s&&(h=s(h)),this.transform.run({uniforms:{time:h}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const s5=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function o5(t,e){const i=iw(e.size);return new Bg(t,{vs:s5,defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"]})}class a5{constructor({gl:e,attribute:i,timeline:s}){U(this,"gl",void 0),U(this,"type","spring"),U(this,"attributeInTransition",void 0),U(this,"settings",void 0),U(this,"attribute",void 0),U(this,"transition",void 0),U(this,"currentStartIndices",void 0),U(this,"currentLength",void 0),U(this,"texture",void 0),U(this,"framebuffer",void 0),U(this,"transform",void 0),U(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Yu(s),this.attribute=i,this.attributeInTransition=new qg(e,{...i.settings,normalized:!1}),this.currentStartIndices=i.startIndices,this.currentLength=0,this.texture=c5(e),this.framebuffer=u5(e,this.texture),this.transform=l5(e,i,this.framebuffer);const a={byteLength:0,usage:35050};this.buffers=[new qi(e,a),new qi(e,a),new qi(e,a)]}get inProgress(){return this.transition.inProgress}start(e,i){const{gl:s,buffers:a,attribute:h}=this,p={numInstances:i,attribute:h,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const c of a)rw({buffer:c,...p});this.settings=e,this.currentStartIndices=h.startIndices,this.currentLength=Hg(h,i),this.attributeInTransition.setData({buffer:a[1],value:h.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/h.size),sourceBuffers:{aTo:tw(s,h)}})}update(){const{buffers:e,transform:i,framebuffer:s,transition:a}=this;if(!a.update())return!1;const p=this.settings;return i.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),i.run({framebuffer:s,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:p.stiffness,damping:p.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),nw(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),df(s)[0]>0||a.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function l5(t,e,i){const s=iw(e.size);return new Bg(t,{framebuffer:i,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:s},varyings:["vNext"]})}function c5(t){return new $r(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function u5(t,e){return new Bn(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const h5={interpolation:r5,spring:a5};class d5{constructor(e,{id:i,timeline:s}){U(this,"id",void 0),U(this,"isSupported",void 0),U(this,"gl",void 0),U(this,"timeline",void 0),U(this,"transitions",void 0),U(this,"needsRedraw",void 0),U(this,"numInstances",void 0),this.id=i,this.gl=e,this.timeline=s,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Bg.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:i,numInstances:s}){this.numInstances=s||1;for(const a in e){const h=e[a],p=h.getTransitionSetting(i);!p||this._updateAttribute(a,h,p)}for(const a in this.transitions){const h=e[a];(!h||!h.getTransitionSetting(i))&&this._removeTransition(a)}}hasAttribute(e){const i=this.transitions[e];return i&&i.inProgress}getAttributes(){const e={};for(const i in this.transitions){const s=this.transitions[i];s.inProgress&&(e[i]=s.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,i,s){const a=this.transitions[e];let h=!a||a.type!==s.type;if(h){if(!this.isSupported){Vi.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}a&&this._removeTransition(e);const p=h5[s.type];p?this.transitions[e]=new p({attribute:i,timeline:this.timeline,gl:this.gl}):(Vi.error("unsupported transition type '".concat(s.type,"'"))(),h=!1)}(h||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(s,this.numInstances))}}const Q1="attributeManager.invalidate",f5="attributeManager.updateStart",p5="attributeManager.updateEnd",m5="attribute.updateStart",g5="attribute.allocate",_5="attribute.updateEnd";class y5{constructor(e,{id:i="attribute-manager",stats:s,timeline:a}={}){U(this,"id",void 0),U(this,"gl",void 0),U(this,"attributes",void 0),U(this,"updateTriggers",void 0),U(this,"needsRedraw",void 0),U(this,"userData",void 0),U(this,"stats",void 0),U(this,"attributeTransitionManager",void 0),U(this,"mergeBoundsMemoized",Xu(gO)),this.id=i,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=s,this.attributeTransitionManager=new d5(e,{id:"".concat(i,"-transitions"),timeline:a}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const i of e)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(e,i){const s=this._invalidateTrigger(e,i);_r(Q1,this,e,s)}invalidateAll(e){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,e);_r(Q1,this,"all")}update({data:e,numInstances:i,startIndices:s=null,transitions:a,props:h={},buffers:p={},context:c={}}){let b=!1;_r(f5,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const T in this.attributes){const P=this.attributes[T],k=P.settings.accessor;P.startIndices=s,P.numInstances=i,h[T]&&Vi.removed("props.".concat(T),"data.attributes.".concat(T))(),P.setExternalBuffer(p[T])||P.setBinaryValue(typeof k=="string"?p[k]:void 0,e.startIndices)||typeof k=="string"&&!p[k]&&P.setConstantValue(h[k])||P.needsUpdate()&&(b=!0,this._updateAttribute({attribute:P,numInstances:i,data:e,props:h,context:c})),this.needsRedraw=this.needsRedraw||P.needsRedraw()}b&&_r(p5,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:a})}updateTransition(){const{attributeTransitionManager:e}=this,i=e.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return this.attributes}getBounds(e){const i=e.map(s=>{var a;return(a=this.attributes[s])===null||a===void 0?void 0:a.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:s}=this,a={...s.getAttributes()};for(const h in i){const p=i[h];p.needsRedraw(e)&&!s.hasAttribute(h)&&(a[h]=p)}return a}getShaderAttributes(e,i={}){e||(e=this.getAttributes());const s={};for(const a in e)i[a]||Object.assign(s,e[a].getShaderAttributes());return s}_add(e,i={}){for(const s in e){const a=e[s];this.attributes[s]=this._createAttribute(s,a,i)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,i,s){const a={...i,id:e,size:i.isIndexed&&1||i.size||1,divisor:s.instanced?1:i.divisor||0};return new qg(this.gl,a)}_mapUpdateTriggersToAttributes(){const e={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(a=>{e[a]||(e[a]=[]),e[a].push(i)});this.updateTriggers=e}_invalidateTrigger(e,i){const{attributes:s,updateTriggers:a}=this,h=a[e];return h&&h.forEach(p=>{const c=s[p];c&&c.setNeedsUpdate(c.id,i)}),h}_updateAttribute(e){const{attribute:i,numInstances:s}=e;if(_r(m5,i),i.constant){i.setConstantValue(i.value);return}i.allocate(s)&&_r(g5,i,s),i.updateBuffer(e)&&(this.needsRedraw=!0,_r(_5,i,s))}}class v5 extends Yu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:i,toValue:s,duration:a,easing:h}}=this,p=h(e/a);this._value=Ud(i,s,p)}}const ev=1e-5;function tv(t,e,i,s,a){const h=e-t,c=(i-e)*a,b=-h*s;return c+b+h+e}function x5(t,e,i,s,a){if(Array.isArray(i)){const h=[];for(let p=0;p<i.length;p++)h[p]=tv(t[p],e[p],i[p],s,a);return h}return tv(t,e,i,s,a)}function iv(t,e){if(Array.isArray(t)){let i=0;for(let s=0;s<t.length;s++){const a=t[s]-e[s];i+=a*a}return Math.sqrt(i)}return Math.abs(t-e)}class b5 extends Yu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:i,damping:s,stiffness:a}=this.settings,{_prevValue:h=e,_currValue:p=e}=this;let c=x5(h,p,i,s,a);const b=iv(c,i),T=iv(c,p);b<ev&&T<ev&&(c=i,this.end()),this._prevValue=p,this._currValue=c}}const w5={interpolation:v5,spring:b5};class E5{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,i,s,a){const{transitions:h}=this;if(h.has(e)){const b=h.get(e),{value:T=b.settings.fromValue}=b;i=T,this.remove(e)}if(a=ew(a),!a)return;const p=w5[a.type];if(!p){Vi.error("unsupported transition type '".concat(a.type,"'"))();return}const c=new p(this.timeline);c.start({...a,fromValue:i,toValue:s}),h.set(e,c)}remove(e){const{transitions:i}=this;i.has(e)&&(i.get(e).cancel(),i.delete(e))}update(){const e={};for(const[i,s]of this.transitions)s.update(),e[i]=s.value,s.inProgress||this.remove(i);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function T5(t){const e=t[ja];for(const i in e){const s=e[i],{validate:a}=s;if(a&&!a(t[i],s))throw new Error("Invalid prop ".concat(i,": ").concat(t[i]))}}function A5(t,e){const i=sw({newProps:t,oldProps:e,propTypes:t[ja],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),s=I5(t,e);let a=!1;return s||(a=P5(t,e)),{dataChanged:s,propsChanged:i,updateTriggersChanged:a,extensionsChanged:M5(t,e),transitionsChanged:S5(t,e)}}function S5(t,e){if(!t.transitions)return!1;const i={},s=t[ja];let a=!1;for(const h in t.transitions){const p=s[h],c=p&&p.type;(c==="number"||c==="color"||c==="array")&&Wm(t[h],e[h],p)&&(i[h]=!0,a=!0)}return a?i:!1}function sw({newProps:t,oldProps:e,ignoreProps:i={},propTypes:s={},triggerName:a="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(a," changed shallowly");for(const h of Object.keys(t))if(!(h in i)){if(!(h in e))return"".concat(a,".").concat(h," added");const p=Wm(t[h],e[h],s[h]);if(p)return"".concat(a,".").concat(h," ").concat(p)}for(const h of Object.keys(e))if(!(h in i)){if(!(h in t))return"".concat(a,".").concat(h," dropped");if(!Object.hasOwnProperty.call(t,h)){const p=Wm(t[h],e[h],s[h]);if(p)return"".concat(a,".").concat(h," ").concat(p)}}return!1}function Wm(t,e,i){let s=i&&i.equal;return s&&!s(t,e,i)||!s&&(s=t&&e&&t.equals,s&&!s.call(t,e))?"changed deeply":!s&&e!==t?"changed shallowly":null}function I5(t,e){if(e===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:s,_dataDiff:a}=t;return s?s(t.data,e.data)||(i="Data comparator detected a change"):t.data!==e.data&&(i="A new data container was supplied"),i&&a&&(i=a(t.data,e.data)||i),i}function P5(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&nv(t,e,"all"))return{all:!0};const i={};let s=!1;for(const a in t.updateTriggers)a!=="all"&&nv(t,e,a)&&(i[a]=!0,s=!0);return s?i:!1}function M5(t,e){if(e===null)return!0;const i=e.extensions,{extensions:s}=t;if(s===i)return!1;if(!i||!s||s.length!==i.length)return!0;for(let a=0;a<s.length;a++)if(!s[a].equals(i[a]))return!0;return!1}function nv(t,e,i){let s=t.updateTriggers[i];s=s==null?{}:s;let a=e.updateTriggers[i];return a=a==null?{}:a,sw({oldProps:a,newProps:s,triggerName:i})}const C5="count(): argument not an object",L5="count(): argument not a container";function k5(t){if(!D5(t))throw new Error(C5);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(R5(t))return Object.keys(t).length;throw new Error(L5)}function R5(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function D5(t){return t!==null&&typeof t=="object"}function z5(t,e){if(!e)return t;const i={...t,...e};if("defines"in e&&(i.defines={...t.defines,...e.defines}),"modules"in e&&(i.modules=(t.modules||[]).concat(e.modules),e.modules.some(s=>s.name==="project64"))){const s=i.modules.findIndex(a=>a.name==="project32");s>=0&&i.modules.splice(s,1)}if("inject"in e)if(!t.inject)i.inject=e.inject;else{const s={...t.inject};for(const a in e.inject)s[a]=(s[a]||"")+e.inject[a];i.inject=s}return i}const O5={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},Zm={};function F5(t,e,i){if(e instanceof $r)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let s=null;e.compressed&&(s={[10241]:e.data.length>1?9985:9729});const a=new $r(t,{...e,parameters:{...O5,...s,...i}});return Zm[a.id]=!0,a}function B5(t){!t||!(t instanceof $r)||Zm[t.id]&&(t.delete(),delete Zm[t.id])}const N5={boolean:{validate(t,e){return!0},equal(t,e,i){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Xm(t)&&(t.length===3||t.length===4)},equal(t,e,i){return Us(t,e,1)}},accessor:{validate(t,e){const i=Wd(t);return i==="function"||i===Wd(e.value)},equal(t,e,i){return typeof e=="function"?!0:Us(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Xm(t)},equal(t,e,i){const{compare:s}=i,a=Number.isInteger(s)?s:s?1:0;return s?Us(t,e,a):t===e}},object:{equal(t,e,i){if(i.ignore)return!0;const{compare:s}=i,a=Number.isInteger(s)?s:s?1:0;return s?Us(t,e,a):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,i){return!i.compare&&i.ignore!==!1||t===e}},data:{transform:(t,e,i)=>{const{dataTransform:s}=i.props;return s&&t?s(t):t}},image:{transform:(t,e,i)=>{const s=i.context;return!s||!s.gl?null:F5(s.gl,t,{...e.parameters,...i.props.textureParameters})},release:t=>{B5(t)}}};function U5(t){const e={},i={},s={};for(const[a,h]of Object.entries(t)){const p=h==null?void 0:h.deprecatedFor;if(p)s[a]=Array.isArray(p)?p:[p];else{const c=V5(a,h);e[a]=c,i[a]=c.value}}return{propTypes:e,defaultProps:i,deprecatedProps:s}}function V5(t,e){switch(Wd(e)){case"object":return cu(t,e);case"array":return cu(t,{type:"array",value:e,compare:!1});case"boolean":return cu(t,{type:"boolean",value:e});case"number":return cu(t,{type:"number",value:e});case"function":return cu(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function cu(t,e){return"type"in e?{name:t,...N5[e.type],...e}:"value"in e?{name:t,type:Wd(e.value),...e}:{name:t,type:"object",value:e}}function Xm(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Wd(t){return Xm(t)?"array":t===null?"null":typeof t}function j5(t,e){let i;for(let h=e.length-1;h>=0;h--){const p=e[h];"extensions"in p&&(i=p.extensions)}const s=Ym(t.constructor,i),a=Object.create(s);a[Hd]=t,a[Wa]={},a[Yo]={};for(let h=0;h<e.length;++h){const p=e[h];for(const c in p)a[c]=p[c]}return Object.freeze(a),a}const G5="_mergedDefaultProps";function Ym(t,e){let i=G5;if(e)for(const a of e){const h=a.constructor;h&&(i+=":".concat(h.extensionName||h.name))}const s=ow(t,i);return s||(t[i]=$5(t,e||[]))}function $5(t,e){if(!t.prototype)return null;const s=Object.getPrototypeOf(t),a=Ym(s),h=ow(t,"defaultProps")||{},p=U5(h),c=Object.assign(Object.create(null),a,p.defaultProps),b=Object.assign(Object.create(null),a==null?void 0:a[ja],p.propTypes),T=Object.assign(Object.create(null),a==null?void 0:a[Jp],p.deprecatedProps);for(const P of e){const k=Ym(P.constructor);k&&(Object.assign(c,k),Object.assign(b,k[ja]),Object.assign(T,k[Jp]))}return H5(c,t),W5(c,b),q5(c,T),c[ja]=b,c[Jp]=T,e.length===0&&!Wg(t,"_propTypes")&&(t._propTypes=b),c}function H5(t,e){const i=X5(e);Object.defineProperties(t,{id:{writable:!0,value:i}})}function q5(t,e){for(const i in e)Object.defineProperty(t,i,{enumerable:!1,set(s){const a="".concat(this.id,": ").concat(i);for(const h of e[i])Wg(this,h)||(this[h]=s);Vi.deprecated(a,e[i].join("/"))()}})}function W5(t,e){const i={},s={};for(const a in e){const h=e[a],{name:p,value:c}=h;h.async&&(i[p]=c,s[p]=Z5(p))}t[Nl]=i,t[Wa]={},Object.defineProperties(t,s)}function Z5(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||Qb(e)?this[Wa][t]=e:this[Yo][t]=e},get(){if(this[Yo]){if(t in this[Yo])return this[Yo][t]||this[Nl][t];if(t in this[Wa]){const e=this[Hd]&&this[Hd].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Nl][t]}}return this[Nl][t]}}}function Wg(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ow(t,e){return Wg(t,e)&&t[e]}function X5(t){const e=t.componentName;return e||Vi.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let Y5=0;class Zg{constructor(...e){U(this,"id",void 0),U(this,"props",void 0),U(this,"count",void 0),this.props=j5(this,e),this.id=this.props.id,this.count=Y5++}clone(e){const{props:i}=this,s={};for(const a in i[Nl])a in i[Yo]?s[a]=i[Yo][a]:a in i[Wa]&&(s[a]=i[Wa][a]);return new this.constructor({...i,...s,...e})}}U(Zg,"componentName","Component");U(Zg,"defaultProps",{});const K5=Object.freeze({});class J5{constructor(e){U(this,"component",void 0),U(this,"onAsyncPropUpdated",void 0),U(this,"asyncProps",void 0),U(this,"oldProps",void 0),U(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const i=this.asyncProps[e];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||K5}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const i=this.asyncProps[e];return i&&i.resolvedValue}isAsyncPropLoading(e){if(e){const i=this.asyncProps[e];return Boolean(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(e,i){this._watchPromise(e,Promise.resolve(i))}setAsyncProps(e){this.component=e[Hd]||this.component;const i=e[Yo]||{},s=e[Wa]||e,a=e[Nl]||{};for(const h in i){const p=i[h];this._createAsyncPropData(h,a[h]),this._updateAsyncProp(h,p),i[h]=this.getAsyncProp(h)}for(const h in s){const p=s[h];this._createAsyncPropData(h,a[h]),this._updateAsyncProp(h,p)}}_fetch(e,i){return null}_onResolve(e,i){}_onError(e,i){}_updateAsyncProp(e,i){if(!!this._didAsyncInputValueChange(e,i)){if(typeof i=="string"&&(i=this._fetch(e,i)),i instanceof Promise){this._watchPromise(e,i);return}if(Qb(i)){this._resolveAsyncIterable(e,i);return}this._setPropValue(e,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,i){const s=this.asyncProps[e];return i===s.resolvedValue||i===s.lastValue?!1:(s.lastValue=i,!0)}_setPropValue(e,i){this._freezeAsyncOldProps();const s=this.asyncProps[e];s&&(i=this._postProcessValue(s,i),s.resolvedValue=i,s.pendingLoadCount++,s.resolvedLoadCount=s.pendingLoadCount)}_setAsyncPropValue(e,i,s){const a=this.asyncProps[e];a&&s>=a.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),a.resolvedValue=i,a.resolvedLoadCount=s,this.onAsyncPropUpdated(e,i))}_watchPromise(e,i){const s=this.asyncProps[e];if(s){s.pendingLoadCount++;const a=s.pendingLoadCount;i.then(h=>{!this.component||(h=this._postProcessValue(s,h),this._setAsyncPropValue(e,h,a),this._onResolve(e,h))}).catch(h=>{this._onError(e,h)})}}async _resolveAsyncIterable(e,i){if(e!=="data"){this._setPropValue(e,i);return}const s=this.asyncProps[e];if(!s)return;s.pendingLoadCount++;const a=s.pendingLoadCount;let h=[],p=0;for await(const c of i){if(!this.component)return;const{dataTransform:b}=this.component.props;b?h=b(c,h):h=h.concat(c),Object.defineProperty(h,"__diff",{enumerable:!1,value:[{startRow:p,endRow:h.length}]}),p=h.length,this._setAsyncPropValue(e,h,a)}this._onResolve(e,h)}_postProcessValue(e,i){const s=e.type;return s&&this.component&&(s.release&&s.release(e.resolvedValue,s,this.component),s.transform)?s.transform(i,s,this.component):i}_createAsyncPropData(e,i){if(!this.asyncProps[e]){const a=this.component&&this.component.props[ja];this.asyncProps[e]={type:a&&a[e],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class Q5 extends J5{constructor({attributeManager:e,layer:i}){super(i),U(this,"attributeManager",void 0),U(this,"needsRedraw",void 0),U(this,"needsUpdate",void 0),U(this,"subLayers",void 0),U(this,"usesPickingColorCache",void 0),U(this,"hasPickingBuffer",void 0),U(this,"changeFlags",void 0),U(this,"viewport",void 0),U(this,"uniformTransitions",void 0),U(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,i){const s=this.layer,a=s==null?void 0:s.props.fetch;return a?a(i,{propName:e,layer:s}):super._fetch(e,i)}_onResolve(e,i){const s=this.layer;if(s){const a=s.props.onDataLoad;e==="data"&&a&&a(i,{propName:e,layer:s})}}_onError(e,i){const s=this.layer;s&&s.raiseError(i,"loading ".concat(e," of ").concat(this.layer))}}const e6="layer.changeFlag",t6="layer.initialize",i6="layer.update",n6="layer.finalize",r6="layer.matched",rv=2**24-1,s6=Object.freeze([]),o6=Xu(({oldViewport:t,viewport:e})=>t.equals(e));let Ds=new Uint8ClampedArray(0);const a6={data:{type:"data",value:s6,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:i,loaders:s,loadOptions:a,signal:h})=>{const{resourceManager:p}=i.context;if(a=a||i.getLoadOptions(),s=s||i.props.loaders,h){var c;a={...a,fetch:{...(c=a)===null||c===void 0?void 0:c.fetch,signal:h}}}let b=p.contains(t);return!b&&!a&&(p.add({resourceId:t,data:Fd(t,s),persistent:!1}),b=!0),b?p.subscribe({resourceId:t,onChange:T=>{var P;return(P=i.internalState)===null||P===void 0?void 0:P.reloadAsyncProp(e,T)},consumerId:i.id,requestId:e}):Fd(t,s,a)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Oi.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Xg extends Zg{constructor(...e){super(...e),U(this,"internalState",null),U(this,"lifecycle",Ll.NO_STATE),U(this,"context",void 0),U(this,"state",void 0),U(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){kn(this.internalState);const i=this.internalState.viewport||this.context.viewport,s=jb(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[a,h,p]=Ub(s,i.pixelProjectionMatrix);return e.length===2?[a,h]:[a,h,p]}unproject(e){return kn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,i){kn(this.internalState);const s=this.internalState.viewport||this.context.viewport;return wO(e,{viewport:s,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const i of this.getModels())i.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Oi.DEFAULT||e===Oi.LNGLAT||e===Oi.CARTESIAN}onHover(e,i){return this.props.onHover&&this.props.onHover(e,i)||!1}onClick(e,i){return this.props.onClick&&this.props.onClick(e,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,i=[]){return i[0]=e+1&255,i[1]=e+1>>8&255,i[2]=e+1>>8>>8&255,i}decodePickingColor(e){kn(e instanceof Uint8Array);const[i,s,a]=e;return i+s*256+a*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:k5(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const i of this.props.extensions)e=z5(e,i.getShaders.call(this,i));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const i=this.getAttributeManager(),{dataChanged:s}=e.changeFlags;if(s&&i)if(Array.isArray(s))for(const a of s)i.invalidateAll(a);else i.invalidateAll();if(i){const{props:a}=e,h=this.internalState.hasPickingBuffer,p=Number.isInteger(a.highlightedObjectIndex)||a.pickable||a.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(h!==p){this.internalState.hasPickingBuffer=p;const{pickingColors:c,instancePickingColors:b}=i.attributes,T=c||b;T&&(p&&T.constant&&(T.constant=!1,i.invalidate(T.id)),!T.value&&!p&&(T.constant=!0,T.value=[0,0,0]))}}}finalizeState(e){for(const s of this.getModels())s.delete();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const i of this.getModels())i.draw(e)}getPickingInfo({info:e,mode:i,sourceLayer:s}){const{index:a}=e;return a>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[a]),e}raiseError(e,i){var s,a;if(i&&(e.message="".concat(i,": ").concat(e.message)),!((s=(a=this.props).onError)!==null&&s!==void 0&&s.call(a,e))){var h,p;(h=this.context)===null||h===void 0||(p=h.onError)===null||p===void 0||p.call(h,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=e,(!i||!o6({oldViewport:i,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const i=this.getAttributeManager();!i||(e==="all"?i.invalidateAll():i.invalidate(e))}updateAttributes(e){for(const i of this.getModels())this._setModelAttributes(i,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const i=this.props,s=this.getNumInstances(),a=this.getStartIndices();e.update({data:i.data,numInstances:s,startIndices:a,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const h=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(h)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const i=e.update(),s=Object.create(this.props);for(const a in i)Object.defineProperty(s,a,{value:i[a]});return s}return this.props}calculateInstancePickingColors(e,{numInstances:i}){if(e.constant)return;const s=Math.floor(Ds.length/3);if(this.internalState.usesPickingColorCache=!0,s<i){i>rv&&Vi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ds=zu.allocate(Ds,i,{size:3,copy:!0,maxCount:Math.max(i,rv)});const a=Math.floor(Ds.length/3),h=[];for(let p=s;p<a;p++)this.encodePickingColor(p,h),Ds[p*3+0]=h[0],Ds[p*3+1]=h[1],Ds[p*3+2]=h[2]}e.value=Ds.subarray(0,i*3)}_setModelAttributes(e,i){const s=this.getAttributeManager(),a=e.userData.excludeAttributes||{},h=s.getShaderAttributes(i,a);e.setAttributes(h)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,a=i||s;if(!a)return;const h=a.getVertexOffset(e),p=a.getVertexOffset(e+1);a.buffer.subData({data:new Uint8Array(p-h),offset:h})}restorePickingColors(){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,s=e||i;!s||(this.internalState.usesPickingColorCache&&s.value.buffer!==Ds.buffer&&(s.value=Ds.subarray(0,s.value.length)),s.updateSubBuffer({startOffset:0}))}_initialize(){kn(!this.internalState),kn(Number.isFinite(this.props.coordinateSystem)),_r(t6,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Q5({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Vi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new E5(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){_r(r6,this,this===e);const{state:i,internalState:s}=e;this!==e&&(this.internalState=s,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(_r(i6,this,e),!e)return;const i=this.props,s=this.context,a=this.internalState,h=s.viewport,p=this._updateUniformTransition();a.propsInTransition=p,s.viewport=a.viewport||h,this.props=p;try{const c=this._getUpdateParams(),b=this.getModels();if(s.gl)this.updateState(c);else try{this.updateState(c)}catch{}for(const P of this.props.extensions)P.updateState.call(this,c,P);const T=this.getModels()[0]!==b[0];this._postUpdate(c,T)}finally{s.viewport=h,this.props=i,this._clearChangeFlags(),a.needsUpdate=!1,a.resetOldProps()}}_finalize(){_r(n6,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const a=this.props,h=this.context;this.props=this.internalState.propsInTransition||a;const p=this.props.opacity;i.opacity=Math.pow(p,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:c}=this.props,b=c&&c(i)||[0,0];po(h.gl,{polygonOffset:b}),gs(h.gl,s,()=>{const T={moduleParameters:e,uniforms:i,parameters:s,context:h};for(const P of this.props.extensions)P.draw.call(this,T,P);this.draw(T)})}finally{this.props=a}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const a in e)if(e[a]){let h=!1;switch(a){case"dataChanged":const p=e[a],c=i[a];p&&Array.isArray(c)&&(i.dataChanged=Array.isArray(p)?c.concat(p):p,h=!0);default:i[a]||(i[a]=e[a],h=!0)}h&&_r(e6,this,a,e)}const s=Boolean(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=s,i.somethingChanged=s||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,i){const s=A5(e,i);if(s.updateTriggersChanged)for(const h in s.updateTriggersChanged)s.updateTriggersChanged[h]&&this.invalidateAttribute(h);if(s.transitionsChanged)for(const h in s.transitionsChanged){var a;this.internalState.uniformTransitions.add(h,i[h],e[h],(a=e.transitions)===null||a===void 0?void 0:a[h])}return this.setChangeFlags(s)}validateProps(){T5(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const i={pickingSelectedColor:e.picked?e.color:null},{highlightColor:s}=this.props;e.picked&&typeof s=="function"&&(i.pickingHighlightColor=s(e)),this.setModuleParameters(i),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new y5(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,i){const{props:s,oldProps:a}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:h}=this.state;h==null||h.setInstanceCount(this.getNumInstances());const{autoHighlight:p,highlightedObjectIndex:c,highlightColor:b}=s;if(i||a.autoHighlight!==p||a.highlightedObjectIndex!==c||a.highlightColor!==b){const T={};p||(T.pickingSelectedColor=null),Array.isArray(b)&&(T.pickingHighlightColor=b),(i||c!==a.highlightedObjectIndex)&&(T.pickingSelectedColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setModuleParameters(T)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const s=this.getAttributeManager(),a=s?s.getNeedsRedraw(e):!1;if(i=i||a,i)for(const h of this.props.extensions)h.onNeedsRedraw.call(this,h);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}U(Xg,"defaultProps",a6);U(Xg,"layerName","Layer");const im=512,l6=Math.PI/180;function aw({map:t,gl:e,deck:i}){if(t.__deck)return t.__deck;const s=i==null?void 0:i.props._customRender,a=i==null?void 0:i.props.onLoad,h=lw({...i==null?void 0:i.props,_customRender:()=>{t.triggerRepaint(),s==null||s("")}});let p;return(!i||i.props.gl===e)&&(Object.assign(h,{gl:e,width:null,height:null,touchAction:"unset",viewState:Bu(t)}),i!=null&&i.isInitialized?sv(i,t):h.onLoad=()=>{a==null||a(),sv(p,t)}),i?(p=i,i.setProps(h),i.userData.isExternal=!0):(p=new Fu(h),t.on("remove",()=>{p.finalize(),t.__deck=null})),p.userData.mapboxLayers=new Set,t.__deck=p,t.on("render",()=>{p.isInitialized&&p6(p,t)}),p}function sv(t,e){const i=()=>{t.isInitialized?m6(t,e):e.off("move",i)};e.on("move",i)}function lw(t){const e="useDevicePixels"in t?t.useDevicePixels:!0;return{...t,useDevicePixels:e,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new Gg({id:"mapbox"})]}}function c6(t,e){t.userData.mapboxLayers.add(e),Yg(t)}function u6(t,e){t.userData.mapboxLayers.delete(e),Yg(t)}function h6(t,e){Yg(t)}function d6(t,e,i){let{currentViewport:s}=t.userData,a=!1;s||(s=cw(t,e,!0),t.userData.currentViewport=s,a=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[s],layerFilter:({layer:h})=>i.id===h.id,clearStack:a,clearCanvas:!1})}function Bu(t){var e;const{lng:i,lat:s}=t.getCenter(),a={longitude:(i+540)%360-180,latitude:s,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return(e=t.getTerrain)!==null&&e!==void 0&&e.call(t)&&f6(t,a),a}function f6(t,e){if(t.getFreeCameraOptions){const{position:i}=t.getFreeCameraOptions();if(!i||i.z===void 0)return;const s=t.transform.height,{longitude:a,latitude:h,pitch:p}=e,c=i.x*im,b=(1-i.y)*im,T=i.z*im,P=Du([a,h]),k=c-P[0],C=b-P[1],H=Math.sqrt(k*k+C*C),ee=p*l6,se=1.5*s,pe=ee<.001?se*Math.cos(ee)/T:se*Math.sin(ee)/H;e.zoom=Math.log2(pe);const fe=se*Math.cos(ee)/pe,ye=T-fe;e.position=[0,0,ye/Td(h)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function cw(t,e,i=!0){return new qa({id:"mapbox",x:0,y:0,width:t.width,height:t.height,...Bu(e),nearZMultiplier:i?.02:.1})}function p6(t,e){const{mapboxLayers:i,isExternal:s}=t.userData;if(s){const a=Array.from(i,P=>P.id),p=Ou(t.props.layers,Boolean).some(P=>P&&!a.includes(P.id));let c=t.getViewports();const b=c.findIndex(P=>P.id==="mapbox"),T=c.length>1||b<0;(p||T)&&(b>=0&&(c=c.slice(),c[b]=cw(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:c,layerFilter:P=>(!t.props.layerFilter||t.props.layerFilter(P))&&(P.viewport.id!=="mapbox"||!a.includes(P.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function m6(t,e){t.setProps({viewState:Bu(e)}),t.needsRedraw({clearRedrawFlags:!0})}function Yg(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(i=>{const s=i.props.type,a=new s(i.props);e.push(a)}),t.setProps({layers:e})}class g6{constructor(e){if(U(this,"id",void 0),U(this,"type",void 0),U(this,"renderingMode",void 0),U(this,"map",void 0),U(this,"deck",void 0),U(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,i){this.map=e,this.deck=aw({map:e,gl:i,deck:this.props.deck}),c6(this.deck,this)}onRemove(){this.deck&&u6(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&h6(this.deck)}render(){d6(this.deck,this.map,this)}}const nm="__UNDEFINED__";function pd(t,e,i,s){if(!t||!e||!t.style||!t.style._loaded)return;const a=Ou(s,Boolean);if(i!==s){const c=Ou(i,Boolean),b=new Set(c.map(T=>T.id));for(const T of a)b.delete(T.id);for(const T of b)t.getLayer(T)&&t.removeLayer(T)}for(const c of a){const b=t.getLayer(c.id);b?b.implementation.setProps(c.props):t.addLayer(new g6({id:c.id,deck:e}),c.props.beforeId)}const h=t.style._order,p={};for(const c of a){let{beforeId:b}=c.props;(!b||!h.includes(b))&&(b=nm),p[b]=p[b]||[],p[b].push(c.id)}for(const c in p){const b=p[c];let T=c===nm?h.length:h.indexOf(c),P=c===nm?void 0:c;for(let k=b.length-1;k>=0;k--){const C=b[k],H=h.indexOf(C);H!==T-1&&(t.moveLayer(C,P),H>T&&T++),T--,P=C}}}class _6{constructor(e){U(this,"_props",void 0),U(this,"_deck",void 0),U(this,"_map",void 0),U(this,"_container",void 0),U(this,"_interleaved",void 0),U(this,"_lastMouseDownPoint",void 0),U(this,"_handleStyleChange",()=>{pd(this._map,this._deck,this._props.layers,this._props.layers)}),U(this,"_updateContainerSize",()=>{if(this._map&&this._container){const{clientWidth:a,clientHeight:h}=this._map.getContainer();Object.assign(this._container.style,{width:"".concat(a,"px"),height:"".concat(h,"px")})}}),U(this,"_updateViewState",()=>{const a=this._deck;a&&(a.setProps({viewState:Bu(this._map)}),a.isInitialized&&a.redraw())}),U(this,"_handleMouseEvent",a=>{const h=this._deck;if(!h||!h.isInitialized)return;const p={type:a.type,offsetCenter:a.point,srcEvent:a},c=this._lastMouseDownPoint;switch(!a.point&&c&&(p.deltaX=a.originalEvent.clientX-c.clientX,p.deltaY=a.originalEvent.clientY-c.clientY,p.offsetCenter={x:c.x+p.deltaX,y:c.y+p.deltaY}),p.type){case"mousedown":h._onPointerDown(p),this._lastMouseDownPoint={...a.point,clientX:a.originalEvent.clientX,clientY:a.originalEvent.clientY};break;case"dragstart":p.type="panstart",h._onEvent(p);break;case"drag":p.type="panmove",h._onEvent(p);break;case"dragend":p.type="panend",h._onEvent(p);break;case"click":p.tapCount=1,h._onEvent(p);break;case"dblclick":p.type="click",p.tapCount=2,h._onEvent(p);break;case"mousemove":p.type="pointermove",h._onPointerMove(p);break;case"mouseout":p.type="pointerleave",h._onPointerMove(p);break;default:return}});const{interleaved:i=!1,...s}=e;this._interleaved=i,this._props=s}setProps(e){this._interleaved&&e.layers&&pd(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?lw(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const i=document.createElement("div");return Object.assign(i.style,{position:"absolute",left:0,top:0,pointerEvents:"none"}),this._container=i,this._deck=new Fu({...this._props,parent:i,viewState:Bu(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),i}_onAddInterleaved(e){return this._deck=aw({map:e,gl:e.painter.context.gl,deck:new Fu({...this._props,gl:e.painter.context.gl})}),e.on("styledata",this._handleStyleChange),pd(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){var e;const i=this._map;i&&(this._interleaved?this._onRemoveInterleaved(i):this._onRemoveOverlaid(i)),(e=this._deck)===null||e===void 0||e.finalize(),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent)}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),pd(e,this._deck,this._props.layers,[])}getDefaultPosition(){return"top-left"}pickObject(e){return kn(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return kn(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return kn(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}}const y6=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,v6=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,x6=1024,b6=4,ov=()=>{},av={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function w6(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function E6(t,e,i,s){const a=Math.min(i/e.width,s/e.height),h=Math.floor(e.width*a),p=Math.floor(e.height*a);return a===1?{data:e,width:h,height:p}:(t.canvas.height=p,t.canvas.width=h,t.clearRect(0,0,h,p),t.drawImage(e,0,0,e.width,e.height,0,0,h,p),{data:t.canvas,width:h,height:p})}function Nu(t){return t&&(t.id||t.url)}function T6(t,e,i,s){const a=t.width,h=t.height,p=new $r(t.gl,{width:e,height:i,parameters:s});return IL(t,p,{targetY:0,width:a,height:h}),t.delete(),p}function lv(t,e,i){for(let s=0;s<e.length;s++){const{icon:a,xOffset:h}=e[s],p=Nu(a);t[p]={...a,x:h,y:i}}}function A6({icons:t,buffer:e,mapping:i={},xOffset:s=0,yOffset:a=0,rowHeight:h=0,canvasWidth:p}){let c=[];for(let b=0;b<t.length;b++){const T=t[b],P=Nu(T);if(!i[P]){const{height:k,width:C}=T;s+C+e>p&&(lv(i,c,a),s=0,a=h+a+e,h=0,c=[]),c.push({icon:T,xOffset:s}),s=s+C+e,h=Math.max(h,k)}}return c.length>0&&lv(i,c,a),{mapping:i,rowHeight:h,xOffset:s,yOffset:a,canvasWidth:p,canvasHeight:w6(h+a+e)}}function S6(t,e,i){if(!t||!e)return null;i=i||{};const s={},{iterable:a,objectInfo:h}=Jb(t);for(const p of a){h.index++;const c=e(p,h),b=Nu(c);if(!c)throw new Error("Icon is missing.");if(!c.url)throw new Error("Icon url is missing.");!s[b]&&(!i[b]||c.url!==i[b].url)&&(s[b]={...c,source:p,sourceIndex:h.index})}return s}class I6{constructor(e,{onUpdate:i=ov,onError:s=ov}){U(this,"gl",void 0),U(this,"onUpdate",void 0),U(this,"onError",void 0),U(this,"_loadOptions",null),U(this,"_texture",null),U(this,"_externalTexture",null),U(this,"_mapping",{}),U(this,"_textureParameters",null),U(this,"_pendingCount",0),U(this,"_autoPacking",!1),U(this,"_xOffset",0),U(this,"_yOffset",0),U(this,"_rowHeight",0),U(this,"_buffer",b6),U(this,"_canvasWidth",x6),U(this,"_canvasHeight",0),U(this,"_canvas",null),this.gl=e,this.onUpdate=i,this.onError=s}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const i=this._autoPacking?Nu(e):e;return this._mapping[i]||{}}setProps({loadOptions:e,autoPacking:i,iconAtlas:s,iconMapping:a,textureParameters:h}){if(e&&(this._loadOptions=e),i!==void 0&&(this._autoPacking=i),a&&(this._mapping=a),s){var p;(p=this._texture)===null||p===void 0||p.delete(),this._texture=null,this._externalTexture=s}h&&(this._textureParameters=h)}get isLoaded(){return this._pendingCount===0}packIcons(e,i){if(!this._autoPacking||typeof document>"u")return;const s=Object.values(S6(e,i,this._mapping)||{});if(s.length>0){const{mapping:a,xOffset:h,yOffset:p,rowHeight:c,canvasHeight:b}=A6({icons:s,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=c,this._mapping=a,this._xOffset=h,this._yOffset=p,this._canvasHeight=b,this._texture||(this._texture=new $r(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||av})),this._texture.height!==this._canvasHeight&&(this._texture=T6(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||av)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(s)}}_loadIcons(e){const i=this._canvas.getContext("2d",{willReadFrequently:!0});for(const s of e)this._pendingCount++,Fd(s.url,this._loadOptions).then(a=>{const h=Nu(s),p=this._mapping[h],{x:c,y:b,width:T,height:P}=p,{data:k,width:C,height:H}=E6(i,a,T,P);this._texture.setSubImageData({data:k,x:c+(T-C)/2,y:b+(P-H)/2,width:C,height:H}),p.width=C,p.height=H,this._texture.generateMipmap(),this.onUpdate()}).catch(a=>{this.onError({url:s.url,source:s.source,sourceIndex:s.sourceIndex,loadOptions:this._loadOptions,error:a})}).finally(()=>{this._pendingCount--})}}const uw=[0,0,0,255],P6={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:uw},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class Kg extends Xg{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(){return super.getShaders({vs:y6,fs:v6,modules:[MO,CO]})}initializeState(){this.state={iconManager:new I6(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:uw},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:i,oldProps:s,changeFlags:a}=e,h=this.getAttributeManager(),{iconAtlas:p,iconMapping:c,data:b,getIcon:T,textureParameters:P}=i,{iconManager:k}=this.state,C=p||this.internalState.isAsyncPropLoading("iconAtlas");if(k.setProps({loadOptions:i.loadOptions,autoPacking:!C,iconAtlas:p,iconMapping:C?c:null,textureParameters:P}),C?s.iconMapping!==i.iconMapping&&h.invalidate("getIcon"):(a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getIcon))&&k.packIcons(b,T),a.extensionsChanged){var H;const{gl:ee}=this.context;(H=this.state.model)===null||H===void 0||H.delete(),this.state.model=this._getModel(ee),h.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:i,sizeMinPixels:s,sizeMaxPixels:a,sizeUnits:h,billboard:p,alphaCutoff:c}=this.props,{iconManager:b}=this.state,T=b.getTexture();T&&this.state.model.setUniforms(e).setUniforms({iconsTexture:T,iconsTextureDim:[T.width,T.height],sizeUnits:Mm[h],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:a,billboard:p,alphaCutoff:c}).draw()}_getModel(e){const i=[-1,-1,-1,1,1,1,1,-1];return new Cb(e,{...this.getShaders(),id:this.props.id,geometry:new dz({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(i)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var i;const s=(i=this.getCurrentLayer())===null||i===void 0?void 0:i.props.onIconError;s?s(e):Vi.error(e.error.message)()}getInstanceOffset(e){const{width:i,height:s,anchorX:a=i/2,anchorY:h=s/2}=this.state.iconManager.getIconMapping(e);return[i/2-a,s/2-h]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:i,y:s,width:a,height:h}=this.state.iconManager.getIconMapping(e);return[i,s,a,h]}}U(Kg,"defaultProps",P6);U(Kg,"layerName","IconLayer");var hw={exports:{}};(function(t,e){(function(i,s){t.exports=s()})(d4,function(){var i,s,a;function h(c,b){if(!i)i=b;else if(!s)s=b;else{var T="var sharedChunk = {}; ("+i+")(sharedChunk); ("+s+")(sharedChunk);",P={};i(P),a=b(P),typeof window<"u"&&(a.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}h(["exports"],function(c){var b=T;function T(o,n,l,d){this.cx=3*o,this.bx=3*(l-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=n,this.p2x=l,this.p2y=d}function P(o,n,l,d){const g=new b(o,n,l,d);return function(y){return g.solve(y)}}T.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,n){if(n===void 0&&(n=1e-6),o<0)return 0;if(o>1)return 1;for(var l=o,d=0;d<8;d++){var g=this.sampleCurveX(l)-o;if(Math.abs(g)<n)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=g/y}var x=0,E=1;for(l=o,d=0;d<20&&(g=this.sampleCurveX(l),!(Math.abs(g-o)<n));d++)o>g?x=l:E=l,l=.5*(E-x)+x;return l},solve:function(o,n){return this.sampleCurveY(this.solveCurveX(o,n))}};const k=P(.25,.1,.25,1);function C(o,n,l){return Math.min(l,Math.max(n,o))}function H(o,n,l){const d=l-n,g=((o-n)%d+d)%d+n;return g===n?l:g}function ee(o,...n){for(const l of n)for(const d in l)o[d]=l[d];return o}let se=1;function pe(o,n){o.forEach(l=>{n[l]&&(n[l]=n[l].bind(n))})}function fe(o,n,l){const d={};for(const g in o)d[g]=n.call(l||this,o[g],g,o);return d}function ye(o,n,l){const d={};for(const g in o)n.call(l||this,o[g],g,o)&&(d[g]=o[g]);return d}function Se(o){return Array.isArray(o)?o.map(Se):typeof o=="object"&&o?fe(o,Se):o}const Ue={};function $e(o){Ue[o]||(typeof console<"u"&&console.warn(o),Ue[o]=!0)}function Ye(o,n,l){return(l.y-o.y)*(n.x-o.x)>(n.y-o.y)*(l.x-o.x)}function Qe(o){let n=0;for(let l,d,g=0,y=o.length,x=y-1;g<y;x=g++)l=o[g],d=o[x],n+=(d.x-l.x)*(l.y+d.y);return n}function at(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function wt(o){const n={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,g,y)=>{const x=g||y;return n[d]=!x||x.toLowerCase(),""}),n["max-age"]){const l=parseInt(n["max-age"],10);isNaN(l)?delete n["max-age"]:n["max-age"]=l}return n}let Mt,Lt,ei=null;function gi(o){if(ei==null){const n=o.navigator?o.navigator.userAgent:null;ei=!!o.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return ei}function Ut(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const mi={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(o){const n=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(o,n=0){const l=window.document.createElement("canvas"),d=l.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return l.width=o.width,l.height=o.height,d.drawImage(o,0,0,o.width,o.height),d.getImageData(-n,-n,o.width+2*n,o.height+2*n)},resolveURL:o=>(Mt||(Mt=document.createElement("a")),Mt.href=o,Mt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Lt==null&&(Lt=matchMedia("(prefers-reduced-motion: reduce)")),Lt.matches)}};var pt=li;function li(o,n){this.x=o,this.y=n}li.prototype={clone:function(){return new li(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,n){return this.clone()._rotateAround(o,n)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var n=o.x-this.x,l=o.y-this.y;return n*n+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,n){return Math.atan2(this.x*n-this.y*o,this.x*o+this.y*n)},_matMult:function(o){var n=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=n,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var n=Math.cos(o),l=Math.sin(o),d=l*this.x+n*this.y;return this.x=n*this.x-l*this.y,this.y=d,this},_rotateAround:function(o,n){var l=Math.cos(o),d=Math.sin(o),g=n.y+d*(this.x-n.x)+l*(this.y-n.y);return this.x=n.x+l*(this.x-n.x)-d*(this.y-n.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},li.convert=function(o){return o instanceof li?o:Array.isArray(o)?new li(o[0],o[1]):o};const si={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Bi="mapbox-tiles";let ln,cn,Ri=500,Hn=50;function qn(){typeof caches>"u"||ln||(ln=caches.open(Bi))}let Ne=1/0;const ht={supported:!1,testSupport:function(o){!Et&&yt&&(Wt?Gt(o):We=o)}};let We,yt,Et=!1,Wt=!1;function Gt(o){const n=o.createTexture();o.bindTexture(o.TEXTURE_2D,n);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,yt),o.isContextLost())return;ht.supported=!0}catch{}o.deleteTexture(n),Et=!0}typeof document<"u"&&(yt=document.createElement("img"),yt.onload=function(){We&&Gt(We),We=null,Wt=!0},yt.onerror=function(){Et=!0,We=null},yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const J={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(J);class ce extends Error{constructor(n,l,d,g){super(`AJAXError: ${l} (${n}): ${d}`),this.status=n,this.statusText=l,this.url=d,this.body=g}}const Ce=at()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Re(o,n){const l=new AbortController,d=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Ce(),signal:l.signal});let g=!1,y=!1;return o.type==="json"&&d.headers.set("Accept","application/json"),((x,E,A)=>{if(y)return;const M=Date.now();fetch(d).then(D=>D.ok?((O,N,G)=>{(o.type==="arrayBuffer"?O.arrayBuffer():o.type==="json"?O.json():O.text()).then($=>{y||(N&&G&&function(ne,ie,_e){if(qn(),!ln)return;const Te={status:ie.status,statusText:ie.statusText,headers:new Headers};ie.headers.forEach((we,Oe)=>Te.headers.set(Oe,we));const ge=wt(ie.headers.get("Cache-Control")||"");ge["no-store"]||(ge["max-age"]&&Te.headers.set("Expires",new Date(_e+1e3*ge["max-age"]).toUTCString()),new Date(Te.headers.get("Expires")).getTime()-_e<42e4||function(we,Oe){if(cn===void 0)try{new Response(new ReadableStream),cn=!0}catch{cn=!1}cn?Oe(we.body):we.blob().then(Oe)}(ie,we=>{const Oe=new Response(we,Te);qn(),ln&&ln.then(De=>De.put(function(ft){const xt=ft.indexOf("?");return xt<0?ft:ft.slice(0,xt)}(ne.url),Oe)).catch(De=>$e(De.message))}))}(d,N,G),g=!0,n(null,$,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch($=>{y||n(new Error($.message))})})(D,null,M):D.blob().then(O=>n(new ce(D.status,D.statusText,o.url,O)))).catch(D=>{D.code!==20&&n(new Error(D.message))})})(),{cancel:()=>{y=!0,g||l.abort()}}}const Fe=function(o,n){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){if(at()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,n);if(!at()){const d=o.url.substring(0,o.url.indexOf("://"));return(si.REGISTERED_PROTOCOLS[d]||Re)(o,n)}}if(!(/^file:/.test(l=o.url)||/^file:/.test(Ce())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Re(o,n);if(at()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,n,void 0,!0)}var l;return function(d,g){const y=new XMLHttpRequest;y.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const x in d.headers)y.setRequestHeader(x,d.headers[x]);return d.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=d.credentials==="include",y.onerror=()=>{g(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let x=y.response;if(d.type==="json")try{x=JSON.parse(y.response)}catch(E){return g(E)}g(null,x,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const x=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});g(new ce(y.status,y.statusText,d.url,x))}},y.send(d.body),{cancel:()=>y.abort()}}(o,n)},Ze=function(o,n){return Fe(ee(o,{type:"arrayBuffer"}),n)};function lt(o){const n=window.document.createElement("a");return n.href=o,n.protocol===window.document.location.protocol&&n.host===window.document.location.host}const ze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xe,Ve;Xe=[],Ve=0;const Ct=function(o,n){if(ht.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Ve>=si.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:o,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return Xe.push(y),y}Ve++;let l=!1;const d=()=>{if(!l)for(l=!0,Ve--;Xe.length&&Ve<si.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Xe.shift(),{requestParameters:x,callback:E,cancelled:A}=y;A||(y.cancel=Ct(x,E).cancel)}},g=Ze(o,(y,x,E,A)=>{d(),y?n(y):x&&function(M,D){typeof createImageBitmap=="function"?function(O,N){const G=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(G).then($=>{N(null,$)}).catch($=>{N(new Error(`Could not load image because of ${$.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(M,D):function(O,N){const G=new Image;G.onload=()=>{N(null,G),URL.revokeObjectURL(G.src),G.onload=null,window.requestAnimationFrame(()=>{G.src=ze})},G.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $=new Blob([new Uint8Array(O)],{type:"image/png"});G.src=O.byteLength?URL.createObjectURL($):ze}(M,D)}(x,(M,D)=>{M!=null?n(M):D!=null&&n(null,D,{cacheControl:E,expires:A})})});return{cancel:()=>{g.cancel(),d()}}};function Tt(o,n,l){l[o]&&l[o].indexOf(n)!==-1||(l[o]=l[o]||[],l[o].push(n))}function Pt(o,n,l){if(l&&l[o]){const d=l[o].indexOf(n);d!==-1&&l[o].splice(d,1)}}class Bt{constructor(n,l={}){ee(this,l),this.type=n}}class Zt extends Bt{constructor(n,l={}){super("error",ee({error:n},l))}}class ci{on(n,l){return this._listeners=this._listeners||{},Tt(n,l,this._listeners),this}off(n,l){return Pt(n,l,this._listeners),Pt(n,l,this._oneTimeListeners),this}once(n,l){return this._oneTimeListeners=this._oneTimeListeners||{},Tt(n,l,this._oneTimeListeners),this}fire(n,l){typeof n=="string"&&(n=new Bt(n,l||{}));const d=n.type;if(this.listens(d)){n.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const E of g)E.call(this,n);const y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const E of y)Pt(d,E,this._oneTimeListeners),E.call(this,n);const x=this._eventedParent;x&&(ee(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(n))}else n instanceof Zt&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,l){return this._eventedParent=n,this._eventedParentData=l,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class je{constructor(n,l,d,g){this.message=(n?`${n}: `:"")+d,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function en(o){const n=o.value;return n?[new je(o.key,n,"constants have been deprecated as of v8")]:[]}function Ki(o,...n){for(const l of n)for(const d in l)o[d]=l[d];return o}function Xt(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function fn(o){if(Array.isArray(o))return o.map(fn);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const n={};for(const l in o)n[l]=fn(o[l]);return n}return Xt(o)}class An extends Error{constructor(n,l){super(l),this.message=l,this.key=n}}class Pi{constructor(n,l=[]){this.parent=n,this.bindings={};for(const[d,g]of l)this.bindings[d]=g}concat(n){return new Pi(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const un={kind:"null"},Ke={kind:"number"},Ht={kind:"string"},$t={kind:"boolean"},xn={kind:"color"},Ir={kind:"object"},jt={kind:"value"},or={kind:"collator"},pn={kind:"formatted"},ys={kind:"padding"},tn={kind:"resolvedImage"};function Sn(o,n){return{kind:"array",itemType:o,N:n}}function wi(o){if(o.kind==="array"){const n=wi(o.itemType);return typeof o.N=="number"?`array<${n}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${n}>`}return o.kind}const vs=[un,Ke,Ht,$t,xn,pn,Ir,Sn(jt),ys,tn];function xr(o,n){if(n.kind==="error")return null;if(o.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!xr(o.itemType,n.itemType))&&(typeof o.N!="number"||o.N===n.N))return null}else{if(o.kind===n.kind)return null;if(o.kind==="value"){for(const l of vs)if(!xr(l,n))return null}}return`Expected ${wi(o)} but found ${wi(n)} instead.`}function br(o,n){return n.some(l=>l.kind===o.kind)}function ts(o,n){return n.some(l=>l==="null"?o===null:l==="array"?Array.isArray(o):l==="object"?o&&!Array.isArray(o)&&typeof o=="object":l===typeof o)}var xs,Hr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function X(o){return(o=Math.round(o))<0?0:o>255?255:o}function R(o){return X(o[o.length-1]==="%"?parseFloat(o)/100*255:parseInt(o))}function F(o){return(n=o[o.length-1]==="%"?parseFloat(o)/100:parseFloat(o))<0?0:n>1?1:n;var n}function q(o,n,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?o+(n-o)*l*6:2*l<1?n:3*l<2?o+(n-o)*(2/3-l)*6:o}try{xs={}.parseCSSColor=function(o){var n,l=o.replace(/ /g,"").toLowerCase();if(l in Hr)return Hr[l].slice();if(l[0]==="#")return l.length===4?(n=parseInt(l.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:l.length===7&&(n=parseInt(l.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var d=l.indexOf("("),g=l.indexOf(")");if(d!==-1&&g+1===l.length){var y=l.substr(0,d),x=l.substr(d+1,g-(d+1)).split(","),E=1;switch(y){case"rgba":if(x.length!==4)return null;E=F(x.pop());case"rgb":return x.length!==3?null:[R(x[0]),R(x[1]),R(x[2]),E];case"hsla":if(x.length!==4)return null;E=F(x.pop());case"hsl":if(x.length!==3)return null;var A=(parseFloat(x[0])%360+360)%360/360,M=F(x[1]),D=F(x[2]),O=D<=.5?D*(M+1):D+M-D*M,N=2*D-O;return[X(255*q(N,O,A+1/3)),X(255*q(N,O,A)),X(255*q(N,O,A-1/3)),E];default:return null}}return null}}catch{}class W{constructor(n,l,d,g=1){this.r=n,this.g=l,this.b=d,this.a=g}static parse(n){if(!n)return;if(n instanceof W)return n;if(typeof n!="string")return;const l=xs(n);return l?new W(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[n,l,d,g]=this.toArray();return`rgba(${Math.round(n)},${Math.round(l)},${Math.round(d)},${g})`}toArray(){const{r:n,g:l,b:d,a:g}=this;return g===0?[0,0,0,0]:[255*n/g,255*l/g,255*d/g,g]}}W.black=new W(0,0,0,1),W.white=new W(1,1,1,1),W.transparent=new W(0,0,0,0),W.red=new W(1,0,0,1);class oe{constructor(n,l,d){this.sensitivity=n?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,l){return this.collator.compare(n,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class he{constructor(n,l,d,g,y){this.text=n,this.image=l,this.scale=d,this.fontStack=g,this.textColor=y}}class le{constructor(n){this.sections=n}static fromString(n){return new le([new he(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof le?n:le.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class re{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof re)return n;if(typeof n=="number")return new re([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const l of n)if(typeof l!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new re(n)}}toString(){return JSON.stringify(this.values)}}class de{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new de({name:n,available:!1}):null}}function Pe(o,n,l,d){return typeof o=="number"&&o>=0&&o<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[o,n,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[o,n,l,d]:[o,n,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Be(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof W||o instanceof oe||o instanceof le||o instanceof re||o instanceof de)return!0;if(Array.isArray(o)){for(const n of o)if(!Be(n))return!1;return!0}if(typeof o=="object"){for(const n in o)if(!Be(o[n]))return!1;return!0}return!1}function Ie(o){if(o===null)return un;if(typeof o=="string")return Ht;if(typeof o=="boolean")return $t;if(typeof o=="number")return Ke;if(o instanceof W)return xn;if(o instanceof oe)return or;if(o instanceof le)return pn;if(o instanceof re)return ys;if(o instanceof de)return tn;if(Array.isArray(o)){const n=o.length;let l;for(const d of o){const g=Ie(d);if(l){if(l===g)continue;l=jt;break}l=g}return Sn(l||jt,n)}return Ir}function mt(o){const n=typeof o;return o===null?"":n==="string"||n==="number"||n==="boolean"?String(o):o instanceof W||o instanceof le||o instanceof re||o instanceof de?o.toString():JSON.stringify(o)}class vt{constructor(n,l){this.type=n,this.value=l}static parse(n,l){if(n.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Be(n[1]))return l.error("invalid value");const d=n[1];let g=Ie(d);const y=l.expectedType;return g.kind!=="array"||g.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(g=y),new vt(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class nt{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const kt={string:Ht,number:Ke,boolean:$t,object:Ir};class St{constructor(n,l){this.type=n,this.args=l}static parse(n,l){if(n.length<2)return l.error("Expected at least one argument.");let d,g=1;const y=n[0];if(y==="array"){let E,A;if(n.length>2){const M=n[1];if(typeof M!="string"||!(M in kt)||M==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);E=kt[M],g++}else E=jt;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return l.error('The length argument to "array" must be a positive integer literal',2);A=n[2],g++}d=Sn(E,A)}else{if(!kt[y])throw new Error(`Types doesn't contain name = ${y}`);d=kt[y]}const x=[];for(;g<n.length;g++){const E=l.parse(n[g],g,jt);if(!E)return null;x.push(E)}return new St(d,x)}evaluate(n){for(let l=0;l<this.args.length;l++){const d=this.args[l].evaluate(n);if(!xr(this.type,Ie(d)))return d;if(l===this.args.length-1)throw new nt(`Expected value to be of type ${wi(this.type)}, but found ${wi(Ie(d))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Yt={"to-boolean":$t,"to-color":xn,"to-number":Ke,"to-string":Ht};class Ot{constructor(n,l){this.type=n,this.args=l}static parse(n,l){if(n.length<2)return l.error("Expected at least one argument.");const d=n[0];if(!Yt[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&n.length!==2)return l.error("Expected one argument.");const g=Yt[d],y=[];for(let x=1;x<n.length;x++){const E=l.parse(n[x],x,jt);if(!E)return null;y.push(E)}return new Ot(g,y)}evaluate(n){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(n));if(this.type.kind==="color"){let l,d;for(const g of this.args){if(l=g.evaluate(n),d=null,l instanceof W)return l;if(typeof l=="string"){const y=n.parseColor(l);if(y)return y}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Pe(l[0],l[1],l[2],l[3]),!d))return new W(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new nt(d||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}if(this.type.kind==="padding"){let l;for(const d of this.args){l=d.evaluate(n);const g=re.parse(l);if(g)return g}throw new nt(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}if(this.type.kind==="number"){let l=null;for(const d of this.args){if(l=d.evaluate(n),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new nt(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?le.fromString(mt(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?de.fromString(mt(this.args[0].evaluate(n))):mt(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Vt=["Unknown","Point","LineString","Polygon"];class ti{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Vt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let l=this._parseColorCache[n];return l||(l=this._parseColorCache[n]=W.parse(n)),l}}class oi{constructor(n,l,d,g){this.name=n,this.type=l,this._evaluate=d,this.args=g}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,l){const d=n[0],g=oi.definitions[d];if(!g)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,E=x.filter(([M])=>!Array.isArray(M)||M.length===n.length-1);let A=null;for(const[M,D]of E){A=new He(l.registry,l.path,null,l.scope);const O=[];let N=!1;for(let G=1;G<n.length;G++){const $=n[G],ne=Array.isArray(M)?M[G-1]:M.type,ie=A.parse($,1+O.length,ne);if(!ie){N=!0;break}O.push(ie)}if(!N)if(Array.isArray(M)&&M.length!==O.length)A.error(`Expected ${M.length} arguments, but found ${O.length} instead.`);else{for(let G=0;G<O.length;G++){const $=Array.isArray(M)?M[G]:M.type,ne=O[G];A.concat(G+1).checkSubtype($,ne.type)}if(A.errors.length===0)return new oi(d,y,D,O)}}if(E.length===1)l.errors.push(...A.errors);else{const M=(E.length?E:x).map(([O])=>{return N=O,Array.isArray(N)?`(${N.map(wi).join(", ")})`:`(${wi(N.type)}...)`;var N}).join(" | "),D=[];for(let O=1;O<n.length;O++){const N=l.parse(n[O],1+D.length);if(!N)return null;D.push(wi(N.type))}l.error(`Expected arguments of type ${M}, but found (${D.join(", ")}) instead.`)}return null}static register(n,l){oi.definitions=l;for(const d in l)n[d]=oi}}class Ci{constructor(n,l,d){this.type=or,this.locale=d,this.caseSensitive=n,this.diacriticSensitive=l}static parse(n,l){if(n.length!==2)return l.error("Expected one argument.");const d=n[1];if(typeof d!="object"||Array.isArray(d))return l.error("Collator options argument must be an object.");const g=l.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,$t);if(!g)return null;const y=l.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,$t);if(!y)return null;let x=null;return d.locale&&(x=l.parse(d.locale,1,Ht),!x)?null:new Ci(g,y,x)}evaluate(n){return new oe(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}const Li=8192;function bn(o,n){o[0]=Math.min(o[0],n[0]),o[1]=Math.min(o[1],n[1]),o[2]=Math.max(o[2],n[0]),o[3]=Math.max(o[3],n[1])}function Pr(o,n){return!(o[0]<=n[0]||o[2]>=n[2]||o[1]<=n[1]||o[3]>=n[3])}function Dn(o,n){const l=(180+o[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,g=Math.pow(2,n.z);return[Math.round(l*g*Li),Math.round(d*g*Li)]}function _i(o,n,l){const d=o[0]-n[0],g=o[1]-n[1],y=o[0]-l[0],x=o[1]-l[1];return d*x-y*g==0&&d*y<=0&&g*x<=0}function $s(o,n){let l=!1;for(let x=0,E=n.length;x<E;x++){const A=n[x];for(let M=0,D=A.length;M<D-1;M++){if(_i(o,A[M],A[M+1]))return!1;(g=A[M])[1]>(d=o)[1]!=(y=A[M+1])[1]>d[1]&&d[0]<(y[0]-g[0])*(d[1]-g[1])/(y[1]-g[1])+g[0]&&(l=!l)}}var d,g,y;return l}function Hs(o,n){for(let l=0;l<n.length;l++)if($s(o,n[l]))return!0;return!1}function vo(o,n,l,d){const g=d[0]-l[0],y=d[1]-l[1],x=(o[0]-l[0])*y-g*(o[1]-l[1]),E=(n[0]-l[0])*y-g*(n[1]-l[1]);return x>0&&E<0||x<0&&E>0}function xo(o,n,l){for(const M of l)for(let D=0;D<M.length-1;++D)if((E=[(x=M[D+1])[0]-(y=M[D])[0],x[1]-y[1]])[0]*(A=[(g=n)[0]-(d=o)[0],g[1]-d[1]])[1]-E[1]*A[0]!=0&&vo(d,g,y,x)&&vo(y,x,d,g))return!0;var d,g,y,x,E,A;return!1}function bs(o,n){for(let l=0;l<o.length;++l)if(!$s(o[l],n))return!1;for(let l=0;l<o.length-1;++l)if(xo(o[l],o[l+1],n))return!1;return!0}function Mr(o,n){for(let l=0;l<n.length;l++)if(bs(o,n[l]))return!0;return!1}function bo(o,n,l){const d=[];for(let g=0;g<o.length;g++){const y=[];for(let x=0;x<o[g].length;x++){const E=Dn(o[g][x],l);bn(n,E),y.push(E)}d.push(y)}return d}function wo(o,n,l){const d=[];for(let g=0;g<o.length;g++){const y=bo(o[g],n,l);d.push(y)}return d}function Eo(o,n,l,d){if(o[0]<l[0]||o[0]>l[2]){const g=.5*d;let y=o[0]-l[0]>g?-d:l[0]-o[0]>g?d:0;y===0&&(y=o[0]-l[2]>g?-d:l[2]-o[0]>g?d:0),o[0]+=y}bn(n,o)}function na(o,n,l,d){const g=Math.pow(2,d.z)*Li,y=[d.x*Li,d.y*Li],x=[];for(const E of o)for(const A of E){const M=[A.x+y[0],A.y+y[1]];Eo(M,n,l,g),x.push(M)}return x}function Xa(o,n,l,d){const g=Math.pow(2,d.z)*Li,y=[d.x*Li,d.y*Li],x=[];for(const A of o){const M=[];for(const D of A){const O=[D.x+y[0],D.y+y[1]];bn(n,O),M.push(O)}x.push(M)}if(n[2]-n[0]<=g/2){(E=n)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const A of x)for(const M of A)Eo(M,n,l,g)}var E;return x}class is{constructor(n,l){this.type=$t,this.geojson=n,this.geometries=l}static parse(n,l){if(n.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Be(n[1])){const d=n[1];if(d.type==="FeatureCollection")for(let g=0;g<d.features.length;++g){const y=d.features[g].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new is(d,d.features[g].geometry)}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new is(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new is(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(l,d){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(d.type==="Polygon"){const E=bo(d.coordinates,y,x),A=na(l.geometry(),g,y,x);if(!Pr(g,y))return!1;for(const M of A)if(!$s(M,E))return!1}if(d.type==="MultiPolygon"){const E=wo(d.coordinates,y,x),A=na(l.geometry(),g,y,x);if(!Pr(g,y))return!1;for(const M of A)if(!Hs(M,E))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(l,d){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(d.type==="Polygon"){const E=bo(d.coordinates,y,x),A=Xa(l.geometry(),g,y,x);if(!Pr(g,y))return!1;for(const M of A)if(!bs(M,E))return!1}if(d.type==="MultiPolygon"){const E=wo(d.coordinates,y,x),A=Xa(l.geometry(),g,y,x);if(!Pr(g,y))return!1;for(const M of A)if(!Mr(M,E))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function j(o){if(o instanceof oi&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof is)return!1;let n=!0;return o.eachChild(l=>{n&&!j(l)&&(n=!1)}),n}function Z(o){if(o instanceof oi&&o.name==="feature-state")return!1;let n=!0;return o.eachChild(l=>{n&&!Z(l)&&(n=!1)}),n}function ae(o,n){if(o instanceof oi&&n.indexOf(o.name)>=0)return!1;let l=!0;return o.eachChild(d=>{l&&!ae(d,n)&&(l=!1)}),l}class Ae{constructor(n,l){this.type=l.type,this.name=n,this.boundExpression=l}static parse(n,l){if(n.length!==2||typeof n[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const d=n[1];return l.scope.has(d)?new Ae(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class He{constructor(n,l=[],d,g=new Pi,y=[]){this.registry=n,this.path=l,this.key=l.map(x=>`[${x}]`).join(""),this.scope=g,this.errors=y,this.expectedType=d}parse(n,l,d,g,y={}){return l?this.concat(l,d,g)._parse(n,y):this._parse(n,y)}_parse(n,l){function d(g,y,x){return x==="assert"?new St(y,[g]):x==="coerce"?new Ot(y,[g]):g}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=n[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[g];if(y){let x=y.parse(n,this);if(!x)return null;if(this.expectedType){const E=this.expectedType,A=x.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||A.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string")if(E.kind!=="padding"||A.kind!=="value"&&A.kind!=="number"&&A.kind!=="array"){if(this.checkSubtype(E,A))return null}else x=d(x,E,l.typeAnnotation||"coerce");else x=d(x,E,l.typeAnnotation||"coerce");else x=d(x,E,l.typeAnnotation||"assert")}if(!(x instanceof vt)&&x.type.kind!=="resolvedImage"&&_t(x)){const E=new ti;try{x=new vt(x.type,x.evaluate(E))}catch(A){return this.error(A.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,l,d){const g=typeof n=="number"?this.path.concat(n):this.path,y=d?this.scope.concat(d):this.scope;return new He(this.registry,g,l||null,y,this.errors)}error(n,...l){const d=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new An(d,n))}checkSubtype(n,l){const d=xr(n,l);return d&&this.error(d),d}}function _t(o){if(o instanceof Ae)return _t(o.boundExpression);if(o instanceof oi&&o.name==="error"||o instanceof Ci||o instanceof is)return!1;const n=o instanceof Ot||o instanceof St;let l=!0;return o.eachChild(d=>{l=n?l&&_t(d):l&&d instanceof vt}),!!l&&j(o)&&ae(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ii(o,n){const l=o.length-1;let d,g,y=0,x=l,E=0;for(;y<=x;)if(E=Math.floor((y+x)/2),d=o[E],g=o[E+1],d<=n){if(E===l||n<g)return E;y=E+1}else{if(!(d>n))throw new nt("Input is not a number.");x=E-1}return 0}class Wi{constructor(n,l,d){this.type=n,this.input=l,this.labels=[],this.outputs=[];for(const[g,y]of d)this.labels.push(g),this.outputs.push(y)}static parse(n,l){if(n.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return l.error("Expected an even number of arguments.");const d=l.parse(n[1],1,Ke);if(!d)return null;const g=[];let y=null;l.expectedType&&l.expectedType.kind!=="value"&&(y=l.expectedType);for(let x=1;x<n.length;x+=2){const E=x===1?-1/0:n[x],A=n[x+1],M=x,D=x+1;if(typeof E!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(g.length&&g[g.length-1][0]>=E)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const O=l.parse(A,D,y);if(!O)return null;y=y||O.type,g.push([E,O])}return new Wi(y,d,g)}evaluate(n){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(n);const g=this.input.evaluate(n);if(g<=l[0])return d[0].evaluate(n);const y=l.length;return g>=l[y-1]?d[y-1].evaluate(n):d[ii(l,g)].evaluate(n)}eachChild(n){n(this.input);for(const l of this.outputs)n(l)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Kt(o,n,l){return o*(1-l)+n*l}var hn=Object.freeze({__proto__:null,number:Kt,color:function(o,n,l){return new W(Kt(o.r,n.r,l),Kt(o.g,n.g,l),Kt(o.b,n.b,l),Kt(o.a,n.a,l))},array:function(o,n,l){return o.map((d,g)=>Kt(d,n[g],l))},padding:function(o,n,l){const d=o.values,g=n.values;return new re([Kt(d[0],g[0],l),Kt(d[1],g[1],l),Kt(d[2],g[2],l),Kt(d[3],g[3],l)])}});const ar=.95047,Ku=1.08883,uc=4/29,Ya=6/29,Ju=3*Ya*Ya,pf=Math.PI/180,mf=180/Math.PI;function hc(o){return o>.008856451679035631?Math.pow(o,1/3):o/Ju+uc}function dc(o){return o>Ya?o*o*o:Ju*(o-uc)}function fc(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function pc(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function vi(o){const n=pc(o.r),l=pc(o.g),d=pc(o.b),g=hc((.4124564*n+.3575761*l+.1804375*d)/ar),y=hc((.2126729*n+.7151522*l+.072175*d)/1);return{l:116*y-16,a:500*(g-y),b:200*(y-hc((.0193339*n+.119192*l+.9503041*d)/Ku)),alpha:o.a}}function Qu(o){let n=(o.l+16)/116,l=isNaN(o.a)?n:n+o.a/500,d=isNaN(o.b)?n:n-o.b/200;return n=1*dc(n),l=ar*dc(l),d=Ku*dc(d),new W(fc(3.2404542*l-1.5371385*n-.4985314*d),fc(-.969266*l+1.8760108*n+.041556*d),fc(.0556434*l-.2040259*n+1.0572252*d),o.alpha)}function gf(o,n,l){const d=n-o;return o+l*(d>180||d<-180?d-360*Math.round(d/360):d)}const ra={forward:vi,reverse:Qu,interpolate:function(o,n,l){return{l:Kt(o.l,n.l,l),a:Kt(o.a,n.a,l),b:Kt(o.b,n.b,l),alpha:Kt(o.alpha,n.alpha,l)}}},sa={forward:function(o){const{l:n,a:l,b:d}=vi(o),g=Math.atan2(d,l)*mf;return{h:g<0?g+360:g,c:Math.sqrt(l*l+d*d),l:n,alpha:o.a}},reverse:function(o){const n=o.h*pf,l=o.c;return Qu({l:o.l,a:Math.cos(n)*l,b:Math.sin(n)*l,alpha:o.alpha})},interpolate:function(o,n,l){return{h:gf(o.h,n.h,l),c:Kt(o.c,n.c,l),l:Kt(o.l,n.l,l),alpha:Kt(o.alpha,n.alpha,l)}}};var eh=Object.freeze({__proto__:null,lab:ra,hcl:sa});class lr{constructor(n,l,d,g,y){this.type=n,this.operator=l,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[x,E]of y)this.labels.push(x),this.outputs.push(E)}static interpolationFactor(n,l,d,g){let y=0;if(n.name==="exponential")y=mc(l,n.base,d,g);else if(n.name==="linear")y=mc(l,1,d,g);else if(n.name==="cubic-bezier"){const x=n.controlPoints;y=new b(x[0],x[1],x[2],x[3]).solve(mc(l,1,d,g))}return y}static parse(n,l){let[d,g,y,...x]=n;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const M=g[1];if(typeof M!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:M}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const M=g.slice(1);if(M.length!==4||M.some(D=>typeof D!="number"||D<0||D>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:M}}}if(n.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(y=l.parse(y,2,Ke),!y)return null;const E=[];let A=null;d==="interpolate-hcl"||d==="interpolate-lab"?A=xn:l.expectedType&&l.expectedType.kind!=="value"&&(A=l.expectedType);for(let M=0;M<x.length;M+=2){const D=x[M],O=x[M+1],N=M+3,G=M+4;if(typeof D!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(E.length&&E[E.length-1][0]>=D)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const $=l.parse(O,G,A);if(!$)return null;A=A||$.type,E.push([D,$])}return A.kind==="number"||A.kind==="color"||A.kind==="padding"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new lr(A,d,g,y,E):l.error(`Type ${wi(A)} is not interpolatable.`)}evaluate(n){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(n);const g=this.input.evaluate(n);if(g<=l[0])return d[0].evaluate(n);const y=l.length;if(g>=l[y-1])return d[y-1].evaluate(n);const x=ii(l,g),E=lr.interpolationFactor(this.interpolation,g,l[x],l[x+1]),A=d[x].evaluate(n),M=d[x+1].evaluate(n);return this.operator==="interpolate"?hn[this.type.kind.toLowerCase()](A,M,E):this.operator==="interpolate-hcl"?sa.reverse(sa.interpolate(sa.forward(A),sa.forward(M),E)):ra.reverse(ra.interpolate(ra.forward(A),ra.forward(M),E))}eachChild(n){n(this.input);for(const l of this.outputs)n(l)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function mc(o,n,l,d){const g=d-l,y=o-l;return g===0?0:n===1?y/g:(Math.pow(n,y)-1)/(Math.pow(n,g)-1)}class Ka{constructor(n,l){this.type=n,this.args=l}static parse(n,l){if(n.length<2)return l.error("Expectected at least one argument.");let d=null;const g=l.expectedType;g&&g.kind!=="value"&&(d=g);const y=[];for(const E of n.slice(1)){const A=l.parse(E,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!A)return null;d=d||A.type,y.push(A)}if(!d)throw new Error("No output type");const x=g&&y.some(E=>xr(g,E.type));return new Ka(x?jt:d,y)}evaluate(n){let l,d=null,g=0;for(const y of this.args)if(g++,d=y.evaluate(n),d&&d instanceof de&&!d.available&&(l||(l=d.name),d=null,g===this.args.length&&(d=l)),d!==null)break;return d}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}class Ja{constructor(n,l){this.type=l.type,this.bindings=[].concat(n),this.result=l}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const l of this.bindings)n(l[1]);n(this.result)}static parse(n,l){if(n.length<4)return l.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const d=[];for(let y=1;y<n.length-1;y+=2){const x=n[y];if(typeof x!="string")return l.error(`Expected string, but found ${typeof x} instead.`,y);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",y);const E=l.parse(n[y+1],y+1);if(!E)return null;d.push([x,E])}const g=l.parse(n[n.length-1],n.length-1,l.expectedType,d);return g?new Ja(d,g):null}outputDefined(){return this.result.outputDefined()}}class gc{constructor(n,l,d){this.type=n,this.index=l,this.input=d}static parse(n,l){if(n.length!==3)return l.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=l.parse(n[1],1,Ke),g=l.parse(n[2],2,Sn(l.expectedType||jt));return d&&g?new gc(g.type.itemType,d,g):null}evaluate(n){const l=this.index.evaluate(n),d=this.input.evaluate(n);if(l<0)throw new nt(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new nt(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new nt(`Array index must be an integer, but found ${l} instead.`);return d[l]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class _c{constructor(n,l){this.type=$t,this.needle=n,this.haystack=l}static parse(n,l){if(n.length!==3)return l.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=l.parse(n[1],1,jt),g=l.parse(n[2],2,jt);return d&&g?br(d.type,[$t,Ht,Ke,un,jt])?new _c(d,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${wi(d.type)} instead`):null}evaluate(n){const l=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!d)return!1;if(!ts(l,["boolean","string","number","null"]))throw new nt(`Expected first argument to be of type boolean, string, number or null, but found ${wi(Ie(l))} instead.`);if(!ts(d,["string","array"]))throw new nt(`Expected second argument to be of type array or string, but found ${wi(Ie(d))} instead.`);return d.indexOf(l)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class Qa{constructor(n,l,d){this.type=Ke,this.needle=n,this.haystack=l,this.fromIndex=d}static parse(n,l){if(n.length<=2||n.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const d=l.parse(n[1],1,jt),g=l.parse(n[2],2,jt);if(!d||!g)return null;if(!br(d.type,[$t,Ht,Ke,un,jt]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${wi(d.type)} instead`);if(n.length===4){const y=l.parse(n[3],3,Ke);return y?new Qa(d,g,y):null}return new Qa(d,g)}evaluate(n){const l=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!ts(l,["boolean","string","number","null"]))throw new nt(`Expected first argument to be of type boolean, string, number or null, but found ${wi(Ie(l))} instead.`);if(!ts(d,["string","array"]))throw new nt(`Expected second argument to be of type array or string, but found ${wi(Ie(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(n);return d.indexOf(l,g)}return d.indexOf(l)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class yc{constructor(n,l,d,g,y,x){this.inputType=n,this.type=l,this.input=d,this.cases=g,this.outputs=y,this.otherwise=x}static parse(n,l){if(n.length<5)return l.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return l.error("Expected an even number of arguments.");let d,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const y={},x=[];for(let M=2;M<n.length-1;M+=2){let D=n[M];const O=n[M+1];Array.isArray(D)||(D=[D]);const N=l.concat(M);if(D.length===0)return N.error("Expected at least one branch label.");for(const $ of D){if(typeof $!="number"&&typeof $!="string")return N.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return N.error("Numeric branch labels must be integer values.");if(d){if(N.checkSubtype(d,Ie($)))return null}else d=Ie($);if(y[String($)]!==void 0)return N.error("Branch labels must be unique.");y[String($)]=x.length}const G=l.parse(O,M,g);if(!G)return null;g=g||G.type,x.push(G)}const E=l.parse(n[1],1,jt);if(!E)return null;const A=l.parse(n[n.length-1],n.length-1,g);return A?E.type.kind!=="value"&&l.concat(1).checkSubtype(d,E.type)?null:new yc(d,g,E,y,x,A):null}evaluate(n){const l=this.input.evaluate(n);return(Ie(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class vc{constructor(n,l,d){this.type=n,this.branches=l,this.otherwise=d}static parse(n,l){if(n.length<4)return l.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&l.expectedType.kind!=="value"&&(d=l.expectedType);const g=[];for(let x=1;x<n.length-1;x+=2){const E=l.parse(n[x],x,$t);if(!E)return null;const A=l.parse(n[x+1],x+1,d);if(!A)return null;g.push([E,A]),d=d||A.type}const y=l.parse(n[n.length-1],n.length-1,d);if(!y)return null;if(!d)throw new Error("Can't infer output type");return new vc(d,g,y)}evaluate(n){for(const[l,d]of this.branches)if(l.evaluate(n))return d.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[l,d]of this.branches)n(l),n(d);n(this.otherwise)}outputDefined(){return this.branches.every(([n,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class el{constructor(n,l,d,g){this.type=n,this.input=l,this.beginIndex=d,this.endIndex=g}static parse(n,l){if(n.length<=2||n.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const d=l.parse(n[1],1,jt),g=l.parse(n[2],2,Ke);if(!d||!g)return null;if(!br(d.type,[Sn(jt),Ht,jt]))return l.error(`Expected first argument to be of type array or string, but found ${wi(d.type)} instead`);if(n.length===4){const y=l.parse(n[3],3,Ke);return y?new el(d.type,d,g,y):null}return new el(d.type,d,g)}evaluate(n){const l=this.input.evaluate(n),d=this.beginIndex.evaluate(n);if(!ts(l,["string","array"]))throw new nt(`Expected first argument to be of type array or string, but found ${wi(Ie(l))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(n);return l.slice(d,g)}return l.slice(d)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function th(o,n){return o==="=="||o==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function ih(o,n,l,d){return d.compare(n,l)===0}function To(o,n,l){const d=o!=="=="&&o!=="!=";return class dw{constructor(y,x,E){this.type=$t,this.lhs=y,this.rhs=x,this.collator=E,this.hasUntypedArgument=y.type.kind==="value"||x.type.kind==="value"}static parse(y,x){if(y.length!==3&&y.length!==4)return x.error("Expected two or three arguments.");const E=y[0];let A=x.parse(y[1],1,jt);if(!A)return null;if(!th(E,A.type))return x.concat(1).error(`"${E}" comparisons are not supported for type '${wi(A.type)}'.`);let M=x.parse(y[2],2,jt);if(!M)return null;if(!th(E,M.type))return x.concat(2).error(`"${E}" comparisons are not supported for type '${wi(M.type)}'.`);if(A.type.kind!==M.type.kind&&A.type.kind!=="value"&&M.type.kind!=="value")return x.error(`Cannot compare types '${wi(A.type)}' and '${wi(M.type)}'.`);d&&(A.type.kind==="value"&&M.type.kind!=="value"?A=new St(M.type,[A]):A.type.kind!=="value"&&M.type.kind==="value"&&(M=new St(A.type,[M])));let D=null;if(y.length===4){if(A.type.kind!=="string"&&M.type.kind!=="string"&&A.type.kind!=="value"&&M.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(D=x.parse(y[3],3,or),!D)return null}return new dw(A,M,D)}evaluate(y){const x=this.lhs.evaluate(y),E=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const A=Ie(x),M=Ie(E);if(A.kind!==M.kind||A.kind!=="string"&&A.kind!=="number")throw new nt(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${A.kind}, ${M.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const A=Ie(x),M=Ie(E);if(A.kind!=="string"||M.kind!=="string")return n(y,x,E)}return this.collator?l(y,x,E,this.collator.evaluate(y)):n(y,x,E)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const _f=To("==",function(o,n,l){return n===l},ih),yf=To("!=",function(o,n,l){return n!==l},function(o,n,l,d){return!ih(0,n,l,d)}),vf=To("<",function(o,n,l){return n<l},function(o,n,l,d){return d.compare(n,l)<0}),xf=To(">",function(o,n,l){return n>l},function(o,n,l,d){return d.compare(n,l)>0}),bf=To("<=",function(o,n,l){return n<=l},function(o,n,l,d){return d.compare(n,l)<=0}),wf=To(">=",function(o,n,l){return n>=l},function(o,n,l,d){return d.compare(n,l)>=0});class xc{constructor(n,l,d,g,y){this.type=Ht,this.number=n,this.locale=l,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(n,l){if(n.length!==3)return l.error("Expected two arguments.");const d=l.parse(n[1],1,Ke);if(!d)return null;const g=n[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let y=null;if(g.locale&&(y=l.parse(g.locale,1,Ht),!y))return null;let x=null;if(g.currency&&(x=l.parse(g.currency,1,Ht),!x))return null;let E=null;if(g["min-fraction-digits"]&&(E=l.parse(g["min-fraction-digits"],1,Ke),!E))return null;let A=null;return g["max-fraction-digits"]&&(A=l.parse(g["max-fraction-digits"],1,Ke),!A)?null:new xc(d,y,x,E,A)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class tl{constructor(n){this.type=pn,this.sections=n}static parse(n,l){if(n.length<2)return l.error("Expected at least one argument.");const d=n[1];if(!Array.isArray(d)&&typeof d=="object")return l.error("First argument must be an image or text section.");const g=[];let y=!1;for(let x=1;x<=n.length-1;++x){const E=n[x];if(y&&typeof E=="object"&&!Array.isArray(E)){y=!1;let A=null;if(E["font-scale"]&&(A=l.parse(E["font-scale"],1,Ke),!A))return null;let M=null;if(E["text-font"]&&(M=l.parse(E["text-font"],1,Sn(Ht)),!M))return null;let D=null;if(E["text-color"]&&(D=l.parse(E["text-color"],1,xn),!D))return null;const O=g[g.length-1];O.scale=A,O.font=M,O.textColor=D}else{const A=l.parse(n[x],1,jt);if(!A)return null;const M=A.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,g.push({content:A,scale:null,font:null,textColor:null})}}return new tl(g)}evaluate(n){return new le(this.sections.map(l=>{const d=l.content.evaluate(n);return Ie(d)===tn?new he("",d,null,null,null):new he(mt(d),null,l.scale?l.scale.evaluate(n):null,l.font?l.font.evaluate(n).join(","):null,l.textColor?l.textColor.evaluate(n):null)}))}eachChild(n){for(const l of this.sections)n(l.content),l.scale&&n(l.scale),l.font&&n(l.font),l.textColor&&n(l.textColor)}outputDefined(){return!1}}class bc{constructor(n){this.type=tn,this.input=n}static parse(n,l){if(n.length!==2)return l.error("Expected two arguments.");const d=l.parse(n[1],1,Ht);return d?new bc(d):l.error("No image name provided.")}evaluate(n){const l=this.input.evaluate(n),d=de.fromString(l);return d&&n.availableImages&&(d.available=n.availableImages.indexOf(l)>-1),d}eachChild(n){n(this.input)}outputDefined(){return!1}}class wc{constructor(n){this.type=Ke,this.input=n}static parse(n,l){if(n.length!==2)return l.error(`Expected 1 argument, but found ${n.length-1} instead.`);const d=l.parse(n[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${wi(d.type)} instead.`):new wc(d):null}evaluate(n){const l=this.input.evaluate(n);if(typeof l=="string"||Array.isArray(l))return l.length;throw new nt(`Expected value to be of type string or array, but found ${wi(Ie(l))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const Ao={"==":_f,"!=":yf,">":xf,"<":vf,">=":wf,"<=":bf,array:St,at:gc,boolean:St,case:vc,coalesce:Ka,collator:Ci,format:tl,image:bc,in:_c,"index-of":Qa,interpolate:lr,"interpolate-hcl":lr,"interpolate-lab":lr,length:wc,let:Ja,literal:vt,match:yc,number:St,"number-format":xc,object:St,slice:el,step:Wi,string:St,"to-boolean":Ot,"to-color":Ot,"to-number":Ot,"to-string":Ot,var:Ae,within:is};function nh(o,[n,l,d,g]){n=n.evaluate(o),l=l.evaluate(o),d=d.evaluate(o);const y=g?g.evaluate(o):1,x=Pe(n,l,d,y);if(x)throw new nt(x);return new W(n/255*y,l/255*y,d/255*y,y)}function rh(o,n){return o in n}function il(o,n){const l=n[o];return l===void 0?null:l}function qs(o){return{type:o}}function sh(o){return{result:"success",value:o}}function So(o){return{result:"error",value:o}}function Ni(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function oh(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function ui(o){return!!o.expression&&o.expression.interpolated}function xi(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Di(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function ji(o){return o}function oa(o,n){const l=n.type==="color",d=o.stops&&typeof o.stops[0][0]=="object",g=d||!(d||o.property!==void 0),y=o.type||(ui(n)?"exponential":"interval");if(l||n.type==="padding"){const M=l?W.parse:re.parse;(o=Ki({},o)).stops&&(o.stops=o.stops.map(D=>[D[0],M(D[1])])),o.default=M(o.default?o.default:n.default)}if(o.colorSpace&&o.colorSpace!=="rgb"&&!eh[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let x,E,A;if(y==="exponential")x=ah;else if(y==="interval")x=Tf;else if(y==="categorical"){x=Ef,E=Object.create(null);for(const M of o.stops)E[M[0]]=M[1];A=typeof o.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);x=Af}if(d){const M={},D=[];for(let G=0;G<o.stops.length;G++){const $=o.stops[G],ne=$[0].zoom;M[ne]===void 0&&(M[ne]={zoom:ne,type:o.type,property:o.property,default:o.default,stops:[]},D.push(ne)),M[ne].stops.push([$[0].value,$[1]])}const O=[];for(const G of D)O.push([M[G].zoom,oa(M[G],n)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:lr.interpolationFactor.bind(void 0,N),zoomStops:O.map(G=>G[0]),evaluate:({zoom:G},$)=>ah({stops:O,base:o.base},n,G).evaluate(G,$)}}if(g){const M=y==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:lr.interpolationFactor.bind(void 0,M),zoomStops:o.stops.map(D=>D[0]),evaluate:({zoom:D})=>x(o,n,D,E,A)}}return{kind:"source",evaluate(M,D){const O=D&&D.properties?D.properties[o.property]:void 0;return O===void 0?Io(o.default,n.default):x(o,n,O,E,A)}}}function Io(o,n,l){return o!==void 0?o:n!==void 0?n:l!==void 0?l:void 0}function Ef(o,n,l,d,g){return Io(typeof l===g?d[l]:void 0,o.default,n.default)}function Tf(o,n,l){if(xi(l)!=="number")return Io(o.default,n.default);const d=o.stops.length;if(d===1||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[d-1][0])return o.stops[d-1][1];const g=ii(o.stops.map(y=>y[0]),l);return o.stops[g][1]}function ah(o,n,l){const d=o.base!==void 0?o.base:1;if(xi(l)!=="number")return Io(o.default,n.default);const g=o.stops.length;if(g===1||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[g-1][0])return o.stops[g-1][1];const y=ii(o.stops.map(D=>D[0]),l),x=function(D,O,N,G){const $=G-N,ne=D-N;return $===0?0:O===1?ne/$:(Math.pow(O,ne)-1)/(Math.pow(O,$)-1)}(l,d,o.stops[y][0],o.stops[y+1][0]),E=o.stops[y][1],A=o.stops[y+1][1];let M=hn[n.type]||ji;if(o.colorSpace&&o.colorSpace!=="rgb"){const D=eh[o.colorSpace];M=(O,N)=>D.reverse(D.interpolate(D.forward(O),D.forward(N),x))}return typeof E.evaluate=="function"?{evaluate(...D){const O=E.evaluate.apply(void 0,D),N=A.evaluate.apply(void 0,D);if(O!==void 0&&N!==void 0)return M(O,N,x)}}:M(E,A,x)}function Af(o,n,l){switch(n.type){case"color":l=W.parse(l);break;case"formatted":l=le.fromString(l.toString());break;case"resolvedImage":l=de.fromString(l.toString());break;case"padding":l=re.parse(l);break;default:xi(l)===n.type||n.type==="enum"&&n.values[l]||(l=void 0)}return Io(l,o.default,n.default)}oi.register(Ao,{error:[{kind:"error"},[Ht],(o,[n])=>{throw new nt(n.evaluate(o))}],typeof:[Ht,[jt],(o,[n])=>wi(Ie(n.evaluate(o)))],"to-rgba":[Sn(Ke,4),[xn],(o,[n])=>n.evaluate(o).toArray()],rgb:[xn,[Ke,Ke,Ke],nh],rgba:[xn,[Ke,Ke,Ke,Ke],nh],has:{type:$t,overloads:[[[Ht],(o,[n])=>rh(n.evaluate(o),o.properties())],[[Ht,Ir],(o,[n,l])=>rh(n.evaluate(o),l.evaluate(o))]]},get:{type:jt,overloads:[[[Ht],(o,[n])=>il(n.evaluate(o),o.properties())],[[Ht,Ir],(o,[n,l])=>il(n.evaluate(o),l.evaluate(o))]]},"feature-state":[jt,[Ht],(o,[n])=>il(n.evaluate(o),o.featureState||{})],properties:[Ir,[],o=>o.properties()],"geometry-type":[Ht,[],o=>o.geometryType()],id:[jt,[],o=>o.id()],zoom:[Ke,[],o=>o.globals.zoom],"heatmap-density":[Ke,[],o=>o.globals.heatmapDensity||0],"line-progress":[Ke,[],o=>o.globals.lineProgress||0],accumulated:[jt,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Ke,qs(Ke),(o,n)=>{let l=0;for(const d of n)l+=d.evaluate(o);return l}],"*":[Ke,qs(Ke),(o,n)=>{let l=1;for(const d of n)l*=d.evaluate(o);return l}],"-":{type:Ke,overloads:[[[Ke,Ke],(o,[n,l])=>n.evaluate(o)-l.evaluate(o)],[[Ke],(o,[n])=>-n.evaluate(o)]]},"/":[Ke,[Ke,Ke],(o,[n,l])=>n.evaluate(o)/l.evaluate(o)],"%":[Ke,[Ke,Ke],(o,[n,l])=>n.evaluate(o)%l.evaluate(o)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(o,[n,l])=>Math.pow(n.evaluate(o),l.evaluate(o))],sqrt:[Ke,[Ke],(o,[n])=>Math.sqrt(n.evaluate(o))],log10:[Ke,[Ke],(o,[n])=>Math.log(n.evaluate(o))/Math.LN10],ln:[Ke,[Ke],(o,[n])=>Math.log(n.evaluate(o))],log2:[Ke,[Ke],(o,[n])=>Math.log(n.evaluate(o))/Math.LN2],sin:[Ke,[Ke],(o,[n])=>Math.sin(n.evaluate(o))],cos:[Ke,[Ke],(o,[n])=>Math.cos(n.evaluate(o))],tan:[Ke,[Ke],(o,[n])=>Math.tan(n.evaluate(o))],asin:[Ke,[Ke],(o,[n])=>Math.asin(n.evaluate(o))],acos:[Ke,[Ke],(o,[n])=>Math.acos(n.evaluate(o))],atan:[Ke,[Ke],(o,[n])=>Math.atan(n.evaluate(o))],min:[Ke,qs(Ke),(o,n)=>Math.min(...n.map(l=>l.evaluate(o)))],max:[Ke,qs(Ke),(o,n)=>Math.max(...n.map(l=>l.evaluate(o)))],abs:[Ke,[Ke],(o,[n])=>Math.abs(n.evaluate(o))],round:[Ke,[Ke],(o,[n])=>{const l=n.evaluate(o);return l<0?-Math.round(-l):Math.round(l)}],floor:[Ke,[Ke],(o,[n])=>Math.floor(n.evaluate(o))],ceil:[Ke,[Ke],(o,[n])=>Math.ceil(n.evaluate(o))],"filter-==":[$t,[Ht,jt],(o,[n,l])=>o.properties()[n.value]===l.value],"filter-id-==":[$t,[jt],(o,[n])=>o.id()===n.value],"filter-type-==":[$t,[Ht],(o,[n])=>o.geometryType()===n.value],"filter-<":[$t,[Ht,jt],(o,[n,l])=>{const d=o.properties()[n.value],g=l.value;return typeof d==typeof g&&d<g}],"filter-id-<":[$t,[jt],(o,[n])=>{const l=o.id(),d=n.value;return typeof l==typeof d&&l<d}],"filter->":[$t,[Ht,jt],(o,[n,l])=>{const d=o.properties()[n.value],g=l.value;return typeof d==typeof g&&d>g}],"filter-id->":[$t,[jt],(o,[n])=>{const l=o.id(),d=n.value;return typeof l==typeof d&&l>d}],"filter-<=":[$t,[Ht,jt],(o,[n,l])=>{const d=o.properties()[n.value],g=l.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[$t,[jt],(o,[n])=>{const l=o.id(),d=n.value;return typeof l==typeof d&&l<=d}],"filter->=":[$t,[Ht,jt],(o,[n,l])=>{const d=o.properties()[n.value],g=l.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[$t,[jt],(o,[n])=>{const l=o.id(),d=n.value;return typeof l==typeof d&&l>=d}],"filter-has":[$t,[jt],(o,[n])=>n.value in o.properties()],"filter-has-id":[$t,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[$t,[Sn(Ht)],(o,[n])=>n.value.indexOf(o.geometryType())>=0],"filter-id-in":[$t,[Sn(jt)],(o,[n])=>n.value.indexOf(o.id())>=0],"filter-in-small":[$t,[Ht,Sn(jt)],(o,[n,l])=>l.value.indexOf(o.properties()[n.value])>=0],"filter-in-large":[$t,[Ht,Sn(jt)],(o,[n,l])=>function(d,g,y,x){for(;y<=x;){const E=y+x>>1;if(g[E]===d)return!0;g[E]>d?x=E-1:y=E+1}return!1}(o.properties()[n.value],l.value,0,l.value.length-1)],all:{type:$t,overloads:[[[$t,$t],(o,[n,l])=>n.evaluate(o)&&l.evaluate(o)],[qs($t),(o,n)=>{for(const l of n)if(!l.evaluate(o))return!1;return!0}]]},any:{type:$t,overloads:[[[$t,$t],(o,[n,l])=>n.evaluate(o)||l.evaluate(o)],[qs($t),(o,n)=>{for(const l of n)if(l.evaluate(o))return!0;return!1}]]},"!":[$t,[$t],(o,[n])=>!n.evaluate(o)],"is-supported-script":[$t,[Ht],(o,[n])=>{const l=o.globals&&o.globals.isSupportedScript;return!l||l(n.evaluate(o))}],upcase:[Ht,[Ht],(o,[n])=>n.evaluate(o).toUpperCase()],downcase:[Ht,[Ht],(o,[n])=>n.evaluate(o).toLowerCase()],concat:[Ht,qs(jt),(o,n)=>n.map(l=>mt(l.evaluate(o))).join("")],"resolved-locale":[Ht,[or],(o,[n])=>n.evaluate(o).resolvedLocale()]});class nl{constructor(n,l){this.expression=n,this._warningHistory={},this._evaluator=new ti,this._defaultValue=l?function(d){return d.type==="color"&&Di(d.default)?new W(0,0,0,0):d.type==="color"?W.parse(d.default)||null:d.type==="padding"?re.parse(d.default)||null:d.default===void 0?null:d.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(n,l,d,g,y,x){return this._evaluator.globals=n,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(n,l,d,g,y,x){this._evaluator.globals=n,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new nt(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function aa(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Ao}function la(o,n){const l=new He(Ao,[],n?function(g){const y={color:xn,string:Ht,number:Ke,enum:Ht,boolean:$t,formatted:pn,padding:ys,resolvedImage:tn};return g.type==="array"?Sn(y[g.value]||jt,g.length):y[g.type]}(n):void 0),d=l.parse(o,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?sh(new nl(d,n)):So(l.errors)}class ca{constructor(n,l){this.kind=n,this._styleExpression=l,this.isStateDependent=n!=="constant"&&!Z(l.expression)}evaluateWithoutErrorHandling(n,l,d,g,y,x){return this._styleExpression.evaluateWithoutErrorHandling(n,l,d,g,y,x)}evaluate(n,l,d,g,y,x){return this._styleExpression.evaluate(n,l,d,g,y,x)}}class Ec{constructor(n,l,d,g){this.kind=n,this.zoomStops=d,this._styleExpression=l,this.isStateDependent=n!=="camera"&&!Z(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(n,l,d,g,y,x){return this._styleExpression.evaluateWithoutErrorHandling(n,l,d,g,y,x)}evaluate(n,l,d,g,y,x){return this._styleExpression.evaluate(n,l,d,g,y,x)}interpolationFactor(n,l,d){return this.interpolationType?lr.interpolationFactor(this.interpolationType,n,l,d):0}}function lh(o,n){const l=la(o,n);if(l.result==="error")return l;const d=l.value.expression,g=j(d);if(!g&&!Ni(n))return So([new An("","data expressions not supported")]);const y=ae(d,["zoom"]);if(!y&&!oh(n))return So([new An("","zoom expressions not supported")]);const x=sl(d);return x||y?x instanceof An?So([x]):x instanceof lr&&!ui(n)?So([new An("",'"interpolate" expressions cannot be used with this property')]):sh(x?new Ec(g?"camera":"composite",l.value,x.labels,x instanceof lr?x.interpolation:void 0):new ca(g?"constant":"source",l.value)):So([new An("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rl{constructor(n,l){this._parameters=n,this._specification=l,Ki(this,oa(this._parameters,this._specification))}static deserialize(n){return new rl(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function sl(o){let n=null;if(o instanceof Ja)n=sl(o.result);else if(o instanceof Ka){for(const l of o.args)if(n=sl(l),n)break}else(o instanceof Wi||o instanceof lr)&&o.input instanceof oi&&o.input.name==="zoom"&&(n=o);return n instanceof An||o.eachChild(l=>{const d=sl(l);d instanceof An?n=d:!n&&d?n=new An("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&d&&n!==d&&(n=new An("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function Cr(o){const n=o.key,l=o.value,d=o.valueSpec||{},g=o.objectElementValidators||{},y=o.style,x=o.styleSpec;let E=[];const A=xi(l);if(A!=="object")return[new je(n,l,`object expected, ${A} found`)];for(const M in l){const D=M.split(".")[0],O=d[D]||d["*"];let N;if(g[D])N=g[D];else if(d[D])N=ur;else if(g["*"])N=g["*"];else{if(!d["*"]){E.push(new je(n,l[M],`unknown property "${M}"`));continue}N=ur}E=E.concat(N({key:(n&&`${n}.`)+M,value:l[M],valueSpec:O,style:y,styleSpec:x,object:l,objectKey:M},l))}for(const M in d)g[M]||d[M].required&&d[M].default===void 0&&l[M]===void 0&&E.push(new je(n,l,`missing required property "${M}"`));return E}function ch(o){const n=o.value,l=o.valueSpec,d=o.style,g=o.styleSpec,y=o.key,x=o.arrayElementValidator||ur;if(xi(n)!=="array")return[new je(y,n,`array expected, ${xi(n)} found`)];if(l.length&&n.length!==l.length)return[new je(y,n,`array length ${l.length} expected, length ${n.length} found`)];if(l["min-length"]&&n.length<l["min-length"])return[new je(y,n,`array length at least ${l["min-length"]} expected, length ${n.length} found`)];let E={type:l.value,values:l.values};g.$version<7&&(E.function=l.function),xi(l.value)==="object"&&(E=l.value);let A=[];for(let M=0;M<n.length;M++)A=A.concat(x({array:n,arrayIndex:M,value:n[M],valueSpec:E,style:d,styleSpec:g,key:`${y}[${M}]`}));return A}function Tc(o){const n=o.key,l=o.value,d=o.valueSpec;let g=xi(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new je(n,l,`number expected, ${g} found`)]:"minimum"in d&&l<d.minimum?[new je(n,l,`${l} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&l>d.maximum?[new je(n,l,`${l} is greater than the maximum value ${d.maximum}`)]:[]}function uh(o){const n=o.valueSpec,l=Xt(o.value.type);let d,g,y,x={};const E=l!=="categorical"&&o.value.property===void 0,A=!E,M=xi(o.value.stops)==="array"&&xi(o.value.stops[0])==="array"&&xi(o.value.stops[0][0])==="object",D=Cr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(G){if(l==="identity")return[new je(G.key,G.value,'identity function may not have a "stops" property')];let $=[];const ne=G.value;return $=$.concat(ch({key:G.key,value:ne,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:O})),xi(ne)==="array"&&ne.length===0&&$.push(new je(G.key,ne,"array must have at least one stop")),$},default:function(G){return ur({key:G.key,value:G.value,valueSpec:n,style:G.style,styleSpec:G.styleSpec})}}});return l==="identity"&&E&&D.push(new je(o.key,o.value,'missing required property "property"')),l==="identity"||o.value.stops||D.push(new je(o.key,o.value,'missing required property "stops"')),l==="exponential"&&o.valueSpec.expression&&!ui(o.valueSpec)&&D.push(new je(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(A&&!Ni(o.valueSpec)?D.push(new je(o.key,o.value,"property functions not supported")):E&&!oh(o.valueSpec)&&D.push(new je(o.key,o.value,"zoom functions not supported"))),l!=="categorical"&&!M||o.value.property!==void 0||D.push(new je(o.key,o.value,'"property" property is required')),D;function O(G){let $=[];const ne=G.value,ie=G.key;if(xi(ne)!=="array")return[new je(ie,ne,`array expected, ${xi(ne)} found`)];if(ne.length!==2)return[new je(ie,ne,`array length 2 expected, length ${ne.length} found`)];if(M){if(xi(ne[0])!=="object")return[new je(ie,ne,`object expected, ${xi(ne[0])} found`)];if(ne[0].zoom===void 0)return[new je(ie,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new je(ie,ne,"object stop key must have value")];if(y&&y>Xt(ne[0].zoom))return[new je(ie,ne[0].zoom,"stop zoom values must appear in ascending order")];Xt(ne[0].zoom)!==y&&(y=Xt(ne[0].zoom),g=void 0,x={}),$=$.concat(Cr({key:`${ie}[0]`,value:ne[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:Tc,value:N}}))}else $=$.concat(N({key:`${ie}[0]`,value:ne[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},ne));return aa(fn(ne[1]))?$.concat([new je(`${ie}[1]`,ne[1],"expressions are not allowed in function stops.")]):$.concat(ur({key:`${ie}[1]`,value:ne[1],valueSpec:n,style:G.style,styleSpec:G.styleSpec}))}function N(G,$){const ne=xi(G.value),ie=Xt(G.value),_e=G.value!==null?G.value:$;if(d){if(ne!==d)return[new je(G.key,_e,`${ne} stop domain type must match previous stop domain type ${d}`)]}else d=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean")return[new je(G.key,_e,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&l!=="categorical"){let Te=`number expected, ${ne} found`;return Ni(n)&&l===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new je(G.key,_e,Te)]}return l!=="categorical"||ne!=="number"||isFinite(ie)&&Math.floor(ie)===ie?l!=="categorical"&&ne==="number"&&g!==void 0&&ie<g?[new je(G.key,_e,"stop domain values must appear in ascending order")]:(g=ie,l==="categorical"&&ie in x?[new je(G.key,_e,"stop domain values must be unique")]:(x[ie]=!0,[])):[new je(G.key,_e,`integer expected, found ${ie}`)]}}function Ws(o){const n=(o.expressionContext==="property"?lh:la)(fn(o.value),o.valueSpec);if(n.result==="error")return n.value.map(d=>new je(`${o.key}${d.key}`,o.value,d.message));const l=n.value.expression||n.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!l.outputDefined())return[new je(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Z(l))return[new je(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!Z(l))return[new je(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!ae(l,["zoom","feature-state"]))return[new je(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!j(l))return[new je(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ua(o){const n=o.key,l=o.value,d=o.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(Xt(l))===-1&&g.push(new je(n,l,`expected one of [${d.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(d.values).indexOf(Xt(l))===-1&&g.push(new je(n,l,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function Po(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const n of o.slice(1))if(!Po(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const Sf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ol(o){if(o==null)return{filter:()=>!0,needGeometry:!1};Po(o)||(o=ha(o));const n=la(o,Sf);if(n.result==="error")throw new Error(n.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,d,g)=>n.value.evaluate(l,d,{},g),needGeometry:dh(o)}}function hh(o,n){return o<n?-1:o>n?1:0}function dh(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let n=1;n<o.length;n++)if(dh(o[n]))return!0;return!1}function ha(o){if(!o)return!0;const n=o[0];return o.length<=1?n!=="any":n==="=="?Ac(o[1],o[2],"=="):n==="!="?Mo(Ac(o[1],o[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Ac(o[1],o[2],n):n==="any"?(l=o.slice(1),["any"].concat(l.map(ha))):n==="all"?["all"].concat(o.slice(1).map(ha)):n==="none"?["all"].concat(o.slice(1).map(ha).map(Mo)):n==="in"?al(o[1],o.slice(2)):n==="!in"?Mo(al(o[1],o.slice(2))):n==="has"?da(o[1]):n==="!has"?Mo(da(o[1])):n!=="within"||o;var l}function Ac(o,n,l){switch(o){case"$type":return[`filter-type-${l}`,n];case"$id":return[`filter-id-${l}`,n];default:return[`filter-${l}`,o,n]}}function al(o,n){if(n.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(l=>typeof l!=typeof n[0])?["filter-in-large",o,["literal",n.sort(hh)]]:["filter-in-small",o,["literal",n]]}}function da(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Mo(o){return["!",o]}function fa(o){return Po(fn(o.value))?Ws(Ki({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):fh(o)}function fh(o){const n=o.value,l=o.key;if(xi(n)!=="array")return[new je(l,n,`array expected, ${xi(n)} found`)];const d=o.styleSpec;let g,y=[];if(n.length<1)return[new je(l,n,"filter array must have at least 1 element")];switch(y=y.concat(ua({key:`${l}[0]`,value:n[0],valueSpec:d.filter_operator,style:o.style,styleSpec:o.styleSpec})),Xt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&Xt(n[1])==="$type"&&y.push(new je(l,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&y.push(new je(l,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(g=xi(n[1]),g!=="string"&&y.push(new je(`${l}[1]`,n[1],`string expected, ${g} found`)));for(let x=2;x<n.length;x++)g=xi(n[x]),Xt(n[1])==="$type"?y=y.concat(ua({key:`${l}[${x}]`,value:n[x],valueSpec:d.geometry_type,style:o.style,styleSpec:o.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new je(`${l}[${x}]`,n[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<n.length;x++)y=y.concat(fh({key:`${l}[${x}]`,value:n[x],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":g=xi(n[1]),n.length!==2?y.push(new je(l,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new je(`${l}[1]`,n[1],`string expected, ${g} found`));break;case"within":g=xi(n[1]),n.length!==2?y.push(new je(l,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="object"&&y.push(new je(`${l}[1]`,n[1],`object expected, ${g} found`))}return y}function pa(o,n){const l=o.key,d=o.style,g=o.styleSpec,y=o.value,x=o.objectKey,E=g[`${n}_${o.layerType}`];if(!E)return[];const A=x.match(/^(.*)-transition$/);if(n==="paint"&&A&&E[A[1]]&&E[A[1]].transition)return ur({key:l,value:y,valueSpec:g.transition,style:d,styleSpec:g});const M=o.valueSpec||E[x];if(!M)return[new je(l,y,`unknown property "${x}"`)];let D;if(xi(y)==="string"&&Ni(M)&&!M.tokens&&(D=/^{([^}]+)}$/.exec(y)))return[new je(l,y,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const O=[];return o.layerType==="symbol"&&(x==="text-field"&&d&&!d.glyphs&&O.push(new je(l,y,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Di(fn(y))&&Xt(y.type)==="identity"&&O.push(new je(l,y,'"text-font" does not support identity functions'))),O.concat(ur({key:o.key,value:y,valueSpec:M,style:d,styleSpec:g,expressionContext:"property",propertyType:n,propertyKey:x}))}function ph(o){return pa(o,"paint")}function mh(o){return pa(o,"layout")}function gh(o){let n=[];const l=o.value,d=o.key,g=o.style,y=o.styleSpec;l.type||l.ref||n.push(new je(d,l,'either "type" or "ref" is required'));let x=Xt(l.type);const E=Xt(l.ref);if(l.id){const A=Xt(l.id);for(let M=0;M<o.arrayIndex;M++){const D=g.layers[M];Xt(D.id)===A&&n.push(new je(d,l.id,`duplicate layer id "${l.id}", previously used at line ${D.id.__line__}`))}}if("ref"in l){let A;["type","source","source-layer","filter","layout"].forEach(M=>{M in l&&n.push(new je(d,l[M],`"${M}" is prohibited for ref layers`))}),g.layers.forEach(M=>{Xt(M.id)===E&&(A=M)}),A?A.ref?n.push(new je(d,l.ref,"ref cannot reference another ref layer")):x=Xt(A.type):n.push(new je(d,l.ref,`ref layer "${E}" not found`))}else if(x!=="background")if(l.source){const A=g.sources&&g.sources[l.source],M=A&&Xt(A.type);A?M==="vector"&&x==="raster"?n.push(new je(d,l.source,`layer "${l.id}" requires a raster source`)):M==="raster"&&x!=="raster"?n.push(new je(d,l.source,`layer "${l.id}" requires a vector source`)):M!=="vector"||l["source-layer"]?M==="raster-dem"&&x!=="hillshade"?n.push(new je(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!l.paint||!l.paint["line-gradient"]||M==="geojson"&&A.lineMetrics||n.push(new je(d,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new je(d,l,`layer "${l.id}" must specify a "source-layer"`)):n.push(new je(d,l.source,`source "${l.source}" not found`))}else n.push(new je(d,l,'missing required property "source"'));return n=n.concat(Cr({key:d,value:l,valueSpec:y.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ur({key:`${d}.type`,value:l.type,valueSpec:y.layer.type,style:o.style,styleSpec:o.styleSpec,object:l,objectKey:"type"}),filter:fa,layout:A=>Cr({layer:l,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":M=>mh(Ki({layerType:x},M))}}),paint:A=>Cr({layer:l,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":M=>ph(Ki({layerType:x},M))}})}})),n}function Co(o){const n=o.value,l=o.key,d=xi(n);return d!=="string"?[new je(l,n,`string expected, ${d} found`)]:[]}const _h={promoteId:function({key:o,value:n}){if(xi(n)==="string")return Co({key:o,value:n});{const l=[];for(const d in n)l.push(...Co({key:`${o}.${d}`,value:n[d]}));return l}}};function ma(o){const n=o.value,l=o.key,d=o.styleSpec,g=o.style;if(!n.type)return[new je(l,n,'"type" is required')];const y=Xt(n.type);let x;switch(y){case"vector":case"raster":case"raster-dem":return x=Cr({key:l,value:n,valueSpec:d[`source_${y.replace("-","_")}`],style:o.style,styleSpec:d,objectElementValidators:_h}),x;case"geojson":if(x=Cr({key:l,value:n,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:_h}),n.cluster)for(const E in n.clusterProperties){const[A,M]=n.clusterProperties[E],D=typeof A=="string"?[A,["accumulated"],["get",E]]:A;x.push(...Ws({key:`${l}.${E}.map`,value:M,expressionContext:"cluster-map"})),x.push(...Ws({key:`${l}.${E}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return x;case"video":return Cr({key:l,value:n,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return Cr({key:l,value:n,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new je(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ua({key:`${l}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:d})}}function ga(o){const n=o.value,l=o.styleSpec,d=l.light,g=o.style;let y=[];const x=xi(n);if(n===void 0)return y;if(x!=="object")return y=y.concat([new je("light",n,`object expected, ${x} found`)]),y;for(const E in n){const A=E.match(/^(.*)-transition$/);y=y.concat(A&&d[A[1]]&&d[A[1]].transition?ur({key:E,value:n[E],valueSpec:l.transition,style:g,styleSpec:l}):d[E]?ur({key:E,value:n[E],valueSpec:d[E],style:g,styleSpec:l}):[new je(E,n[E],`unknown property "${E}"`)])}return y}function cr(o){const n=o.value,l=o.styleSpec,d=l.terrain,g=o.style;let y=[];const x=xi(n);if(n===void 0)return y;if(x!=="object")return y=y.concat([new je("terrain",n,`object expected, ${x} found`)]),y;for(const E in n)y=y.concat(d[E]?ur({key:E,value:n[E],valueSpec:d[E],style:g,styleSpec:l}):[new je(E,n[E],`unknown property "${E}"`)]);return y}const _a={"*":()=>[],array:ch,boolean:function(o){const n=o.value,l=o.key,d=xi(n);return d!=="boolean"?[new je(l,n,`boolean expected, ${d} found`)]:[]},number:Tc,color:function(o){const n=o.key,l=o.value,d=xi(l);return d!=="string"?[new je(n,l,`color expected, ${d} found`)]:xs(l)===null?[new je(n,l,`color expected, "${l}" found`)]:[]},constants:en,enum:ua,filter:fa,function:uh,layer:gh,object:Cr,source:ma,light:ga,terrain:cr,string:Co,formatted:function(o){return Co(o).length===0?[]:Ws(o)},resolvedImage:function(o){return Co(o).length===0?[]:Ws(o)},padding:function(o){const n=o.key,l=o.value;if(xi(l)==="array"){if(l.length<1||l.length>4)return[new je(n,l,`padding requires 1 to 4 values; ${l.length} values found`)];const d={type:"number"};let g=[];for(let y=0;y<l.length;y++)g=g.concat(ur({key:`${n}[${y}]`,value:l[y],valueSpec:d}));return g}return Tc({key:n,value:l,valueSpec:{}})}};function ur(o){const n=o.value,l=o.valueSpec,d=o.styleSpec;return l.expression&&Di(Xt(n))?uh(o):l.expression&&aa(fn(n))?Ws(o):l.type&&_a[l.type]?_a[l.type](o):Cr(Ki({},o,{valueSpec:l.type?d[l.type]:l}))}function If(o){const n=o.value,l=o.key,d=Co(o);return d.length||(n.indexOf("{fontstack}")===-1&&d.push(new je(l,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&d.push(new je(l,n,'"glyphs" url must include a "{range}" token'))),d}function ws(o,n=be){let l=[];return l=l.concat(ur({key:"",value:o,valueSpec:n.$root,styleSpec:n,style:o,objectElementValidators:{glyphs:If,"*":()=>[]}})),o.constants&&(l=l.concat(en({key:"constants",value:o.constants,style:o,styleSpec:n}))),yh(l)}function yh(o){return[].concat(o).sort((n,l)=>n.line-l.line)}function ns(o){return function(...n){return yh(o.apply(this,n))}}ws.source=ns(ma),ws.light=ns(ga),ws.terrain=ns(cr),ws.layer=ns(gh),ws.filter=ns(fa),ws.paintProperty=ns(ph),ws.layoutProperty=ns(mh);const ya=ws,Sc=ya.light,Pf=ya.paintProperty,Mf=ya.layoutProperty;function ll(o,n){let l=!1;if(n&&n.length)for(const d of n)o.fire(new Zt(new Error(d.message))),l=!0;return l}class va{constructor(n,l,d){const g=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const x=new Int32Array(this.arrayBuffer);n=x[0],this.d=(l=x[1])+2*(d=x[2]);for(let A=0;A<this.d*this.d;A++){const M=x[3+A],D=x[3+A+1];g.push(M===D?null:x.subarray(M,D))}const E=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],E),this.bboxes=x.subarray(E),this.insert=this._insertReadonly}else{this.d=l+2*d;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=n,this.padding=d,this.scale=l/n,this.uid=0;const y=d/l*n;this.min=-y,this.max=n+y}insert(n,l,d,g,y){this._forEachCell(l,d,g,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,l,d,g,y,x){this.cells[y].push(x)}query(n,l,d,g,y){const x=this.min,E=this.max;if(n<=x&&l<=x&&E<=d&&E<=g&&!y)return Array.prototype.slice.call(this.keys);{const A=[];return this._forEachCell(n,l,d,g,this._queryCell,A,{},y),A}}_queryCell(n,l,d,g,y,x,E,A){const M=this.cells[y];if(M!==null){const D=this.keys,O=this.bboxes;for(let N=0;N<M.length;N++){const G=M[N];if(E[G]===void 0){const $=4*G;(A?A(O[$+0],O[$+1],O[$+2],O[$+3]):n<=O[$+2]&&l<=O[$+3]&&d>=O[$+0]&&g>=O[$+1])?(E[G]=!0,x.push(D[G])):E[G]=!1}}}}_forEachCell(n,l,d,g,y,x,E,A){const M=this._convertToCellCoord(n),D=this._convertToCellCoord(l),O=this._convertToCellCoord(d),N=this._convertToCellCoord(g);for(let G=M;G<=O;G++)for(let $=D;$<=N;$++){const ne=this.d*$+G;if((!A||A(this._convertFromCellCoord(G),this._convertFromCellCoord($),this._convertFromCellCoord(G+1),this._convertFromCellCoord($+1)))&&y.call(this,n,l,d,g,ne,x,E,A))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,l=3+this.cells.length+1+1;let d=0;for(let x=0;x<this.cells.length;x++)d+=this.cells[x].length;const g=new Int32Array(l+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let y=l;for(let x=0;x<n.length;x++){const E=n[x];g[3+x]=y,g.set(E,y),y+=E.length}return g[3+n.length]=y,g.set(this.keys,y),y+=this.keys.length,g[3+n.length+1]=y,g.set(this.bboxes,y),y+=this.bboxes.length,g.buffer}static serialize(n,l){const d=n.toArrayBuffer();return l&&l.push(d),{buffer:d}}static deserialize(n){return new va(n.buffer)}}const rs={};function gt(o,n,l={}){if(rs[o])throw new Error(`${o} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:o,writeable:!1}),rs[o]={klass:n,omit:l.omit||[],shallow:l.shallow||[]}}gt("Object",Object),gt("TransferableGridIndex",va),gt("Color",W),gt("Error",Error),gt("AJAXError",ce),gt("ResolvedImage",de),gt("StylePropertyFunction",rl),gt("StyleExpression",nl,{omit:["_evaluator"]}),gt("ZoomDependentExpression",Ec),gt("ZoomConstantExpression",ca),gt("CompoundExpression",oi,{omit:["_evaluate"]});for(const o in Ao)Ao[o]._classRegistryKey||gt(`Expression_${o}`,Ao[o]);function vh(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Zs(o,n){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob)return o;if(vh(o)||Ut(o))return n&&n.push(o),o;if(ArrayBuffer.isView(o)){const l=o;return n&&n.push(l.buffer),l}if(o instanceof ImageData)return n&&n.push(o.data.buffer),o;if(Array.isArray(o)){const l=[];for(const d of o)l.push(Zs(d,n));return l}if(typeof o=="object"){const l=o.constructor,d=l._classRegistryKey;if(!d)throw new Error("can't serialize object of unregistered class");if(!rs[d])throw new Error(`${d} is not registered.`);const g=l.serialize?l.serialize(o,n):{};if(l.serialize){if(n&&g===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in o){if(!o.hasOwnProperty(y)||rs[d].omit.indexOf(y)>=0)continue;const x=o[y];g[y]=rs[d].shallow.indexOf(y)>=0?x:Zs(x,n)}o instanceof Error&&(g.message=o.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof o)}function Es(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||vh(o)||Ut(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(Es);if(typeof o=="object"){const n=o.$name||"Object";if(!rs[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:l}=rs[n];if(!l)throw new Error(`can't deserialize unregistered class ${n}`);if(l.deserialize)return l.deserialize(o);const d=Object.create(l.prototype);for(const g of Object.keys(o)){if(g==="$name")continue;const y=o[g];d[g]=rs[n].shallow.indexOf(g)>=0?y:Es(y)}return d}throw new Error("can't deserialize object of type "+typeof o)}class Ic{constructor(){this.first=!0}update(n,l){const d=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=l),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=d,!0))}}const rt={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function cl(o){for(const n of o)if(Mc(n.charCodeAt(0)))return!0;return!1}function Cf(o){for(const n of o)if(!Pc(n.charCodeAt(0)))return!1;return!0}function Pc(o){return!(rt.Arabic(o)||rt["Arabic Supplement"](o)||rt["Arabic Extended-A"](o)||rt["Arabic Presentation Forms-A"](o)||rt["Arabic Presentation Forms-B"](o))}function Mc(o){return!(o!==746&&o!==747&&(o<4352||!(rt["Bopomofo Extended"](o)||rt.Bopomofo(o)||rt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||rt["CJK Compatibility Ideographs"](o)||rt["CJK Compatibility"](o)||rt["CJK Radicals Supplement"](o)||rt["CJK Strokes"](o)||!(!rt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||rt["CJK Unified Ideographs Extension A"](o)||rt["CJK Unified Ideographs"](o)||rt["Enclosed CJK Letters and Months"](o)||rt["Hangul Compatibility Jamo"](o)||rt["Hangul Jamo Extended-A"](o)||rt["Hangul Jamo Extended-B"](o)||rt["Hangul Jamo"](o)||rt["Hangul Syllables"](o)||rt.Hiragana(o)||rt["Ideographic Description Characters"](o)||rt.Kanbun(o)||rt["Kangxi Radicals"](o)||rt["Katakana Phonetic Extensions"](o)||rt.Katakana(o)&&o!==12540||!(!rt["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!rt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||rt["Unified Canadian Aboriginal Syllabics"](o)||rt["Unified Canadian Aboriginal Syllabics Extended"](o)||rt["Vertical Forms"](o)||rt["Yijing Hexagram Symbols"](o)||rt["Yi Syllables"](o)||rt["Yi Radicals"](o))))}function xh(o){return!(Mc(o)||function(n){return!!(rt["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||rt["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||rt["Letterlike Symbols"](n)||rt["Number Forms"](n)||rt["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||rt["Control Pictures"](n)&&n!==9251||rt["Optical Character Recognition"](n)||rt["Enclosed Alphanumerics"](n)||rt["Geometric Shapes"](n)||rt["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||rt["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||rt["CJK Symbols and Punctuation"](n)||rt.Katakana(n)||rt["Private Use Area"](n)||rt["CJK Compatibility Forms"](n)||rt["Small Form Variants"](n)||rt["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(o))}function bh(o){return o>=1424&&o<=2303||rt["Arabic Presentation Forms-A"](o)||rt["Arabic Presentation Forms-B"](o)}function Lf(o,n){return!(!n&&bh(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||rt.Khmer(o))}function wh(o){for(const n of o)if(bh(n.charCodeAt(0)))return!0;return!1}const Cc="deferred",Lc="loading",kc="loaded";let Rc=null,Kn="unavailable",Ts=null;const Eh=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(Kn="error"),Rc&&Rc(o)};function Lo(){Dc.fire(new Bt("pluginStateChange",{pluginStatus:Kn,pluginURL:Ts}))}const Dc=new ci,xa=function(){return Kn},Th=function(){if(Kn!==Cc||!Ts)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Kn=Lc,Lo(),Ts&&Ze({url:Ts},o=>{o?Eh(o):(Kn=kc,Lo())})},wr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Kn===kc||wr.applyArabicShaping!=null,isLoading:()=>Kn===Lc,setState(o){if(!at())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Kn=o.pluginStatus,Ts=o.pluginURL},isParsed(){if(!at())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return wr.applyArabicShaping!=null&&wr.processBidirectionalText!=null&&wr.processStyledBidirectionalText!=null},getPluginURL(){if(!at())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ts}};class Gi{constructor(n,l){this.zoom=n,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ic,this.transition={})}isSupportedScript(n){return function(l,d){for(const g of l)if(!Lf(g.charCodeAt(0),d))return!1;return!0}(n,wr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,l=n-Math.floor(n),d=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*l}}}class ba{constructor(n,l){this.property=n,this.value=l,this.expression=function(d,g){if(Di(d))return new rl(d,g);if(aa(d)){const y=lh(d,g);if(y.result==="error")throw new Error(y.value.map(x=>`${x.key}: ${x.message}`).join(", "));return y.value}{let y=d;return g.type==="color"&&typeof d=="string"?y=W.parse(d):g.type!=="padding"||typeof d!="number"&&!Array.isArray(d)||(y=re.parse(d)),{kind:"constant",evaluate:()=>y}}}(l===void 0?n.specification.default:l,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,l,d){return this.property.possiblyEvaluate(this,n,l,d)}}class ul{constructor(n){this.property=n,this.value=new ba(n,void 0)}transitioned(n,l){return new Sh(this.property,this.value,l,ee({},n.transition,this.transition),n.now)}untransitioned(){return new Sh(this.property,this.value,null,{},0)}}class Ah{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return Se(this._values[n].value.value)}setValue(n,l){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new ul(this._values[n].property)),this._values[n].value=new ba(this._values[n].property,l===null?void 0:Se(l))}getTransition(n){return Se(this._values[n].transition)}setTransition(n,l){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new ul(this._values[n].property)),this._values[n].transition=Se(l)||void 0}serialize(){const n={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(n[l]=d);const g=this.getTransition(l);g!==void 0&&(n[`${l}-transition`]=g)}return n}transitioned(n,l){const d=new Ih(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(n,l._values[g]);return d}untransitioned(){const n=new Ih(this._properties);for(const l of Object.keys(this._values))n._values[l]=this._values[l].untransitioned();return n}}class Sh{constructor(n,l,d,g,y){this.property=n,this.value=l,this.begin=y+g.delay||0,this.end=this.begin+g.duration||0,n.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(n,l,d){const g=n.now||0,y=this.value.possiblyEvaluate(n,l,d),x=this.prior;if(x){if(g>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(g<this.begin)return x.possiblyEvaluate(n,l,d);{const E=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(n,l,d),y,function(A){if(A<=0)return 0;if(A>=1)return 1;const M=A*A,D=M*A;return 4*(A<.5?D:3*(A-M)+D-.75)}(E))}}return y}}class Ih{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,l,d){const g=new wa(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(n,l,d);return g}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class kf{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return Se(this._values[n].value)}setValue(n,l){this._values[n]=new ba(this._values[n].property,l===null?void 0:Se(l))}serialize(){const n={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(n[l]=d)}return n}possiblyEvaluate(n,l,d){const g=new wa(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(n,l,d);return g}}class qr{constructor(n,l,d){this.property=n,this.value=l,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,l,d,g){return this.property.evaluate(this.value,this.parameters,n,l,d,g)}}class wa{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class At{constructor(n){this.specification=n}possiblyEvaluate(n,l){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(l)}interpolate(n,l,d){const g=hn[this.specification.type];return g?g(n,l,d):n}}class Ft{constructor(n,l){this.specification=n,this.overrides=l}possiblyEvaluate(n,l,d,g){return new qr(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(l,null,{},d,g)}:n.expression,l)}interpolate(n,l,d){if(n.value.kind!=="constant"||l.value.kind!=="constant")return n;if(n.value.value===void 0||l.value.value===void 0)return new qr(this,{kind:"constant",value:void 0},n.parameters);const g=hn[this.specification.type];return g?new qr(this,{kind:"constant",value:g(n.value.value,l.value.value,d)},n.parameters):n}evaluate(n,l,d,g,y,x){return n.kind==="constant"?n.value:n.evaluate(l,d,g,y,x)}}class ko extends Ft{possiblyEvaluate(n,l,d,g){if(n.value===void 0)return new qr(this,{kind:"constant",value:void 0},l);if(n.expression.kind==="constant"){const y=n.expression.evaluate(l,null,{},d,g),x=n.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,E=this._calculate(x,x,x,l);return new qr(this,{kind:"constant",value:E},l)}if(n.expression.kind==="camera"){const y=this._calculate(n.expression.evaluate({zoom:l.zoom-1}),n.expression.evaluate({zoom:l.zoom}),n.expression.evaluate({zoom:l.zoom+1}),l);return new qr(this,{kind:"constant",value:y},l)}return new qr(this,n.expression,l)}evaluate(n,l,d,g,y,x){if(n.kind==="source"){const E=n.evaluate(l,d,g,y,x);return this._calculate(E,E,E,l)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(l.zoom)-1},d,g),n.evaluate({zoom:Math.floor(l.zoom)},d,g),n.evaluate({zoom:Math.floor(l.zoom)+1},d,g),l):n.value}_calculate(n,l,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:l}:{from:d,to:l}}interpolate(n){return n}}class zc{constructor(n){this.specification=n}possiblyEvaluate(n,l,d,g){if(n.value!==void 0){if(n.expression.kind==="constant"){const y=n.expression.evaluate(l,null,{},d,g);return this._calculate(y,y,y,l)}return this._calculate(n.expression.evaluate(new Gi(Math.floor(l.zoom-1),l)),n.expression.evaluate(new Gi(Math.floor(l.zoom),l)),n.expression.evaluate(new Gi(Math.floor(l.zoom+1),l)),l)}}_calculate(n,l,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:l}:{from:d,to:l}}interpolate(n){return n}}class As{constructor(n){this.specification=n}possiblyEvaluate(n,l,d,g){return!!n.expression.evaluate(l,null,{},d,g)}interpolate(){return!1}}class zn{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in n){const d=n[l];d.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new ba(d,void 0),y=this.defaultTransitionablePropertyValues[l]=new ul(d);this.defaultTransitioningPropertyValues[l]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}gt("DataDrivenProperty",Ft),gt("DataConstantProperty",At),gt("CrossFadedDataDrivenProperty",ko),gt("CrossFadedProperty",zc),gt("ColorRampProperty",As);const Ss="-transition";class Wr extends ci{constructor(n,l){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),l.layout&&(this._unevaluatedLayout=new kf(l.layout)),l.paint)){this._transitionablePaint=new Ah(l.paint);for(const d in n.paint)this.setPaintProperty(d,n.paint[d],{validate:!1});for(const d in n.layout)this.setLayoutProperty(d,n.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wa(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,l,d={}){l!=null&&this._validate(Mf,`layers.${this.id}.layout.${n}`,n,l,d)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,l):this.visibility=l)}getPaintProperty(n){return n.endsWith(Ss)?this._transitionablePaint.getTransition(n.slice(0,-Ss.length)):this._transitionablePaint.getValue(n)}setPaintProperty(n,l,d={}){if(l!=null&&this._validate(Pf,`layers.${this.id}.paint.${n}`,n,l,d))return!1;if(n.endsWith(Ss))return this._transitionablePaint.setTransition(n.slice(0,-Ss.length),l||void 0),!1;{const g=this._transitionablePaint._values[n],y=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),E=g.value;this._transitionablePaint.setValue(n,l),this._handleSpecialPaintPropertyUpdate(n);const A=this._transitionablePaint._values[n].value;return A.isDataDriven()||x||y||this._handleOverridablePaintPropertyUpdate(n,E,A)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,l,d){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,l){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,l)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),ye(n,(l,d)=>!(l===void 0||d==="layout"&&!Object.keys(l).length||d==="paint"&&!Object.keys(l).length))}_validate(n,l,d,g,y={}){return(!y||y.validate!==!1)&&ll(this,n.call(ya,{key:l,layerType:this.type,objectKey:d,value:g,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const l=this.paint.get(n);if(l instanceof qr&&Ni(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const Ph={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Is{constructor(n,l){this._structArray=n,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class nn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,l){return n._trim(),l&&(n.isTransferred=!0,l.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const l=Object.create(this.prototype);return l.arrayBuffer=n.arrayBuffer,l.length=n.length,l.capacity=n.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function mn(o,n=1){let l=0,d=0;return{members:o.map(g=>{const y=Ph[g.type].BYTES_PER_ELEMENT,x=l=Oc(l,Math.max(n,y)),E=g.components||1;return d=Math.max(d,y),l+=y*E,{name:g.name,type:g.type,components:E,offset:x}}),size:Oc(l,Math.max(d,n)),alignment:n}}function Oc(o,n){return Math.ceil(o/n)*n}class Xs extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l){const d=this.length;return this.resize(d+1),this.emplace(d,n,l)}emplace(n,l,d){const g=2*n;return this.int16[g+0]=l,this.int16[g+1]=d,n}}Xs.prototype.bytesPerElement=4,gt("StructArrayLayout2i4",Xs);class m extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,n,l,d,g)}emplace(n,l,d,g,y){const x=4*n;return this.int16[x+0]=l,this.int16[x+1]=d,this.int16[x+2]=g,this.int16[x+3]=y,n}}m.prototype.bytesPerElement=8,gt("StructArrayLayout4i8",m);class r extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,n,l,d,g,y,x)}emplace(n,l,d,g,y,x,E){const A=6*n;return this.int16[A+0]=l,this.int16[A+1]=d,this.int16[A+2]=g,this.int16[A+3]=y,this.int16[A+4]=x,this.int16[A+5]=E,n}}r.prototype.bytesPerElement=12,gt("StructArrayLayout2i4i12",r);class u extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,n,l,d,g,y,x)}emplace(n,l,d,g,y,x,E){const A=4*n,M=8*n;return this.int16[A+0]=l,this.int16[A+1]=d,this.uint8[M+4]=g,this.uint8[M+5]=y,this.uint8[M+6]=x,this.uint8[M+7]=E,n}}u.prototype.bytesPerElement=8,gt("StructArrayLayout2i4ub8",u);class f extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l){const d=this.length;return this.resize(d+1),this.emplace(d,n,l)}emplace(n,l,d){const g=2*n;return this.float32[g+0]=l,this.float32[g+1]=d,n}}f.prototype.bytesPerElement=8,gt("StructArrayLayout2f8",f);class _ extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,d,g,y,x,E,A,M,D){const O=this.length;return this.resize(O+1),this.emplace(O,n,l,d,g,y,x,E,A,M,D)}emplace(n,l,d,g,y,x,E,A,M,D,O){const N=10*n;return this.uint16[N+0]=l,this.uint16[N+1]=d,this.uint16[N+2]=g,this.uint16[N+3]=y,this.uint16[N+4]=x,this.uint16[N+5]=E,this.uint16[N+6]=A,this.uint16[N+7]=M,this.uint16[N+8]=D,this.uint16[N+9]=O,n}}_.prototype.bytesPerElement=20,gt("StructArrayLayout10ui20",_);class v extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,d,g,y,x,E,A,M,D,O,N){const G=this.length;return this.resize(G+1),this.emplace(G,n,l,d,g,y,x,E,A,M,D,O,N)}emplace(n,l,d,g,y,x,E,A,M,D,O,N,G){const $=12*n;return this.int16[$+0]=l,this.int16[$+1]=d,this.int16[$+2]=g,this.int16[$+3]=y,this.uint16[$+4]=x,this.uint16[$+5]=E,this.uint16[$+6]=A,this.uint16[$+7]=M,this.int16[$+8]=D,this.int16[$+9]=O,this.int16[$+10]=N,this.int16[$+11]=G,n}}v.prototype.bytesPerElement=24,gt("StructArrayLayout4i4ui4i24",v);class w extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,l,d)}emplace(n,l,d,g){const y=3*n;return this.float32[y+0]=l,this.float32[y+1]=d,this.float32[y+2]=g,n}}w.prototype.bytesPerElement=12,gt("StructArrayLayout3f12",w);class S extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const l=this.length;return this.resize(l+1),this.emplace(l,n)}emplace(n,l){return this.uint32[1*n+0]=l,n}}S.prototype.bytesPerElement=4,gt("StructArrayLayout1ul4",S);class I extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,d,g,y,x,E,A,M){const D=this.length;return this.resize(D+1),this.emplace(D,n,l,d,g,y,x,E,A,M)}emplace(n,l,d,g,y,x,E,A,M,D){const O=10*n,N=5*n;return this.int16[O+0]=l,this.int16[O+1]=d,this.int16[O+2]=g,this.int16[O+3]=y,this.int16[O+4]=x,this.int16[O+5]=E,this.uint32[N+3]=A,this.uint16[O+8]=M,this.uint16[O+9]=D,n}}I.prototype.bytesPerElement=20,gt("StructArrayLayout6i1ul2ui20",I);class L extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,n,l,d,g,y,x)}emplace(n,l,d,g,y,x,E){const A=6*n;return this.int16[A+0]=l,this.int16[A+1]=d,this.int16[A+2]=g,this.int16[A+3]=y,this.int16[A+4]=x,this.int16[A+5]=E,n}}L.prototype.bytesPerElement=12,gt("StructArrayLayout2i2i2i12",L);class z extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,n,l,d,g,y)}emplace(n,l,d,g,y,x){const E=4*n,A=8*n;return this.float32[E+0]=l,this.float32[E+1]=d,this.float32[E+2]=g,this.int16[A+6]=y,this.int16[A+7]=x,n}}z.prototype.bytesPerElement=16,gt("StructArrayLayout2f1f2i16",z);class B extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,n,l,d,g)}emplace(n,l,d,g,y){const x=12*n,E=3*n;return this.uint8[x+0]=l,this.uint8[x+1]=d,this.float32[E+1]=g,this.float32[E+2]=y,n}}B.prototype.bytesPerElement=12,gt("StructArrayLayout2ub2f12",B);class V extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,l,d)}emplace(n,l,d,g){const y=3*n;return this.uint16[y+0]=l,this.uint16[y+1]=d,this.uint16[y+2]=g,n}}V.prototype.bytesPerElement=6,gt("StructArrayLayout3ui6",V);class Q extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,g,y,x,E,A,M,D,O,N,G,$,ne,ie,_e){const Te=this.length;return this.resize(Te+1),this.emplace(Te,n,l,d,g,y,x,E,A,M,D,O,N,G,$,ne,ie,_e)}emplace(n,l,d,g,y,x,E,A,M,D,O,N,G,$,ne,ie,_e,Te){const ge=24*n,we=12*n,Oe=48*n;return this.int16[ge+0]=l,this.int16[ge+1]=d,this.uint16[ge+2]=g,this.uint16[ge+3]=y,this.uint32[we+2]=x,this.uint32[we+3]=E,this.uint32[we+4]=A,this.uint16[ge+10]=M,this.uint16[ge+11]=D,this.uint16[ge+12]=O,this.float32[we+7]=N,this.float32[we+8]=G,this.uint8[Oe+36]=$,this.uint8[Oe+37]=ne,this.uint8[Oe+38]=ie,this.uint32[we+10]=_e,this.int16[ge+22]=Te,n}}Q.prototype.bytesPerElement=48,gt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Q);class Y extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,g,y,x,E,A,M,D,O,N,G,$,ne,ie,_e,Te,ge,we,Oe,De,ft,xt,st,tt,Je,ot){const it=this.length;return this.resize(it+1),this.emplace(it,n,l,d,g,y,x,E,A,M,D,O,N,G,$,ne,ie,_e,Te,ge,we,Oe,De,ft,xt,st,tt,Je,ot)}emplace(n,l,d,g,y,x,E,A,M,D,O,N,G,$,ne,ie,_e,Te,ge,we,Oe,De,ft,xt,st,tt,Je,ot,it){const qe=34*n,Dt=17*n;return this.int16[qe+0]=l,this.int16[qe+1]=d,this.int16[qe+2]=g,this.int16[qe+3]=y,this.int16[qe+4]=x,this.int16[qe+5]=E,this.int16[qe+6]=A,this.int16[qe+7]=M,this.uint16[qe+8]=D,this.uint16[qe+9]=O,this.uint16[qe+10]=N,this.uint16[qe+11]=G,this.uint16[qe+12]=$,this.uint16[qe+13]=ne,this.uint16[qe+14]=ie,this.uint16[qe+15]=_e,this.uint16[qe+16]=Te,this.uint16[qe+17]=ge,this.uint16[qe+18]=we,this.uint16[qe+19]=Oe,this.uint16[qe+20]=De,this.uint16[qe+21]=ft,this.uint16[qe+22]=xt,this.uint32[Dt+12]=st,this.float32[Dt+13]=tt,this.float32[Dt+14]=Je,this.float32[Dt+15]=ot,this.float32[Dt+16]=it,n}}Y.prototype.bytesPerElement=68,gt("StructArrayLayout8i15ui1ul4f68",Y);class K extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const l=this.length;return this.resize(l+1),this.emplace(l,n)}emplace(n,l){return this.float32[1*n+0]=l,n}}K.prototype.bytesPerElement=4,gt("StructArrayLayout1f4",K);class ue extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,l,d)}emplace(n,l,d,g){const y=3*n;return this.int16[y+0]=l,this.int16[y+1]=d,this.int16[y+2]=g,n}}ue.prototype.bytesPerElement=6,gt("StructArrayLayout3i6",ue);class me extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,l,d)}emplace(n,l,d,g){const y=4*n;return this.uint32[2*n+0]=l,this.uint16[y+2]=d,this.uint16[y+3]=g,n}}me.prototype.bytesPerElement=8,gt("StructArrayLayout1ul2ui8",me);class ve extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l){const d=this.length;return this.resize(d+1),this.emplace(d,n,l)}emplace(n,l,d){const g=2*n;return this.uint16[g+0]=l,this.uint16[g+1]=d,n}}ve.prototype.bytesPerElement=4,gt("StructArrayLayout2ui4",ve);class te extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const l=this.length;return this.resize(l+1),this.emplace(l,n)}emplace(n,l){return this.uint16[1*n+0]=l,n}}te.prototype.bytesPerElement=2,gt("StructArrayLayout1ui2",te);class Ee extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,n,l,d,g)}emplace(n,l,d,g,y){const x=4*n;return this.float32[x+0]=l,this.float32[x+1]=d,this.float32[x+2]=g,this.float32[x+3]=y,n}}Ee.prototype.bytesPerElement=16,gt("StructArrayLayout4f16",Ee);class xe extends Is{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new pt(this.anchorPointX,this.anchorPointY)}}xe.prototype.size=20;class Le extends I{get(n){return new xe(this,n)}}gt("CollisionBoxArray",Le);class ke extends Is{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ke.prototype.size=48;class Ge extends Q{get(n){return new ke(this,n)}}gt("PlacedSymbolArray",Ge);class Me extends Is{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Me.prototype.size=68;class ct extends Y{get(n){return new Me(this,n)}}gt("SymbolInstanceArray",ct);class et extends K{getoffsetX(n){return this.float32[1*n+0]}}gt("GlyphOffsetArray",et);class dt extends ue{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}gt("SymbolLineVertexArray",dt);class qt extends Is{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}qt.prototype.size=8;class Jt extends me{get(n){return new qt(this,n)}}gt("FeatureIndexArray",Jt);class Rt extends Xs{}class Ti extends Xs{}class Ai extends Xs{}class di extends r{}class fi extends u{}class Si extends f{}class In extends _{}class Zr extends v{}class Lr extends w{}class Xr extends S{}class Ps extends L{}class Er extends B{}class Jn extends V{}class ss extends ve{}const hl=mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:wn}=hl;class ni{constructor(n=[]){this.segments=n}prepareSegment(n,l,d,g){let y=this.segments[this.segments.length-1];return n>ni.MAX_VERTEX_ARRAY_LENGTH&&$e(`Max vertices per segment is ${ni.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!y||y.vertexLength+n>ni.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==g)&&(y={vertexOffset:l.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},g!==void 0&&(y.sortKey=g),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const n of this.segments)for(const l in n.vaos)n.vaos[l].destroy()}static simpleSegment(n,l,d,g){return new ni([{vertexOffset:n,primitiveOffset:l,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function Ei(o,n){return 256*(o=C(Math.floor(o),0,255))+C(Math.floor(n),0,255)}ni.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gt("SegmentVector",ni);const Pn=mn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Mn={exports:{}},$i={exports:{}};$i.exports=function(o,n){var l,d,g,y,x,E,A,M;for(d=o.length-(l=3&o.length),g=n,x=3432918353,E=461845907,M=0;M<d;)A=255&o.charCodeAt(M)|(255&o.charCodeAt(++M))<<8|(255&o.charCodeAt(++M))<<16|(255&o.charCodeAt(++M))<<24,++M,g=27492+(65535&(y=5*(65535&(g=(g^=A=(65535&(A=(A=(65535&A)*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*E+(((A>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(A=0,l){case 3:A^=(255&o.charCodeAt(M+2))<<16;case 2:A^=(255&o.charCodeAt(M+1))<<8;case 1:g^=A=(65535&(A=(A=(65535&(A^=255&o.charCodeAt(M)))*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*E+(((A>>>16)*E&65535)<<16)&4294967295}return g^=o.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Tr={exports:{}};Tr.exports=function(o,n){for(var l,d=o.length,g=n^d,y=0;d>=4;)l=1540483477*(65535&(l=255&o.charCodeAt(y)|(255&o.charCodeAt(++y))<<8|(255&o.charCodeAt(++y))<<16|(255&o.charCodeAt(++y))<<24))+((1540483477*(l>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:g^=(255&o.charCodeAt(y+2))<<16;case 2:g^=(255&o.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&o.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Ys=$i.exports,Fc=Tr.exports;Mn.exports=Ys,Mn.exports.murmur3=Ys,Mn.exports.murmur2=Fc;class Ro{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,l,d,g){this.ids.push(Mh(n)),this.positions.push(l,d,g)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=Mh(n);let d=0,g=this.ids.length-1;for(;d<g;){const x=d+g>>1;this.ids[x]>=l?g=x:d=x+1}const y=[];for(;this.ids[d]===l;)y.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return y}static serialize(n,l){const d=new Float64Array(n.ids),g=new Uint32Array(n.positions);return Bc(d,g,0,d.length-1),l&&l.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(n){const l=new Ro;return l.ids=n.ids,l.positions=n.positions,l.indexed=!0,l}}function Mh(o){const n=+o;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Mn.exports(String(o))}function Bc(o,n,l,d){for(;l<d;){const g=o[l+d>>1];let y=l-1,x=d+1;for(;;){do y++;while(o[y]<g);do x--;while(o[x]>g);if(y>=x)break;Ms(o,y,x),Ms(n,3*y,3*x),Ms(n,3*y+1,3*x+1),Ms(n,3*y+2,3*x+2)}x-l<d-x?(Bc(o,n,l,x),l=x+1):(Bc(o,n,x+1,d),d=x)}}function Ms(o,n,l){const d=o[n];o[n]=o[l],o[l]=d}gt("FeaturePositionMap",Ro);class Ks{constructor(n,l){this.gl=n.gl,this.location=l}}class Js extends Ks{constructor(n,l){super(n,l),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class dl extends Ks{constructor(n,l){super(n,l),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class Qg extends Ks{constructor(n,l){super(n,l),this.current=W.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const pw=new Float32Array(16);function Rf(o){return[Ei(255*o.r,255*o.g),Ei(255*o.b,255*o.a)]}class Nc{constructor(n,l,d){this.value=n,this.uniformNames=l.map(g=>`u_${g}`),this.type=d}setUniform(n,l,d){n.set(d.constantOr(this.value))}getBinding(n,l,d){return this.type==="color"?new Qg(n,l):new Js(n,l)}}class fl{constructor(n,l){this.uniformNames=l.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=n.tlbr}setUniform(n,l,d,g){const y=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&n.set(y)}getBinding(n,l,d){return d.substr(0,9)==="u_pattern"?new dl(n,l):new Js(n,l)}}class Qs{constructor(n,l,d,g){this.expression=n,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(n,l,d,g,y){const x=this.paintVertexArray.length,E=this.expression.evaluate(new Gi(0),l,{},g,[],y);this.paintVertexArray.resize(n),this._setPaintValue(x,n,E)}updatePaintArray(n,l,d,g){const y=this.expression.evaluate({zoom:0},d,g);this._setPaintValue(n,l,y)}_setPaintValue(n,l,d){if(this.type==="color"){const g=Rf(d);for(let y=n;y<l;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=n;g<l;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class os{constructor(n,l,d,g,y,x){this.expression=n,this.uniformNames=l.map(E=>`u_${E}_t`),this.type=d,this.useIntegerZoom=g,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=l.map(E=>({name:`a_${E}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(n,l,d,g,y){const x=this.expression.evaluate(new Gi(this.zoom),l,{},g,[],y),E=this.expression.evaluate(new Gi(this.zoom+1),l,{},g,[],y),A=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(A,n,x,E)}updatePaintArray(n,l,d,g){const y=this.expression.evaluate({zoom:this.zoom},d,g),x=this.expression.evaluate({zoom:this.zoom+1},d,g);this._setPaintValue(n,l,y,x)}_setPaintValue(n,l,d,g){if(this.type==="color"){const y=Rf(d),x=Rf(g);for(let E=n;E<l;E++)this.paintVertexArray.emplace(E,y[0],y[1],x[0],x[1])}else{for(let y=n;y<l;y++)this.paintVertexArray.emplace(y,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,l){const d=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=C(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);n.set(g)}getBinding(n,l,d){return new Js(n,l)}}class Do{constructor(n,l,d,g,y,x){this.expression=n,this.type=l,this.useIntegerZoom=d,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(n,l,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(g,n,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(n,l,d,g,y){this._setPaintValues(n,l,d.patterns&&d.patterns[this.layerId],y)}_setPaintValues(n,l,d,g){if(!g||!d)return;const{min:y,mid:x,max:E}=d,A=g[y],M=g[x],D=g[E];if(A&&M&&D)for(let O=n;O<l;O++)this.zoomInPaintVertexArray.emplace(O,M.tl[0],M.tl[1],M.br[0],M.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],M.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,M.tl[0],M.tl[1],M.br[0],M.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],M.pixelRatio,D.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,Pn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,Pn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class e_{constructor(n,l,d){this.binders={},this._buffers=[];const g=[];for(const y in n.paint._values){if(!d(y))continue;const x=n.paint.get(y);if(!(x instanceof qr&&Ni(x.property.specification)))continue;const E=mw(y,n.type),A=x.value,M=x.property.specification.type,D=x.property.useIntegerZoom,O=x.property.specification["property-type"],N=O==="cross-faded"||O==="cross-faded-data-driven";if(A.kind==="constant")this.binders[y]=N?new fl(A.value,E):new Nc(A.value,E,M),g.push(`/u_${y}`);else if(A.kind==="source"||N){const G=t_(y,M,"source");this.binders[y]=N?new Do(A,M,D,l,G,n.id):new Qs(A,E,M,G),g.push(`/a_${y}`)}else{const G=t_(y,M,"composite");this.binders[y]=new os(A,E,M,D,l,G),g.push(`/z_${y}`)}}this.cacheKey=g.sort().join("")}getMaxValue(n){const l=this.binders[n];return l instanceof Qs||l instanceof os?l.maxValue:0}populatePaintArrays(n,l,d,g,y){for(const x in this.binders){const E=this.binders[x];(E instanceof Qs||E instanceof os||E instanceof Do)&&E.populatePaintArray(n,l,d,g,y)}}setConstantPatternPositions(n,l){for(const d in this.binders){const g=this.binders[d];g instanceof fl&&g.setConstantPatternPositions(n,l)}}updatePaintArrays(n,l,d,g,y){let x=!1;for(const E in n){const A=l.getPositions(E);for(const M of A){const D=d.feature(M.index);for(const O in this.binders){const N=this.binders[O];if((N instanceof Qs||N instanceof os||N instanceof Do)&&N.expression.isStateDependent===!0){const G=g.paint.get(O);N.expression=G.value,N.updatePaintArray(M.start,M.end,D,n[E],y),x=!0}}}}return x}defines(){const n=[];for(const l in this.binders){const d=this.binders[l];(d instanceof Nc||d instanceof fl)&&n.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return n}getBinderAttributes(){const n=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Qs||d instanceof os)for(let g=0;g<d.paintVertexAttributes.length;g++)n.push(d.paintVertexAttributes[g].name);else if(d instanceof Do)for(let g=0;g<Pn.members.length;g++)n.push(Pn.members[g].name)}return n}getBinderUniforms(){const n=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Nc||d instanceof fl||d instanceof os)for(const g of d.uniformNames)n.push(g)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,l){const d=[];for(const g in this.binders){const y=this.binders[g];if(y instanceof Nc||y instanceof fl||y instanceof os){for(const x of y.uniformNames)if(l[x]){const E=y.getBinding(n,l[x],x);d.push({name:x,property:g,binding:E})}}}return d}setUniforms(n,l,d,g){for(const{name:y,property:x,binding:E}of l)this.binders[x].setUniform(E,g,d.get(x),y)}updatePaintBuffers(n){this._buffers=[];for(const l in this.binders){const d=this.binders[l];if(n&&d instanceof Do){const g=n.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof Qs||d instanceof os)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(n){for(const l in this.binders){const d=this.binders[l];(d instanceof Qs||d instanceof os||d instanceof Do)&&d.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const l=this.binders[n];(l instanceof Qs||l instanceof os||l instanceof Do)&&l.destroy()}}}class Ea{constructor(n,l,d=()=>!0){this.programConfigurations={};for(const g of n)this.programConfigurations[g.id]=new e_(g,l,d);this.needsUpload=!1,this._featureMap=new Ro,this._bufferOffset=0}populatePaintArrays(n,l,d,g,y,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(n,l,g,y,x);l.id!==void 0&&this._featureMap.add(l.id,d,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,l,d,g){for(const y of d)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(n,this._featureMap,l,y,g)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function mw(o,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${n}-`,"").replace(/-/g,"_")]}function t_(o,n,l){const d={color:{source:f,composite:Ee},number:{source:K,composite:f}},g=function(y){return{"line-pattern":{source:In,composite:In},"fill-pattern":{source:In,composite:In},"fill-extrusion-pattern":{source:In,composite:In}}[y]}(o);return g&&g[l]||d[n][l]}gt("ConstantBinder",Nc),gt("CrossFadedConstantBinder",fl),gt("SourceExpressionBinder",Qs),gt("CrossFadedCompositeBinder",Do),gt("CompositeExpressionBinder",os),gt("ProgramConfiguration",e_,{omit:["_buffers"]}),gt("ProgramConfigurationSet",Ea);var En=8192;const Df=Math.pow(2,14)-1,i_=-Df-1;function Ta(o){const n=En/o.extent,l=o.loadGeometry();for(let d=0;d<l.length;d++){const g=l[d];for(let y=0;y<g.length;y++){const x=g[y],E=Math.round(x.x*n),A=Math.round(x.y*n);x.x=C(E,i_,Df),x.y=C(A,i_,Df),(E<x.x||E>x.x+1||A<x.y||A>x.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Aa(o,n){return{type:o.type,id:o.id,properties:o.properties,geometry:n?Ta(o):[]}}function Ch(o,n,l,d,g){o.emplaceBack(2*n+(d+1)/2,2*l+(g+1)/2)}class zf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Ti,this.indexArray=new Jn,this.segments=new ni,this.programConfigurations=new Ea(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(n,l,d){const g=this.layers[0],y=[];let x=null,E=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),E=!x.isConstant());for(const{feature:A,id:M,index:D,sourceLayerIndex:O}of n){const N=this.layers[0]._featureFilter.needGeometry,G=Aa(A,N);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),G,d))continue;const $=E?x.evaluate(G,{},d):void 0,ne={id:M,properties:A.properties,type:A.type,sourceLayerIndex:O,index:D,geometry:N?G.geometry:Ta(A),patterns:{},sortKey:$};y.push(ne)}E&&y.sort((A,M)=>A.sortKey-M.sortKey);for(const A of y){const{geometry:M,index:D,sourceLayerIndex:O}=A,N=n[D].feature;this.addFeature(A,M,D,d),l.featureIndex.insert(N,M,D,O,this.index)}}update(n,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,l,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,wn),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,l,d,g){for(const y of l)for(const x of y){const E=x.x,A=x.y;if(E<0||E>=En||A<0||A>=En)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),D=M.vertexLength;Ch(this.layoutVertexArray,E,A,-1,-1),Ch(this.layoutVertexArray,E,A,1,-1),Ch(this.layoutVertexArray,E,A,1,1),Ch(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,{},g)}}function n_(o,n){for(let l=0;l<o.length;l++)if(pl(n,o[l]))return!0;for(let l=0;l<n.length;l++)if(pl(o,n[l]))return!0;return!!Of(o,n)}function gw(o,n,l){return!!pl(o,n)||!!Ff(n,o,l)}function r_(o,n){if(o.length===1)return o_(n,o[0]);for(let l=0;l<n.length;l++){const d=n[l];for(let g=0;g<d.length;g++)if(pl(o,d[g]))return!0}for(let l=0;l<o.length;l++)if(o_(n,o[l]))return!0;for(let l=0;l<n.length;l++)if(Of(o,n[l]))return!0;return!1}function _w(o,n,l){if(o.length>1){if(Of(o,n))return!0;for(let d=0;d<n.length;d++)if(Ff(n[d],o,l))return!0}for(let d=0;d<o.length;d++)if(Ff(o[d],n,l))return!0;return!1}function Of(o,n){if(o.length===0||n.length===0)return!1;for(let l=0;l<o.length-1;l++){const d=o[l],g=o[l+1];for(let y=0;y<n.length-1;y++)if(yw(d,g,n[y],n[y+1]))return!0}return!1}function yw(o,n,l,d){return Ye(o,l,d)!==Ye(n,l,d)&&Ye(o,n,l)!==Ye(o,n,d)}function Ff(o,n,l){const d=l*l;if(n.length===1)return o.distSqr(n[0])<d;for(let g=1;g<n.length;g++)if(s_(o,n[g-1],n[g])<d)return!0;return!1}function s_(o,n,l){const d=n.distSqr(l);if(d===0)return o.distSqr(n);const g=((o.x-n.x)*(l.x-n.x)+(o.y-n.y)*(l.y-n.y))/d;return o.distSqr(g<0?n:g>1?l:l.sub(n)._mult(g)._add(n))}function o_(o,n){let l,d,g,y=!1;for(let x=0;x<o.length;x++){l=o[x];for(let E=0,A=l.length-1;E<l.length;A=E++)d=l[E],g=l[A],d.y>n.y!=g.y>n.y&&n.x<(g.x-d.x)*(n.y-d.y)/(g.y-d.y)+d.x&&(y=!y)}return y}function pl(o,n){let l=!1;for(let d=0,g=o.length-1;d<o.length;g=d++){const y=o[d],x=o[g];y.y>n.y!=x.y>n.y&&n.x<(x.x-y.x)*(n.y-y.y)/(x.y-y.y)+y.x&&(l=!l)}return l}function vw(o,n,l){const d=l[0],g=l[2];if(o.x<d.x&&n.x<d.x||o.x>g.x&&n.x>g.x||o.y<d.y&&n.y<d.y||o.y>g.y&&n.y>g.y)return!1;const y=Ye(o,n,l[0]);return y!==Ye(o,n,l[1])||y!==Ye(o,n,l[2])||y!==Ye(o,n,l[3])}function Uc(o,n,l){const d=n.paint.get(o).value;return d.kind==="constant"?d.value:l.programConfigurations.get(n.id).getMaxValue(o)}function Lh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function kh(o,n,l,d,g){if(!n[0]&&!n[1])return o;const y=pt.convert(n)._mult(g);l==="viewport"&&y._rotate(-d);const x=[];for(let E=0;E<o.length;E++)x.push(o[E].sub(y));return x}gt("CircleBucket",zf,{omit:["layers"]});const xw=new zn({"circle-sort-key":new Ft(be.layout_circle["circle-sort-key"])});var bw={paint:new zn({"circle-radius":new Ft(be.paint_circle["circle-radius"]),"circle-color":new Ft(be.paint_circle["circle-color"]),"circle-blur":new Ft(be.paint_circle["circle-blur"]),"circle-opacity":new Ft(be.paint_circle["circle-opacity"]),"circle-translate":new At(be.paint_circle["circle-translate"]),"circle-translate-anchor":new At(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new At(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new At(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ft(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ft(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ft(be.paint_circle["circle-stroke-opacity"])}),layout:xw},Qn=1e-6,er=typeof Float32Array<"u"?Float32Array:Array;function a_(){var o=new er(9);return er!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Bf(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function l_(o,n,l){var d=n[0],g=n[1],y=n[2],x=n[3],E=n[4],A=n[5],M=n[6],D=n[7],O=n[8],N=n[9],G=n[10],$=n[11],ne=n[12],ie=n[13],_e=n[14],Te=n[15],ge=l[0],we=l[1],Oe=l[2],De=l[3];return o[0]=ge*d+we*E+Oe*O+De*ne,o[1]=ge*g+we*A+Oe*N+De*ie,o[2]=ge*y+we*M+Oe*G+De*_e,o[3]=ge*x+we*D+Oe*$+De*Te,o[4]=(ge=l[4])*d+(we=l[5])*E+(Oe=l[6])*O+(De=l[7])*ne,o[5]=ge*g+we*A+Oe*N+De*ie,o[6]=ge*y+we*M+Oe*G+De*_e,o[7]=ge*x+we*D+Oe*$+De*Te,o[8]=(ge=l[8])*d+(we=l[9])*E+(Oe=l[10])*O+(De=l[11])*ne,o[9]=ge*g+we*A+Oe*N+De*ie,o[10]=ge*y+we*M+Oe*G+De*_e,o[11]=ge*x+we*D+Oe*$+De*Te,o[12]=(ge=l[12])*d+(we=l[13])*E+(Oe=l[14])*O+(De=l[15])*ne,o[13]=ge*g+we*A+Oe*N+De*ie,o[14]=ge*y+we*M+Oe*G+De*_e,o[15]=ge*x+we*D+Oe*$+De*Te,o}Math.hypot||(Math.hypot=function(){for(var o=0,n=arguments.length;n--;)o+=arguments[n]*arguments[n];return Math.sqrt(o)});var Vc,ww=l_;function c_(){var o=new er(3);return er!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function u_(o,n,l){var d=new er(3);return d[0]=o,d[1]=n,d[2]=l,d}function Rh(o,n,l){var d=n[0],g=n[1],y=n[2],x=n[3];return o[0]=l[0]*d+l[4]*g+l[8]*y+l[12]*x,o[1]=l[1]*d+l[5]*g+l[9]*y+l[13]*x,o[2]=l[2]*d+l[6]*g+l[10]*y+l[14]*x,o[3]=l[3]*d+l[7]*g+l[11]*y+l[15]*x,o}function h_(){var o=new er(4);return er!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function d_(o,n){const l=Rh([],[o.x,o.y,0,1],n);return new pt(l[0]/l[3],l[1]/l[3])}c_(),Vc=new er(4),er!=Float32Array&&(Vc[0]=0,Vc[1]=0,Vc[2]=0,Vc[3]=0),c_(),u_(1,0,0),u_(0,1,0),h_(),h_(),a_(),function(){var o;o=new er(2),er!=Float32Array&&(o[0]=0,o[1]=0)}();class f_ extends zf{}gt("HeatmapBucket",f_,{omit:["layers"]});var Ew={paint:new zn({"heatmap-radius":new Ft(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ft(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new At(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new As(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new At(be.paint_heatmap["heatmap-opacity"])})};function Nf(o,{width:n,height:l},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==n*l*d)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${n*l*d}`)}else g=new Uint8Array(n*l*d);return o.width=n,o.height=l,o.data=g,o}function p_(o,{width:n,height:l},d){if(n===o.width&&l===o.height)return;const g=Nf({},{width:n,height:l},d);Uf(o,g,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,n),height:Math.min(o.height,l)},d),o.width=n,o.height=l,o.data=g.data}function Uf(o,n,l,d,g,y){if(g.width===0||g.height===0)return n;if(g.width>o.width||g.height>o.height||l.x>o.width-g.width||l.y>o.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>n.width||g.height>n.height||d.x>n.width-g.width||d.y>n.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=o.data,E=n.data;if(x===E)throw new Error("srcData equals dstData, so image is already copied");for(let A=0;A<g.height;A++){const M=((l.y+A)*o.width+l.x)*y,D=((d.y+A)*n.width+d.x)*y;for(let O=0;O<g.width*y;O++)E[D+O]=x[M+O]}return n}class jc{constructor(n,l){Nf(this,n,1,l)}resize(n){p_(this,n,1)}clone(){return new jc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,l,d,g,y){Uf(n,l,d,g,y,1)}}class kr{constructor(n,l){Nf(this,n,4,l)}resize(n){p_(this,n,4)}replace(n,l){l?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new kr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,l,d,g,y){Uf(n,l,d,g,y,4)}}function m_(o){const n={},l=o.resolution||256,d=o.clips?o.clips.length:1,g=o.image||new kr({width:l,height:d});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const y=(x,E,A)=>{n[o.evaluationKey]=A;const M=o.expression.evaluate(n);g.data[x+E+0]=Math.floor(255*M.r/M.a),g.data[x+E+1]=Math.floor(255*M.g/M.a),g.data[x+E+2]=Math.floor(255*M.b/M.a),g.data[x+E+3]=Math.floor(255*M.a)};if(o.clips)for(let x=0,E=0;x<d;++x,E+=4*l)for(let A=0,M=0;A<l;A++,M+=4){const D=A/(l-1),{start:O,end:N}=o.clips[x];y(E,M,O*(1-D)+N*D)}else for(let x=0,E=0;x<l;x++,E+=4)y(0,E,x/(l-1));return g}gt("AlphaImage",jc),gt("RGBAImage",kr);var Tw={paint:new zn({"hillshade-illumination-direction":new At(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new At(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new At(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new At(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new At(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new At(be.paint_hillshade["hillshade-accent-color"])})};const Aw=mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sw}=Aw;var Dh={exports:{}};function zh(o,n,l){l=l||2;var d,g,y,x,E,A,M,D=n&&n.length,O=D?n[0]*l:o.length,N=g_(o,0,O,l,!0),G=[];if(!N||N.next===N.prev)return G;if(D&&(N=function(ne,ie,_e,Te){var ge,we,Oe,De=[];for(ge=0,we=ie.length;ge<we;ge++)(Oe=g_(ne,ie[ge]*Te,ge<we-1?ie[ge+1]*Te:ne.length,Te,!1))===Oe.next&&(Oe.steiner=!0),De.push(Dw(Oe));for(De.sort(Lw),ge=0;ge<De.length;ge++)_e=kw(De[ge],_e);return _e}(o,n,N,l)),o.length>80*l){d=y=o[0],g=x=o[1];for(var $=l;$<O;$+=l)(E=o[$])<d&&(d=E),(A=o[$+1])<g&&(g=A),E>y&&(y=E),A>x&&(x=A);M=(M=Math.max(y-d,x-g))!==0?32767/M:0}return Gc(N,G,l,d,g,M,0),G}function g_(o,n,l,d,g){var y,x;if(g===Gf(o,n,l,d)>0)for(y=n;y<l;y+=d)x=v_(y,o[y],o[y+1],x);else for(y=l-d;y>=n;y-=d)x=v_(y,o[y],o[y+1],x);return x&&Oh(x,x.next)&&(Hc(x),x=x.next),x}function Sa(o,n){if(!o)return o;n||(n=o);var l,d=o;do if(l=!1,d.steiner||!Oh(d,d.next)&&dn(d.prev,d,d.next)!==0)d=d.next;else{if(Hc(d),(d=n=d.prev)===d.next)break;l=!0}while(l||d!==n);return n}function Gc(o,n,l,d,g,y,x){if(o){!x&&y&&function(D,O,N,G){var $=D;do $.z===0&&($.z=Vf($.x,$.y,O,N,G)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==D);$.prevZ.nextZ=null,$.prevZ=null,function(ne){var ie,_e,Te,ge,we,Oe,De,ft,xt=1;do{for(_e=ne,ne=null,we=null,Oe=0;_e;){for(Oe++,Te=_e,De=0,ie=0;ie<xt&&(De++,Te=Te.nextZ);ie++);for(ft=xt;De>0||ft>0&&Te;)De!==0&&(ft===0||!Te||_e.z<=Te.z)?(ge=_e,_e=_e.nextZ,De--):(ge=Te,Te=Te.nextZ,ft--),we?we.nextZ=ge:ne=ge,ge.prevZ=we,we=ge;_e=Te}we.nextZ=null,xt*=2}while(Oe>1)}($)}(o,d,g,y);for(var E,A,M=o;o.prev!==o.next;)if(E=o.prev,A=o.next,y?Pw(o,d,g,y):Iw(o))n.push(E.i/l|0),n.push(o.i/l|0),n.push(A.i/l|0),Hc(o),o=A.next,M=A.next;else if((o=A)===M){x?x===1?Gc(o=Mw(Sa(o),n,l),n,l,d,g,y,2):x===2&&Cw(o,n,l,d,g,y):Gc(Sa(o),n,l,d,g,y,1);break}}}function Iw(o){var n=o.prev,l=o,d=o.next;if(dn(n,l,d)>=0)return!1;for(var g=n.x,y=l.x,x=d.x,E=n.y,A=l.y,M=d.y,D=g<y?g<x?g:x:y<x?y:x,O=E<A?E<M?E:M:A<M?A:M,N=g>y?g>x?g:x:y>x?y:x,G=E>A?E>M?E:M:A>M?A:M,$=d.next;$!==n;){if($.x>=D&&$.x<=N&&$.y>=O&&$.y<=G&&ml(g,E,y,A,x,M,$.x,$.y)&&dn($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function Pw(o,n,l,d){var g=o.prev,y=o,x=o.next;if(dn(g,y,x)>=0)return!1;for(var E=g.x,A=y.x,M=x.x,D=g.y,O=y.y,N=x.y,G=E<A?E<M?E:M:A<M?A:M,$=D<O?D<N?D:N:O<N?O:N,ne=E>A?E>M?E:M:A>M?A:M,ie=D>O?D>N?D:N:O>N?O:N,_e=Vf(G,$,n,l,d),Te=Vf(ne,ie,n,l,d),ge=o.prevZ,we=o.nextZ;ge&&ge.z>=_e&&we&&we.z<=Te;){if(ge.x>=G&&ge.x<=ne&&ge.y>=$&&ge.y<=ie&&ge!==g&&ge!==x&&ml(E,D,A,O,M,N,ge.x,ge.y)&&dn(ge.prev,ge,ge.next)>=0||(ge=ge.prevZ,we.x>=G&&we.x<=ne&&we.y>=$&&we.y<=ie&&we!==g&&we!==x&&ml(E,D,A,O,M,N,we.x,we.y)&&dn(we.prev,we,we.next)>=0))return!1;we=we.nextZ}for(;ge&&ge.z>=_e;){if(ge.x>=G&&ge.x<=ne&&ge.y>=$&&ge.y<=ie&&ge!==g&&ge!==x&&ml(E,D,A,O,M,N,ge.x,ge.y)&&dn(ge.prev,ge,ge.next)>=0)return!1;ge=ge.prevZ}for(;we&&we.z<=Te;){if(we.x>=G&&we.x<=ne&&we.y>=$&&we.y<=ie&&we!==g&&we!==x&&ml(E,D,A,O,M,N,we.x,we.y)&&dn(we.prev,we,we.next)>=0)return!1;we=we.nextZ}return!0}function Mw(o,n,l){var d=o;do{var g=d.prev,y=d.next.next;!Oh(g,y)&&__(g,d,d.next,y)&&$c(g,y)&&$c(y,g)&&(n.push(g.i/l|0),n.push(d.i/l|0),n.push(y.i/l|0),Hc(d),Hc(d.next),d=o=y),d=d.next}while(d!==o);return Sa(d)}function Cw(o,n,l,d,g,y){var x=o;do{for(var E=x.next.next;E!==x.prev;){if(x.i!==E.i&&zw(x,E)){var A=y_(x,E);return x=Sa(x,x.next),A=Sa(A,A.next),Gc(x,n,l,d,g,y,0),void Gc(A,n,l,d,g,y,0)}E=E.next}x=x.next}while(x!==o)}function Lw(o,n){return o.x-n.x}function kw(o,n){var l=function(g,y){var x,E=y,A=g.x,M=g.y,D=-1/0;do{if(M<=E.y&&M>=E.next.y&&E.next.y!==E.y){var O=E.x+(M-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(O<=A&&O>D&&(D=O,x=E.x<E.next.x?E:E.next,O===A))return x}E=E.next}while(E!==y);if(!x)return null;var N,G=x,$=x.x,ne=x.y,ie=1/0;E=x;do A>=E.x&&E.x>=$&&A!==E.x&&ml(M<ne?A:D,M,$,ne,M<ne?D:A,M,E.x,E.y)&&(N=Math.abs(M-E.y)/(A-E.x),$c(E,g)&&(N<ie||N===ie&&(E.x>x.x||E.x===x.x&&Rw(x,E)))&&(x=E,ie=N)),E=E.next;while(E!==G);return x}(o,n);if(!l)return n;var d=y_(l,o);return Sa(d,d.next),Sa(l,l.next)}function Rw(o,n){return dn(o.prev,o,n.prev)<0&&dn(n.next,o,o.next)<0}function Vf(o,n,l,d,g){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-l)*g|0)|o<<8))|o<<4))|o<<2))|o<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-d)*g|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Dw(o){var n=o,l=o;do(n.x<l.x||n.x===l.x&&n.y<l.y)&&(l=n),n=n.next;while(n!==o);return l}function ml(o,n,l,d,g,y,x,E){return(g-x)*(n-E)>=(o-x)*(y-E)&&(o-x)*(d-E)>=(l-x)*(n-E)&&(l-x)*(y-E)>=(g-x)*(d-E)}function zw(o,n){return o.next.i!==n.i&&o.prev.i!==n.i&&!function(l,d){var g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==d.i&&g.next.i!==d.i&&__(g,g.next,l,d))return!0;g=g.next}while(g!==l);return!1}(o,n)&&($c(o,n)&&$c(n,o)&&function(l,d){var g=l,y=!1,x=(l.x+d.x)/2,E=(l.y+d.y)/2;do g.y>E!=g.next.y>E&&g.next.y!==g.y&&x<(g.next.x-g.x)*(E-g.y)/(g.next.y-g.y)+g.x&&(y=!y),g=g.next;while(g!==l);return y}(o,n)&&(dn(o.prev,o,n.prev)||dn(o,n.prev,n))||Oh(o,n)&&dn(o.prev,o,o.next)>0&&dn(n.prev,n,n.next)>0)}function dn(o,n,l){return(n.y-o.y)*(l.x-n.x)-(n.x-o.x)*(l.y-n.y)}function Oh(o,n){return o.x===n.x&&o.y===n.y}function __(o,n,l,d){var g=Bh(dn(o,n,l)),y=Bh(dn(o,n,d)),x=Bh(dn(l,d,o)),E=Bh(dn(l,d,n));return g!==y&&x!==E||!(g!==0||!Fh(o,l,n))||!(y!==0||!Fh(o,d,n))||!(x!==0||!Fh(l,o,d))||!(E!==0||!Fh(l,n,d))}function Fh(o,n,l){return n.x<=Math.max(o.x,l.x)&&n.x>=Math.min(o.x,l.x)&&n.y<=Math.max(o.y,l.y)&&n.y>=Math.min(o.y,l.y)}function Bh(o){return o>0?1:o<0?-1:0}function $c(o,n){return dn(o.prev,o,o.next)<0?dn(o,n,o.next)>=0&&dn(o,o.prev,n)>=0:dn(o,n,o.prev)<0||dn(o,o.next,n)<0}function y_(o,n){var l=new jf(o.i,o.x,o.y),d=new jf(n.i,n.x,n.y),g=o.next,y=n.prev;return o.next=n,n.prev=o,l.next=g,g.prev=l,d.next=l,l.prev=d,y.next=d,d.prev=y,d}function v_(o,n,l,d){var g=new jf(o,n,l);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function Hc(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function jf(o,n,l){this.i=o,this.x=n,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gf(o,n,l,d){for(var g=0,y=n,x=l-d;y<l;y+=d)g+=(o[x]-o[y])*(o[y+1]+o[x+1]),x=y;return g}function Ow(o,n,l,d,g){x_(o,n,l||0,d||o.length-1,g||Fw)}function x_(o,n,l,d,g){for(;d>l;){if(d-l>600){var y=d-l+1,x=n-l+1,E=Math.log(y),A=.5*Math.exp(2*E/3),M=.5*Math.sqrt(E*A*(y-A)/y)*(x-y/2<0?-1:1);x_(o,n,Math.max(l,Math.floor(n-x*A/y+M)),Math.min(d,Math.floor(n+(y-x)*A/y+M)),g)}var D=o[n],O=l,N=d;for(qc(o,l,n),g(o[d],D)>0&&qc(o,l,d);O<N;){for(qc(o,O,N),O++,N--;g(o[O],D)<0;)O++;for(;g(o[N],D)>0;)N--}g(o[l],D)===0?qc(o,l,N):qc(o,++N,d),N<=n&&(l=N+1),n<=N&&(d=N-1)}}function qc(o,n,l){var d=o[n];o[n]=o[l],o[l]=d}function Fw(o,n){return o<n?-1:o>n?1:0}function $f(o,n){const l=o.length;if(l<=1)return[o];const d=[];let g,y;for(let x=0;x<l;x++){const E=Qe(o[x]);E!==0&&(o[x].area=Math.abs(E),y===void 0&&(y=E<0),y===E<0?(g&&d.push(g),g=[o[x]]):g.push(o[x]))}if(g&&d.push(g),n>1)for(let x=0;x<d.length;x++)d[x].length<=n||(Ow(d[x],n,1,d[x].length-1,Bw),d[x]=d[x].slice(0,n));return d}function Bw(o,n){return n.area-o.area}function Hf(o,n,l){const d=l.patternDependencies;let g=!1;for(const y of n){const x=y.paint.get(`${o}-pattern`);x.isConstant()||(g=!0);const E=x.constantOr(null);E&&(g=!0,d[E.to]=!0,d[E.from]=!0)}return g}function qf(o,n,l,d,g){const y=g.patternDependencies;for(const x of n){const E=x.paint.get(`${o}-pattern`).value;if(E.kind!=="constant"){let A=E.evaluate({zoom:d-1},l,{},g.availableImages),M=E.evaluate({zoom:d},l,{},g.availableImages),D=E.evaluate({zoom:d+1},l,{},g.availableImages);A=A&&A.name?A.name:A,M=M&&M.name?M.name:M,D=D&&D.name?D.name:D,y[A]=!0,y[M]=!0,y[D]=!0,l.patterns[x.id]={min:A,mid:M,max:D}}}return l}Dh.exports=zh,Dh.exports.default=zh,zh.deviation=function(o,n,l,d){var g=n&&n.length,y=Math.abs(Gf(o,0,g?n[0]*l:o.length,l));if(g)for(var x=0,E=n.length;x<E;x++)y-=Math.abs(Gf(o,n[x]*l,x<E-1?n[x+1]*l:o.length,l));var A=0;for(x=0;x<d.length;x+=3){var M=d[x]*l,D=d[x+1]*l,O=d[x+2]*l;A+=Math.abs((o[M]-o[O])*(o[D+1]-o[M+1])-(o[M]-o[D])*(o[O+1]-o[M+1]))}return y===0&&A===0?0:Math.abs((A-y)/y)},zh.flatten=function(o){for(var n=o[0][0].length,l={vertices:[],holes:[],dimensions:n},d=0,g=0;g<o.length;g++){for(var y=0;y<o[g].length;y++)for(var x=0;x<n;x++)l.vertices.push(o[g][y][x]);g>0&&l.holes.push(d+=o[g-1].length)}return l};class Wf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ai,this.indexArray=new Jn,this.indexArray2=new ss,this.programConfigurations=new Ea(n.layers,n.zoom),this.segments=new ni,this.segments2=new ni,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(n,l,d){this.hasPattern=Hf("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),y=!g.isConstant(),x=[];for(const{feature:E,id:A,index:M,sourceLayerIndex:D}of n){const O=this.layers[0]._featureFilter.needGeometry,N=Aa(E,O);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),N,d))continue;const G=y?g.evaluate(N,{},d,l.availableImages):void 0,$={id:A,properties:E.properties,type:E.type,sourceLayerIndex:D,index:M,geometry:O?N.geometry:Ta(E),patterns:{},sortKey:G};x.push($)}y&&x.sort((E,A)=>E.sortKey-A.sortKey);for(const E of x){const{geometry:A,index:M,sourceLayerIndex:D}=E;if(this.hasPattern){const O=qf("fill",this.layers,E,this.zoom,l);this.patternFeatures.push(O)}else this.addFeature(E,A,M,d,{});l.featureIndex.insert(n[M].feature,A,M,D,this.index)}}update(n,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,l,this.stateDependentLayers,d)}addFeatures(n,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Sw),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,l,d,g,y){for(const x of $f(l,500)){let E=0;for(const G of x)E+=G.length;const A=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),M=A.vertexLength,D=[],O=[];for(const G of x){if(G.length===0)continue;G!==x[0]&&O.push(D.length/2);const $=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),ne=$.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(ne+G.length-1,ne),D.push(G[0].x),D.push(G[0].y);for(let ie=1;ie<G.length;ie++)this.layoutVertexArray.emplaceBack(G[ie].x,G[ie].y),this.indexArray2.emplaceBack(ne+ie-1,ne+ie),D.push(G[ie].x),D.push(G[ie].y);$.vertexLength+=G.length,$.primitiveLength+=G.length}const N=Dh.exports(D,O);for(let G=0;G<N.length;G+=3)this.indexArray.emplaceBack(M+N[G],M+N[G+1],M+N[G+2]);A.vertexLength+=E,A.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,y,g)}}gt("FillBucket",Wf,{omit:["layers","patternFeatures"]});const Nw=new zn({"fill-sort-key":new Ft(be.layout_fill["fill-sort-key"])});var Uw={paint:new zn({"fill-antialias":new At(be.paint_fill["fill-antialias"]),"fill-opacity":new Ft(be.paint_fill["fill-opacity"]),"fill-color":new Ft(be.paint_fill["fill-color"]),"fill-outline-color":new Ft(be.paint_fill["fill-outline-color"]),"fill-translate":new At(be.paint_fill["fill-translate"]),"fill-translate-anchor":new At(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new ko(be.paint_fill["fill-pattern"])}),layout:Nw};const Vw=mn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),jw=mn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Gw}=Vw;var zo={},$w=pt,b_=gl;function gl(o,n,l,d,g){this.properties={},this.extent=l,this.type=0,this._pbf=o,this._geometry=-1,this._keys=d,this._values=g,o.readFields(Hw,this,n)}function Hw(o,n,l){o==1?n.id=l.readVarint():o==2?function(d,g){for(var y=d.readVarint()+d.pos;d.pos<y;){var x=g._keys[d.readVarint()],E=g._values[d.readVarint()];g.properties[x]=E}}(l,n):o==3?n.type=l.readVarint():o==4&&(n._geometry=l.pos)}function qw(o){for(var n,l,d=0,g=0,y=o.length,x=y-1;g<y;x=g++)d+=((l=o[x]).x-(n=o[g]).x)*(n.y+l.y);return d}gl.types=["Unknown","Point","LineString","Polygon"],gl.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var n,l=o.readVarint()+o.pos,d=1,g=0,y=0,x=0,E=[];o.pos<l;){if(g<=0){var A=o.readVarint();d=7&A,g=A>>3}if(g--,d===1||d===2)y+=o.readSVarint(),x+=o.readSVarint(),d===1&&(n&&E.push(n),n=[]),n.push(new $w(y,x));else{if(d!==7)throw new Error("unknown command "+d);n&&n.push(n[0].clone())}}return n&&E.push(n),E},gl.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var n=o.readVarint()+o.pos,l=1,d=0,g=0,y=0,x=1/0,E=-1/0,A=1/0,M=-1/0;o.pos<n;){if(d<=0){var D=o.readVarint();l=7&D,d=D>>3}if(d--,l===1||l===2)(g+=o.readSVarint())<x&&(x=g),g>E&&(E=g),(y+=o.readSVarint())<A&&(A=y),y>M&&(M=y);else if(l!==7)throw new Error("unknown command "+l)}return[x,A,E,M]},gl.prototype.toGeoJSON=function(o,n,l){var d,g,y=this.extent*Math.pow(2,l),x=this.extent*o,E=this.extent*n,A=this.loadGeometry(),M=gl.types[this.type];function D(G){for(var $=0;$<G.length;$++){var ne=G[$];G[$]=[360*(ne.x+x)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+E)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(d=0;d<A.length;d++)O[d]=A[d][0];D(A=O);break;case 2:for(d=0;d<A.length;d++)D(A[d]);break;case 3:for(A=function(G){var $=G.length;if($<=1)return[G];for(var ne,ie,_e=[],Te=0;Te<$;Te++){var ge=qw(G[Te]);ge!==0&&(ie===void 0&&(ie=ge<0),ie===ge<0?(ne&&_e.push(ne),ne=[G[Te]]):ne.push(G[Te]))}return ne&&_e.push(ne),_e}(A),d=0;d<A.length;d++)for(g=0;g<A[d].length;g++)D(A[d][g])}A.length===1?A=A[0]:M="Multi"+M;var N={type:"Feature",geometry:{type:M,coordinates:A},properties:this.properties};return"id"in this&&(N.id=this.id),N};var Ww=b_,w_=E_;function E_(o,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Zw,this,n),this.length=this._features.length}function Zw(o,n,l){o===15?n.version=l.readVarint():o===1?n.name=l.readString():o===5?n.extent=l.readVarint():o===2?n._features.push(l.pos):o===3?n._keys.push(l.readString()):o===4&&n._values.push(function(d){for(var g=null,y=d.readVarint()+d.pos;d.pos<y;){var x=d.readVarint()>>3;g=x===1?d.readString():x===2?d.readFloat():x===3?d.readDouble():x===4?d.readVarint64():x===5?d.readVarint():x===6?d.readSVarint():x===7?d.readBoolean():null}return g}(l))}E_.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var n=this._pbf.readVarint()+this._pbf.pos;return new Ww(this._pbf,n,this.extent,this._keys,this._values)};var Xw=w_;function Yw(o,n,l){if(o===3){var d=new Xw(l,l.readVarint()+l.pos);d.length&&(n[d.name]=d)}}zo.VectorTile=function(o,n){this.layers=o.readFields(Yw,{},n)},zo.VectorTileFeature=b_,zo.VectorTileLayer=w_;const Kw=zo.VectorTileFeature.types,Zf=Math.pow(2,13);function Wc(o,n,l,d,g,y,x,E){o.emplaceBack(n,l,2*Math.floor(d*Zf)+x,g*Zf*2,y*Zf*2,Math.round(E))}class Xf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new di,this.centroidVertexArray=new Rt,this.indexArray=new Jn,this.programConfigurations=new Ea(n.layers,n.zoom),this.segments=new ni,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(n,l,d){this.features=[],this.hasPattern=Hf("fill-extrusion",this.layers,l);for(const{feature:g,id:y,index:x,sourceLayerIndex:E}of n){const A=this.layers[0]._featureFilter.needGeometry,M=Aa(g,A);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),M,d))continue;const D={id:y,sourceLayerIndex:E,index:x,geometry:A?M.geometry:Ta(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(qf("fill-extrusion",this.layers,D,this.zoom,l)):this.addFeature(D,D.geometry,x,d,{}),l.featureIndex.insert(g,D.geometry,x,E,this.index,!0)}}addFeatures(n,l,d){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,l,d)}}update(n,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,l,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Gw),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,jw.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,l,d,g,y){const x={x:0,y:0,vertexCount:0};for(const E of $f(l,500)){let A=0;for(const $ of E)A+=$.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const $ of E){if($.length===0||Qw($))continue;let ne=0;for(let ie=0;ie<$.length;ie++){const _e=$[ie];if(ie>=1){const Te=$[ie-1];if(!Jw(_e,Te)){M.vertexLength+4>ni.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ge=_e.sub(Te)._perp()._unit(),we=Te.dist(_e);ne+we>32768&&(ne=0),Wc(this.layoutVertexArray,_e.x,_e.y,ge.x,ge.y,0,0,ne),Wc(this.layoutVertexArray,_e.x,_e.y,ge.x,ge.y,0,1,ne),x.x+=2*_e.x,x.y+=2*_e.y,x.vertexCount+=2,ne+=we,Wc(this.layoutVertexArray,Te.x,Te.y,ge.x,ge.y,0,0,ne),Wc(this.layoutVertexArray,Te.x,Te.y,ge.x,ge.y,0,1,ne),x.x+=2*Te.x,x.y+=2*Te.y,x.vertexCount+=2;const Oe=M.vertexLength;this.indexArray.emplaceBack(Oe,Oe+2,Oe+1),this.indexArray.emplaceBack(Oe+1,Oe+2,Oe+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+A>ni.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),Kw[n.type]!=="Polygon")continue;const D=[],O=[],N=M.vertexLength;for(const $ of E)if($.length!==0){$!==E[0]&&O.push(D.length/2);for(let ne=0;ne<$.length;ne++){const ie=$[ne];Wc(this.layoutVertexArray,ie.x,ie.y,0,0,1,1,0),x.x+=ie.x,x.y+=ie.y,x.vertexCount+=1,D.push(ie.x),D.push(ie.y)}}const G=Dh.exports(D,O);for(let $=0;$<G.length;$+=3)this.indexArray.emplaceBack(N+G[$],N+G[$+2],N+G[$+1]);M.primitiveLength+=G.length/3,M.vertexLength+=A}for(let E=0;E<x.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,y,g)}}function Jw(o,n){return o.x===n.x&&(o.x<0||o.x>En)||o.y===n.y&&(o.y<0||o.y>En)}function Qw(o){return o.every(n=>n.x<0)||o.every(n=>n.x>En)||o.every(n=>n.y<0)||o.every(n=>n.y>En)}gt("FillExtrusionBucket",Xf,{omit:["layers","features"]});var e2={paint:new zn({"fill-extrusion-opacity":new At(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ft(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new At(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new At(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ko(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ft(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ft(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new At(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Zc(o,n){return o.x*n.x+o.y*n.y}function T_(o,n){if(o.length===1){let l=0;const d=n[l++];let g;for(;!g||d.equals(g);)if(g=n[l++],!g)return 1/0;for(;l<n.length;l++){const y=n[l],x=o[0],E=g.sub(d),A=y.sub(d),M=x.sub(d),D=Zc(E,E),O=Zc(E,A),N=Zc(A,A),G=Zc(M,E),$=Zc(M,A),ne=D*N-O*O,ie=(N*G-O*$)/ne,_e=(D*$-O*G)/ne,Te=d.z*(1-ie-_e)+g.z*ie+y.z*_e;if(isFinite(Te))return Te}return 1/0}{let l=1/0;for(const d of n)l=Math.min(l,d.z);return l}}const t2=mn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:i2}=t2,n2=mn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:r2}=n2,s2=zo.VectorTileFeature.types,o2=Math.cos(Math.PI/180*37.5),A_=Math.pow(2,14)/.5;class Yf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new fi,this.layoutVertexArray2=new Si,this.indexArray=new Jn,this.programConfigurations=new Ea(n.layers,n.zoom),this.segments=new ni,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(n,l,d){this.hasPattern=Hf("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),y=!g.isConstant(),x=[];for(const{feature:E,id:A,index:M,sourceLayerIndex:D}of n){const O=this.layers[0]._featureFilter.needGeometry,N=Aa(E,O);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),N,d))continue;const G=y?g.evaluate(N,{},d):void 0,$={id:A,properties:E.properties,type:E.type,sourceLayerIndex:D,index:M,geometry:O?N.geometry:Ta(E),patterns:{},sortKey:G};x.push($)}y&&x.sort((E,A)=>E.sortKey-A.sortKey);for(const E of x){const{geometry:A,index:M,sourceLayerIndex:D}=E;if(this.hasPattern){const O=qf("line",this.layers,E,this.zoom,l);this.patternFeatures.push(O)}else this.addFeature(E,A,M,d,{});l.featureIndex.insert(n[M].feature,A,M,D,this.index)}}update(n,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,l,this.stateDependentLayers,d)}addFeatures(n,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,r2)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,i2),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,l,d,g,y){const x=this.layers[0].layout,E=x.get("line-join").evaluate(n,{}),A=x.get("line-cap"),M=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const O of l)this.addLine(O,n,E,A,M,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,y,g)}addLine(n,l,d,g,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let _e=0;_e<n.length-1;_e++)this.totalDistance+=n[_e].dist(n[_e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=s2[l.type]==="Polygon";let A=n.length;for(;A>=2&&n[A-1].equals(n[A-2]);)A--;let M=0;for(;M<A-1&&n[M].equals(n[M+1]);)M++;if(A<(E?3:2))return;d==="bevel"&&(y=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let N,G,$,ne,ie;this.e1=this.e2=-1,E&&(N=n[A-2],ie=n[M].sub(N)._unit()._perp());for(let _e=M;_e<A;_e++){if($=_e===A-1?E?n[M+1]:void 0:n[_e+1],$&&n[_e].equals($))continue;ie&&(ne=ie),N&&(G=N),N=n[_e],ie=$?$.sub(N)._unit()._perp():ne,ne=ne||ie;let Te=ne.add(ie);Te.x===0&&Te.y===0||Te._unit();const ge=ne.x*ie.x+ne.y*ie.y,we=Te.x*ie.x+Te.y*ie.y,Oe=we!==0?1/we:1/0,De=2*Math.sqrt(2-2*we),ft=we<o2&&G&&$,xt=ne.x*ie.y-ne.y*ie.x>0;if(ft&&_e>M){const Je=N.dist(G);if(Je>2*D){const ot=N.sub(N.sub(G)._mult(D/Je)._round());this.updateDistance(G,ot),this.addCurrentVertex(ot,ne,0,0,O),G=ot}}const st=G&&$;let tt=st?d:E?"butt":g;if(st&&tt==="round"&&(Oe<x?tt="miter":Oe<=2&&(tt="fakeround")),tt==="miter"&&Oe>y&&(tt="bevel"),tt==="bevel"&&(Oe>2&&(tt="flipbevel"),Oe<y&&(tt="miter")),G&&this.updateDistance(G,N),tt==="miter")Te._mult(Oe),this.addCurrentVertex(N,Te,0,0,O);else if(tt==="flipbevel"){if(Oe>100)Te=ie.mult(-1);else{const Je=Oe*ne.add(ie).mag()/ne.sub(ie).mag();Te._perp()._mult(Je*(xt?-1:1))}this.addCurrentVertex(N,Te,0,0,O),this.addCurrentVertex(N,Te.mult(-1),0,0,O)}else if(tt==="bevel"||tt==="fakeround"){const Je=-Math.sqrt(Oe*Oe-1),ot=xt?Je:0,it=xt?0:Je;if(G&&this.addCurrentVertex(N,ne,ot,it,O),tt==="fakeround"){const qe=Math.round(180*De/Math.PI/20);for(let Dt=1;Dt<qe;Dt++){let It=Dt/qe;if(It!==.5){const Ui=It-.5;It+=It*Ui*(It-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*Ui*Ui+(.848013+ge*(.215638*ge-1.06021)))}const Qt=ie.sub(ne)._mult(It)._add(ne)._unit()._mult(xt?-1:1);this.addHalfVertex(N,Qt.x,Qt.y,!1,xt,0,O)}}$&&this.addCurrentVertex(N,ie,-ot,-it,O)}else if(tt==="butt")this.addCurrentVertex(N,Te,0,0,O);else if(tt==="square"){const Je=G?1:-1;this.addCurrentVertex(N,Te,Je,Je,O)}else tt==="round"&&(G&&(this.addCurrentVertex(N,ne,0,0,O),this.addCurrentVertex(N,ne,1,1,O,!0)),$&&(this.addCurrentVertex(N,ie,-1,-1,O,!0),this.addCurrentVertex(N,ie,0,0,O)));if(ft&&_e<A-1){const Je=N.dist($);if(Je>2*D){const ot=N.add($.sub(N)._mult(D/Je)._round());this.updateDistance(N,ot),this.addCurrentVertex(ot,ie,0,0,O),N=ot}}}}addCurrentVertex(n,l,d,g,y,x=!1){const E=l.y*g-l.x,A=-l.y-l.x*g;this.addHalfVertex(n,l.x+l.y*d,l.y-l.x*d,x,!1,d,y),this.addHalfVertex(n,E,A,x,!0,-g,y),this.distance>A_/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(n,l,d,g,y,x))}addHalfVertex({x:n,y:l},d,g,y,x,E,A){const M=.5*(this.lineClips?this.scaledDistance*(A_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(y?1:0),(l<<1)+(x?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(E===0?0:E<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),A.primitiveLength++),x?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,l){this.distance+=n.dist(l),this.updateScaledDistance()}}gt("LineBucket",Yf,{omit:["layers","patternFeatures"]});const a2=new zn({"line-cap":new At(be.layout_line["line-cap"]),"line-join":new Ft(be.layout_line["line-join"]),"line-miter-limit":new At(be.layout_line["line-miter-limit"]),"line-round-limit":new At(be.layout_line["line-round-limit"]),"line-sort-key":new Ft(be.layout_line["line-sort-key"])});var S_={paint:new zn({"line-opacity":new Ft(be.paint_line["line-opacity"]),"line-color":new Ft(be.paint_line["line-color"]),"line-translate":new At(be.paint_line["line-translate"]),"line-translate-anchor":new At(be.paint_line["line-translate-anchor"]),"line-width":new Ft(be.paint_line["line-width"]),"line-gap-width":new Ft(be.paint_line["line-gap-width"]),"line-offset":new Ft(be.paint_line["line-offset"]),"line-blur":new Ft(be.paint_line["line-blur"]),"line-dasharray":new zc(be.paint_line["line-dasharray"]),"line-pattern":new ko(be.paint_line["line-pattern"]),"line-gradient":new As(be.paint_line["line-gradient"])}),layout:a2};const I_=new class extends Ft{possiblyEvaluate(o,n){return n=new Gi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(o,n)}evaluate(o,n,l,d){return n=ee({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(o,n,l,d)}}(S_.paint.properties["line-width"].specification);function P_(o,n){return n>0?n+2*o:o}I_.useIntegerZoom=!0;const l2=mn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),c2=mn([{name:"a_projected_pos",components:3,type:"Float32"}],4);mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const u2=mn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);mn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const M_=mn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),h2=mn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function d2(o,n,l){return o.sections.forEach(d=>{d.text=function(g,y,x){const E=y.layout.get("text-transform").evaluate(x,{});return E==="uppercase"?g=g.toLocaleUpperCase():E==="lowercase"&&(g=g.toLocaleLowerCase()),wr.applyArabicShaping&&(g=wr.applyArabicShaping(g)),g}(d.text,n,l)}),o}mn([{name:"triangle",components:3,type:"Uint16"}]),mn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),mn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),mn([{type:"Float32",name:"offsetX"}]),mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Xc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var On=24,Kf=Mi,C_=function(o,n,l,d,g){var y,x,E=8*g-d-1,A=(1<<E)-1,M=A>>1,D=-7,O=l?g-1:0,N=l?-1:1,G=o[n+O];for(O+=N,y=G&(1<<-D)-1,G>>=-D,D+=E;D>0;y=256*y+o[n+O],O+=N,D-=8);for(x=y&(1<<-D)-1,y>>=-D,D+=d;D>0;x=256*x+o[n+O],O+=N,D-=8);if(y===0)y=1-M;else{if(y===A)return x?NaN:1/0*(G?-1:1);x+=Math.pow(2,d),y-=M}return(G?-1:1)*x*Math.pow(2,y-d)},L_=function(o,n,l,d,g,y){var x,E,A,M=8*y-g-1,D=(1<<M)-1,O=D>>1,N=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=d?0:y-1,$=d?1:-1,ne=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(E=isNaN(n)?1:0,x=D):(x=Math.floor(Math.log(n)/Math.LN2),n*(A=Math.pow(2,-x))<1&&(x--,A*=2),(n+=x+O>=1?N/A:N*Math.pow(2,1-O))*A>=2&&(x++,A/=2),x+O>=D?(E=0,x=D):x+O>=1?(E=(n*A-1)*Math.pow(2,g),x+=O):(E=n*Math.pow(2,O-1)*Math.pow(2,g),x=0));g>=8;o[l+G]=255&E,G+=$,E/=256,g-=8);for(x=x<<g|E,M+=g;M>0;o[l+G]=255&x,G+=$,x/=256,M-=8);o[l+G-$]|=128*ne};function Mi(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Mi.Varint=0,Mi.Fixed64=1,Mi.Bytes=2,Mi.Fixed32=5;var Oo,Jf=4294967296,k_=1/Jf,R_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function eo(o){return o.type===Mi.Bytes?o.readVarint()+o.pos:o.pos+1}function _l(o,n,l){return l?4294967296*n+(o>>>0):4294967296*(n>>>0)+(o>>>0)}function D_(o,n,l){var d=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));l.realloc(d);for(var g=l.pos-1;g>=o;g--)l.buf[g+d]=l.buf[g]}function f2(o,n){for(var l=0;l<o.length;l++)n.writeVarint(o[l])}function p2(o,n){for(var l=0;l<o.length;l++)n.writeSVarint(o[l])}function m2(o,n){for(var l=0;l<o.length;l++)n.writeFloat(o[l])}function g2(o,n){for(var l=0;l<o.length;l++)n.writeDouble(o[l])}function _2(o,n){for(var l=0;l<o.length;l++)n.writeBoolean(o[l])}function y2(o,n){for(var l=0;l<o.length;l++)n.writeFixed32(o[l])}function v2(o,n){for(var l=0;l<o.length;l++)n.writeSFixed32(o[l])}function x2(o,n){for(var l=0;l<o.length;l++)n.writeFixed64(o[l])}function b2(o,n){for(var l=0;l<o.length;l++)n.writeSFixed64(o[l])}function Nh(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+16777216*o[n+3]}function yl(o,n,l){o[l]=n,o[l+1]=n>>>8,o[l+2]=n>>>16,o[l+3]=n>>>24}function z_(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+(o[n+3]<<24)}function w2(o,n,l){o===1&&l.readMessage(E2,n)}function E2(o,n,l){if(o===3){const{id:d,bitmap:g,width:y,height:x,left:E,top:A,advance:M}=l.readMessage(T2,{});n.push({id:d,bitmap:new jc({width:y+6,height:x+6},g),metrics:{width:y,height:x,left:E,top:A,advance:M}})}}function T2(o,n,l){o===1?n.id=l.readVarint():o===2?n.bitmap=l.readBytes():o===3?n.width=l.readVarint():o===4?n.height=l.readVarint():o===5?n.left=l.readSVarint():o===6?n.top=l.readSVarint():o===7&&(n.advance=l.readVarint())}function O_(o){let n=0,l=0;for(const x of o)n+=x.w*x.h,l=Math.max(l,x.w);o.sort((x,E)=>E.h-x.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),l),h:1/0}];let g=0,y=0;for(const x of o)for(let E=d.length-1;E>=0;E--){const A=d[E];if(!(x.w>A.w||x.h>A.h)){if(x.x=A.x,x.y=A.y,y=Math.max(y,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===A.w&&x.h===A.h){const M=d.pop();E<d.length&&(d[E]=M)}else x.h===A.h?(A.x+=x.w,A.w-=x.w):x.w===A.w?(A.y+=x.h,A.h-=x.h):(d.push({x:A.x+x.w,y:A.y,w:A.w-x.w,h:x.h}),A.y+=x.h,A.h-=x.h);break}}return{w:g,h:y,fill:n/(g*y)||0}}Mi.prototype={destroy:function(){this.buf=null},readFields:function(o,n,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),g=d>>3,y=this.pos;this.type=7&d,o(g,n,this),this.pos===y&&this.skip(d)}return n},readMessage:function(o,n){return this.readFields(o,n,this.readVarint()+this.pos)},readFixed32:function(){var o=Nh(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=z_(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Nh(this.buf,this.pos)+Nh(this.buf,this.pos+4)*Jf;return this.pos+=8,o},readSFixed64:function(){var o=Nh(this.buf,this.pos)+z_(this.buf,this.pos+4)*Jf;return this.pos+=8,o},readFloat:function(){var o=C_(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=C_(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var n,l,d=this.buf;return n=127&(l=d[this.pos++]),l<128?n:(n|=(127&(l=d[this.pos++]))<<7,l<128?n:(n|=(127&(l=d[this.pos++]))<<14,l<128?n:(n|=(127&(l=d[this.pos++]))<<21,l<128?n:function(g,y,x){var E,A,M=x.buf;if(E=(112&(A=M[x.pos++]))>>4,A<128||(E|=(127&(A=M[x.pos++]))<<3,A<128)||(E|=(127&(A=M[x.pos++]))<<10,A<128)||(E|=(127&(A=M[x.pos++]))<<17,A<128)||(E|=(127&(A=M[x.pos++]))<<24,A<128)||(E|=(1&(A=M[x.pos++]))<<31,A<128))return _l(g,E,y);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(l=d[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,n=this.pos;return this.pos=o,o-n>=12&&R_?function(l,d,g){return R_.decode(l.subarray(d,g))}(this.buf,n,o):function(l,d,g){for(var y="",x=d;x<g;){var E,A,M,D=l[x],O=null,N=D>239?4:D>223?3:D>191?2:1;if(x+N>g)break;N===1?D<128&&(O=D):N===2?(192&(E=l[x+1]))==128&&(O=(31&D)<<6|63&E)<=127&&(O=null):N===3?(A=l[x+2],(192&(E=l[x+1]))==128&&(192&A)==128&&((O=(15&D)<<12|(63&E)<<6|63&A)<=2047||O>=55296&&O<=57343)&&(O=null)):N===4&&(A=l[x+2],M=l[x+3],(192&(E=l[x+1]))==128&&(192&A)==128&&(192&M)==128&&((O=(15&D)<<18|(63&E)<<12|(63&A)<<6|63&M)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,N=1):O>65535&&(O-=65536,y+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),y+=String.fromCharCode(O),x+=N}return y}(this.buf,n,o)},readBytes:function(){var o=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,o);return this.pos=o,n},readPackedVarint:function(o,n){if(this.type!==Mi.Bytes)return o.push(this.readVarint(n));var l=eo(this);for(o=o||[];this.pos<l;)o.push(this.readVarint(n));return o},readPackedSVarint:function(o){if(this.type!==Mi.Bytes)return o.push(this.readSVarint());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Mi.Bytes)return o.push(this.readBoolean());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Mi.Bytes)return o.push(this.readFloat());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Mi.Bytes)return o.push(this.readDouble());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Mi.Bytes)return o.push(this.readFixed32());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Mi.Bytes)return o.push(this.readSFixed32());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Mi.Bytes)return o.push(this.readFixed64());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Mi.Bytes)return o.push(this.readSFixed64());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed64());return o},skip:function(o){var n=7&o;if(n===Mi.Varint)for(;this.buf[this.pos++]>127;);else if(n===Mi.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Mi.Fixed32)this.pos+=4;else{if(n!==Mi.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(o,n){this.writeVarint(o<<3|n)},realloc:function(o){for(var n=this.length||16;n<this.pos+o;)n*=2;if(n!==this.length){var l=new Uint8Array(n);l.set(this.buf),this.buf=l,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),yl(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),yl(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),yl(this.buf,-1&o,this.pos),yl(this.buf,Math.floor(o*k_),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),yl(this.buf,-1&o,this.pos),yl(this.buf,Math.floor(o*k_),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(n,l){var d,g;if(n>=0?(d=n%4294967296|0,g=n/4294967296|0):(g=~(-n/4294967296),4294967295^(d=~(-n%4294967296))?d=d+1|0:(d=0,g=g+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(y,x,E){E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,E.buf[E.pos]=127&(y>>>=7)}(d,0,l),function(y,x){var E=(7&y)<<4;x.buf[x.pos++]|=E|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))}(g,l)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var n=this.pos;this.pos=function(d,g,y){for(var x,E,A=0;A<g.length;A++){if((x=g.charCodeAt(A))>55295&&x<57344){if(!E){x>56319||A+1===g.length?(d[y++]=239,d[y++]=191,d[y++]=189):E=x;continue}if(x<56320){d[y++]=239,d[y++]=191,d[y++]=189,E=x;continue}x=E-55296<<10|x-56320|65536,E=null}else E&&(d[y++]=239,d[y++]=191,d[y++]=189,E=null);x<128?d[y++]=x:(x<2048?d[y++]=x>>6|192:(x<65536?d[y++]=x>>12|224:(d[y++]=x>>18|240,d[y++]=x>>12&63|128),d[y++]=x>>6&63|128),d[y++]=63&x|128)}return y}(this.buf,o,this.pos);var l=this.pos-n;l>=128&&D_(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l},writeFloat:function(o){this.realloc(4),L_(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),L_(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var n=o.length;this.writeVarint(n),this.realloc(n);for(var l=0;l<n;l++)this.buf[this.pos++]=o[l]},writeRawMessage:function(o,n){this.pos++;var l=this.pos;o(n,this);var d=this.pos-l;d>=128&&D_(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(o,n,l){this.writeTag(o,Mi.Bytes),this.writeRawMessage(n,l)},writePackedVarint:function(o,n){n.length&&this.writeMessage(o,f2,n)},writePackedSVarint:function(o,n){n.length&&this.writeMessage(o,p2,n)},writePackedBoolean:function(o,n){n.length&&this.writeMessage(o,_2,n)},writePackedFloat:function(o,n){n.length&&this.writeMessage(o,m2,n)},writePackedDouble:function(o,n){n.length&&this.writeMessage(o,g2,n)},writePackedFixed32:function(o,n){n.length&&this.writeMessage(o,y2,n)},writePackedSFixed32:function(o,n){n.length&&this.writeMessage(o,v2,n)},writePackedFixed64:function(o,n){n.length&&this.writeMessage(o,x2,n)},writePackedSFixed64:function(o,n){n.length&&this.writeMessage(o,b2,n)},writeBytesField:function(o,n){this.writeTag(o,Mi.Bytes),this.writeBytes(n)},writeFixed32Field:function(o,n){this.writeTag(o,Mi.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(o,n){this.writeTag(o,Mi.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(o,n){this.writeTag(o,Mi.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(o,n){this.writeTag(o,Mi.Fixed64),this.writeSFixed64(n)},writeVarintField:function(o,n){this.writeTag(o,Mi.Varint),this.writeVarint(n)},writeSVarintField:function(o,n){this.writeTag(o,Mi.Varint),this.writeSVarint(n)},writeStringField:function(o,n){this.writeTag(o,Mi.Bytes),this.writeString(n)},writeFloatField:function(o,n){this.writeTag(o,Mi.Fixed32),this.writeFloat(n)},writeDoubleField:function(o,n){this.writeTag(o,Mi.Fixed64),this.writeDouble(n)},writeBooleanField:function(o,n){this.writeVarintField(o,Boolean(n))}};class Qf{constructor(n,{pixelRatio:l,version:d,stretchX:g,stretchY:y,content:x}){this.paddedRect=n,this.pixelRatio=l,this.stretchX=g,this.stretchY=y,this.content=x,this.version=d}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class F_{constructor(n,l){const d={},g={};this.haveRenderCallbacks=[];const y=[];this.addImages(n,d,y),this.addImages(l,g,y);const{w:x,h:E}=O_(y),A=new kr({width:x||1,height:E||1});for(const M in n){const D=n[M],O=d[M].paddedRect;kr.copy(D.data,A,{x:0,y:0},{x:O.x+1,y:O.y+1},D.data)}for(const M in l){const D=l[M],O=g[M].paddedRect,N=O.x+1,G=O.y+1,$=D.data.width,ne=D.data.height;kr.copy(D.data,A,{x:0,y:0},{x:N,y:G},D.data),kr.copy(D.data,A,{x:0,y:ne-1},{x:N,y:G-1},{width:$,height:1}),kr.copy(D.data,A,{x:0,y:0},{x:N,y:G+ne},{width:$,height:1}),kr.copy(D.data,A,{x:$-1,y:0},{x:N-1,y:G},{width:1,height:ne}),kr.copy(D.data,A,{x:0,y:0},{x:N+$,y:G},{width:1,height:ne})}this.image=A,this.iconPositions=d,this.patternPositions=g}addImages(n,l,d){for(const g in n){const y=n[g],x={x:0,y:0,w:y.data.width+2,h:y.data.height+2};d.push(x),l[g]=new Qf(x,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(n,l){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in n.updatedImages)this.patchUpdatedImage(this.iconPositions[d],n.getImage(d),l),this.patchUpdatedImage(this.patternPositions[d],n.getImage(d),l)}patchUpdatedImage(n,l,d){if(!n||!l||n.version===l.version)return;n.version=l.version;const[g,y]=n.tl;d.update(l.data,void 0,{x:g,y})}}gt("ImagePosition",Qf),gt("ImageAtlas",F_),c.WritingMode=void 0,(Oo=c.WritingMode||(c.WritingMode={}))[Oo.none=0]="none",Oo[Oo.horizontal=1]="horizontal",Oo[Oo.vertical=2]="vertical",Oo[Oo.horizontalOnly=3]="horizontalOnly";const Uh=-17;class Yc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,l){const d=new Yc;return d.scale=n||1,d.fontStack=l,d}static forImage(n){const l=new Yc;return l.imageName=n,l}}class vl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,l){const d=new vl;for(let g=0;g<n.sections.length;g++){const y=n.sections[g];y.image?d.addImageSection(y):d.addTextSection(y,l)}return d}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let l="";for(let d=0;d<n.length;d++){const g=n.charCodeAt(d+1)||null,y=n.charCodeAt(d-1)||null;l+=g&&xh(g)&&!Xc[n[d+1]]||y&&xh(y)&&!Xc[n[d-1]]||!Xc[n[d]]?n[d]:Xc[n[d]]}return l}(this.text)}trim(){let n=0;for(let d=0;d<this.text.length&&jh[this.text.charCodeAt(d)];d++)n++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=n&&jh[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(n,l),this.sectionIndex=this.sectionIndex.slice(n,l)}substring(n,l){const d=new vl;return d.text=this.text.substring(n,l),d.sectionIndex=this.sectionIndex.slice(n,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,l)=>Math.max(n,this.sections[l].scale),0)}addTextSection(n,l){this.text+=n.text,this.sections.push(Yc.forText(n.scale,n.fontStack||l));const d=this.sections.length-1;for(let g=0;g<n.text.length;++g)this.sectionIndex.push(d)}addImageSection(n){const l=n.image?n.image.name:"";if(l.length===0)return void $e("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Yc.forImage(l)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Vh(o,n,l,d,g,y,x,E,A,M,D,O,N,G,$,ne){const ie=vl.fromFeature(o,g);let _e;O===c.WritingMode.vertical&&ie.verticalizePunctuation();const{processBidirectionalText:Te,processStyledBidirectionalText:ge}=wr;if(Te&&ie.sections.length===1){_e=[];const De=Te(ie.toString(),ep(ie,M,y,n,d,G,$));for(const ft of De){const xt=new vl;xt.text=ft,xt.sections=ie.sections;for(let st=0;st<ft.length;st++)xt.sectionIndex.push(0);_e.push(xt)}}else if(ge){_e=[];const De=ge(ie.text,ie.sectionIndex,ep(ie,M,y,n,d,G,$));for(const ft of De){const xt=new vl;xt.text=ft[0],xt.sectionIndex=ft[1],xt.sections=ie.sections,_e.push(xt)}}else _e=function(De,ft){const xt=[],st=De.text;let tt=0;for(const Je of ft)xt.push(De.substring(tt,Je)),tt=Je;return tt<st.length&&xt.push(De.substring(tt,st.length)),xt}(ie,ep(ie,M,y,n,d,G,$));const we=[],Oe={positionedLines:we,text:ie.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(De,ft,xt,st,tt,Je,ot,it,qe,Dt,It,Qt){let Ui=0,Hi=Uh,Tn=0,Dr=0;const Un=it==="right"?1:it==="left"?0:.5;let gn=0;for(const _n of tt){_n.trim();const jn=_n.getMaxScale(),Zn=(jn-1)*On,tr={positionedGlyphs:[],lineOffset:0};De.positionedLines[gn]=tr;const dr=tr.positionedGlyphs;let fr=0;if(!_n.length()){Hi+=Je,++gn;continue}for(let Ln=0;Ln<_n.length();Ln++){const ai=_n.getSection(Ln),Ar=_n.getSectionIndex(Ln),Gn=_n.getCharCode(Ln);let Xn=0,Yr=null,as=null,ls=null,io=On;const Kr=!(qe===c.WritingMode.horizontal||!It&&!Mc(Gn)||It&&(jh[Gn]||(Cn=Gn,rt.Arabic(Cn)||rt["Arabic Supplement"](Cn)||rt["Arabic Extended-A"](Cn)||rt["Arabic Presentation Forms-A"](Cn)||rt["Arabic Presentation Forms-B"](Cn))));if(ai.imageName){const zr=st[ai.imageName];if(!zr)continue;ls=ai.imageName,De.iconsInText=De.iconsInText||!0,as=zr.paddedRect;const pr=zr.displaySize;ai.scale=ai.scale*On/Qt,Yr={width:pr[0],height:pr[1],left:1,top:-3,advance:Kr?pr[1]:pr[0]},Xn=Zn+(On-pr[1]*ai.scale),io=Yr.advance;const no=Kr?pr[0]*ai.scale-On*jn:pr[1]*ai.scale-On*jn;no>0&&no>fr&&(fr=no)}else{const zr=xt[ai.fontStack],pr=zr&&zr[Gn];if(pr&&pr.rect)as=pr.rect,Yr=pr.metrics;else{const no=ft[ai.fontStack],Qc=no&&no[Gn];if(!Qc)continue;Yr=Qc.metrics}Xn=(jn-ai.scale)*On}Kr?(De.verticalizable=!0,dr.push({glyph:Gn,imageName:ls,x:Ui,y:Hi+Xn,vertical:Kr,scale:ai.scale,fontStack:ai.fontStack,sectionIndex:Ar,metrics:Yr,rect:as}),Ui+=io*ai.scale+Dt):(dr.push({glyph:Gn,imageName:ls,x:Ui,y:Hi+Xn,vertical:Kr,scale:ai.scale,fontStack:ai.fontStack,sectionIndex:Ar,metrics:Yr,rect:as}),Ui+=Yr.advance*ai.scale+Dt)}dr.length!==0&&(Tn=Math.max(Ui-Dt,Tn),I2(dr,0,dr.length-1,Un,fr)),Ui=0;const Zi=Je*jn+fr;tr.lineOffset=Math.max(fr,Zn),Hi+=Zi,Dr=Math.max(Zi,Dr),++gn}var Cn;const Vn=Hi-Uh,{horizontalAlign:Wn,verticalAlign:hr}=tp(ot);(function(_n,jn,Zn,tr,dr,fr,Zi,Ln,ai){const Ar=(jn-Zn)*dr;let Gn=0;Gn=fr!==Zi?-Ln*tr-Uh:(-tr*ai+.5)*Zi;for(const Xn of _n)for(const Yr of Xn.positionedGlyphs)Yr.x+=Ar,Yr.y+=Gn})(De.positionedLines,Un,Wn,hr,Tn,Dr,Je,Vn,tt.length),De.top+=-hr*Vn,De.bottom=De.top+Vn,De.left+=-Wn*Tn,De.right=De.left+Tn}(Oe,n,l,d,_e,x,E,A,O,M,N,ne),!function(De){for(const ft of De)if(ft.positionedGlyphs.length!==0)return!1;return!0}(we)&&Oe}const jh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},A2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function B_(o,n,l,d,g,y){if(n.imageName){const x=d[n.imageName];return x?x.displaySize[0]*n.scale*On/y+g:0}{const x=l[n.fontStack],E=x&&x[o];return E?E.metrics.advance*n.scale+g:0}}function N_(o,n,l,d){const g=Math.pow(o-n,2);return d?o<n?g/2:2*g:g+Math.abs(l)*l}function S2(o,n,l){let d=0;return o===10&&(d-=1e4),l&&(d+=150),o!==40&&o!==65288||(d+=50),n!==41&&n!==65289||(d+=50),d}function U_(o,n,l,d,g,y){let x=null,E=N_(n,l,g,y);for(const A of d){const M=N_(n-A.x,l,g,y)+A.badness;M<=E&&(x=A,E=M)}return{index:o,x:n,priorBreak:x,badness:E}}function V_(o){return o?V_(o.priorBreak).concat(o.index):[]}function ep(o,n,l,d,g,y,x){if(y!=="point")return[];if(!o)return[];const E=[],A=function(N,G,$,ne,ie,_e){let Te=0;for(let ge=0;ge<N.length();ge++){const we=N.getSection(ge);Te+=B_(N.getCharCode(ge),we,ne,ie,G,_e)}return Te/Math.max(1,Math.ceil(Te/$))}(o,n,l,d,g,x),M=o.text.indexOf("\u200B")>=0;let D=0;for(let N=0;N<o.length();N++){const G=o.getSection(N),$=o.getCharCode(N);if(jh[$]||(D+=B_($,G,d,g,n,x)),N<o.length()-1){const ne=!((O=$)<11904||!(rt["Bopomofo Extended"](O)||rt.Bopomofo(O)||rt["CJK Compatibility Forms"](O)||rt["CJK Compatibility Ideographs"](O)||rt["CJK Compatibility"](O)||rt["CJK Radicals Supplement"](O)||rt["CJK Strokes"](O)||rt["CJK Symbols and Punctuation"](O)||rt["CJK Unified Ideographs Extension A"](O)||rt["CJK Unified Ideographs"](O)||rt["Enclosed CJK Letters and Months"](O)||rt["Halfwidth and Fullwidth Forms"](O)||rt.Hiragana(O)||rt["Ideographic Description Characters"](O)||rt["Kangxi Radicals"](O)||rt["Katakana Phonetic Extensions"](O)||rt.Katakana(O)||rt["Vertical Forms"](O)||rt["Yi Radicals"](O)||rt["Yi Syllables"](O)));(A2[$]||ne||G.imageName)&&E.push(U_(N+1,D,A,E,S2($,o.getCharCode(N+1),ne&&M),!1))}}var O;return V_(U_(o.length(),D,A,E,0,!0))}function tp(o){let n=.5,l=.5;switch(o){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:n,verticalAlign:l}}function I2(o,n,l,d,g){if(!d&&!g)return;const y=o[l],x=(o[l].x+y.metrics.advance*y.scale)*d;for(let E=n;E<=l;E++)o[E].x-=x,o[E].y+=g}function P2(o,n,l){const{horizontalAlign:d,verticalAlign:g}=tp(l),y=n[0]-o.displaySize[0]*d,x=n[1]-o.displaySize[1]*g;return{image:o,top:x,bottom:x+o.displaySize[1],left:y,right:y+o.displaySize[0]}}function j_(o,n,l,d,g,y){const x=o.image;let E;if(x.content){const ie=x.content,_e=x.pixelRatio||1;E=[ie[0]/_e,ie[1]/_e,x.displaySize[0]-ie[2]/_e,x.displaySize[1]-ie[3]/_e]}const A=n.left*y,M=n.right*y;let D,O,N,G;l==="width"||l==="both"?(G=g[0]+A-d[3],O=g[0]+M+d[1]):(G=g[0]+(A+M-x.displaySize[0])/2,O=G+x.displaySize[0]);const $=n.top*y,ne=n.bottom*y;return l==="height"||l==="both"?(D=g[1]+$-d[0],N=g[1]+ne+d[2]):(D=g[1]+($+ne-x.displaySize[1])/2,N=D+x.displaySize[1]),{image:x,top:D,right:O,bottom:N,left:G,collisionPadding:E}}const to=128;function G_(o,n){const{expression:l}=n;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Gi(o+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=l;let y=0;for(;y<d.length&&d[y]<=o;)y++;y=Math.max(0,y-1);let x=y;for(;x<d.length&&d[x]<o+1;)x++;x=Math.min(d.length-1,x);const E=d[y],A=d[x];return l.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:A,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:A,minSize:l.evaluate(new Gi(E)),maxSize:l.evaluate(new Gi(A)),interpolationType:g}}}class Fo extends pt{constructor(n,l,d,g){super(n,l),this.angle=d,g!==void 0&&(this.segment=g)}clone(){return new Fo(this.x,this.y,this.angle,this.segment)}}function $_(o,n,l,d,g){if(n.segment===void 0)return!0;let y=n,x=n.segment+1,E=0;for(;E>-l/2;){if(x--,x<0)return!1;E-=o[x].dist(y),y=o[x]}E+=o[x].dist(o[x+1]),x++;const A=[];let M=0;for(;E<l/2;){const D=o[x],O=o[x+1];if(!O)return!1;let N=o[x-1].angleTo(D)-D.angleTo(O);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:E,angleDelta:N}),M+=N;E-A[0].distance>d;)M-=A.shift().angleDelta;if(M>g)return!1;x++,E+=D.dist(O)}return!0}function H_(o){let n=0;for(let l=0;l<o.length-1;l++)n+=o[l].dist(o[l+1]);return n}function q_(o,n,l){return o?.6*n*l:0}function W_(o,n){return Math.max(o?o.right-o.left:0,n?n.right-n.left:0)}function M2(o,n,l,d,g,y){const x=q_(l,g,y),E=W_(l,d)*y;let A=0;const M=H_(o)/2;for(let D=0;D<o.length-1;D++){const O=o[D],N=o[D+1],G=O.dist(N);if(A+G>M){const $=(M-A)/G,ne=Kt(O.x,N.x,$),ie=Kt(O.y,N.y,$),_e=new Fo(ne,ie,N.angleTo(O),D);return _e._round(),!x||$_(o,_e,E,x,n)?_e:void 0}A+=G}}function C2(o,n,l,d,g,y,x,E,A){const M=q_(d,y,x),D=W_(d,g),O=D*x,N=o[0].x===0||o[0].x===A||o[0].y===0||o[0].y===A;return n-O<n/4&&(n=O+n/4),Z_(o,N?n/2*E%n:(D/2+2*y)*x*E%n,n,M,l,O,N,!1,A)}function Z_(o,n,l,d,g,y,x,E,A){const M=y/2,D=H_(o);let O=0,N=n-l,G=[];for(let $=0;$<o.length-1;$++){const ne=o[$],ie=o[$+1],_e=ne.dist(ie),Te=ie.angleTo(ne);for(;N+l<O+_e;){N+=l;const ge=(N-O)/_e,we=Kt(ne.x,ie.x,ge),Oe=Kt(ne.y,ie.y,ge);if(we>=0&&we<A&&Oe>=0&&Oe<A&&N-M>=0&&N+M<=D){const De=new Fo(we,Oe,Te,$);De._round(),d&&!$_(o,De,y,d,g)||G.push(De)}}O+=_e}return E||G.length||x||(G=Z_(o,O/2,l,d,g,y,x,!0,A)),G}function X_(o,n,l,d,g){const y=[];for(let x=0;x<o.length;x++){const E=o[x];let A;for(let M=0;M<E.length-1;M++){let D=E[M],O=E[M+1];D.x<n&&O.x<n||(D.x<n?D=new pt(n,D.y+(n-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x<n&&(O=new pt(n,D.y+(n-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y<l&&O.y<l||(D.y<l?D=new pt(D.x+(l-D.y)/(O.y-D.y)*(O.x-D.x),l)._round():O.y<l&&(O=new pt(D.x+(l-D.y)/(O.y-D.y)*(O.x-D.x),l)._round()),D.x>=d&&O.x>=d||(D.x>=d?D=new pt(d,D.y+(d-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x>=d&&(O=new pt(d,D.y+(d-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y>=g&&O.y>=g||(D.y>=g?D=new pt(D.x+(g-D.y)/(O.y-D.y)*(O.x-D.x),g)._round():O.y>=g&&(O=new pt(D.x+(g-D.y)/(O.y-D.y)*(O.x-D.x),g)._round()),A&&D.equals(A[A.length-1])||(A=[D],y.push(A)),A.push(O)))))}}return y}function Y_(o,n,l,d){const g=[],y=o.image,x=y.pixelRatio,E=y.paddedRect.w-2,A=y.paddedRect.h-2,M=o.right-o.left,D=o.bottom-o.top,O=y.stretchX||[[0,E]],N=y.stretchY||[[0,A]],G=(Je,ot)=>Je+ot[1]-ot[0],$=O.reduce(G,0),ne=N.reduce(G,0),ie=E-$,_e=A-ne;let Te=0,ge=$,we=0,Oe=ne,De=0,ft=ie,xt=0,st=_e;if(y.content&&d){const Je=y.content;Te=Gh(O,0,Je[0]),we=Gh(N,0,Je[1]),ge=Gh(O,Je[0],Je[2]),Oe=Gh(N,Je[1],Je[3]),De=Je[0]-Te,xt=Je[1]-we,ft=Je[2]-Je[0]-ge,st=Je[3]-Je[1]-Oe}const tt=(Je,ot,it,qe)=>{const Dt=$h(Je.stretch-Te,ge,M,o.left),It=Hh(Je.fixed-De,ft,Je.stretch,$),Qt=$h(ot.stretch-we,Oe,D,o.top),Ui=Hh(ot.fixed-xt,st,ot.stretch,ne),Hi=$h(it.stretch-Te,ge,M,o.left),Tn=Hh(it.fixed-De,ft,it.stretch,$),Dr=$h(qe.stretch-we,Oe,D,o.top),Un=Hh(qe.fixed-xt,st,qe.stretch,ne),gn=new pt(Dt,Qt),Cn=new pt(Hi,Qt),Vn=new pt(Hi,Dr),Wn=new pt(Dt,Dr),hr=new pt(It/x,Ui/x),_n=new pt(Tn/x,Un/x),jn=n*Math.PI/180;if(jn){const dr=Math.sin(jn),fr=Math.cos(jn),Zi=[fr,-dr,dr,fr];gn._matMult(Zi),Cn._matMult(Zi),Wn._matMult(Zi),Vn._matMult(Zi)}const Zn=Je.stretch+Je.fixed,tr=ot.stretch+ot.fixed;return{tl:gn,tr:Cn,bl:Wn,br:Vn,tex:{x:y.paddedRect.x+1+Zn,y:y.paddedRect.y+1+tr,w:it.stretch+it.fixed-Zn,h:qe.stretch+qe.fixed-tr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hr,pixelOffsetBR:_n,minFontScaleX:ft/x/M,minFontScaleY:st/x/D,isSDF:l}};if(d&&(y.stretchX||y.stretchY)){const Je=K_(O,ie,$),ot=K_(N,_e,ne);for(let it=0;it<Je.length-1;it++){const qe=Je[it],Dt=Je[it+1];for(let It=0;It<ot.length-1;It++)g.push(tt(qe,ot[It],Dt,ot[It+1]))}}else g.push(tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:A+1}));return g}function Gh(o,n,l){let d=0;for(const g of o)d+=Math.max(n,Math.min(l,g[1]))-Math.max(n,Math.min(l,g[0]));return d}function K_(o,n,l){const d=[{fixed:-1,stretch:0}];for(const[g,y]of o){const x=d[d.length-1];d.push({fixed:g-x.stretch,stretch:x.stretch}),d.push({fixed:g-x.stretch,stretch:x.stretch+(y-g)})}return d.push({fixed:n+1,stretch:l}),d}function $h(o,n,l,d){return o/n*l+d}function Hh(o,n,l,d){return o-n*l/d}gt("Anchor",Fo);class qh{constructor(n,l,d,g,y,x,E,A,M,D){if(this.boxStartIndex=n.length,M){let O=x.top,N=x.bottom;const G=x.collisionPadding;G&&(O-=G[1],N+=G[3]);let $=N-O;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{let O=x.top*E-A[0],N=x.bottom*E+A[2],G=x.left*E-A[3],$=x.right*E+A[1];const ne=x.collisionPadding;if(ne&&(G-=ne[0]*E,O-=ne[1]*E,$+=ne[2]*E,N+=ne[3]*E),D){const ie=new pt(G,O),_e=new pt($,O),Te=new pt(G,N),ge=new pt($,N),we=D*Math.PI/180;ie._rotate(we),_e._rotate(we),Te._rotate(we),ge._rotate(we),G=Math.min(ie.x,_e.x,Te.x,ge.x),$=Math.max(ie.x,_e.x,Te.x,ge.x),O=Math.min(ie.y,_e.y,Te.y,ge.y),N=Math.max(ie.y,_e.y,Te.y,ge.y)}n.emplaceBack(l.x,l.y,G,O,$,N,d,g,y)}this.boxEndIndex=n.length}}class L2{constructor(n=[],l=k2){if(this.data=n,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:l,compare:d}=this,g=l[n];for(;n>0;){const y=n-1>>1,x=l[y];if(d(g,x)>=0)break;l[n]=x,n=y}l[n]=g}_down(n){const{data:l,compare:d}=this,g=this.length>>1,y=l[n];for(;n<g;){let x=1+(n<<1),E=l[x];const A=x+1;if(A<this.length&&d(l[A],E)<0&&(x=A,E=l[A]),d(E,y)>=0)break;l[n]=E,n=x}l[n]=y}}function k2(o,n){return o<n?-1:o>n?1:0}function R2(o,n=1,l=!1){let d=1/0,g=1/0,y=-1/0,x=-1/0;const E=o[0];for(let G=0;G<E.length;G++){const $=E[G];(!G||$.x<d)&&(d=$.x),(!G||$.y<g)&&(g=$.y),(!G||$.x>y)&&(y=$.x),(!G||$.y>x)&&(x=$.y)}const A=Math.min(y-d,x-g);let M=A/2;const D=new L2([],D2);if(A===0)return new pt(d,g);for(let G=d;G<y;G+=A)for(let $=g;$<x;$+=A)D.push(new xl(G+M,$+M,M,o));let O=function(G){let $=0,ne=0,ie=0;const _e=G[0];for(let Te=0,ge=_e.length,we=ge-1;Te<ge;we=Te++){const Oe=_e[Te],De=_e[we],ft=Oe.x*De.y-De.x*Oe.y;ne+=(Oe.x+De.x)*ft,ie+=(Oe.y+De.y)*ft,$+=3*ft}return new xl(ne/$,ie/$,0,G)}(o),N=D.length;for(;D.length;){const G=D.pop();(G.d>O.d||!O.d)&&(O=G,l&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,N)),G.max-O.d<=n||(M=G.h/2,D.push(new xl(G.p.x-M,G.p.y-M,M,o)),D.push(new xl(G.p.x+M,G.p.y-M,M,o)),D.push(new xl(G.p.x-M,G.p.y+M,M,o)),D.push(new xl(G.p.x+M,G.p.y+M,M,o)),N+=4)}return l&&(console.log(`num probes: ${N}`),console.log(`best distance: ${O.d}`)),O.p}function D2(o,n){return n.max-o.max}function xl(o,n,l,d){this.p=new pt(o,n),this.h=l,this.d=function(g,y){let x=!1,E=1/0;for(let A=0;A<y.length;A++){const M=y[A];for(let D=0,O=M.length,N=O-1;D<O;N=D++){const G=M[D],$=M[N];G.y>g.y!=$.y>g.y&&g.x<($.x-G.x)*(g.y-G.y)/($.y-G.y)+G.x&&(x=!x),E=Math.min(E,s_(g,G,$))}}return(x?1:-1)*Math.sqrt(E)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}const ip=Number.POSITIVE_INFINITY;function J_(o,n){return n[1]!==ip?function(l,d,g){let y=0,x=0;switch(d=Math.abs(d),g=Math.abs(g),l){case"top-right":case"top-left":case"top":x=g-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-g}switch(l){case"top-right":case"bottom-right":case"right":y=-d;break;case"top-left":case"bottom-left":case"left":y=d}return[y,x]}(o,n[0],n[1]):function(l,d){let g=0,y=0;d<0&&(d=0);const x=d/Math.sqrt(2);switch(l){case"top-right":case"top-left":y=x-7;break;case"bottom-right":case"bottom-left":y=7-x;break;case"bottom":y=7-d;break;case"top":y=d-7}switch(l){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=d;break;case"right":g=-d}return[g,y]}(o,n[0])}function np(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function z2(o,n,l,d,g,y,x,E,A,M,D){let O=y.textMaxSize.evaluate(n,{});O===void 0&&(O=x);const N=o.layers[0].layout,G=N.get("icon-offset").evaluate(n,{},D),$=ey(l.horizontal),ne=x/24,ie=o.tilePixelRatio*ne,_e=o.tilePixelRatio*O/24,Te=o.tilePixelRatio*E,ge=o.tilePixelRatio*N.get("symbol-spacing"),we=N.get("text-padding")*o.tilePixelRatio,Oe=function(qe,Dt,It,Qt=1){const Ui=qe.get("icon-padding").evaluate(Dt,{},It),Hi=Ui&&Ui.values;return[Hi[0]*Qt,Hi[1]*Qt,Hi[2]*Qt,Hi[3]*Qt]}(N,n,D,o.tilePixelRatio),De=N.get("text-max-angle")/180*Math.PI,ft=N.get("text-rotation-alignment")!=="viewport"&&N.get("symbol-placement")!=="point",xt=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",st=N.get("symbol-placement"),tt=ge/2,Je=N.get("icon-text-fit");let ot;d&&Je!=="none"&&(o.allowVerticalPlacement&&l.vertical&&(ot=j_(d,l.vertical,Je,N.get("icon-text-fit-padding"),G,ne)),$&&(d=j_(d,$,Je,N.get("icon-text-fit-padding"),G,ne)));const it=(qe,Dt)=>{Dt.x<0||Dt.x>=En||Dt.y<0||Dt.y>=En||function(It,Qt,Ui,Hi,Tn,Dr,Un,gn,Cn,Vn,Wn,hr,_n,jn,Zn,tr,dr,fr,Zi,Ln,ai,Ar,Gn,Xn,Yr){const as=It.addToLineVertexArray(Qt,Ui);let ls,io,Kr,zr,pr=0,no=0,Qc=0,gy=0,fp=-1,pp=-1;const ro={};let _y=Mn.exports(""),mp=0,gp=0;if(gn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[mp,gp]=gn.layout.get("text-offset").evaluate(ai,{},Xn).map(mr=>mr*On):(mp=gn.layout.get("text-radial-offset").evaluate(ai,{},Xn)*On,gp=ip),It.allowVerticalPlacement&&Hi.vertical){const mr=gn.layout.get("text-rotate").evaluate(ai,{},Xn)+90;Kr=new qh(Cn,Qt,Vn,Wn,hr,Hi.vertical,_n,jn,Zn,mr),Un&&(zr=new qh(Cn,Qt,Vn,Wn,hr,Un,dr,fr,Zn,mr))}if(Tn){const mr=gn.layout.get("icon-rotate").evaluate(ai,{}),Cs=gn.layout.get("icon-text-fit")!=="none",eu=Y_(Tn,mr,Gn,Cs),tu=Un?Y_(Un,mr,Gn,Cs):void 0;io=new qh(Cn,Qt,Vn,Wn,hr,Tn,dr,fr,!1,mr),pr=4*eu.length;const xy=It.iconSizeData;let Pa=null;xy.kind==="source"?(Pa=[to*gn.layout.get("icon-size").evaluate(ai,{})],Pa[0]>Bo&&$e(`${It.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):xy.kind==="composite"&&(Pa=[to*Ar.compositeIconSizes[0].evaluate(ai,{},Xn),to*Ar.compositeIconSizes[1].evaluate(ai,{},Xn)],(Pa[0]>Bo||Pa[1]>Bo)&&$e(`${It.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),It.addSymbols(It.icon,eu,Pa,Ln,Zi,ai,c.WritingMode.none,Qt,as.lineStartIndex,as.lineLength,-1,Xn),fp=It.icon.placedSymbolArray.length-1,tu&&(no=4*tu.length,It.addSymbols(It.icon,tu,Pa,Ln,Zi,ai,c.WritingMode.vertical,Qt,as.lineStartIndex,as.lineLength,-1,Xn),pp=It.icon.placedSymbolArray.length-1)}const yy=Object.keys(Hi.horizontal);for(const mr of yy){const Cs=Hi.horizontal[mr];if(!ls){_y=Mn.exports(Cs.text);const tu=gn.layout.get("text-rotate").evaluate(ai,{},Xn);ls=new qh(Cn,Qt,Vn,Wn,hr,Cs,_n,jn,Zn,tu)}const eu=Cs.positionedLines.length===1;if(Qc+=Q_(It,Qt,Cs,Dr,gn,Zn,ai,tr,as,Hi.vertical?c.WritingMode.horizontal:c.WritingMode.horizontalOnly,eu?yy:[mr],ro,fp,Ar,Xn),eu)break}Hi.vertical&&(gy+=Q_(It,Qt,Hi.vertical,Dr,gn,Zn,ai,tr,as,c.WritingMode.vertical,["vertical"],ro,pp,Ar,Xn));const Z2=ls?ls.boxStartIndex:It.collisionBoxArray.length,X2=ls?ls.boxEndIndex:It.collisionBoxArray.length,Y2=Kr?Kr.boxStartIndex:It.collisionBoxArray.length,K2=Kr?Kr.boxEndIndex:It.collisionBoxArray.length,J2=io?io.boxStartIndex:It.collisionBoxArray.length,Q2=io?io.boxEndIndex:It.collisionBoxArray.length,eE=zr?zr.boxStartIndex:It.collisionBoxArray.length,tE=zr?zr.boxEndIndex:It.collisionBoxArray.length;let cs=-1;const Kh=(mr,Cs)=>mr&&mr.circleDiameter?Math.max(mr.circleDiameter,Cs):Cs;cs=Kh(ls,cs),cs=Kh(Kr,cs),cs=Kh(io,cs),cs=Kh(zr,cs);const vy=cs>-1?1:0;vy&&(cs*=Yr/On),It.glyphOffsetArray.length>=bl.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ai.sortKey!==void 0&&It.addToSortKeyRanges(It.symbolInstances.length,ai.sortKey),It.symbolInstances.emplaceBack(Qt.x,Qt.y,ro.right>=0?ro.right:-1,ro.center>=0?ro.center:-1,ro.left>=0?ro.left:-1,ro.vertical||-1,fp,pp,_y,Z2,X2,Y2,K2,J2,Q2,eE,tE,Vn,Qc,gy,pr,no,vy,0,_n,mp,gp,cs)}(o,Dt,qe,l,d,g,ot,o.layers[0],o.collisionBoxArray,n.index,n.sourceLayerIndex,o.index,ie,[we,we,we,we],ft,A,Te,Oe,xt,G,n,y,M,D,x)};if(st==="line")for(const qe of X_(n.geometry,0,0,En,En)){const Dt=C2(qe,ge,De,l.vertical||$,d,24,_e,o.overscaling,En);for(const It of Dt){const Qt=$;Qt&&O2(o,Qt.text,tt,It)||it(qe,It)}}else if(st==="line-center"){for(const qe of n.geometry)if(qe.length>1){const Dt=M2(qe,De,l.vertical||$,d,24,_e);Dt&&it(qe,Dt)}}else if(n.type==="Polygon")for(const qe of $f(n.geometry,0)){const Dt=R2(qe,16);it(qe[0],new Fo(Dt.x,Dt.y,0))}else if(n.type==="LineString")for(const qe of n.geometry)it(qe,new Fo(qe[0].x,qe[0].y,0));else if(n.type==="Point")for(const qe of n.geometry)for(const Dt of qe)it([Dt],new Fo(Dt.x,Dt.y,0))}const Bo=32640;function Q_(o,n,l,d,g,y,x,E,A,M,D,O,N,G,$){const ne=function(Te,ge,we,Oe,De,ft,xt,st){const tt=Oe.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,Je=[];for(const ot of ge.positionedLines)for(const it of ot.positionedGlyphs){if(!it.rect)continue;const qe=it.rect||{};let Dt=4,It=!0,Qt=1,Ui=0;const Hi=(De||st)&&it.vertical,Tn=it.metrics.advance*it.scale/2;if(st&&ge.verticalizable){const Zi=(it.scale-1)*On,Ln=(On-it.metrics.width*it.scale)/2;Ui=ot.lineOffset/2-(it.imageName?-Ln:Zi)}if(it.imageName){const Zi=xt[it.imageName];It=Zi.sdf,Qt=Zi.pixelRatio,Dt=1/Qt}const Dr=De?[it.x+Tn,it.y]:[0,0];let Un=De?[0,0]:[it.x+Tn+we[0],it.y+we[1]-Ui],gn=[0,0];Hi&&(gn=Un,Un=[0,0]);const Cn=(it.metrics.left-Dt)*it.scale-Tn+Un[0],Vn=(-it.metrics.top-Dt)*it.scale+Un[1],Wn=Cn+qe.w*it.scale/Qt,hr=Vn+qe.h*it.scale/Qt,_n=new pt(Cn,Vn),jn=new pt(Wn,Vn),Zn=new pt(Cn,hr),tr=new pt(Wn,hr);if(Hi){const Zi=new pt(-Tn,Tn-Uh),Ln=-Math.PI/2,ai=12-Tn,Ar=new pt(22-ai,-(it.imageName?ai:0)),Gn=new pt(...gn);_n._rotateAround(Ln,Zi)._add(Ar)._add(Gn),jn._rotateAround(Ln,Zi)._add(Ar)._add(Gn),Zn._rotateAround(Ln,Zi)._add(Ar)._add(Gn),tr._rotateAround(Ln,Zi)._add(Ar)._add(Gn)}if(tt){const Zi=Math.sin(tt),Ln=Math.cos(tt),ai=[Ln,-Zi,Zi,Ln];_n._matMult(ai),jn._matMult(ai),Zn._matMult(ai),tr._matMult(ai)}const dr=new pt(0,0),fr=new pt(0,0);Je.push({tl:_n,tr:jn,bl:Zn,br:tr,tex:qe,writingMode:ge.writingMode,glyphOffset:Dr,sectionIndex:it.sectionIndex,isSDF:It,pixelOffsetTL:dr,pixelOffsetBR:fr,minFontScaleX:0,minFontScaleY:0})}return Je}(0,l,E,g,y,x,d,o.allowVerticalPlacement),ie=o.textSizeData;let _e=null;ie.kind==="source"?(_e=[to*g.layout.get("text-size").evaluate(x,{})],_e[0]>Bo&&$e(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ie.kind==="composite"&&(_e=[to*G.compositeTextSizes[0].evaluate(x,{},$),to*G.compositeTextSizes[1].evaluate(x,{},$)],(_e[0]>Bo||_e[1]>Bo)&&$e(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,ne,_e,E,y,x,M,n,A.lineStartIndex,A.lineLength,N,$);for(const Te of D)O[Te]=o.text.placedSymbolArray.length-1;return 4*ne.length}function ey(o){for(const n in o)return o[n];return null}function O2(o,n,l,d){const g=o.compareText;if(n in g){const y=g[n];for(let x=y.length-1;x>=0;x--)if(d.dist(y[x])<l)return!0}else g[n]=[];return g[n].push(d),!1}const F2=zo.VectorTileFeature.types,B2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wh(o,n,l,d,g,y,x,E,A,M,D,O,N){const G=E?Math.min(Bo,Math.round(E[0])):0,$=E?Math.min(Bo,Math.round(E[1])):0;o.emplaceBack(n,l,Math.round(32*d),Math.round(32*g),y,x,(G<<1)+(A?1:0),$,16*M,16*D,256*O,256*N)}function rp(o,n,l){o.emplaceBack(n.x,n.y,l),o.emplaceBack(n.x,n.y,l),o.emplaceBack(n.x,n.y,l),o.emplaceBack(n.x,n.y,l)}function N2(o){for(const n of o.sections)if(wh(n.text))return!0;return!1}class sp{constructor(n){this.layoutVertexArray=new Zr,this.indexArray=new Jn,this.programConfigurations=n,this.segments=new ni,this.dynamicLayoutVertexArray=new Lr,this.opacityVertexArray=new Xr,this.placedSymbolArray=new Ge}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,l,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,l2.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,c2.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,B2,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}gt("SymbolBuffers",sp);class op{constructor(n,l,d){this.layoutVertexArray=new n,this.layoutAttributes=l,this.indexArray=new d,this.segments=new ni,this.collisionVertexArray=new Er}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,u2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}gt("CollisionBuffers",op);class bl{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(x=>x.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bf([]),this.placementViewportMatrix=Bf([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=G_(this.zoom,l["text-size"]),this.iconSizeData=G_(this.zoom,l["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=lp(d,"text-overlap","text-allow-overlap")!=="never"||lp(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(x=>c.WritingMode[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=n.sourceID}createArrays(){this.text=new sp(new Ea(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new sp(new Ea(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new et,this.lineVertexArray=new dt,this.symbolInstances=new ct}calculateGlyphDependencies(n,l,d,g,y){for(let x=0;x<n.length;x++)if(l[n.charCodeAt(x)]=!0,(d||g)&&y){const E=Xc[n.charAt(x)];E&&(l[E.charCodeAt(0)]=!0)}}populate(n,l,d){const g=this.layers[0],y=g.layout,x=y.get("text-font"),E=y.get("text-field"),A=y.get("icon-image"),M=(E.value.kind!=="constant"||E.value.value instanceof le&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),D=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,O=y.get("symbol-sort-key");if(this.features=[],!M&&!D)return;const N=l.iconDependencies,G=l.glyphDependencies,$=l.availableImages,ne=new Gi(this.zoom);for(const{feature:ie,id:_e,index:Te,sourceLayerIndex:ge}of n){const we=g._featureFilter.needGeometry,Oe=Aa(ie,we);if(!g._featureFilter.filter(ne,Oe,d))continue;let De,ft;if(we||(Oe.geometry=Ta(ie)),M){const st=g.getValueAndResolveTokens("text-field",Oe,d,$),tt=le.factory(st);N2(tt)&&(this.hasRTLText=!0),(!this.hasRTLText||xa()==="unavailable"||this.hasRTLText&&wr.isParsed())&&(De=d2(tt,g,Oe))}if(D){const st=g.getValueAndResolveTokens("icon-image",Oe,d,$);ft=st instanceof de?st:de.fromString(st)}if(!De&&!ft)continue;const xt=this.sortFeaturesByKey?O.evaluate(Oe,{},d):void 0;if(this.features.push({id:_e,text:De,icon:ft,index:Te,sourceLayerIndex:ge,geometry:Oe.geometry,properties:ie.properties,type:F2[ie.type],sortKey:xt}),ft&&(N[ft.name]=!0),De){const st=x.evaluate(Oe,{},d).join(","),tt=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.WritingMode.vertical)>=0;for(const Je of De.sections)if(Je.image)N[Je.image.name]=!0;else{const ot=cl(De.toString()),it=Je.fontStack||st,qe=G[it]=G[it]||{};this.calculateGlyphDependencies(Je.text,qe,tt,this.allowVerticalPlacement,ot)}}}y.get("symbol-placement")==="line"&&(this.features=function(ie){const _e={},Te={},ge=[];let we=0;function Oe(st){ge.push(ie[st]),we++}function De(st,tt,Je){const ot=Te[st];return delete Te[st],Te[tt]=ot,ge[ot].geometry[0].pop(),ge[ot].geometry[0]=ge[ot].geometry[0].concat(Je[0]),ot}function ft(st,tt,Je){const ot=_e[tt];return delete _e[tt],_e[st]=ot,ge[ot].geometry[0].shift(),ge[ot].geometry[0]=Je[0].concat(ge[ot].geometry[0]),ot}function xt(st,tt,Je){const ot=Je?tt[0][tt[0].length-1]:tt[0][0];return`${st}:${ot.x}:${ot.y}`}for(let st=0;st<ie.length;st++){const tt=ie[st],Je=tt.geometry,ot=tt.text?tt.text.toString():null;if(!ot){Oe(st);continue}const it=xt(ot,Je),qe=xt(ot,Je,!0);if(it in Te&&qe in _e&&Te[it]!==_e[qe]){const Dt=ft(it,qe,Je),It=De(it,qe,ge[Dt].geometry);delete _e[it],delete Te[qe],Te[xt(ot,ge[It].geometry,!0)]=It,ge[Dt].geometry=null}else it in Te?De(it,qe,Je):qe in _e?ft(it,qe,Je):(Oe(st),_e[it]=we-1,Te[qe]=we-1)}return ge.filter(st=>st.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,_e)=>ie.sortKey-_e.sortKey)}update(n,l,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,l,this.layers,d),this.icon.programConfigurations.updatePaintArrays(n,l,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,l){const d=this.lineVertexArray.length;if(n.segment!==void 0){let g=n.dist(l[n.segment+1]),y=n.dist(l[n.segment]);const x={};for(let E=n.segment+1;E<l.length;E++)x[E]={x:l[E].x,y:l[E].y,tileUnitDistanceFromAnchor:g},E<l.length-1&&(g+=l[E+1].dist(l[E]));for(let E=n.segment||0;E>=0;E--)x[E]={x:l[E].x,y:l[E].y,tileUnitDistanceFromAnchor:y},E>0&&(y+=l[E-1].dist(l[E]));for(let E=0;E<l.length;E++){const A=x[E];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(n,l,d,g,y,x,E,A,M,D,O,N){const G=n.indexArray,$=n.layoutVertexArray,ne=n.segments.prepareSegment(4*l.length,$,G,this.canOverlap?x.sortKey:void 0),ie=this.glyphOffsetArray.length,_e=ne.vertexLength,Te=this.allowVerticalPlacement&&E===c.WritingMode.vertical?Math.PI/2:0,ge=x.text&&x.text.sections;for(let we=0;we<l.length;we++){const{tl:Oe,tr:De,bl:ft,br:xt,tex:st,pixelOffsetTL:tt,pixelOffsetBR:Je,minFontScaleX:ot,minFontScaleY:it,glyphOffset:qe,isSDF:Dt,sectionIndex:It}=l[we],Qt=ne.vertexLength,Ui=qe[1];Wh($,A.x,A.y,Oe.x,Ui+Oe.y,st.x,st.y,d,Dt,tt.x,tt.y,ot,it),Wh($,A.x,A.y,De.x,Ui+De.y,st.x+st.w,st.y,d,Dt,Je.x,tt.y,ot,it),Wh($,A.x,A.y,ft.x,Ui+ft.y,st.x,st.y+st.h,d,Dt,tt.x,Je.y,ot,it),Wh($,A.x,A.y,xt.x,Ui+xt.y,st.x+st.w,st.y+st.h,d,Dt,Je.x,Je.y,ot,it),rp(n.dynamicLayoutVertexArray,A,Te),G.emplaceBack(Qt,Qt+1,Qt+2),G.emplaceBack(Qt+1,Qt+2,Qt+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qe[0]),we!==l.length-1&&It===l[we+1].sectionIndex||n.programConfigurations.populatePaintArrays($.length,x,x.index,{},N,ge&&ge[It])}n.placedSymbolArray.emplaceBack(A.x,A.y,ie,this.glyphOffsetArray.length-ie,_e,M,D,A.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],E,0,!1,0,O)}_addCollisionDebugVertex(n,l,d,g,y,x){return l.emplaceBack(0,0),n.emplaceBack(d.x,d.y,g,y,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(n,l,d,g,y,x,E){const A=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),M=A.vertexLength,D=y.layoutVertexArray,O=y.collisionVertexArray,N=E.anchorX,G=E.anchorY;this._addCollisionDebugVertex(D,O,x,N,G,new pt(n,l)),this._addCollisionDebugVertex(D,O,x,N,G,new pt(d,l)),this._addCollisionDebugVertex(D,O,x,N,G,new pt(d,g)),this._addCollisionDebugVertex(D,O,x,N,G,new pt(n,g)),A.vertexLength+=4;const $=y.indexArray;$.emplaceBack(M,M+1),$.emplaceBack(M+1,M+2),$.emplaceBack(M+2,M+3),$.emplaceBack(M+3,M),A.primitiveLength+=4}addDebugCollisionBoxes(n,l,d,g){for(let y=n;y<l;y++){const x=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new op(Ps,M_.members,ss),this.iconCollisionBox=new op(Ps,M_.members,ss);for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(n,l,d,g,y,x,E,A,M){const D={};for(let O=l;O<d;O++){const N=n.get(O);D.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.textFeatureIndex=N.featureIndex;break}for(let O=g;O<y;O++){const N=n.get(O);D.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalTextFeatureIndex=N.featureIndex;break}for(let O=x;O<E;O++){const N=n.get(O);D.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.iconFeatureIndex=N.featureIndex;break}for(let O=A;O<M;O++){const N=n.get(O);D.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalIconFeatureIndex=N.featureIndex;break}return D}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,l){const d=n.placedSymbolArray.get(l),g=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<g;y+=4)n.indexArray.emplaceBack(y,y+1,y+2),n.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(n),d=Math.cos(n),g=[],y=[],x=[];for(let E=0;E<this.symbolInstances.length;++E){x.push(E);const A=this.symbolInstances.get(E);g.push(0|Math.round(l*A.anchorX+d*A.anchorY)),y.push(A.featureIndex)}return x.sort((E,A)=>g[E]-g[A]||y[A]-y[E]),x}addToSortKeyRanges(n,l){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((g,y,x)=>{g>=0&&x.indexOf(g)===y&&this.addIndicesForPlacedSymbol(this.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}gt("SymbolBucket",bl,{omit:["layers","collisionBoxArray","features","compareText"]}),bl.MAX_GLYPHS=65535,bl.addDynamicAttributes=rp;const U2=new zn({"symbol-placement":new At(be.layout_symbol["symbol-placement"]),"symbol-spacing":new At(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new At(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ft(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new At(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new At(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new At(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new At(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new At(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new At(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ft(be.layout_symbol["icon-size"]),"icon-text-fit":new At(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new At(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ft(be.layout_symbol["icon-image"]),"icon-rotate":new Ft(be.layout_symbol["icon-rotate"]),"icon-padding":new Ft(be.layout_symbol["icon-padding"]),"icon-keep-upright":new At(be.layout_symbol["icon-keep-upright"]),"icon-offset":new Ft(be.layout_symbol["icon-offset"]),"icon-anchor":new Ft(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new At(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new At(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new At(be.layout_symbol["text-rotation-alignment"]),"text-field":new Ft(be.layout_symbol["text-field"]),"text-font":new Ft(be.layout_symbol["text-font"]),"text-size":new Ft(be.layout_symbol["text-size"]),"text-max-width":new Ft(be.layout_symbol["text-max-width"]),"text-line-height":new At(be.layout_symbol["text-line-height"]),"text-letter-spacing":new Ft(be.layout_symbol["text-letter-spacing"]),"text-justify":new Ft(be.layout_symbol["text-justify"]),"text-radial-offset":new Ft(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new At(be.layout_symbol["text-variable-anchor"]),"text-anchor":new Ft(be.layout_symbol["text-anchor"]),"text-max-angle":new At(be.layout_symbol["text-max-angle"]),"text-writing-mode":new At(be.layout_symbol["text-writing-mode"]),"text-rotate":new Ft(be.layout_symbol["text-rotate"]),"text-padding":new At(be.layout_symbol["text-padding"]),"text-keep-upright":new At(be.layout_symbol["text-keep-upright"]),"text-transform":new Ft(be.layout_symbol["text-transform"]),"text-offset":new Ft(be.layout_symbol["text-offset"]),"text-allow-overlap":new At(be.layout_symbol["text-allow-overlap"]),"text-overlap":new At(be.layout_symbol["text-overlap"]),"text-ignore-placement":new At(be.layout_symbol["text-ignore-placement"]),"text-optional":new At(be.layout_symbol["text-optional"])});var ap={paint:new zn({"icon-opacity":new Ft(be.paint_symbol["icon-opacity"]),"icon-color":new Ft(be.paint_symbol["icon-color"]),"icon-halo-color":new Ft(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ft(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ft(be.paint_symbol["icon-halo-blur"]),"icon-translate":new At(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new At(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ft(be.paint_symbol["text-opacity"]),"text-color":new Ft(be.paint_symbol["text-color"],{runtimeType:xn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Ft(be.paint_symbol["text-halo-color"]),"text-halo-width":new Ft(be.paint_symbol["text-halo-width"]),"text-halo-blur":new Ft(be.paint_symbol["text-halo-blur"]),"text-translate":new At(be.paint_symbol["text-translate"]),"text-translate-anchor":new At(be.paint_symbol["text-translate-anchor"])}),layout:U2};class ty{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:un,this.defaultValue=n}evaluate(n){if(n.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(n.formattedSection))return l.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}gt("FormatSectionOverride",ty,{omit:["defaultValue"]});class Zh extends Wr{constructor(n){super(n,ap)}recalculate(n,l){if(super.recalculate(n,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const y of d)g.indexOf(y)<0&&g.push(y);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,l,d,g){const y=this.layout.get(n).evaluate(l,{},d,g),x=this._unevaluatedLayout._values[n];return x.isDataDriven()||aa(x.value)||!y?y:function(E,A){return A.replace(/{([^{}]+)}/g,(M,D)=>D in E?String(E[D]):"")}(l.properties,y)}createBucket(n){return new bl(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of ap.paint.overridableProperties){if(!Zh.hasPaintOverride(this.layout,n))continue;const l=this.paint.get(n),d=new ty(l),g=new nl(d,l.property.specification);let y=null;y=l.value.kind==="constant"||l.value.kind==="source"?new ca("source",g):new Ec("composite",g,l.value.zoomStops),this.paint._values[n]=new qr(l.property,y,l.parameters)}}_handleOverridablePaintPropertyUpdate(n,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&Zh.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,l){const d=n.get("text-field"),g=ap.paint.properties[l];let y=!1;const x=E=>{for(const A of E)if(g.overrides&&g.overrides.hasOverride(A))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof le)x(d.value.value.sections);else if(d.value.kind==="source"){const E=M=>{y||(M instanceof vt&&Ie(M.value)===pn?x(M.value.sections):M instanceof tl?x(M.sections):M.eachChild(E))},A=d.value;A._styleExpression&&E(A._styleExpression.expression)}return y}}function lp(o,n,l){let d="never";const g=o.get(n);return g?d=g:o.get(l)&&(d="always"),d}var V2={paint:new zn({"background-color":new At(be.paint_background["background-color"]),"background-pattern":new zc(be.paint_background["background-pattern"]),"background-opacity":new At(be.paint_background["background-opacity"])})},j2={paint:new zn({"raster-opacity":new At(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new At(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new At(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new At(be.paint_raster["raster-brightness-max"]),"raster-saturation":new At(be.paint_raster["raster-saturation"]),"raster-contrast":new At(be.paint_raster["raster-contrast"]),"raster-resampling":new At(be.paint_raster["raster-resampling"]),"raster-fade-duration":new At(be.paint_raster["raster-fade-duration"])})};class G2 extends Wr{constructor(n){super(n,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const $2={circle:class extends Wr{constructor(o){super(o,bw)}createBucket(o){return new zf(o)}queryRadius(o){const n=o;return Uc("circle-radius",this,n)+Uc("circle-stroke-width",this,n)+Lh(this.paint.get("circle-translate"))}queryIntersectsFeature(o,n,l,d,g,y,x,E){const A=kh(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,x),M=this.paint.get("circle-radius").evaluate(n,l)+this.paint.get("circle-stroke-width").evaluate(n,l),D=this.paint.get("circle-pitch-alignment")==="map",O=D?A:function(G,$){return G.map(ne=>d_(ne,$))}(A,E),N=D?M*x:M;for(const G of d)for(const $ of G){const ne=D?$:d_($,E);let ie=N;const _e=Rh([],[$.x,$.y,0,1],E);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=_e[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=y.cameraToCenterDistance/_e[3]),gw(O,ne,ie))return!0}return!1}},heatmap:class extends Wr{constructor(o){super(o,Ew),this._updateColorRamp()}createBucket(o){return new f_(o)}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=m_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Wr{constructor(o){super(o,Tw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Wr{constructor(o){super(o,Uw)}recalculate(o,n){super.recalculate(o,n);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Wf(o)}queryRadius(){return Lh(this.paint.get("fill-translate"))}queryIntersectsFeature(o,n,l,d,g,y,x){return r_(kh(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,x),d)}isTileClipped(){return!0}},"fill-extrusion":class extends Wr{constructor(o){super(o,e2)}createBucket(o){return new Xf(o)}queryRadius(){return Lh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,n,l,d,g,y,x,E){const A=kh(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,x),M=this.paint.get("fill-extrusion-height").evaluate(n,l),D=this.paint.get("fill-extrusion-base").evaluate(n,l),O=function(G,$,ne,ie){const _e=[];for(const Te of G){const ge=[Te.x,Te.y,0,1];Rh(ge,ge,$),_e.push(new pt(ge[0]/ge[3],ge[1]/ge[3]))}return _e}(A,E),N=function(G,$,ne,ie){const _e=[],Te=[],ge=ie[8]*$,we=ie[9]*$,Oe=ie[10]*$,De=ie[11]*$,ft=ie[8]*ne,xt=ie[9]*ne,st=ie[10]*ne,tt=ie[11]*ne;for(const Je of G){const ot=[],it=[];for(const qe of Je){const Dt=qe.x,It=qe.y,Qt=ie[0]*Dt+ie[4]*It+ie[12],Ui=ie[1]*Dt+ie[5]*It+ie[13],Hi=ie[2]*Dt+ie[6]*It+ie[14],Tn=ie[3]*Dt+ie[7]*It+ie[15],Dr=Hi+Oe,Un=Tn+De,gn=Qt+ft,Cn=Ui+xt,Vn=Hi+st,Wn=Tn+tt,hr=new pt((Qt+ge)/Un,(Ui+we)/Un);hr.z=Dr/Un,ot.push(hr);const _n=new pt(gn/Wn,Cn/Wn);_n.z=Vn/Wn,it.push(_n)}_e.push(ot),Te.push(it)}return[_e,Te]}(d,D,M,E);return function(G,$,ne){let ie=1/0;r_(ne,$)&&(ie=T_(ne,$[0]));for(let _e=0;_e<$.length;_e++){const Te=$[_e],ge=G[_e];for(let we=0;we<Te.length-1;we++){const Oe=Te[we],De=[Oe,Te[we+1],ge[we+1],ge[we],Oe];n_(ne,De)&&(ie=Math.min(ie,T_(ne,De)))}}return ie!==1/0&&ie}(N[0],N[1],O)}},line:class extends Wr{constructor(o){super(o,S_),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){o==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Wi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,n){super.recalculate(o,n),this.paint._values["line-floorwidth"]=I_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Yf(o)}queryRadius(o){const n=o,l=P_(Uc("line-width",this,n),Uc("line-gap-width",this,n)),d=Uc("line-offset",this,n);return l/2+Math.abs(d)+Lh(this.paint.get("line-translate"))}queryIntersectsFeature(o,n,l,d,g,y,x){const E=kh(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,x),A=x/2*P_(this.paint.get("line-width").evaluate(n,l),this.paint.get("line-gap-width").evaluate(n,l)),M=this.paint.get("line-offset").evaluate(n,l);return M&&(d=function(D,O){const N=[];for(let G=0;G<D.length;G++){const $=D[G],ne=[];for(let ie=0;ie<$.length;ie++){const _e=$[ie-1],Te=$[ie],ge=$[ie+1],we=ie===0?new pt(0,0):Te.sub(_e)._unit()._perp(),Oe=ie===$.length-1?new pt(0,0):ge.sub(Te)._unit()._perp(),De=we._add(Oe)._unit(),ft=De.x*Oe.x+De.y*Oe.y;ft!==0&&De._mult(1/ft),ne.push(De._mult(O)._add(Te))}N.push(ne)}return N}(d,M*x)),function(D,O,N){for(let G=0;G<O.length;G++){const $=O[G];if(D.length>=3){for(let ne=0;ne<$.length;ne++)if(pl(D,$[ne]))return!0}if(_w(D,$,N))return!0}return!1}(E,d,A)}isTileClipped(){return!0}},symbol:Zh,background:class extends Wr{constructor(o){super(o,V2)}},raster:class extends Wr{constructor(o){super(o,j2)}}};class H2{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const iy=63710088e-1;class rn{constructor(n,l){if(isNaN(n)||isNaN(l))throw new Error(`Invalid LngLat object: (${n}, ${l})`);if(this.lng=+n,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new rn(H(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const l=Math.PI/180,d=this.lat*l,g=n.lat*l,y=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((n.lng-this.lng)*l);return iy*Math.acos(Math.min(y,1))}toBounds(n=0){const l=360*n/40075017,d=l/Math.cos(Math.PI/180*this.lat);return new Ia(new rn(this.lng-d,this.lat-l),new rn(this.lng+d,this.lat+l))}static convert(n){if(n instanceof rn)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new rn(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new rn(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ia{constructor(n,l){n&&(l?this.setSouthWest(n).setNorthEast(l):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof rn?new rn(n.lng,n.lat):rn.convert(n),this}setSouthWest(n){return this._sw=n instanceof rn?new rn(n.lng,n.lat):rn.convert(n),this}extend(n){const l=this._sw,d=this._ne;let g,y;if(n instanceof rn)g=n,y=n;else{if(!(n instanceof Ia))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Ia.convert(n)):this.extend(rn.convert(n)):this;if(g=n._sw,y=n._ne,!g||!y)return this}return l||d?(l.lng=Math.min(g.lng,l.lng),l.lat=Math.min(g.lat,l.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new rn(g.lng,g.lat),this._ne=new rn(y.lng,y.lat)),this}getCenter(){return new rn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new rn(this.getWest(),this.getNorth())}getSouthEast(){return new rn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:l,lat:d}=rn.convert(n);let g=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(n){return n instanceof Ia?n:n&&new Ia(n)}}const ny=2*Math.PI*iy;function ry(o){return ny*Math.cos(o*Math.PI/180)}function sy(o){return(180+o)/360}function oy(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function ay(o,n){return o/ry(n)}function cp(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}class Xh{constructor(n,l,d=0){this.x=+n,this.y=+l,this.z=+d}static fromLngLat(n,l=0){const d=rn.convert(n);return new Xh(sy(d.lng),oy(d.lat),ay(l,d.lat))}toLngLat(){return new rn(360*this.x-180,cp(this.y))}toAltitude(){return this.z*ry(cp(this.y))}meterInMercatorCoordinateUnits(){return 1/ny*(n=cp(this.y),1/Math.cos(n*Math.PI/180));var n}}function ly(o,n,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[o*d-2*Math.PI*6378137/2,n*d-2*Math.PI*6378137/2]}class up{constructor(n,l,d){if(n<0||n>25||d<0||d>=Math.pow(2,n)||l<0||l>=Math.pow(2,n))throw new Error(`x=${l}, y=${d}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=l,this.y=d,this.key=Kc(0,n,n,l,d)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,l,d){const g=(x=this.y,E=this.z,A=ly(256*(y=this.x),256*(x=Math.pow(2,E)-x-1),E),M=ly(256*(y+1),256*(x+1),E),A[0]+","+A[1]+","+M[0]+","+M[1]);var y,x,E,A,M;const D=function(O,N,G){let $,ne="";for(let ie=O;ie>0;ie--)$=1<<ie-1,ne+=(N&$?1:0)+(G&$?2:0);return ne}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,g)}isChildOf(n){const l=this.z-n.z;return l>0&&n.x===this.x>>l&&n.y===this.y>>l}getTilePoint(n){const l=Math.pow(2,this.z);return new pt((n.x*l-this.x)*En,(n.y*l-this.y)*En)}toString(){return`${this.z}/${this.x}/${this.y}`}}class cy{constructor(n,l){this.wrap=n,this.canonical=l,this.key=Kc(n,l.z,l.z,l.x,l.y)}}class Rr{constructor(n,l,d,g,y){if(n<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${d}`);this.overscaledZ=n,this.wrap=l,this.canonical=new up(d,+g,+y),this.key=Kc(l,n,d,g,y)}clone(){return new Rr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-n;return n>this.canonical.z?new Rr(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rr(n,this.wrap,n,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(n,l){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-n;return n>this.canonical.z?Kc(this.wrap*+l,n,this.canonical.z,this.canonical.x,this.canonical.y):Kc(this.wrap*+l,n,n,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const l=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>l&&n.canonical.y===this.canonical.y>>l}children(n){if(this.overscaledZ>=n)return[new Rr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new Rr(l,this.wrap,l,d,g),new Rr(l,this.wrap,l,d+1,g),new Rr(l,this.wrap,l,d,g+1),new Rr(l,this.wrap,l,d+1,g+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Rr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Rr(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new cy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new Xh(n.x-this.wrap,n.y))}}function Kc(o,n,l,d,g){(o*=2)<0&&(o=-1*o-1);const y=1<<l;return(y*y*o+y*g+d).toString(36)+l.toString(36)+n.toString(36)}gt("CanonicalTileID",up),gt("OverscaledTileID",Rr,{omit:["posMatrix"]});class uy{constructor(n,l,d){if(this.uid=n,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void $e(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const g=this.dim=l.height-2;this.data=new Uint32Array(l.data.buffer),this.encoding=d||"mapbox";for(let y=0;y<g;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(g,y)]=this.data[this._idx(g-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,g)]=this.data[this._idx(y,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let y=0;y<g;y++)for(let x=0;x<g;x++){const E=this.get(y,x);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(n,l){const d=new Uint8Array(this.data.buffer),g=4*this._idx(n,l);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(d[g],d[g+1],d[g+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(n,l){if(n<-1||n>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(n+1)}_unpackMapbox(n,l,d){return(256*n*256+256*l+d)/10-1e4}_unpackTerrarium(n,l,d){return 256*n+l+d/256-32768}getPixels(){return new kr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,l,d){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,y=l*this.dim+this.dim,x=d*this.dim,E=d*this.dim+this.dim;switch(l){case-1:g=y-1;break;case 1:y=g+1}switch(d){case-1:x=E-1;break;case 1:E=x+1}const A=-l*this.dim,M=-d*this.dim;for(let D=x;D<E;D++)for(let O=g;O<y;O++)this.data[this._idx(O,D)]=n.data[this._idx(O+A,D+M)]}}gt("DEMData",uy);class hy{constructor(n){this._stringToNumber={},this._numberToString=[];for(let l=0;l<n.length;l++){const d=n[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class dy{constructor(n,l,d,g,y){this.type="Feature",this._vectorTileFeature=n,n._z=l,n._x=d,n._y=g,this.properties=n.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(n[l]=this[l]);return n}}class fy{constructor(n,l){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new va(En,16,0),this.grid3D=new va(En,16,0),this.featureIndexArray=new Jt,this.promoteId=l}insert(n,l,d,g,y,x){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,y);const A=x?this.grid3D:this.grid;for(let M=0;M<l.length;M++){const D=l[M],O=[1/0,1/0,-1/0,-1/0];for(let N=0;N<D.length;N++){const G=D[N];O[0]=Math.min(O[0],G.x),O[1]=Math.min(O[1],G.y),O[2]=Math.max(O[2],G.x),O[3]=Math.max(O[3],G.y)}O[0]<En&&O[1]<En&&O[2]>=0&&O[3]>=0&&A.insert(E,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new zo.VectorTile(new Kf(this.rawTileData)).layers,this.sourceLayerCoder=new hy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,l,d,g){this.loadVTLayers();const y=n.params||{},x=En/n.tileSize/n.scale,E=ol(y.filter),A=n.queryGeometry,M=n.queryPadding*x,D=my(A),O=this.grid.query(D.minX-M,D.minY-M,D.maxX+M,D.maxY+M),N=my(n.cameraQueryGeometry),G=this.grid3D.query(N.minX-M,N.minY-M,N.maxX+M,N.maxY+M,(ie,_e,Te,ge)=>function(we,Oe,De,ft,xt){for(const tt of we)if(Oe<=tt.x&&De<=tt.y&&ft>=tt.x&&xt>=tt.y)return!0;const st=[new pt(Oe,De),new pt(Oe,xt),new pt(ft,xt),new pt(ft,De)];if(we.length>2){for(const tt of st)if(pl(we,tt))return!0}for(let tt=0;tt<we.length-1;tt++)if(vw(we[tt],we[tt+1],st))return!0;return!1}(n.cameraQueryGeometry,ie-M,_e-M,Te+M,ge+M));for(const ie of G)O.push(ie);O.sort(q2);const $={};let ne;for(let ie=0;ie<O.length;ie++){const _e=O[ie];if(_e===ne)continue;ne=_e;const Te=this.featureIndexArray.get(_e);let ge=null;this.loadMatchingFeature($,Te.bucketIndex,Te.sourceLayerIndex,Te.featureIndex,E,y.layers,y.availableImages,l,d,g,(we,Oe,De)=>(ge||(ge=Ta(we)),Oe.queryIntersectsFeature(A,we,De,ge,this.z,n.transform,x,n.pixelPosMatrix)))}return $}loadMatchingFeature(n,l,d,g,y,x,E,A,M,D,O){const N=this.bucketLayerIDs[l];if(x&&!function(ie,_e){for(let Te=0;Te<ie.length;Te++)if(_e.indexOf(ie[Te])>=0)return!0;return!1}(x,N))return;const G=this.sourceLayerCoder.decode(d),$=this.vtLayers[G].feature(g);if(y.needGeometry){const ie=Aa($,!0);if(!y.filter(new Gi(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!y.filter(new Gi(this.tileID.overscaledZ),$))return;const ne=this.getId($,G);for(let ie=0;ie<N.length;ie++){const _e=N[ie];if(x&&x.indexOf(_e)<0)continue;const Te=A[_e];if(!Te)continue;let ge={};ne&&D&&(ge=D.getState(Te.sourceLayer||"_geojsonTileLayer",ne));const we=ee({},M[_e]);we.paint=py(we.paint,Te.paint,$,ge,E),we.layout=py(we.layout,Te.layout,$,ge,E);const Oe=!O||O($,Te,ge);if(!Oe)continue;const De=new dy($,this.z,this.x,this.y,ne);De.layer=we;let ft=n[_e];ft===void 0&&(ft=n[_e]=[]),ft.push({featureIndex:g,feature:De,intersectionZ:Oe})}}lookupSymbolFeatures(n,l,d,g,y,x,E,A){const M={};this.loadVTLayers();const D=ol(y);for(const O of n)this.loadMatchingFeature(M,d,g,O,D,x,E,A,l);return M}hasLayer(n){for(const l of this.bucketLayerIDs)for(const d of l)if(n===d)return!0;return!1}getId(n,l){let d=n.id;return this.promoteId&&(d=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof d=="boolean"&&(d=Number(d))),d}}function py(o,n,l,d,g){return fe(o,(y,x)=>{const E=n instanceof wa?n.get(x):null;return E&&E.evaluate?E.evaluate(l,d,g):E})}function my(o){let n=1/0,l=1/0,d=-1/0,g=-1/0;for(const y of o)n=Math.min(n,y.x),l=Math.min(l,y.y),d=Math.max(d,y.x),g=Math.max(g,y.y);return{minX:n,minY:l,maxX:d,maxY:g}}function q2(o,n){return n-o}var hp;gt("FeatureIndex",fy,{omit:["rawTileData","sourceLayerCoder"]}),c.PerformanceMarkers=void 0,(hp=c.PerformanceMarkers||(c.PerformanceMarkers={})).create="create",hp.load="load",hp.fullLoad="fullLoad";let Yh=null,Jc=[];const dp=1e3/30,W2={mark(o){performance.mark(o)},frame(o){const n=o;Yh!=null&&Jc.push(n-Yh),Yh=n},clearMetrics(){Yh=null,Jc=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const o in c.PerformanceMarkers)performance.clearMarks(c.PerformanceMarkers[o])},getPerformanceMetrics(){performance.measure("loadTime",c.PerformanceMarkers.create,c.PerformanceMarkers.load),performance.measure("fullLoadTime",c.PerformanceMarkers.create,c.PerformanceMarkers.fullLoad);const o=performance.getEntriesByName("loadTime")[0].duration,n=performance.getEntriesByName("fullLoadTime")[0].duration,l=Jc.length,d=1/(Jc.reduce((y,x)=>y+x,0)/l/1e3),g=Jc.filter(y=>y>dp).reduce((y,x)=>y+(x-dp)/dp,0);return{loadTime:o,fullLoadTime:n,fps:d,percentDroppedFrames:g/(l+g)*100}}};c.AJAXError=ce,c.ARRAY_TYPE=er,c.Actor=class{constructor(o,n,l){this.target=o,this.parent=n,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},pe(["receive","process"],this),this.invoker=new H2(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=at()?o:window}send(o,n,l,d,g=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[y]=l);const x=gi(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:o,hasCallback:!!l,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:Zs(n,x)},x),{cancel:()=>{l&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(o){const n=o.data,l=n.id;if(l&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){delete this.tasks[l];const d=this.cancelCallbacks[l];delete this.cancelCallbacks[l],d&&d()}else at()||n.mustQueue?(this.tasks[l]=n,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,n)}process(){if(!this.taskQueue.length)return;const o=this.taskQueue.shift(),n=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),n&&this.processTask(o,n)}processTask(o,n){if(n.type==="<response>"){const l=this.callbacks[o];delete this.callbacks[o],l&&(n.error?l(Es(n.error)):l(null,Es(n.data)))}else{let l=!1;const d=gi(this.globalScope)?void 0:[],g=n.hasCallback?(E,A)=>{l=!0,delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:E?Zs(E):null,data:Zs(A,d)},d)}:E=>{l=!0};let y=null;const x=Es(n.data);if(this.parent[n.type])y=this.parent[n.type](n.sourceMapId,x,g);else if(this.parent.getWorkerSource){const E=n.type.split(".");y=this.parent.getWorkerSource(n.sourceMapId,E[0],x.source)[E[1]](x,g)}else g(new Error(`Could not find function ${n.type}`));!l&&y&&y.cancel&&(this.cancelCallbacks[o]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.AlphaImage=jc,c.CanonicalTileID=up,c.CollisionBoxArray=Le,c.CollisionCircleLayoutArray=class extends z{},c.Color=W,c.DEMData=uy,c.DataConstantProperty=At,c.DictionaryCoder=hy,c.EXTENT=En,c.ErrorEvent=Zt,c.EvaluationParameters=Gi,c.Event=Bt,c.Evented=ci,c.FeatureIndex=fy,c.FillBucket=Wf,c.FillExtrusionBucket=Xf,c.GeoJSONFeature=dy,c.ImageAtlas=F_,c.ImagePosition=Qf,c.LineBucket=Yf,c.LineStripIndexArray=class extends te{},c.LngLat=rn,c.LngLatBounds=Ia,c.MercatorCoordinate=Xh,c.ONE_EM=On,c.OverscaledTileID=Rr,c.PerformanceUtils=W2,c.PosArray=Rt,c.Properties=zn,c.QuadTriangleArray=class extends V{},c.RGBAImage=kr,c.RasterBoundsArray=class extends m{},c.RequestPerformance=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},c.ResourceType=J,c.SegmentVector=ni,c.SymbolBucket=bl,c.Transitionable=Ah,c.TriangleIndexArray=Jn,c.Uniform1f=Js,c.Uniform1i=class extends Ks{constructor(o,n){super(o,n),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},c.Uniform2f=class extends Ks{constructor(o,n){super(o,n),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},c.Uniform3f=class extends Ks{constructor(o,n){super(o,n),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},c.Uniform4f=dl,c.UniformColor=Qg,c.UniformMatrix4f=class extends Ks{constructor(o,n){super(o,n),this.current=pw}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let n=1;n<16;n++)if(o[n]!==this.current[n]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},c.UnwrappedTileID=cy,c.ValidationError=je,c.ZoomHistory=Ic,c.add=function(o,n,l){return o[0]=n[0]+l[0],o[1]=n[1]+l[1],o[2]=n[2]+l[2],o},c.addDynamicAttributes=rp,c.asyncAll=function(o,n,l){if(!o.length)return l(null,[]);let d=o.length;const g=new Array(o.length);let y=null;o.forEach((x,E)=>{n(x,(A,M)=>{A&&(y=A),g[E]=M,--d==0&&l(y,g)})})},c.bezier=P,c.bindAll=pe,c.cacheEntryPossiblyAdded=function(o){Ne++,Ne>Hn&&(o.getActor().send("enforceCacheSizeLimit",Ri),Ne=0)},c.clamp=C,c.clearTileCache=function(o){const n=caches.delete(Bi);o&&n.catch(o).then(()=>o())},c.clipLine=X_,c.clone=function(o){var n=new er(16);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=o[3],n[4]=o[4],n[5]=o[5],n[6]=o[6],n[7]=o[7],n[8]=o[8],n[9]=o[9],n[10]=o[10],n[11]=o[11],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15],n},c.clone$1=Se,c.clone$2=function(o){var n=new er(3);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n},c.collisionCircleLayout=h2,c.config=si,c.copy=function(o,n){return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},c.create=function(){var o=new er(16);return er!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},c.create$1=a_,c.createExpression=la,c.createFilter=ol,c.createLayout=mn,c.createStyleLayer=function(o){return o.type==="custom"?new G2(o):new $2[o.type](o)},c.cross=function(o,n,l){var d=n[0],g=n[1],y=n[2],x=l[0],E=l[1],A=l[2];return o[0]=g*A-y*E,o[1]=y*x-d*A,o[2]=d*E-g*x,o},c.dot=function(o,n){return o[0]*n[0]+o[1]*n[1]+o[2]*n[2]},c.dot$1=function(o,n){return o[0]*n[0]+o[1]*n[1]+o[2]*n[2]+o[3]*n[3]},c.ease=k,c.emitValidationErrors=ll,c.enforceCacheSizeLimit=function(o){qn(),ln&&ln.then(n=>{n.keys().then(l=>{for(let d=0;d<l.length-o;d++)n.delete(l[d])})})},c.equals=function(o,n){var l=o[0],d=o[1],g=o[2],y=o[3],x=o[4],E=o[5],A=o[6],M=o[7],D=o[8],O=o[9],N=o[10],G=o[11],$=o[12],ne=o[13],ie=o[14],_e=o[15],Te=n[0],ge=n[1],we=n[2],Oe=n[3],De=n[4],ft=n[5],xt=n[6],st=n[7],tt=n[8],Je=n[9],ot=n[10],it=n[11],qe=n[12],Dt=n[13],It=n[14],Qt=n[15];return Math.abs(l-Te)<=Qn*Math.max(1,Math.abs(l),Math.abs(Te))&&Math.abs(d-ge)<=Qn*Math.max(1,Math.abs(d),Math.abs(ge))&&Math.abs(g-we)<=Qn*Math.max(1,Math.abs(g),Math.abs(we))&&Math.abs(y-Oe)<=Qn*Math.max(1,Math.abs(y),Math.abs(Oe))&&Math.abs(x-De)<=Qn*Math.max(1,Math.abs(x),Math.abs(De))&&Math.abs(E-ft)<=Qn*Math.max(1,Math.abs(E),Math.abs(ft))&&Math.abs(A-xt)<=Qn*Math.max(1,Math.abs(A),Math.abs(xt))&&Math.abs(M-st)<=Qn*Math.max(1,Math.abs(M),Math.abs(st))&&Math.abs(D-tt)<=Qn*Math.max(1,Math.abs(D),Math.abs(tt))&&Math.abs(O-Je)<=Qn*Math.max(1,Math.abs(O),Math.abs(Je))&&Math.abs(N-ot)<=Qn*Math.max(1,Math.abs(N),Math.abs(ot))&&Math.abs(G-it)<=Qn*Math.max(1,Math.abs(G),Math.abs(it))&&Math.abs($-qe)<=Qn*Math.max(1,Math.abs($),Math.abs(qe))&&Math.abs(ne-Dt)<=Qn*Math.max(1,Math.abs(ne),Math.abs(Dt))&&Math.abs(ie-It)<=Qn*Math.max(1,Math.abs(ie),Math.abs(It))&&Math.abs(_e-Qt)<=Qn*Math.max(1,Math.abs(_e),Math.abs(Qt))},c.evaluateSizeForFeature=function(o,{uSize:n,uSizeT:l},{lowerSize:d,upperSize:g}){return o.kind==="source"?d/to:o.kind==="composite"?Kt(d/to,g/to,l):n},c.evaluateSizeForZoom=function(o,n){let l=0,d=0;if(o.kind==="constant")d=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:x}=o,E=g?C(lr.interpolationFactor(g,n,y,x),0,1):0;o.kind==="camera"?d=Kt(o.minSize,o.maxSize,E):l=E}return{uSizeT:l,uSize:d}},c.evaluateVariableOffset=J_,c.evented=Dc,c.exported=mi,c.exported$1=ht,c.extend=ee,c.filterObject=ye,c.fromRotation=function(o,n){var l=Math.sin(n),d=Math.cos(n);return o[0]=d,o[1]=l,o[2]=0,o[3]=-l,o[4]=d,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},c.fromScaling=function(o,n){return o[0]=n[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},c.getAnchorAlignment=tp,c.getAnchorJustification=np,c.getArrayBuffer=Ze,c.getImage=Ct,c.getJSON=function(o,n){return Fe(ee(o,{type:"json"}),n)},c.getOverlapMode=lp,c.getRTLTextPluginStatus=xa,c.getReferrer=Ce,c.getVideo=function(o,n){const l=window.document.createElement("video");l.muted=!0,l.onloadstart=function(){n(null,l)};for(let d=0;d<o.length;d++){const g=window.document.createElement("source");lt(o[d])||(l.crossOrigin="Anonymous"),g.src=o[d],l.appendChild(g)}return{cancel:()=>{}}},c.identity=Bf,c.invert=function(o,n){var l=n[0],d=n[1],g=n[2],y=n[3],x=n[4],E=n[5],A=n[6],M=n[7],D=n[8],O=n[9],N=n[10],G=n[11],$=n[12],ne=n[13],ie=n[14],_e=n[15],Te=l*E-d*x,ge=l*A-g*x,we=l*M-y*x,Oe=d*A-g*E,De=d*M-y*E,ft=g*M-y*A,xt=D*ne-O*$,st=D*ie-N*$,tt=D*_e-G*$,Je=O*ie-N*ne,ot=O*_e-G*ne,it=N*_e-G*ie,qe=Te*it-ge*ot+we*Je+Oe*tt-De*st+ft*xt;return qe?(o[0]=(E*it-A*ot+M*Je)*(qe=1/qe),o[1]=(g*ot-d*it-y*Je)*qe,o[2]=(ne*ft-ie*De+_e*Oe)*qe,o[3]=(N*De-O*ft-G*Oe)*qe,o[4]=(A*tt-x*it-M*st)*qe,o[5]=(l*it-g*tt+y*st)*qe,o[6]=(ie*we-$*ft-_e*ge)*qe,o[7]=(D*ft-N*we+G*ge)*qe,o[8]=(x*ot-E*tt+M*xt)*qe,o[9]=(d*tt-l*ot-y*xt)*qe,o[10]=($*De-ne*we+_e*Te)*qe,o[11]=(O*we-D*De-G*Te)*qe,o[12]=(E*st-x*Je-A*xt)*qe,o[13]=(l*Je-d*st+g*xt)*qe,o[14]=(ne*ge-$*Oe-ie*Te)*qe,o[15]=(D*Oe-O*ge+N*Te)*qe,o):null},c.isImageBitmap=Ut,c.isSafari=gi,c.isWorker=at,c.keysDifference=function(o,n){const l=[];for(const d in o)d in n||l.push(d);return l},c.lazyLoadRTLTextPlugin=function(){wr.isLoading()||wr.isLoaded()||xa()!=="deferred"||Th()},c.makeRequest=Fe,c.mapObject=fe,c.mercatorXfromLng=sy,c.mercatorYfromLat=oy,c.mercatorZfromAltitude=ay,c.mul=ww,c.mul$1=function(o,n,l){return o[0]=n[0]*l[0],o[1]=n[1]*l[1],o[2]=n[2]*l[2],o[3]=n[3]*l[3],o},c.multiply=l_,c.nextPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},c.normalize=function(o,n){var l=n[0],d=n[1],g=n[2],y=l*l+d*d+g*g;return y>0&&(y=1/Math.sqrt(y)),o[0]=n[0]*y,o[1]=n[1]*y,o[2]=n[2]*y,o},c.number=Kt,c.ortho=function(o,n,l,d,g,y,x){var E=1/(n-l),A=1/(d-g),M=1/(y-x);return o[0]=-2*E,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*A,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*M,o[11]=0,o[12]=(n+l)*E,o[13]=(g+d)*A,o[14]=(x+y)*M,o[15]=1,o},c.parseCacheControl=wt,c.parseGlyphPbf=function(o){return new Kf(o).readFields(w2,[])},c.pbf=Kf,c.performSymbolLayout=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=En/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const n=o.bucket.layers[0].layout,l=o.bucket.layers[0]._unevaluatedLayout._values,d={layoutIconSize:l["icon-size"].possiblyEvaluate(new Gi(o.bucket.zoom+1),o.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new Gi(o.bucket.zoom+1),o.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new Gi(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:M}=o.bucket.textSizeData;d.compositeTextSizes=[l["text-size"].possiblyEvaluate(new Gi(A),o.canonical),l["text-size"].possiblyEvaluate(new Gi(M),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:M}=o.bucket.iconSizeData;d.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new Gi(A),o.canonical),l["icon-size"].possiblyEvaluate(new Gi(M),o.canonical)]}const g=n.get("text-line-height")*On,y=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",x=n.get("text-keep-upright"),E=n.get("text-size");for(const A of o.bucket.features){const M=n.get("text-font").evaluate(A,{},o.canonical).join(","),D=E.evaluate(A,{},o.canonical),O=d.layoutTextSize.evaluate(A,{},o.canonical),N=d.layoutIconSize.evaluate(A,{},o.canonical),G={horizontal:{},vertical:void 0},$=A.text;let ne,ie=[0,0];if($){const ge=$.toString(),we=n.get("text-letter-spacing").evaluate(A,{},o.canonical)*On,Oe=Cf(ge)?we:0,De=n.get("text-anchor").evaluate(A,{},o.canonical),ft=n.get("text-variable-anchor");if(!ft){const ot=n.get("text-radial-offset").evaluate(A,{},o.canonical);ie=ot?J_(De,[ot*On,ip]):n.get("text-offset").evaluate(A,{},o.canonical).map(it=>it*On)}let xt=y?"center":n.get("text-justify").evaluate(A,{},o.canonical);const st=n.get("symbol-placement"),tt=st==="point"?n.get("text-max-width").evaluate(A,{},o.canonical)*On:0,Je=()=>{o.bucket.allowVerticalPlacement&&cl(ge)&&(G.vertical=Vh($,o.glyphMap,o.glyphPositions,o.imagePositions,M,tt,g,De,"left",Oe,ie,c.WritingMode.vertical,!0,st,O,D))};if(!y&&ft){const ot=xt==="auto"?ft.map(qe=>np(qe)):[xt];let it=!1;for(let qe=0;qe<ot.length;qe++){const Dt=ot[qe];if(!G.horizontal[Dt])if(it)G.horizontal[Dt]=G.horizontal[0];else{const It=Vh($,o.glyphMap,o.glyphPositions,o.imagePositions,M,tt,g,"center",Dt,Oe,ie,c.WritingMode.horizontal,!1,st,O,D);It&&(G.horizontal[Dt]=It,it=It.positionedLines.length===1)}}Je()}else{xt==="auto"&&(xt=np(De));const ot=Vh($,o.glyphMap,o.glyphPositions,o.imagePositions,M,tt,g,De,xt,Oe,ie,c.WritingMode.horizontal,!1,st,O,D);ot&&(G.horizontal[xt]=ot),Je(),cl(ge)&&y&&x&&(G.vertical=Vh($,o.glyphMap,o.glyphPositions,o.imagePositions,M,tt,g,De,xt,Oe,ie,c.WritingMode.vertical,!1,st,O,D))}}let _e=!1;if(A.icon&&A.icon.name){const ge=o.imageMap[A.icon.name];ge&&(ne=P2(o.imagePositions[A.icon.name],n.get("icon-offset").evaluate(A,{},o.canonical),n.get("icon-anchor").evaluate(A,{},o.canonical)),_e=!!ge.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=_e:o.bucket.sdfIcons!==_e&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ge.pixelRatio!==o.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const Te=ey(G.horizontal)||G.vertical;o.bucket.iconsInText=!!Te&&Te.iconsInText,(Te||ne)&&z2(o.bucket,A,G,ne,o.imageMap,d,O,N,ie,_e,o.canonical)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},c.perspective=function(o,n,l,d,g){var y,x=1/Math.tan(n/2);return o[0]=x/l,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=x,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,g!=null&&g!==1/0?(o[10]=(g+d)*(y=1/(d-g)),o[14]=2*g*d*y):(o[10]=-1,o[14]=-2*d),o},c.pick=function(o,n){const l={};for(let d=0;d<n.length;d++){const g=n[d];g in o&&(l[g]=o[g])}return l},c.plugin=wr,c.pointGeometry=pt,c.polygonIntersectsPolygon=n_,c.potpack=O_,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.register=gt,c.registerForPluginStateChange=function(o){return o({pluginStatus:Kn,pluginURL:Ts}),Dc.on("pluginStateChange",o),o},c.renderColorRamp=m_,c.rotateX=function(o,n,l){var d=Math.sin(l),g=Math.cos(l),y=n[4],x=n[5],E=n[6],A=n[7],M=n[8],D=n[9],O=n[10],N=n[11];return n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[4]=y*g+M*d,o[5]=x*g+D*d,o[6]=E*g+O*d,o[7]=A*g+N*d,o[8]=M*g-y*d,o[9]=D*g-x*d,o[10]=O*g-E*d,o[11]=N*g-A*d,o},c.rotateZ=function(o,n,l){var d=Math.sin(l),g=Math.cos(l),y=n[0],x=n[1],E=n[2],A=n[3],M=n[4],D=n[5],O=n[6],N=n[7];return n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[0]=y*g+M*d,o[1]=x*g+D*d,o[2]=E*g+O*d,o[3]=A*g+N*d,o[4]=M*g-y*d,o[5]=D*g-x*d,o[6]=O*g-E*d,o[7]=N*g-A*d,o},c.scale=function(o,n,l){var d=l[0],g=l[1],y=l[2];return o[0]=n[0]*d,o[1]=n[1]*d,o[2]=n[2]*d,o[3]=n[3]*d,o[4]=n[4]*g,o[5]=n[5]*g,o[6]=n[6]*g,o[7]=n[7]*g,o[8]=n[8]*y,o[9]=n[9]*y,o[10]=n[10]*y,o[11]=n[11]*y,o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},c.scale$1=function(o,n,l){return o[0]=n[0]*l,o[1]=n[1]*l,o[2]=n[2]*l,o},c.setCacheLimits=function(o,n){Ri=o,Hn=n},c.setRTLTextPlugin=function(o,n,l=!1){if(Kn===Cc||Kn===Lc||Kn===kc)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ts=mi.resolveURL(o),Kn=Cc,Rc=n,Lo(),l||Th()},c.spec=be,c.sphericalToCartesian=function([o,n,l]){return n+=90,n*=Math.PI/180,l*=Math.PI/180,{x:o*Math.cos(n)*Math.sin(l),y:o*Math.sin(n)*Math.sin(l),z:o*Math.cos(l)}},c.sqrLen=function(o){var n=o[0],l=o[1];return n*n+l*l},c.sub=function(o,n,l){return o[0]=n[0]-l[0],o[1]=n[1]-l[1],o[2]=n[2]-l[2],o},c.toEvaluationFeature=Aa,c.transformMat3=function(o,n,l){var d=n[0],g=n[1],y=n[2];return o[0]=d*l[0]+g*l[3]+y*l[6],o[1]=d*l[1]+g*l[4]+y*l[7],o[2]=d*l[2]+g*l[5]+y*l[8],o},c.transformMat4=Rh,c.transformMat4$1=function(o,n,l){var d=n[0],g=n[1];return o[0]=l[0]*d+l[4]*g+l[12],o[1]=l[1]*d+l[5]*g+l[13],o},c.translate=function(o,n,l){var d,g,y,x,E,A,M,D,O,N,G,$,ne=l[0],ie=l[1],_e=l[2];return n===o?(o[12]=n[0]*ne+n[4]*ie+n[8]*_e+n[12],o[13]=n[1]*ne+n[5]*ie+n[9]*_e+n[13],o[14]=n[2]*ne+n[6]*ie+n[10]*_e+n[14],o[15]=n[3]*ne+n[7]*ie+n[11]*_e+n[15]):(g=n[1],y=n[2],x=n[3],E=n[4],A=n[5],M=n[6],D=n[7],O=n[8],N=n[9],G=n[10],$=n[11],o[0]=d=n[0],o[1]=g,o[2]=y,o[3]=x,o[4]=E,o[5]=A,o[6]=M,o[7]=D,o[8]=O,o[9]=N,o[10]=G,o[11]=$,o[12]=d*ne+E*ie+O*_e+n[12],o[13]=g*ne+A*ie+N*_e+n[13],o[14]=y*ne+M*ie+G*_e+n[14],o[15]=x*ne+D*ie+$*_e+n[15]),o},c.triggerPluginCompletionEvent=Eh,c.unicodeBlockLookup=rt,c.uniqueId=function(){return se++},c.validateCustomStyleLayer=function(o){const n=[],l=o.id;return l===void 0&&n.push({message:`layers.${l}: missing required property "id"`}),o.render===void 0&&n.push({message:`layers.${l}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&n.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),n},c.validateLight=Sc,c.validateStyle=ya,c.vectorTile=zo,c.warnOnce=$e,c.wrap=H}),h(["./shared"],function(c){function b(X){const R=typeof X;if(R==="number"||R==="boolean"||R==="string"||X==null)return JSON.stringify(X);if(Array.isArray(X)){let W="[";for(const oe of X)W+=`${b(oe)},`;return`${W}]`}const F=Object.keys(X).sort();let q="{";for(let W=0;W<F.length;W++)q+=`${JSON.stringify(F[W])}:${b(X[F[W]])},`;return`${q}}`}function T(X){let R="";for(const F of c.refProperties)R+=`/${b(X[F])}`;return R}class P{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,F){for(const W of R){this._layerConfigs[W.id]=W;const oe=this._layers[W.id]=c.createStyleLayer(W);oe._featureFilter=c.createFilter(oe.filter),this.keyCache[W.id]&&delete this.keyCache[W.id]}for(const W of F)delete this.keyCache[W],delete this._layerConfigs[W],delete this._layers[W];this.familiesBySource={};const q=function(W,oe){const he={};for(let re=0;re<W.length;re++){const de=oe&&oe[W[re].id]||T(W[re]);oe&&(oe[W[re].id]=de);let Pe=he[de];Pe||(Pe=he[de]=[]),Pe.push(W[re])}const le=[];for(const re in he)le.push(he[re]);return le}(Object.values(this._layerConfigs),this.keyCache);for(const W of q){const oe=W.map(Be=>this._layers[Be.id]),he=oe[0];if(he.visibility==="none")continue;const le=he.source||"";let re=this.familiesBySource[le];re||(re=this.familiesBySource[le]={});const de=he.sourceLayer||"_geojsonTileLayer";let Pe=re[de];Pe||(Pe=re[de]=[]),Pe.push(oe)}}}class k{constructor(R){const F={},q=[];for(const le in R){const re=R[le],de=F[le]={};for(const Pe in re){const Be=re[+Pe];if(!Be||Be.bitmap.width===0||Be.bitmap.height===0)continue;const Ie={x:0,y:0,w:Be.bitmap.width+2,h:Be.bitmap.height+2};q.push(Ie),de[Pe]={rect:Ie,metrics:Be.metrics}}}const{w:W,h:oe}=c.potpack(q),he=new c.AlphaImage({width:W||1,height:oe||1});for(const le in R){const re=R[le];for(const de in re){const Pe=re[+de];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;const Be=F[le][de].rect;c.AlphaImage.copy(Pe.bitmap,he,{x:0,y:0},{x:Be.x+1,y:Be.y+1},Pe.bitmap)}}this.image=he,this.positions=F}}c.register("GlyphAtlas",k);class C{constructor(R){this.tileID=new c.OverscaledTileID(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId}parse(R,F,q,W,oe){this.status="parsing",this.data=R,this.collisionBoxArray=new c.CollisionBoxArray;const he=new c.DictionaryCoder(Object.keys(R.layers).sort()),le=new c.FeatureIndex(this.tileID,this.promoteId);le.bucketLayerIDs=[];const re={},de={featureIndex:le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},Pe=F.familiesBySource[this.source];for(const Ot in Pe){const Vt=R.layers[Ot];if(!Vt)continue;Vt.version===1&&c.warnOnce(`Vector tile source "${this.source}" layer "${Ot}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ti=he.encode(Ot),oi=[];for(let Ci=0;Ci<Vt.length;Ci++){const Li=Vt.feature(Ci),bn=le.getId(Li,Ot);oi.push({feature:Li,id:bn,index:Ci,sourceLayerIndex:ti})}for(const Ci of Pe[Ot]){const Li=Ci[0];Li.source!==this.source&&c.warnOnce(`layer.source = ${Li.source} does not equal this.source = ${this.source}`),Li.minzoom&&this.zoom<Math.floor(Li.minzoom)||Li.maxzoom&&this.zoom>=Li.maxzoom||Li.visibility!=="none"&&(H(Ci,this.zoom,q),(re[Li.id]=Li.createBucket({index:le.bucketLayerIDs.length,layers:Ci,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ti,sourceID:this.source})).populate(oi,de,this.tileID.canonical),le.bucketLayerIDs.push(Ci.map(bn=>bn.id)))}}let Be,Ie,mt,vt;const nt=c.mapObject(de.glyphDependencies,Ot=>Object.keys(Ot).map(Number));Object.keys(nt).length?W.send("getGlyphs",{uid:this.uid,stacks:nt},(Ot,Vt)=>{Be||(Be=Ot,Ie=Vt,Yt.call(this))}):Ie={};const kt=Object.keys(de.iconDependencies);kt.length?W.send("getImages",{icons:kt,source:this.source,tileID:this.tileID,type:"icons"},(Ot,Vt)=>{Be||(Be=Ot,mt=Vt,Yt.call(this))}):mt={};const St=Object.keys(de.patternDependencies);function Yt(){if(Be)return oe(Be);if(Ie&&mt&&vt){const Ot=new k(Ie),Vt=new c.ImageAtlas(mt,vt);for(const ti in re){const oi=re[ti];oi instanceof c.SymbolBucket?(H(oi.layers,this.zoom,q),c.performSymbolLayout({bucket:oi,glyphMap:Ie,glyphPositions:Ot.positions,imageMap:mt,imagePositions:Vt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):oi.hasPattern&&(oi instanceof c.LineBucket||oi instanceof c.FillBucket||oi instanceof c.FillExtrusionBucket)&&(H(oi.layers,this.zoom,q),oi.addFeatures(de,this.tileID.canonical,Vt.patternPositions))}this.status="done",oe(null,{buckets:Object.values(re).filter(ti=>!ti.isEmpty()),featureIndex:le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ot.image,imageAtlas:Vt,glyphMap:this.returnDependencies?Ie:null,iconMap:this.returnDependencies?mt:null,glyphPositions:this.returnDependencies?Ot.positions:null})}}St.length?W.send("getImages",{icons:St,source:this.source,tileID:this.tileID,type:"patterns"},(Ot,Vt)=>{Be||(Be=Ot,vt=Vt,Yt.call(this))}):vt={},Yt.call(this)}}function H(X,R,F){const q=new c.EvaluationParameters(R);for(const W of X)W.recalculate(q,F)}function ee(X,R){const F=c.getArrayBuffer(X.request,(q,W,oe,he)=>{q?R(q):W&&R(null,{vectorTile:new c.vectorTile.VectorTile(new c.pbf(W)),rawData:W,cacheControl:oe,expires:he})});return()=>{F.cancel(),R()}}class se{constructor(R,F,q,W){this.actor=R,this.layerIndex=F,this.availableImages=q,this.loadVectorData=W||ee,this.loading={},this.loaded={}}loadTile(R,F){const q=R.uid;this.loading||(this.loading={});const W=!!(R&&R.request&&R.request.collectResourceTiming)&&new c.RequestPerformance(R.request),oe=this.loading[q]=new C(R);oe.abort=this.loadVectorData(R,(he,le)=>{if(delete this.loading[q],he||!le)return oe.status="done",this.loaded[q]=oe,F(he);const re=le.rawData,de={};le.expires&&(de.expires=le.expires),le.cacheControl&&(de.cacheControl=le.cacheControl);const Pe={};if(W){const Be=W.finish();Be&&(Pe.resourceTiming=JSON.parse(JSON.stringify(Be)))}oe.vectorTile=le.vectorTile,oe.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor,(Be,Ie)=>{if(Be||!Ie)return F(Be);F(null,c.extend({rawTileData:re.slice(0)},Ie,de,Pe))}),this.loaded=this.loaded||{},this.loaded[q]=oe})}reloadTile(R,F){const q=this.loaded,W=R.uid,oe=this;if(q&&q[W]){const he=q[W];he.showCollisionBoxes=R.showCollisionBoxes;const le=(re,de)=>{const Pe=he.reloadCallback;Pe&&(delete he.reloadCallback,he.parse(he.vectorTile,oe.layerIndex,this.availableImages,oe.actor,Pe)),F(re,de)};he.status==="parsing"?he.reloadCallback=le:he.status==="done"&&(he.vectorTile?he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,le):le())}}abortTile(R,F){const q=this.loading,W=R.uid;q&&q[W]&&q[W].abort&&(q[W].abort(),delete q[W]),F()}removeTile(R,F){const q=this.loaded,W=R.uid;q&&q[W]&&delete q[W],F()}}class pe{constructor(){this.loaded={}}loadTile(R,F){const{uid:q,encoding:W,rawImageData:oe}=R,he=c.isImageBitmap(oe)?this.getImageData(oe):oe,le=new c.DEMData(q,he,W);this.loaded=this.loaded||{},this.loaded[q]=le,F(null,le)}getImageData(R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const F=this.offscreenCanvasContext.getImageData(-1,-1,R.width+2,R.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new c.RGBAImage({width:F.width,height:F.height},F.data)}removeTile(R){const F=this.loaded,q=R.uid;F&&F[q]&&delete F[q]}}var fe=function X(R,F){var q,W=R&&R.type;if(W==="FeatureCollection")for(q=0;q<R.features.length;q++)X(R.features[q],F);else if(W==="GeometryCollection")for(q=0;q<R.geometries.length;q++)X(R.geometries[q],F);else if(W==="Feature")X(R.geometry,F);else if(W==="Polygon")ye(R.coordinates,F);else if(W==="MultiPolygon")for(q=0;q<R.coordinates.length;q++)ye(R.coordinates[q],F);return R};function ye(X,R){if(X.length!==0){Se(X[0],R);for(var F=1;F<X.length;F++)Se(X[F],!R)}}function Se(X,R){for(var F=0,q=0,W=0,oe=X.length,he=oe-1;W<oe;he=W++){var le=(X[W][0]-X[he][0])*(X[he][1]+X[W][1]),re=F+le;q+=Math.abs(F)>=Math.abs(le)?F-re+le:le-re+F,F=re}F+q>=0!=!!R&&X.reverse()}const Ue=c.vectorTile.VectorTileFeature.prototype.toGeoJSON;class $e{constructor(R){this._feature=R,this.extent=c.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(this._feature.type===1){const R=[];for(const F of this._feature.geometry)R.push([new c.pointGeometry(F[0],F[1])]);return R}{const R=[];for(const F of this._feature.geometry){const q=[];for(const W of F)q.push(new c.pointGeometry(W[0],W[1]));R.push(q)}return R}}toGeoJSON(R,F,q){return Ue.call(this,R,F,q)}}class Ye{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=R.length,this._features=R}feature(R){return new $e(this._features[R])}}var Qe={exports:{}},at=c.pointGeometry,wt=c.vectorTile.VectorTileFeature,Mt=Lt;function Lt(X,R){this.options=R||{},this.features=X,this.length=X.length}function ei(X,R){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=R||4096}Lt.prototype.feature=function(X){return new ei(this.features[X],this.options.extent)},ei.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var R=0;R<X.length;R++){for(var F=X[R],q=[],W=0;W<F.length;W++)q.push(new at(F[W][0],F[W][1]));this.geometry.push(q)}return this.geometry},ei.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,R=1/0,F=-1/0,q=1/0,W=-1/0,oe=0;oe<X.length;oe++)for(var he=X[oe],le=0;le<he.length;le++){var re=he[le];R=Math.min(R,re.x),F=Math.max(F,re.x),q=Math.min(q,re.y),W=Math.max(W,re.y)}return[R,q,F,W]},ei.prototype.toGeoJSON=wt.prototype.toGeoJSON;var gi=c.pbf,Ut=Mt;function mi(X){var R=new gi;return function(F,q){for(var W in F.layers)q.writeMessage(3,pt,F.layers[W])}(X,R),R.finish()}function pt(X,R){var F;R.writeVarintField(15,X.version||1),R.writeStringField(1,X.name||""),R.writeVarintField(5,X.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<X.length;F++)q.feature=X.feature(F),R.writeMessage(2,li,q);var W=q.keys;for(F=0;F<W.length;F++)R.writeStringField(3,W[F]);var oe=q.values;for(F=0;F<oe.length;F++)R.writeMessage(4,Ri,oe[F])}function li(X,R){var F=X.feature;F.id!==void 0&&R.writeVarintField(1,F.id),R.writeMessage(2,si,X),R.writeVarintField(3,F.type),R.writeMessage(4,cn,F)}function si(X,R){var F=X.feature,q=X.keys,W=X.values,oe=X.keycache,he=X.valuecache;for(var le in F.properties){var re=F.properties[le],de=oe[le];if(re!==null){de===void 0&&(q.push(le),oe[le]=de=q.length-1),R.writeVarint(de);var Pe=typeof re;Pe!=="string"&&Pe!=="boolean"&&Pe!=="number"&&(re=JSON.stringify(re));var Be=Pe+":"+re,Ie=he[Be];Ie===void 0&&(W.push(re),he[Be]=Ie=W.length-1),R.writeVarint(Ie)}}}function Bi(X,R){return(R<<3)+(7&X)}function ln(X){return X<<1^X>>31}function cn(X,R){for(var F=X.loadGeometry(),q=X.type,W=0,oe=0,he=F.length,le=0;le<he;le++){var re=F[le],de=1;q===1&&(de=re.length),R.writeVarint(Bi(1,de));for(var Pe=q===3?re.length-1:re.length,Be=0;Be<Pe;Be++){Be===1&&q!==1&&R.writeVarint(Bi(2,Pe-1));var Ie=re[Be].x-W,mt=re[Be].y-oe;R.writeVarint(ln(Ie)),R.writeVarint(ln(mt)),W+=Ie,oe+=mt}q===3&&R.writeVarint(Bi(7,1))}}function Ri(X,R){var F=typeof X;F==="string"?R.writeStringField(1,X):F==="boolean"?R.writeBooleanField(7,X):F==="number"&&(X%1!=0?R.writeDoubleField(3,X):X<0?R.writeSVarintField(6,X):R.writeVarintField(5,X))}function Hn(X,R,F,q,W,oe){if(W-q<=F)return;const he=q+W>>1;qn(X,R,he,q,W,oe%2),Hn(X,R,F,q,he-1,oe+1),Hn(X,R,F,he+1,W,oe+1)}function qn(X,R,F,q,W,oe){for(;W>q;){if(W-q>600){const de=W-q+1,Pe=F-q+1,Be=Math.log(de),Ie=.5*Math.exp(2*Be/3),mt=.5*Math.sqrt(Be*Ie*(de-Ie)/de)*(Pe-de/2<0?-1:1);qn(X,R,F,Math.max(q,Math.floor(F-Pe*Ie/de+mt)),Math.min(W,Math.floor(F+(de-Pe)*Ie/de+mt)),oe)}const he=R[2*F+oe];let le=q,re=W;for(Ne(X,R,q,F),R[2*W+oe]>he&&Ne(X,R,q,W);le<re;){for(Ne(X,R,le,re),le++,re--;R[2*le+oe]<he;)le++;for(;R[2*re+oe]>he;)re--}R[2*q+oe]===he?Ne(X,R,q,re):(re++,Ne(X,R,re,W)),re<=F&&(q=re+1),F<=re&&(W=re-1)}}function Ne(X,R,F,q){ht(X,F,q),ht(R,2*F,2*q),ht(R,2*F+1,2*q+1)}function ht(X,R,F){const q=X[R];X[R]=X[F],X[F]=q}function We(X,R,F,q){const W=X-F,oe=R-q;return W*W+oe*oe}Qe.exports=mi,Qe.exports.fromVectorTileJs=mi,Qe.exports.fromGeojsonVt=function(X,R){R=R||{};var F={};for(var q in X)F[q]=new Ut(X[q].features,R),F[q].name=q,F[q].version=R.version,F[q].extent=R.extent;return mi({layers:F})},Qe.exports.GeoJSONWrapper=Ut;const yt=X=>X[0],Et=X=>X[1];class Wt{constructor(R,F=yt,q=Et,W=64,oe=Float64Array){this.nodeSize=W,this.points=R;const he=R.length<65536?Uint16Array:Uint32Array,le=this.ids=new he(R.length),re=this.coords=new oe(2*R.length);for(let de=0;de<R.length;de++)le[de]=de,re[2*de]=F(R[de]),re[2*de+1]=q(R[de]);Hn(le,re,W,0,le.length-1,0)}range(R,F,q,W){return function(oe,he,le,re,de,Pe,Be){const Ie=[0,oe.length-1,0],mt=[];let vt,nt;for(;Ie.length;){const kt=Ie.pop(),St=Ie.pop(),Yt=Ie.pop();if(St-Yt<=Be){for(let ti=Yt;ti<=St;ti++)vt=he[2*ti],nt=he[2*ti+1],vt>=le&&vt<=de&&nt>=re&&nt<=Pe&&mt.push(oe[ti]);continue}const Ot=Math.floor((Yt+St)/2);vt=he[2*Ot],nt=he[2*Ot+1],vt>=le&&vt<=de&&nt>=re&&nt<=Pe&&mt.push(oe[Ot]);const Vt=(kt+1)%2;(kt===0?le<=vt:re<=nt)&&(Ie.push(Yt),Ie.push(Ot-1),Ie.push(Vt)),(kt===0?de>=vt:Pe>=nt)&&(Ie.push(Ot+1),Ie.push(St),Ie.push(Vt))}return mt}(this.ids,this.coords,R,F,q,W,this.nodeSize)}within(R,F,q){return function(W,oe,he,le,re,de){const Pe=[0,W.length-1,0],Be=[],Ie=re*re;for(;Pe.length;){const mt=Pe.pop(),vt=Pe.pop(),nt=Pe.pop();if(vt-nt<=de){for(let Vt=nt;Vt<=vt;Vt++)We(oe[2*Vt],oe[2*Vt+1],he,le)<=Ie&&Be.push(W[Vt]);continue}const kt=Math.floor((nt+vt)/2),St=oe[2*kt],Yt=oe[2*kt+1];We(St,Yt,he,le)<=Ie&&Be.push(W[kt]);const Ot=(mt+1)%2;(mt===0?he-re<=St:le-re<=Yt)&&(Pe.push(nt),Pe.push(kt-1),Pe.push(Ot)),(mt===0?he+re>=St:le+re>=Yt)&&(Pe.push(kt+1),Pe.push(vt),Pe.push(Ot))}return Be}(this.ids,this.coords,R,F,q,this.nodeSize)}}const Gt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},J=Math.fround||(ce=new Float32Array(1),X=>(ce[0]=+X,ce[0]));var ce;class Ce{constructor(R){this.options=Ct(Object.create(Gt),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:F,minZoom:q,maxZoom:W,nodeSize:oe}=this.options;F&&console.time("total time");const he=`prepare ${R.length} points`;F&&console.time(he),this.points=R;let le=[];for(let re=0;re<R.length;re++)R[re].geometry&&le.push(Fe(R[re],re));this.trees[W+1]=new Wt(le,Tt,Pt,oe,Float32Array),F&&console.timeEnd(he);for(let re=W;re>=q;re--){const de=+Date.now();le=this._cluster(le,re),this.trees[re]=new Wt(le,Tt,Pt,oe,Float32Array),F&&console.log("z%d: %d clusters in %dms",re,le.length,+Date.now()-de)}return F&&console.timeEnd("total time"),this}getClusters(R,F){let q=((R[0]+180)%360+360)%360-180;const W=Math.max(-90,Math.min(90,R[1]));let oe=R[2]===180?180:((R[2]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)q=-180,oe=180;else if(q>oe){const Pe=this.getClusters([q,W,180,he],F),Be=this.getClusters([-180,W,oe,he],F);return Pe.concat(Be)}const le=this.trees[this._limitZoom(F)],re=le.range(ze(q),Xe(he),ze(oe),Xe(W)),de=[];for(const Pe of re){const Be=le.points[Pe];de.push(Be.numPoints?Ze(Be):this.points[Be.index])}return de}getChildren(R){const F=this._getOriginId(R),q=this._getOriginZoom(R),W="No cluster with the specified id.",oe=this.trees[q];if(!oe)throw new Error(W);const he=oe.points[F];if(!he)throw new Error(W);const le=this.options.radius/(this.options.extent*Math.pow(2,q-1)),re=oe.within(he.x,he.y,le),de=[];for(const Pe of re){const Be=oe.points[Pe];Be.parentId===R&&de.push(Be.numPoints?Ze(Be):this.points[Be.index])}if(de.length===0)throw new Error(W);return de}getLeaves(R,F,q){const W=[];return this._appendLeaves(W,R,F=F||10,q=q||0,0),W}getTile(R,F,q){const W=this.trees[this._limitZoom(R)],oe=Math.pow(2,R),{extent:he,radius:le}=this.options,re=le/he,de=(q-re)/oe,Pe=(q+1+re)/oe,Be={features:[]};return this._addTileFeatures(W.range((F-re)/oe,de,(F+1+re)/oe,Pe),W.points,F,q,oe,Be),F===0&&this._addTileFeatures(W.range(1-re/oe,de,1,Pe),W.points,oe,q,oe,Be),F===oe-1&&this._addTileFeatures(W.range(0,de,re/oe,Pe),W.points,-1,q,oe,Be),Be.features.length?Be:null}getClusterExpansionZoom(R){let F=this._getOriginZoom(R)-1;for(;F<=this.options.maxZoom;){const q=this.getChildren(R);if(F++,q.length!==1)break;R=q[0].properties.cluster_id}return F}_appendLeaves(R,F,q,W,oe){const he=this.getChildren(F);for(const le of he){const re=le.properties;if(re&&re.cluster?oe+re.point_count<=W?oe+=re.point_count:oe=this._appendLeaves(R,re.cluster_id,q,W,oe):oe<W?oe++:R.push(le),R.length===q)break}return oe}_addTileFeatures(R,F,q,W,oe,he){for(const le of R){const re=F[le],de=re.numPoints;let Pe,Be,Ie;if(de)Pe=lt(re),Be=re.x,Ie=re.y;else{const nt=this.points[re.index];Pe=nt.properties,Be=ze(nt.geometry.coordinates[0]),Ie=Xe(nt.geometry.coordinates[1])}const mt={type:1,geometry:[[Math.round(this.options.extent*(Be*oe-q)),Math.round(this.options.extent*(Ie*oe-W))]],tags:Pe};let vt;de?vt=re.id:this.options.generateId?vt=re.index:this.points[re.index].id&&(vt=this.points[re.index].id),vt!==void 0&&(mt.id=vt),he.features.push(mt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,F){const q=[],{radius:W,extent:oe,reduce:he,minPoints:le}=this.options,re=W/(oe*Math.pow(2,F));for(let de=0;de<R.length;de++){const Pe=R[de];if(Pe.zoom<=F)continue;Pe.zoom=F;const Be=this.trees[F+1],Ie=Be.within(Pe.x,Pe.y,re),mt=Pe.numPoints||1;let vt=mt;for(const nt of Ie){const kt=Be.points[nt];kt.zoom>F&&(vt+=kt.numPoints||1)}if(vt>mt&&vt>=le){let nt=Pe.x*mt,kt=Pe.y*mt,St=he&&mt>1?this._map(Pe,!0):null;const Yt=(de<<5)+(F+1)+this.points.length;for(const Ot of Ie){const Vt=Be.points[Ot];if(Vt.zoom<=F)continue;Vt.zoom=F;const ti=Vt.numPoints||1;nt+=Vt.x*ti,kt+=Vt.y*ti,Vt.parentId=Yt,he&&(St||(St=this._map(Pe,!0)),he(St,this._map(Vt)))}Pe.parentId=Yt,q.push(Re(nt/vt,kt/vt,Yt,vt,St))}else if(q.push(Pe),vt>1)for(const nt of Ie){const kt=Be.points[nt];kt.zoom<=F||(kt.zoom=F,q.push(kt))}}return q}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,F){if(R.numPoints)return F?Ct({},R.properties):R.properties;const q=this.points[R.index].properties,W=this.options.map(q);return F&&W===q?Ct({},W):W}}function Re(X,R,F,q,W){return{x:J(X),y:J(R),zoom:1/0,id:F,parentId:-1,numPoints:q,properties:W}}function Fe(X,R){const[F,q]=X.geometry.coordinates;return{x:J(ze(F)),y:J(Xe(q)),zoom:1/0,index:R,parentId:-1}}function Ze(X){return{type:"Feature",id:X.id,properties:lt(X),geometry:{type:"Point",coordinates:[(R=X.x,360*(R-.5)),Ve(X.y)]}};var R}function lt(X){const R=X.numPoints,F=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return Ct(Ct({},X.properties),{cluster:!0,cluster_id:X.id,point_count:R,point_count_abbreviated:F})}function ze(X){return X/360+.5}function Xe(X){const R=Math.sin(X*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function Ve(X){const R=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function Ct(X,R){for(const F in R)X[F]=R[F];return X}function Tt(X){return X.x}function Pt(X){return X.y}function Bt(X,R,F,q){for(var W,oe=q,he=F-R>>1,le=F-R,re=X[R],de=X[R+1],Pe=X[F],Be=X[F+1],Ie=R+3;Ie<F;Ie+=3){var mt=Zt(X[Ie],X[Ie+1],re,de,Pe,Be);if(mt>oe)W=Ie,oe=mt;else if(mt===oe){var vt=Math.abs(Ie-he);vt<le&&(W=Ie,le=vt)}}oe>q&&(W-R>3&&Bt(X,R,W,q),X[W+2]=oe,F-W>3&&Bt(X,W,F,q))}function Zt(X,R,F,q,W,oe){var he=W-F,le=oe-q;if(he!==0||le!==0){var re=((X-F)*he+(R-q)*le)/(he*he+le*le);re>1?(F=W,q=oe):re>0&&(F+=he*re,q+=le*re)}return(he=X-F)*he+(le=R-q)*le}function ci(X,R,F,q){var W={id:X===void 0?null:X,type:R,geometry:F,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(oe){var he=oe.geometry,le=oe.type;if(le==="Point"||le==="MultiPoint"||le==="LineString")be(oe,he);else if(le==="Polygon"||le==="MultiLineString")for(var re=0;re<he.length;re++)be(oe,he[re]);else if(le==="MultiPolygon")for(re=0;re<he.length;re++)for(var de=0;de<he[re].length;de++)be(oe,he[re][de])}(W),W}function be(X,R){for(var F=0;F<R.length;F+=3)X.minX=Math.min(X.minX,R[F]),X.minY=Math.min(X.minY,R[F+1]),X.maxX=Math.max(X.maxX,R[F]),X.maxY=Math.max(X.maxY,R[F+1])}function je(X,R,F,q){if(R.geometry){var W=R.geometry.coordinates,oe=R.geometry.type,he=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),le=[],re=R.id;if(F.promoteId?re=R.properties[F.promoteId]:F.generateId&&(re=q||0),oe==="Point")en(W,le);else if(oe==="MultiPoint")for(var de=0;de<W.length;de++)en(W[de],le);else if(oe==="LineString")Ki(W,le,he,!1);else if(oe==="MultiLineString"){if(F.lineMetrics){for(de=0;de<W.length;de++)Ki(W[de],le=[],he,!1),X.push(ci(re,"LineString",le,R.properties));return}Xt(W,le,he,!1)}else if(oe==="Polygon")Xt(W,le,he,!0);else{if(oe!=="MultiPolygon"){if(oe==="GeometryCollection"){for(de=0;de<R.geometry.geometries.length;de++)je(X,{id:re,geometry:R.geometry.geometries[de],properties:R.properties},F,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(de=0;de<W.length;de++){var Pe=[];Xt(W[de],Pe,he,!0),le.push(Pe)}}X.push(ci(re,oe,le,R.properties))}}function en(X,R){R.push(fn(X[0])),R.push(An(X[1])),R.push(0)}function Ki(X,R,F,q){for(var W,oe,he=0,le=0;le<X.length;le++){var re=fn(X[le][0]),de=An(X[le][1]);R.push(re),R.push(de),R.push(0),le>0&&(he+=q?(W*de-re*oe)/2:Math.sqrt(Math.pow(re-W,2)+Math.pow(de-oe,2))),W=re,oe=de}var Pe=R.length-3;R[2]=1,Bt(R,0,Pe,F),R[Pe+2]=1,R.size=Math.abs(he),R.start=0,R.end=R.size}function Xt(X,R,F,q){for(var W=0;W<X.length;W++){var oe=[];Ki(X[W],oe,F,q),R.push(oe)}}function fn(X){return X/360+.5}function An(X){var R=Math.sin(X*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function Pi(X,R,F,q,W,oe,he,le){if(q/=R,oe>=(F/=R)&&he<q)return X;if(he<F||oe>=q)return null;for(var re=[],de=0;de<X.length;de++){var Pe=X[de],Be=Pe.geometry,Ie=Pe.type,mt=W===0?Pe.minX:Pe.minY,vt=W===0?Pe.maxX:Pe.maxY;if(mt>=F&&vt<q)re.push(Pe);else if(!(vt<F||mt>=q)){var nt=[];if(Ie==="Point"||Ie==="MultiPoint")un(Be,nt,F,q,W);else if(Ie==="LineString")Ke(Be,nt,F,q,W,!1,le.lineMetrics);else if(Ie==="MultiLineString")$t(Be,nt,F,q,W,!1);else if(Ie==="Polygon")$t(Be,nt,F,q,W,!0);else if(Ie==="MultiPolygon")for(var kt=0;kt<Be.length;kt++){var St=[];$t(Be[kt],St,F,q,W,!0),St.length&&nt.push(St)}if(nt.length){if(le.lineMetrics&&Ie==="LineString"){for(kt=0;kt<nt.length;kt++)re.push(ci(Pe.id,Ie,nt[kt],Pe.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(nt.length===1?(Ie="LineString",nt=nt[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=nt.length===3?"Point":"MultiPoint"),re.push(ci(Pe.id,Ie,nt,Pe.tags))}}}return re.length?re:null}function un(X,R,F,q,W){for(var oe=0;oe<X.length;oe+=3){var he=X[oe+W];he>=F&&he<=q&&(R.push(X[oe]),R.push(X[oe+1]),R.push(X[oe+2]))}}function Ke(X,R,F,q,W,oe,he){for(var le,re,de=Ht(X),Pe=W===0?Ir:jt,Be=X.start,Ie=0;Ie<X.length-3;Ie+=3){var mt=X[Ie],vt=X[Ie+1],nt=X[Ie+2],kt=X[Ie+3],St=X[Ie+4],Yt=W===0?mt:vt,Ot=W===0?kt:St,Vt=!1;he&&(le=Math.sqrt(Math.pow(mt-kt,2)+Math.pow(vt-St,2))),Yt<F?Ot>F&&(re=Pe(de,mt,vt,kt,St,F),he&&(de.start=Be+le*re)):Yt>q?Ot<q&&(re=Pe(de,mt,vt,kt,St,q),he&&(de.start=Be+le*re)):xn(de,mt,vt,nt),Ot<F&&Yt>=F&&(re=Pe(de,mt,vt,kt,St,F),Vt=!0),Ot>q&&Yt<=q&&(re=Pe(de,mt,vt,kt,St,q),Vt=!0),!oe&&Vt&&(he&&(de.end=Be+le*re),R.push(de),de=Ht(X)),he&&(Be+=le)}var ti=X.length-3;mt=X[ti],vt=X[ti+1],nt=X[ti+2],(Yt=W===0?mt:vt)>=F&&Yt<=q&&xn(de,mt,vt,nt),ti=de.length-3,oe&&ti>=3&&(de[ti]!==de[0]||de[ti+1]!==de[1])&&xn(de,de[0],de[1],de[2]),de.length&&R.push(de)}function Ht(X){var R=[];return R.size=X.size,R.start=X.start,R.end=X.end,R}function $t(X,R,F,q,W,oe){for(var he=0;he<X.length;he++)Ke(X[he],R,F,q,W,oe,!1)}function xn(X,R,F,q){X.push(R),X.push(F),X.push(q)}function Ir(X,R,F,q,W,oe){var he=(oe-R)/(q-R);return X.push(oe),X.push(F+(W-F)*he),X.push(1),he}function jt(X,R,F,q,W,oe){var he=(oe-F)/(W-F);return X.push(R+(q-R)*he),X.push(oe),X.push(1),he}function or(X,R){for(var F=[],q=0;q<X.length;q++){var W,oe=X[q],he=oe.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")W=pn(oe.geometry,R);else if(he==="MultiLineString"||he==="Polygon"){W=[];for(var le=0;le<oe.geometry.length;le++)W.push(pn(oe.geometry[le],R))}else if(he==="MultiPolygon")for(W=[],le=0;le<oe.geometry.length;le++){for(var re=[],de=0;de<oe.geometry[le].length;de++)re.push(pn(oe.geometry[le][de],R));W.push(re)}F.push(ci(oe.id,he,W,oe.tags))}return F}function pn(X,R){var F=[];F.size=X.size,X.start!==void 0&&(F.start=X.start,F.end=X.end);for(var q=0;q<X.length;q+=3)F.push(X[q]+R,X[q+1],X[q+2]);return F}function ys(X,R){if(X.transformed)return X;var F,q,W,oe=1<<X.z,he=X.x,le=X.y;for(F=0;F<X.features.length;F++){var re=X.features[F],de=re.geometry,Pe=re.type;if(re.geometry=[],Pe===1)for(q=0;q<de.length;q+=2)re.geometry.push(tn(de[q],de[q+1],R,oe,he,le));else for(q=0;q<de.length;q++){var Be=[];for(W=0;W<de[q].length;W+=2)Be.push(tn(de[q][W],de[q][W+1],R,oe,he,le));re.geometry.push(Be)}}return X.transformed=!0,X}function tn(X,R,F,q,W,oe){return[Math.round(F*(X*q-W)),Math.round(F*(R*q-oe))]}function Sn(X,R,F,q,W){for(var oe=R===W.maxZoom?0:W.tolerance/((1<<R)*W.extent),he={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:q,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},le=0;le<X.length;le++){he.numFeatures++,wi(he,X[le],oe,W);var re=X[le].minX,de=X[le].minY,Pe=X[le].maxX,Be=X[le].maxY;re<he.minX&&(he.minX=re),de<he.minY&&(he.minY=de),Pe>he.maxX&&(he.maxX=Pe),Be>he.maxY&&(he.maxY=Be)}return he}function wi(X,R,F,q){var W=R.geometry,oe=R.type,he=[];if(oe==="Point"||oe==="MultiPoint")for(var le=0;le<W.length;le+=3)he.push(W[le]),he.push(W[le+1]),X.numPoints++,X.numSimplified++;else if(oe==="LineString")vs(he,W,X,F,!1,!1);else if(oe==="MultiLineString"||oe==="Polygon")for(le=0;le<W.length;le++)vs(he,W[le],X,F,oe==="Polygon",le===0);else if(oe==="MultiPolygon")for(var re=0;re<W.length;re++){var de=W[re];for(le=0;le<de.length;le++)vs(he,de[le],X,F,!0,le===0)}if(he.length){var Pe=R.tags||null;if(oe==="LineString"&&q.lineMetrics){for(var Be in Pe={},R.tags)Pe[Be]=R.tags[Be];Pe.mapbox_clip_start=W.start/W.size,Pe.mapbox_clip_end=W.end/W.size}var Ie={geometry:he,type:oe==="Polygon"||oe==="MultiPolygon"?3:oe==="LineString"||oe==="MultiLineString"?2:1,tags:Pe};R.id!==null&&(Ie.id=R.id),X.features.push(Ie)}}function vs(X,R,F,q,W,oe){var he=q*q;if(q>0&&R.size<(W?he:q))F.numPoints+=R.length/3;else{for(var le=[],re=0;re<R.length;re+=3)(q===0||R[re+2]>he)&&(F.numSimplified++,le.push(R[re]),le.push(R[re+1])),F.numPoints++;W&&function(de,Pe){for(var Be=0,Ie=0,mt=de.length,vt=mt-2;Ie<mt;vt=Ie,Ie+=2)Be+=(de[Ie]-de[vt])*(de[Ie+1]+de[vt+1]);if(Be>0===Pe)for(Ie=0,mt=de.length;Ie<mt/2;Ie+=2){var nt=de[Ie],kt=de[Ie+1];de[Ie]=de[mt-2-Ie],de[Ie+1]=de[mt-1-Ie],de[mt-2-Ie]=nt,de[mt-1-Ie]=kt}}(le,oe),X.push(le)}}function xr(X,R){var F=(R=this.options=function(W,oe){for(var he in oe)W[he]=oe[he];return W}(Object.create(this.options),R)).debug;if(F&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var q=function(W,oe){var he=[];if(W.type==="FeatureCollection")for(var le=0;le<W.features.length;le++)je(he,W.features[le],oe,le);else je(he,W.type==="Feature"?W:{geometry:W},oe);return he}(X,R);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function(W,oe){var he=oe.buffer/oe.extent,le=W,re=Pi(W,1,-1-he,he,0,-1,2,oe),de=Pi(W,1,1-he,2+he,0,-1,2,oe);return(re||de)&&(le=Pi(W,1,-he,1+he,0,-1,2,oe)||[],re&&(le=or(re,1).concat(le)),de&&(le=le.concat(or(de,-1)))),le}(q,R),q.length&&this.splitTile(q,0,0,0),F&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function br(X,R,F){return 32*((1<<X)*F+R)+X}function ts(X,R){const F=X.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const q=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!q)return R(null,null);const W=new Ye(q.features);let oe=Qe.exports(W);oe.byteOffset===0&&oe.byteLength===oe.buffer.byteLength||(oe=new Uint8Array(oe)),R(null,{vectorTile:W,rawData:oe.buffer})}xr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},xr.prototype.splitTile=function(X,R,F,q,W,oe,he){for(var le=[X,R,F,q],re=this.options,de=re.debug;le.length;){q=le.pop(),F=le.pop(),R=le.pop(),X=le.pop();var Pe=1<<R,Be=br(R,F,q),Ie=this.tiles[Be];if(!Ie&&(de>1&&console.time("creation"),Ie=this.tiles[Be]=Sn(X,R,F,q,re),this.tileCoords.push({z:R,x:F,y:q}),de)){de>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,F,q,Ie.numFeatures,Ie.numPoints,Ie.numSimplified),console.timeEnd("creation"));var mt="z"+R;this.stats[mt]=(this.stats[mt]||0)+1,this.total++}if(Ie.source=X,W){if(R===re.maxZoom||R===W)continue;var vt=1<<W-R;if(F!==Math.floor(oe/vt)||q!==Math.floor(he/vt))continue}else if(R===re.indexMaxZoom||Ie.numPoints<=re.indexMaxPoints)continue;if(Ie.source=null,X.length!==0){de>1&&console.time("clipping");var nt,kt,St,Yt,Ot,Vt,ti=.5*re.buffer/re.extent,oi=.5-ti,Ci=.5+ti,Li=1+ti;nt=kt=St=Yt=null,Ot=Pi(X,Pe,F-ti,F+Ci,0,Ie.minX,Ie.maxX,re),Vt=Pi(X,Pe,F+oi,F+Li,0,Ie.minX,Ie.maxX,re),X=null,Ot&&(nt=Pi(Ot,Pe,q-ti,q+Ci,1,Ie.minY,Ie.maxY,re),kt=Pi(Ot,Pe,q+oi,q+Li,1,Ie.minY,Ie.maxY,re),Ot=null),Vt&&(St=Pi(Vt,Pe,q-ti,q+Ci,1,Ie.minY,Ie.maxY,re),Yt=Pi(Vt,Pe,q+oi,q+Li,1,Ie.minY,Ie.maxY,re),Vt=null),de>1&&console.timeEnd("clipping"),le.push(nt||[],R+1,2*F,2*q),le.push(kt||[],R+1,2*F,2*q+1),le.push(St||[],R+1,2*F+1,2*q),le.push(Yt||[],R+1,2*F+1,2*q+1)}}},xr.prototype.getTile=function(X,R,F){var q=this.options,W=q.extent,oe=q.debug;if(X<0||X>24)return null;var he=1<<X,le=br(X,R=(R%he+he)%he,F);if(this.tiles[le])return ys(this.tiles[le],W);oe>1&&console.log("drilling down to z%d-%d-%d",X,R,F);for(var re,de=X,Pe=R,Be=F;!re&&de>0;)de--,Pe=Math.floor(Pe/2),Be=Math.floor(Be/2),re=this.tiles[br(de,Pe,Be)];return re&&re.source?(oe>1&&console.log("found parent tile z%d-%d-%d",de,Pe,Be),oe>1&&console.time("drilling down"),this.splitTile(re.source,de,Pe,Be,X,R,F),oe>1&&console.timeEnd("drilling down"),this.tiles[le]?ys(this.tiles[le],W):null):null};class xs extends se{constructor(R,F,q,W){super(R,F,q,ts),W&&(this.loadGeoJSON=W)}loadData(R,F){var q;(q=this._pendingRequest)===null||q===void 0||q.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const W=!!(R&&R.request&&R.request.collectResourceTiming)&&new c.RequestPerformance(R.request);this._pendingCallback=F,this._pendingRequest=this.loadGeoJSON(R,(oe,he)=>{if(delete this._pendingCallback,delete this._pendingRequest,oe||!he)return F(oe);if(typeof he!="object")return F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{fe(he,!0);try{if(R.filter){const re=c.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(re.result==="error")throw new Error(re.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));he={type:"FeatureCollection",features:he.features.filter(Pe=>re.value.evaluate({zoom:0},Pe))}}this._geoJSONIndex=R.cluster?new Ce(function({superclusterOptions:re,clusterProperties:de}){if(!de||!re)return re;const Pe={},Be={},Ie={accumulated:null,zoom:0},mt={properties:null},vt=Object.keys(de);for(const nt of vt){const[kt,St]=de[nt],Yt=c.createExpression(St),Ot=c.createExpression(typeof kt=="string"?[kt,["accumulated"],["get",nt]]:kt);Pe[nt]=Yt.value,Be[nt]=Ot.value}return re.map=nt=>{mt.properties=nt;const kt={};for(const St of vt)kt[St]=Pe[St].evaluate(Ie,mt);return kt},re.reduce=(nt,kt)=>{mt.properties=kt;for(const St of vt)Ie.accumulated=nt[St],nt[St]=Be[St].evaluate(Ie,mt)},re}(R)).load(he.features):function(re,de){return new xr(re,de)}(he,R.geojsonVtOptions)}catch(re){return F(re)}this.loaded={};const le={};if(W){const re=W.finish();re&&(le.resourceTiming={},le.resourceTiming[R.source]=JSON.parse(JSON.stringify(re)))}F(null,le)}})}reloadTile(R,F){const q=this.loaded;return q&&q[R.uid]?super.reloadTile(R,F):this.loadTile(R,F)}loadGeoJSON(R,F){if(R.request)return c.getJSON(R.request,F);if(typeof R.data=="string")try{F(null,JSON.parse(R.data))}catch{F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}else F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(R,F){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),F()}getClusterExpansionZoom(R,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(q){F(q)}}getClusterChildren(R,F){try{F(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(q){F(q)}}getClusterLeaves(R,F){try{F(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(q){F(q)}}}class Hr{constructor(R){this.self=R,this.actor=new c.Actor(R,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:se,geojson:xs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,q)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=q},this.self.registerRTLTextPlugin=F=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=F.applyArabicShaping,c.plugin.processBidirectionalText=F.processBidirectionalText,c.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}setReferrer(R,F){this.referrer=F}setImages(R,F,q){this.availableImages[R]=F;for(const W in this.workerSources[R]){const oe=this.workerSources[R][W];for(const he in oe)oe[he].availableImages=F}q()}setLayers(R,F,q){this.getLayerIndex(R).replace(F),q()}updateLayers(R,F,q){this.getLayerIndex(R).update(F.layers,F.removedIds),q()}loadTile(R,F,q){this.getWorkerSource(R,F.type,F.source).loadTile(F,q)}loadDEMTile(R,F,q){this.getDEMWorkerSource(R,F.source).loadTile(F,q)}reloadTile(R,F,q){this.getWorkerSource(R,F.type,F.source).reloadTile(F,q)}abortTile(R,F,q){this.getWorkerSource(R,F.type,F.source).abortTile(F,q)}removeTile(R,F,q){this.getWorkerSource(R,F.type,F.source).removeTile(F,q)}removeDEMTile(R,F){this.getDEMWorkerSource(R,F.source).removeTile(F)}removeSource(R,F,q){if(!this.workerSources[R]||!this.workerSources[R][F.type]||!this.workerSources[R][F.type][F.source])return;const W=this.workerSources[R][F.type][F.source];delete this.workerSources[R][F.type][F.source],W.removeSource!==void 0?W.removeSource(F,q):q()}loadWorkerSource(R,F,q){try{this.self.importScripts(F.url),q()}catch(W){q(W.toString())}}syncRTLPluginState(R,F,q){try{c.plugin.setState(F);const W=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&W!=null){this.self.importScripts(W);const oe=c.plugin.isParsed();q(oe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${W}`),oe)}}catch(W){q(W.toString())}}getAvailableImages(R){let F=this.availableImages[R];return F||(F=[]),F}getLayerIndex(R){let F=this.layerIndexes[R];return F||(F=this.layerIndexes[R]=new P),F}getWorkerSource(R,F,q){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][F]||(this.workerSources[R][F]={}),!this.workerSources[R][F][q]){const W={send:(oe,he,le)=>{this.actor.send(oe,he,le,R)}};this.workerSources[R][F][q]=new this.workerSourceTypes[F](W,this.getLayerIndex(R),this.getAvailableImages(R))}return this.workerSources[R][F][q]}getDEMWorkerSource(R,F){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][F]||(this.demWorkerSources[R][F]=new pe),this.demWorkerSources[R][F]}enforceCacheSizeLimit(R,F){c.enforceCacheSizeLimit(F)}}return c.isWorker()&&(self.worker=new Hr(self)),Hr}),h(["./shared"],function(c){var b=T;function T(m){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,_,v=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(v);try{_=new Worker(w),f=!0}catch{f=!1}return _&&_.terminate(),URL.revokeObjectURL(w),f}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var f=document.createElement("canvas");f.width=f.height=1;var _=f.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===f.width}()?(P[u=r&&r.failIfMajorPerformanceCaveat]===void 0&&(P[u]=function(f){var _,v=function(w){var S=document.createElement("canvas"),I=Object.create(T.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=w,S.getContext("webgl",I)||S.getContext("experimental-webgl",I)}(f);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(u)),P[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var u}(m)}var P={};function k(m,r){if(Array.isArray(m)){if(!Array.isArray(r)||m.length!==r.length)return!1;for(let u=0;u<m.length;u++)if(!k(m[u],r[u]))return!1;return!0}if(typeof m=="object"&&m!==null&&r!==null){if(typeof r!="object"||Object.keys(m).length!==Object.keys(r).length)return!1;for(const u in m)if(!k(m[u],r[u]))return!1;return!0}return m===r}T.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class C{static testProp(r){if(!C.docStyle)return r[0];for(let u=0;u<r.length;u++)if(r[u]in C.docStyle)return r[u];return r[0]}static create(r,u,f){const _=window.document.createElement(r);return u!==void 0&&(_.className=u),f&&f.appendChild(_),_}static createNS(r,u){return window.document.createElementNS(r,u)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(r,u){r.style[C.transformProp]=u}static addEventListener(r,u,f,_={}){r.addEventListener(u,f,"passive"in _?_:_.capture)}static removeEventListener(r,u,f,_={}){r.removeEventListener(u,f,"passive"in _?_:_.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static mousePos(r,u){const f=r.getBoundingClientRect();return new c.pointGeometry(u.clientX-f.left-r.clientLeft,u.clientY-f.top-r.clientTop)}static touchPos(r,u){const f=r.getBoundingClientRect(),_=[];for(let v=0;v<u.length;v++)_.push(new c.pointGeometry(u[v].clientX-f.left-r.clientLeft,u[v].clientY-f.top-r.clientTop));return _}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);class H{constructor(r){this._transformRequestFn=r}transformRequest(r,u){return this._transformRequestFn&&this._transformRequestFn(r,u)||{url:r}}normalizeSpriteURL(r,u,f){const _=function(v){const w=v.match(ee);if(!w)throw new Error(`Unable to parse URL "${v}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(r);return _.path+=`${u}${f}`,function(v){const w=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${w}`}(_)}setTransformRequest(r){this._transformRequestFn=r}}const ee=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class se{constructor(r,u,f,_){this.context=r,this.format=f,this.texture=r.gl.createTexture(),this.update(u,_)}update(r,u,f){const{width:_,height:v}=r,w=!(this.size&&this.size[0]===_&&this.size[1]===v||f),{context:S}=this,{gl:I}=S;if(this.useMipmap=Boolean(u&&u.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!u||u.premultiply!==!1)),w)this.size=[_,v],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||c.isImageBitmap(r)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,r):I.texImage2D(I.TEXTURE_2D,0,this.format,_,v,0,this.format,I.UNSIGNED_BYTE,r.data);else{const{x:L,y:z}=f||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||c.isImageBitmap(r)?I.texSubImage2D(I.TEXTURE_2D,0,L,z,I.RGBA,I.UNSIGNED_BYTE,r):I.texSubImage2D(I.TEXTURE_2D,0,L,z,_,v,I.RGBA,I.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(r,u,f){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),f!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=v.LINEAR),r!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,r),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,f||r),this.filter=r),u!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,u),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function pe(m){const{userImage:r}=m;return!!(r&&r.render&&r.render())&&(m.data.replace(new Uint8Array(r.data.buffer)),!0)}class fe extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:u,callback:f}of this.requestors)this._notify(u,f);this.requestors=[]}}getImage(r){return this.images[r]}addImage(r,u){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,u)&&(this.images[r]=u)}_validate(r,u){let f=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),f=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),f=!1),this._validateContent(u.content,u)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),f=!1),f}_validateStretch(r,u){if(!r)return!0;let f=0;for(const _ of r){if(_[0]<f||_[1]<_[0]||u<_[1])return!1;f=_[1]}return!0}_validateContent(r,u){return!(r&&(r.length!==4||r[0]<0||u.data.width<r[0]||r[1]<0||u.data.height<r[1]||r[2]<0||u.data.width<r[2]||r[3]<0||u.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,u){const f=this.images[r];if(f.data.width!==u.data.width||f.data.height!==u.data.height)throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=f.version+1,this.images[r]=u,this.updatedImages[r]=!0}removeImage(r){const u=this.images[r];delete this.images[r],delete this.patterns[r],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,u){let f=!0;if(!this.isLoaded())for(const _ of r)this.images[_]||(f=!1);this.isLoaded()||f?this._notify(r,u):this.requestors.push({ids:r,callback:u})}_notify(r,u){const f={};for(const _ of r){this.images[_]||this.fire(new c.Event("styleimagemissing",{id:_}));const v=this.images[_];v?f[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:c.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,f)}getPixelSize(){const{width:r,height:u}=this.atlasImage;return{width:r,height:u}}getPattern(r){const u=this.patterns[r],f=this.getImage(r);if(!f)return null;if(u&&u.position.version===f.version)return u.position;if(u)u.position.version=f.version;else{const _={w:f.data.width+2,h:f.data.height+2,x:0,y:0},v=new c.ImagePosition(_,f);this.patterns[r]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const u=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new se(r,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const v in this.patterns)r.push(this.patterns[v].bin);const{w:u,h:f}=c.potpack(r),_=this.atlasImage;_.resize({width:u||1,height:f||1});for(const v in this.patterns){const{bin:w}=this.patterns[v],S=w.x+1,I=w.y+1,L=this.images[v].data,z=L.width,B=L.height;c.RGBAImage.copy(L,_,{x:0,y:0},{x:S,y:I},{width:z,height:B}),c.RGBAImage.copy(L,_,{x:0,y:B-1},{x:S,y:I-1},{width:z,height:1}),c.RGBAImage.copy(L,_,{x:0,y:0},{x:S,y:I+B},{width:z,height:1}),c.RGBAImage.copy(L,_,{x:z-1,y:0},{x:S-1,y:I},{width:1,height:B}),c.RGBAImage.copy(L,_,{x:0,y:0},{x:S+z,y:I},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const u of r){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const f=this.images[u];f||c.warnOnce(`Image with ID: "${u}" was not found`),pe(f)&&this.updateImage(u,f)}}}const ye=1e20;function Se(m,r,u,f,_,v,w,S,I){for(let L=r;L<r+f;L++)Ue(m,u*v+L,v,_,w,S,I);for(let L=u;L<u+_;L++)Ue(m,L*v+r,1,f,w,S,I)}function Ue(m,r,u,f,_,v,w){v[0]=0,w[0]=-ye,w[1]=ye,_[0]=m[r];for(let S=1,I=0,L=0;S<f;S++){_[S]=m[r+S*u];const z=S*S;do{const B=v[I];L=(_[S]-_[B]+z-B*B)/(S-B)/2}while(L<=w[I]&&--I>-1);I++,v[I]=S,w[I]=L,w[I+1]=ye}for(let S=0,I=0;S<f;S++){for(;w[I+1]<S;)I++;const L=v[I],z=S-L;m[r+S*u]=_[L]+z*z}}class $e{constructor(r,u){this.requestManager=r,this.localIdeographFontFamily=u,this.entries={}}setURL(r){this.url=r}getGlyphs(r,u){const f=[];for(const _ in r)for(const v of r[_])f.push({stack:_,id:v});c.asyncAll(f,({stack:_,id:v},w)=>{let S=this.entries[_];S||(S=this.entries[_]={glyphs:{},requests:{},ranges:{}});let I=S.glyphs[v];if(I!==void 0)return void w(null,{stack:_,id:v,glyph:I});if(I=this._tinySDF(S,_,v),I)return S.glyphs[v]=I,void w(null,{stack:_,id:v,glyph:I});const L=Math.floor(v/256);if(256*L>65535)return void w(new Error("glyphs > 65535 not supported"));if(S.ranges[L])return void w(null,{stack:_,id:v,glyph:I});let z=S.requests[L];z||(z=S.requests[L]=[],$e.loadGlyphRange(_,L,this.url,this.requestManager,(B,V)=>{if(V){for(const Q in V)this._doesCharSupportLocalGlyph(+Q)||(S.glyphs[+Q]=V[+Q]);S.ranges[L]=!0}for(const Q of z)Q(B,V);delete S.requests[L]})),z.push((B,V)=>{B?w(B):V&&w(null,{stack:_,id:v,glyph:V[v]||null})})},(_,v)=>{if(_)u(_);else if(v){const w={};for(const{stack:S,id:I,glyph:L}of v)(w[S]||(w[S]={}))[I]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics};u(null,w)}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(c.unicodeBlockLookup["CJK Unified Ideographs"](r)||c.unicodeBlockLookup["Hangul Syllables"](r)||c.unicodeBlockLookup.Hiragana(r)||c.unicodeBlockLookup.Katakana(r))}_tinySDF(r,u,f){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(f))return;let v=r.tinySDF;if(!v){let S="400";/bold/i.test(u)?S="900":/medium/i.test(u)?S="500":/light/i.test(u)&&(S="200"),v=r.tinySDF=new $e.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:S})}const w=v.draw(String.fromCharCode(f));return{id:f,bitmap:new c.AlphaImage({width:w.width||30,height:w.height||30},w.data),metrics:{width:w.glyphWidth||24,height:w.glyphHeight||24,left:w.glyphLeft||0,top:w.glyphTop-27||-8,advance:w.glyphAdvance||24}}}}$e.loadGlyphRange=function(m,r,u,f,_){const v=256*r,w=v+255,S=f.transformRequest(u.replace("{fontstack}",m).replace("{range}",`${v}-${w}`),c.ResourceType.Glyphs);c.getArrayBuffer(S,(I,L)=>{if(I)_(I);else if(L){const z={};for(const B of c.parseGlyphPbf(L))z[B.id]=B;_(null,z)}})},$e.TinySDF=class{constructor({fontSize:m=24,buffer:r=3,radius:u=8,cutoff:f=.25,fontFamily:_="sans-serif",fontWeight:v="normal",fontStyle:w="normal"}={}){this.buffer=r,this.cutoff=f,this.radius=u;const S=this.size=m+4*r,I=this._createCanvas(S),L=this.ctx=I.getContext("2d",{willReadFrequently:!0});L.font=`${w} ${v} ${m}px ${_}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const r=document.createElement("canvas");return r.width=r.height=m,r}draw(m){const{width:r,actualBoundingBoxAscent:u,actualBoundingBoxDescent:f,actualBoundingBoxLeft:_,actualBoundingBoxRight:v}=this.ctx.measureText(m),w=Math.ceil(u),S=Math.min(this.size-this.buffer,Math.ceil(v-_)),I=Math.min(this.size-this.buffer,w+Math.ceil(f)),L=S+2*this.buffer,z=I+2*this.buffer,B=Math.max(L*z,0),V=new Uint8ClampedArray(B),Q={data:V,width:L,height:z,glyphWidth:S,glyphHeight:I,glyphTop:w,glyphLeft:0,glyphAdvance:r};if(S===0||I===0)return Q;const{ctx:Y,buffer:K,gridInner:ue,gridOuter:me}=this;Y.clearRect(K,K,S,I),Y.fillText(m,K,K+w);const ve=Y.getImageData(K,K,S,I);me.fill(ye,0,B),ue.fill(0,0,B);for(let te=0;te<I;te++)for(let Ee=0;Ee<S;Ee++){const xe=ve.data[4*(te*S+Ee)+3]/255;if(xe===0)continue;const Le=(te+K)*L+Ee+K;if(xe===1)me[Le]=0,ue[Le]=ye;else{const ke=.5-xe;me[Le]=ke>0?ke*ke:0,ue[Le]=ke<0?ke*ke:0}}Se(me,0,0,L,z,L,this.f,this.v,this.z),Se(ue,K,K,S,I,L,this.f,this.v,this.z);for(let te=0;te<B;te++){const Ee=Math.sqrt(me[te])-Math.sqrt(ue[te]);V[te]=Math.round(255-255*(Ee/this.radius+this.cutoff))}return Q}};const Ye=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(m,r){return c.sphericalToCartesian(m.expression.evaluate(r))}interpolate(m,r,u){return{x:c.number(m.x,r.x,u),y:c.number(m.y,r.y,u),z:c.number(m.z,r.z,u)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)}),Qe="-transition";class at extends c.Evented{constructor(r){super(),this._transitionable=new c.Transitionable(Ye),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,u={}){if(!this._validate(c.validateLight,r,u))for(const f in r){const _=r[f];f.endsWith(Qe)?this._transitionable.setTransition(f.slice(0,-Qe.length),_):this._transitionable.setValue(f,_)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,f){return(!f||f.validate!==!1)&&c.emitValidationErrors(this,r.call(c.validateStyle,c.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class wt{constructor(r,u){this.width=r,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,u){const f=r.join(",")+String(u);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(r,u)),this.dashEntry[f]}getDashRanges(r,u,f){const _=[];let v=r.length%2==1?-r[r.length-1]*f:0,w=r[0]*f,S=!0;_.push({left:v,right:w,isDash:S,zeroLength:r[0]===0});let I=r[0];for(let L=1;L<r.length;L++){S=!S;const z=r[L];v=I*f,I+=z,w=I*f,_.push({left:v,right:w,isDash:S,zeroLength:z===0})}return _}addRoundDash(r,u,f){const _=u/2;for(let v=-f;v<=f;v++){const w=this.width*(this.nextRow+f+v);let S=0,I=r[S];for(let L=0;L<this.width;L++){L/I.right>1&&(I=r[++S]);const z=Math.abs(L-I.left),B=Math.abs(L-I.right),V=Math.min(z,B);let Q;const Y=v/f*(_+1);if(I.isDash){const K=_-Math.abs(Y);Q=Math.sqrt(V*V+K*K)}else Q=_-Math.sqrt(V*V+Y*Y);this.data[w+L]=Math.max(0,Math.min(255,Q+128))}}}addRegularDash(r){for(let S=r.length-1;S>=0;--S){const I=r[S],L=r[S+1];I.zeroLength?r.splice(S,1):L&&L.isDash===I.isDash&&(L.left=I.left,r.splice(S,1))}const u=r[0],f=r[r.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const _=this.width*this.nextRow;let v=0,w=r[v];for(let S=0;S<this.width;S++){S/w.right>1&&(w=r[++v]);const I=Math.abs(S-w.left),L=Math.abs(S-w.right),z=Math.min(I,L);this.data[_+S]=Math.max(0,Math.min(255,(w.isDash?z:-z)+128))}}addDash(r,u){const f=u?7:0,_=2*f+1;if(this.nextRow+_>this.height)return c.warnOnce("LineAtlas out of space"),null;let v=0;for(let S=0;S<r.length;S++)v+=r[S];if(v!==0){const S=this.width/v,I=this.getDashRanges(r,this.width,S);u?this.addRoundDash(I,S,f):this.addRegularDash(I)}const w={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:v};return this.nextRow+=_,this.dirty=!0,w}bind(r){const u=r.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}class Mt{constructor(r,u){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const f=this.workerPool.acquire(this.id);for(let _=0;_<f.length;_++){const v=new Mt.Actor(f[_],u,this.id);v.name=`Worker ${_}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,u,f){c.asyncAll(this.actors,(_,v)=>{_.send(r,u,v)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Lt(m,r,u){const f=function(_,v){if(_)return u(_);if(v){const w=c.pick(c.extend(v,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(w.vectorLayers=v.vector_layers,w.vectorLayerIds=w.vectorLayers.map(S=>S.id)),u(null,w)}};return m.url?c.getJSON(r.transformRequest(m.url,c.ResourceType.Source),f):c.exported.frame(()=>f(null,m))}Mt.Actor=c.Actor;class ei{constructor(r,u,f){this.bounds=c.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=u||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const u=Math.pow(2,r.z),f=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*u),_=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*u),v=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*u),w=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*u);return r.x>=f&&r.x<v&&r.y>=_&&r.y<w}}class gi extends c.Evented{constructor(r,u,f,_){if(super(),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(u,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lt(this._options,this.map._requestManager,(r,u)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r?this.fire(new c.ErrorEvent(r)):u&&(c.extend(this,u),u.bounds&&(this.tileBounds=new ei(u.bounds,this.minzoom,this.maxzoom)),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}loadTile(r,u){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(f,c.ResourceType.Tile),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function v(w,S){return delete r.request,r.aborted?u(null):w&&w.status!==404?u(w):(S&&S.resourceTiming&&(r.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&r.setExpiryData(S),r.loadVectorData(S,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),u(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired"?r.state==="loading"?r.reloadCallback=u:r.request=r.actor.send("reloadTile",_,v.bind(this)):(r.actor=this.dispatcher.getActor(),r.request=r.actor.send("loadTile",_,v.bind(this)))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id},void 0)}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ut extends c.Evented{constructor(r,u,f,_){super(),this.id=r,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},u),c.extend(this,c.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lt(this._options,this.map._requestManager,(r,u)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new c.ErrorEvent(r)):u&&(c.extend(this,u),u.bounds&&(this.tileBounds=new ei(u.bounds,this.minzoom,this.maxzoom)),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,u){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.request=c.getImage(this.map._requestManager.transformRequest(f,c.ResourceType.Tile),(_,v,w)=>{if(delete r.request,r.aborted)r.state="unloaded",u(null);else if(_)r.state="errored",u(_);else if(v){this.map._refreshExpiredTiles&&r.setExpiryData(w);const S=this.map.painter.context,I=S.gl;r.texture=this.map.painter.getTileTexture(v.width),r.texture?r.texture.update(v,{useMipmap:!0}):(r.texture=new se(S,v,I.RGBA,{useMipmap:!0}),r.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),r.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),u(null)}})}abortTile(r,u){r.request&&(r.request.cancel(),delete r.request),u()}unloadTile(r,u){r.texture&&this.map.painter.saveTileTexture(r.texture),u()}hasTransition(){return!1}}let mi;class pt extends Ut{constructor(r,u,f,_){super(r,u,f,_),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(r,u){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(v,w){v&&(r.state="errored",u(v)),w&&(r.dem=w,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded",u(null))}r.request=c.getImage(this.map._requestManager.transformRequest(f,c.ResourceType.Tile),function(v,w){if(delete r.request,r.aborted)r.state="unloaded",u(null);else if(v)r.state="errored",u(v);else if(w){this.map._refreshExpiredTiles&&r.setExpiryData(w),delete w.cacheControl,delete w.expires;const S=c.isImageBitmap(w)&&(mi==null&&(mi=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),mi)?w:c.exported.getImageData(w,1),I={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:S,encoding:this.encoding};r.actor&&r.state!=="expired"||(r.actor=this.dispatcher.getActor(),r.actor.send("loadDEMTile",I,_.bind(this)))}}.bind(this)),r.neighboringTiles=this._getNeighboringTiles(r.tileID)}_getNeighboringTiles(r){const u=r.canonical,f=Math.pow(2,u.z),_=(u.x-1+f)%f,v=u.x===0?r.wrap-1:r.wrap,w=(u.x+1+f)%f,S=u.x+1===f?r.wrap+1:r.wrap,I={};return I[new c.OverscaledTileID(r.overscaledZ,v,u.z,_,u.y).key]={backfilled:!1},I[new c.OverscaledTileID(r.overscaledZ,S,u.z,w,u.y).key]={backfilled:!1},u.y>0&&(I[new c.OverscaledTileID(r.overscaledZ,v,u.z,_,u.y-1).key]={backfilled:!1},I[new c.OverscaledTileID(r.overscaledZ,r.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},I[new c.OverscaledTileID(r.overscaledZ,S,u.z,w,u.y-1).key]={backfilled:!1}),u.y+1<f&&(I[new c.OverscaledTileID(r.overscaledZ,v,u.z,_,u.y+1).key]={backfilled:!1},I[new c.OverscaledTileID(r.overscaledZ,r.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},I[new c.OverscaledTileID(r.overscaledZ,S,u.z,w,u.y+1).key]={backfilled:!1}),I}unloadTile(r){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&r.actor.send("removeDEMTile",{uid:r.uid,source:this.id})}}class li extends c.Evented{constructor(r,u,f,_){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(_),this._data=u.data,this._options=c.extend({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const v=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*v,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*v,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:c.EXTENT,radius:(u.clusterRadius||50)*v,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData("content"),this}getClusterExpansionZoom(r,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:r,source:this.id},u),this}getClusterChildren(r,u){return this.actor.send("geojson.getClusterChildren",{clusterId:r,source:this.id},u),this}getClusterLeaves(r,u,f,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:r,limit:u,offset:f},_),this}_updateWorkerData(r){const u=c.extend({},this.workerOptions),f=this._data;typeof f=="string"?(u.request=this.map._requestManager.transformRequest(c.exported.resolveURL(f),c.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(f),this._pendingLoads++,this.fire(new c.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,u,(_,v)=>{if(this._pendingLoads--,this._removed||v&&v.abandoned)return void this.fire(new c.Event("dataabort",{dataType:"source",sourceDataType:r}));let w=null;if(v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w=v.resourceTiming[this.id].slice(0)),_)return void this.fire(new c.ErrorEvent(_));const S={dataType:"source",sourceDataType:r};this._collectResourceTiming&&w&&w.length>0&&c.extend(S,{resourceTiming:w}),this.fire(new c.Event("data",S))})}loaded(){return this._pendingLoads===0}loadTile(r,u){const f=r.actor?"reloadTile":"loadTile";r.actor=this.actor;const _={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.request=this.actor.send(f,_,(v,w)=>(delete r.request,r.unloadVectorData(),r.aborted?u(null):v?u(v):(r.loadVectorData(w,this.map.painter,f==="reloadTile"),u(null))))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.aborted=!0}unloadTile(r){r.unloadVectorData(),this.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var si=c.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Bi extends c.Evented{constructor(r,u,f,_){super(),this.id=r,this.dispatcher=f,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=u}load(r,u){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(f,_)=>{this._loaded=!0,f?this.fire(new c.ErrorEvent(f)):_&&(this.image=_,r&&(this.coordinates=r),u&&u(),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}setCoordinates(r){this.coordinates=r;const u=r.map(c.MercatorCoordinate.fromLngLat);this.tileID=function(_){let v=1/0,w=1/0,S=-1/0,I=-1/0;for(const V of _)v=Math.min(v,V.x),w=Math.min(w,V.y),S=Math.max(S,V.x),I=Math.max(I,V.y);const L=Math.max(S-v,I-w),z=Math.max(0,Math.floor(-Math.log(L)/Math.LN2)),B=Math.pow(2,z);return new c.CanonicalTileID(z,Math.floor((v+S)/2*B),Math.floor((w+I)/2*B))}(u),this.minzoom=this.maxzoom=this.tileID.z;const f=u.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new c.RasterBoundsArray,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,c.EXTENT,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,c.EXTENT),this._boundsArray.emplaceBack(f[2].x,f[2].y,c.EXTENT,c.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,u=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new se(r,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(r,u){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},u(null)):(r.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ln extends Bi{constructor(r,u,f,_){super(r,u,f,_),this.roundZoom=!0,this.type="video",this.options=u}load(){this._loaded=!1;const r=this.options;this.urls=[];for(const u of r.urls)this.urls.push(this.map._requestManager.transformRequest(u,c.ResourceType.Source).url);c.getVideo(this.urls,(u,f)=>{this._loaded=!0,u?this.fire(new c.ErrorEvent(u)):f&&(this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const u=this.video.seekable;r<u.start(0)||r>u.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,u=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new se(r,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class cn extends Bi{constructor(r,u,f,_){super(r,u,f,_),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${r}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${r}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,f=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new se(u,this.canvas,f.RGBA,{premultiply:!0});for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const Ri={vector:gi,raster:Ut,"raster-dem":pt,geojson:li,video:ln,image:Bi,canvas:cn};function Hn(m,r){const u=c.create();return c.translate(u,u,[1,1,0]),c.scale(u,u,[.5*m.width,.5*m.height,1]),c.multiply(u,u,m.calculatePosMatrix(r.toUnwrapped()))}function qn(m,r,u,f,_,v){const w=function(B,V,Q){if(B)for(const Y of B){const K=V[Y];if(K&&K.source===Q&&K.type==="fill-extrusion")return!0}else for(const Y in V){const K=V[Y];if(K.source===Q&&K.type==="fill-extrusion")return!0}return!1}(_&&_.layers,r,m.id),S=v.maxPitchScaleFactor(),I=m.tilesIn(f,S,w);I.sort(Ne);const L=[];for(const B of I)L.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(r,u,m._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,_,v,S,Hn(m.transform,B.tileID))});const z=function(B){const V={},Q={};for(const Y of B){const K=Y.queryResults,ue=Y.wrappedTileID,me=Q[ue]=Q[ue]||{};for(const ve in K){const te=K[ve],Ee=me[ve]=me[ve]||{},xe=V[ve]=V[ve]||[];for(const Le of te)Ee[Le.featureIndex]||(Ee[Le.featureIndex]=!0,xe.push(Le))}}return V}(L);for(const B in z)z[B].forEach(V=>{const Q=V.feature,Y=m.getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=Y});return z}function Ne(m,r){const u=m.tileID,f=r.tileID;return u.overscaledZ-f.overscaledZ||u.canonical.y-f.canonical.y||u.wrap-f.wrap||u.canonical.x-f.canonical.x}class ht{constructor(r,u){this.tileID=r,this.uid=c.uniqueId(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const u=r+this.timeAdded;u<c.exported.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.textures.forEach(u=>r.saveTileTexture(u)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(r,u,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(_,v){const w={};if(!v)return w;for(const S of _){const I=S.layerIds.map(L=>v.getLayer(L)).filter(Boolean);if(I.length!==0){S.layers=I,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(L=>I.filter(z=>z.id===L)[0]));for(const L of I)w[L.id]=S}}return w}(r.buckets,u.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof c.SymbolBucket){if(this.hasSymbolBuckets=!0,!f)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof c.SymbolBucket&&v.hasRTLText){this.hasRTLText=!0,c.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const v=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(_).queryRadius(v))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new c.CollisionBoxArray}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const f in this.buckets){const _=this.buckets[f];_.uploadPending()&&_.upload(r)}const u=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new se(r,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new se(r,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,u,f,_,v,w,S,I,L,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:v,scale:w,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:S,queryPadding:this.queryPadding*L},r,u,f):{}}querySourceFeatures(r,u){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),v=u?u.sourceLayer:"",w=_._geojsonTileLayer||_[v];if(!w)return;const S=c.createFilter(u&&u.filter),{z:I,x:L,y:z}=this.tileID.canonical,B={z:I,x:L,y:z};for(let V=0;V<w.length;V++){const Q=w.feature(V);if(S.needGeometry){const ue=c.toEvaluationFeature(Q,!0);if(!S.filter(new c.EvaluationParameters(this.tileID.overscaledZ),ue,this.tileID.canonical))continue}else if(!S.filter(new c.EvaluationParameters(this.tileID.overscaledZ),Q))continue;const Y=f.getId(Q,v),K=new c.GeoJSONFeature(Q,I,L,z,Y);K.tile=B,r.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const u=this.expirationTime;if(r.cacheControl){const f=c.parseCacheControl(r.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(u)if(this.expirationTime<u)_=!0;else{const v=this.expirationTime-u;v?this.expirationTime=f+Math.max(v,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!u.style.hasLayer(_))continue;const v=this.buckets[_],w=v.layers[0].sourceLayer||"_geojsonTileLayer",S=f[w],I=r[w];if(!S||!I||Object.keys(I).length===0)continue;v.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const L=u&&u.style&&u.style.getLayer(_);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=c.exported.now()+r}setDependencies(r,u){const f={};for(const _ of u)f[_]=!0;this.dependencies[r]=f}hasDependency(r,u){for(const f of r){const _=this.dependencies[f];if(_){for(const v of u)if(_[v])return!0}}return!1}}class We{constructor(r,u){this.max=r,this.onRemove=u,this.reset()}reset(){for(const r in this.data)for(const u of this.data[r])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(r,u,f){const _=r.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const v={value:u,timeout:void 0};if(f!==void 0&&(v.timeout=setTimeout(()=>{this.remove(r,v)},f)),this.data[_].push(v),this.order.push(_),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const u=this.data[r].shift();return u.timeout&&clearTimeout(u.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),u.value}getByKey(r){const u=this.data[r];return u?u[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,u){if(!this.has(r))return this;const f=r.wrapped().key,_=u===void 0?0:this.data[f].indexOf(u),v=this.data[f][_];return this.data[f].splice(_,1),v.timeout&&clearTimeout(v.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(v.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(r){const u=[];for(const f in this.data)for(const _ of this.data[f])r(_.value)||u.push(_);for(const f of u)this.remove(f.value.tileID,f)}}class yt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,u,f){const _=String(u);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][_]=this.stateChanges[r][_]||{},c.extend(this.stateChanges[r][_],f),this.deletedStates[r]===null){this.deletedStates[r]={};for(const v in this.state[r])v!==_&&(this.deletedStates[r][v]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][_]===null){this.deletedStates[r][_]={};for(const v in this.state[r][_])f[v]||(this.deletedStates[r][_][v]=null)}else for(const v in f)this.deletedStates[r]&&this.deletedStates[r][_]&&this.deletedStates[r][_][v]===null&&delete this.deletedStates[r][_][v]}removeFeatureState(r,u,f){if(this.deletedStates[r]===null)return;const _=String(u);if(this.deletedStates[r]=this.deletedStates[r]||{},f&&u!==void 0)this.deletedStates[r][_]!==null&&(this.deletedStates[r][_]=this.deletedStates[r][_]||{},this.deletedStates[r][_][f]=null);else if(u!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][_])for(f in this.deletedStates[r][_]={},this.stateChanges[r][_])this.deletedStates[r][_][f]=null;else this.deletedStates[r][_]=null;else this.deletedStates[r]=null}getState(r,u){const f=String(u),_=c.extend({},(this.state[r]||{})[f],(this.stateChanges[r]||{})[f]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const v=this.deletedStates[r][u];if(v===null)return{};for(const w in v)delete _[w]}return _}initializeTileState(r,u){r.setFeatureState(this.state,u)}coalesceChanges(r,u){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const v={};for(const w in this.stateChanges[_])this.state[_][w]||(this.state[_][w]={}),c.extend(this.state[_][w],this.stateChanges[_][w]),v[w]=this.state[_][w];f[_]=v}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const v={};if(this.deletedStates[_]===null)for(const w in this.state[_])v[w]={},this.state[_][w]={};else for(const w in this.deletedStates[_]){if(this.deletedStates[_][w]===null)this.state[_][w]={};else for(const S of Object.keys(this.deletedStates[_][w]))delete this.state[_][w][S];v[w]=this.state[_][w]}f[_]=f[_]||{},c.extend(f[_],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const _ in r)r[_].setFeatureState(f,u)}}class Et extends c.Evented{constructor(r,u,f){super(),this.id=r,this.dispatcher=f,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,v,w,S){const I=new Ri[v.type](_,v,w,S);if(I.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${I.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],I),I}(r,u,f,this),this._tiles={},this._cache=new We(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new yt}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const u=this._tiles[r];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,u){return this._source.loadTile(r,u)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){this._source.abortTile&&this._source.abortTile(r,()=>{}),this._source.fire(new c.Event("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const f=this._tiles[u];f.upload(r),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(Wt).map(r=>r.key)}getRenderableIds(r){const u=[];for(const f in this._tiles)this._isIdRenderable(f,r)&&u.push(this._tiles[f]);return r?u.sort((f,_)=>{const v=f.tileID,w=_.tileID,S=new c.pointGeometry(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),I=new c.pointGeometry(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-w.overscaledZ||I.y-S.y||I.x-S.x}).map(f=>f.tileID.key):u.map(f=>f.tileID).sort(Wt).map(f=>f.key)}hasRenderableParent(r){const u=this.findLoadedParent(r,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(r,u){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(u||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,u){const f=this._tiles[r];f&&(f.state!=="loading"&&(f.state=u),this._loadTile(f,this._tileLoaded.bind(this,f,r,u)))}_tileLoaded(r,u,f,_){if(_)return r.state="errored",void(_.status!==404?this._source.fire(new c.ErrorEvent(_,{tile:r})):this.update(this.transform,this.terrain));r.timeAdded=c.exported.now(),f==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(u,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new c.Event("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const u=this.getRenderableIds();for(let _=0;_<u.length;_++){const v=u[_];if(r.neighboringTiles&&r.neighboringTiles[v]){const w=this.getTileByID(v);f(r,w),f(w,r)}}function f(_,v){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let w=v.tileID.canonical.x-_.tileID.canonical.x;const S=v.tileID.canonical.y-_.tileID.canonical.y,I=Math.pow(2,_.tileID.canonical.z),L=v.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+I)===1?w+=I:Math.abs(w-I)===1&&(w-=I)),v.dem&&_.dem&&(_.dem.backfillBorder(v.dem,w,S),_.neighboringTiles&&_.neighboringTiles[L]&&(_.neighboringTiles[L].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,u,f,_){for(const v in this._tiles){let w=this._tiles[v];if(_[v]||!w.hasData()||w.tileID.overscaledZ<=u||w.tileID.overscaledZ>f)continue;let S=w.tileID;for(;w&&w.tileID.overscaledZ>u+1;){const L=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[L.key],w&&w.hasData()&&(S=L)}let I=S;for(;I.overscaledZ>u;)if(I=I.scaledTo(I.overscaledZ-1),r[I.key]){_[S.key]=S;break}}}findLoadedParent(r,u){if(r.key in this._loadedParentTiles){const f=this._loadedParentTiles[r.key];return f&&f.tileID.overscaledZ>=u?f:null}for(let f=r.overscaledZ-1;f>=u;f--){const _=r.scaledTo(f),v=this._getLoadedTile(_);if(v)return v}}_getLoadedTile(r){const u=this._tiles[r.key];return u&&u.hasData()?u:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const u=Math.ceil(r.width/this._source.tileSize)+1,f=Math.ceil(r.height/this._source.tileSize)+1,_=Math.floor(u*f*5),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(r){const u=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,u){const f={};for(const _ in this._tiles){const v=this._tiles[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+u),f[v.tileID.key]=v}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(r,u){if(this.transform=r,this.terrain=u,!this._sourceLoaded||this._paused)return;let f;this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new c.OverscaledTileID(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)):(f=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u}),this._source.hasTile&&(f=f.filter(L=>this._source.hasTile(L)))):f=[];const _=r.coveringZoomLevel(this._source),v=Math.max(_-Et.maxOverzooming,this._source.minzoom),w=Math.max(_+Et.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const z of f)if(z.canonical.z>this._source.minzoom){const B=z.scaledTo(z.canonical.z-1);L[B.key]=B;const V=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));L[V.key]=V}f=f.concat(Object.values(L))}const S=this._updateRetainedTiles(f,_);if(Gt(this._source.type)){const L={},z={},B=Object.keys(S);for(const V of B){const Q=S[V],Y=this._tiles[V];if(!Y||Y.fadeEndTime&&Y.fadeEndTime<=c.exported.now())continue;const K=this.findLoadedParent(Q,v);K&&(this._addTile(K.tileID),L[K.tileID.key]=K.tileID),z[V]=Q}this._retainLoadedChildren(z,_,w,S);for(const V in L)S[V]||(this._coveredTiles[V]=!0,S[V]=L[V]);if(u){const V={},Q={};for(const Y of f)this._tiles[Y.key].hasData()?V[Y.key]=Y:Q[Y.key]=Y;for(const Y in Q){const K=Q[Y].children(this._source.maxzoom);this._tiles[K[0].key]&&this._tiles[K[1].key]&&this._tiles[K[2].key]&&this._tiles[K[3].key]&&(V[K[0].key]=S[K[0].key]=K[0],V[K[1].key]=S[K[1].key]=K[1],V[K[2].key]=S[K[2].key]=K[2],V[K[3].key]=S[K[3].key]=K[3],delete Q[Y])}for(const Y in Q){const K=this.findLoadedParent(Q[Y],this._source.minzoom);if(K){V[K.tileID.key]=S[K.tileID.key]=K.tileID;for(const ue in V)V[ue].isChildOf(K.tileID)&&delete V[ue]}}for(const Y in this._tiles)V[Y]||(this._coveredTiles[Y]=!0)}}for(const L in S)this._tiles[L].clearFadeHold();const I=c.keysDifference(this._tiles,S);for(const L of I){const z=this._tiles[L];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,u){const f={},_={},v=Math.max(u-Et.maxOverzooming,this._source.minzoom),w=Math.max(u+Et.maxUnderzooming,this._source.minzoom),S={};for(const I of r){const L=this._addTile(I);f[I.key]=I,L.hasData()||u<this._source.maxzoom&&(S[I.key]=I)}this._retainLoadedChildren(S,u,w,f);for(const I of r){let L=this._tiles[I.key];if(L.hasData())continue;if(u+1>this._source.maxzoom){const B=I.children(this._source.maxzoom)[0],V=this.getTile(B);if(V&&V.hasData()){f[B.key]=B;continue}}else{const B=I.children(this._source.maxzoom);if(f[B[0].key]&&f[B[1].key]&&f[B[2].key]&&f[B[3].key])continue}let z=L.wasRequested();for(let B=I.overscaledZ-1;B>=v;--B){const V=I.scaledTo(B);if(_[V.key]||(_[V.key]=!0,L=this.getTile(V),!L&&z&&(L=this._addTile(V)),L&&(f[V.key]=V,z=L.wasRequested(),L.hasData())))break}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const u=[];let f,_=this._tiles[r].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}u.push(_.key);const v=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(v),f)break;_=v}for(const v of u)this._loadedParentTiles[v]=f}}_addTile(r){let u=this._tiles[r.key];if(u)return u;u=this._cache.getAndRemove(r),u&&(this._setTileReloadTimer(r.key,u),u.tileID=r,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,u)));const f=u;return u||(u=new ht(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(u,this._tileLoaded.bind(this,u,r.key,u.state))),u.uses++,this._tiles[r.key]=u,f||this._source.fire(new c.Event("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(r,u){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const f=u.getExpiryTimeout();f&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},f))}_removeTile(r){const u=this._tiles[r];u&&(u.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,u,f){const _=[],v=this.transform;if(!v)return _;const w=f?v.getCameraQueryGeometry(r):r,S=r.map(Y=>v.pointCoordinate(Y,this.terrain)),I=w.map(Y=>v.pointCoordinate(Y,this.terrain)),L=this.getIds();let z=1/0,B=1/0,V=-1/0,Q=-1/0;for(const Y of I)z=Math.min(z,Y.x),B=Math.min(B,Y.y),V=Math.max(V,Y.x),Q=Math.max(Q,Y.y);for(let Y=0;Y<L.length;Y++){const K=this._tiles[L[Y]];if(K.holdingForFade())continue;const ue=K.tileID,me=Math.pow(2,v.zoom-K.tileID.overscaledZ),ve=u*K.queryPadding*c.EXTENT/K.tileSize/me,te=[ue.getTilePoint(new c.MercatorCoordinate(z,B)),ue.getTilePoint(new c.MercatorCoordinate(V,Q))];if(te[0].x-ve<c.EXTENT&&te[0].y-ve<c.EXTENT&&te[1].x+ve>=0&&te[1].y+ve>=0){const Ee=S.map(Le=>ue.getTilePoint(Le)),xe=I.map(Le=>ue.getTilePoint(Le));_.push({tile:K,tileID:ue,queryGeometry:Ee,cameraQueryGeometry:xe,scale:me})}}return _}getVisibleCoordinates(r){const u=this.getRenderableIds(r).map(f=>this._tiles[f].tileID);for(const f of u)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(Gt(this._source.type))for(const r in this._tiles){const u=this._tiles[r];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=c.exported.now())return!0}return!1}setFeatureState(r,u,f){this._state.updateState(r=r||"_geojsonTileLayer",u,f)}removeFeatureState(r,u,f){this._state.removeFeatureState(r=r||"_geojsonTileLayer",u,f)}getFeatureState(r,u){return this._state.getState(r=r||"_geojsonTileLayer",u)}setDependencies(r,u,f){const _=this._tiles[r];_&&_.setDependencies(u,f)}reloadTilesForDependencies(r,u){for(const f in this._tiles)this._tiles[f].hasDependency(r,u)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(r,u))}}function Wt(m,r){const u=Math.abs(2*m.wrap)-+(m.wrap<0),f=Math.abs(2*r.wrap)-+(r.wrap<0);return m.overscaledZ-r.overscaledZ||f-u||r.canonical.y-m.canonical.y||r.canonical.x-m.canonical.x}function Gt(m){return m==="raster"||m==="image"||m==="video"}Et.maxOverzooming=10,Et.maxUnderzooming=3;const J="mapboxgl_preloaded_worker_pool";class ce{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<ce.workerCount;)this.workers.push(new Worker(Xs.workerUrl));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[J]}numActive(){return Object.keys(this.active).length}}const Ce=Math.floor(c.exported.hardwareConcurrency/2);let Re;function Fe(){return Re||(Re=new ce),Re}function Ze(m,r){const u={};for(const f in m)f!=="ref"&&(u[f]=m[f]);return c.refProperties.forEach(f=>{f in r&&(u[f]=r[f])}),u}function lt(m){m=m.slice();const r=Object.create(null);for(let u=0;u<m.length;u++)r[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=Ze(m[u],r[m[u].ref]));return m}ce.workerCount=Math.max(Math.min(Ce,6),1);const ze={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Xe(m,r,u){u.push({command:ze.addSource,args:[m,r[m]]})}function Ve(m,r,u){r.push({command:ze.removeSource,args:[m]}),u[m]=!0}function Ct(m,r,u,f){Ve(m,u,f),Xe(m,r,u)}function Tt(m,r,u){let f;for(f in m[u])if(Object.prototype.hasOwnProperty.call(m[u],f)&&f!=="data"&&!k(m[u][f],r[u][f]))return!1;for(f in r[u])if(Object.prototype.hasOwnProperty.call(r[u],f)&&f!=="data"&&!k(m[u][f],r[u][f]))return!1;return!0}function Pt(m,r,u,f,_,v){let w;for(w in r=r||{},m=m||{})Object.prototype.hasOwnProperty.call(m,w)&&(k(m[w],r[w])||u.push({command:v,args:[f,w,r[w],_]}));for(w in r)Object.prototype.hasOwnProperty.call(r,w)&&!Object.prototype.hasOwnProperty.call(m,w)&&(k(m[w],r[w])||u.push({command:v,args:[f,w,r[w],_]}))}function Bt(m){return m.id}function Zt(m,r){return m[r.id]=r,m}class ci{constructor(r,u){this.reset(r,u)}reset(r,u){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=c.clamp(r,0,1);let u=1,f=this._distances[u];const _=r*this.paddedLength+this.padding;for(;f<_&&u<this._distances.length;)f=this._distances[++u];const v=u-1,w=this._distances[v],S=f-w,I=S>0?(_-w)/S:0;return this.points[v].mult(1-I).add(this.points[u].mult(I))}}function be(m,r){let u=!0;return m==="always"||m!=="never"&&r!=="never"||(u=!1),u}class je{constructor(r,u,f){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(u/f);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=u,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,u,f,_,v){this._forEachCell(u,f,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(r,u,f,_){this._forEachCell(u-_,f-_,u+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(u),this.circles.push(f),this.circles.push(_)}_insertBoxCell(r,u,f,_,v,w){this.boxCells[v].push(w)}_insertCircleCell(r,u,f,_,v,w){this.circleCells[v].push(w)}_query(r,u,f,_,v,w,S){if(f<0||r>this.width||_<0||u>this.height)return[];const I=[];if(r<=0&&u<=0&&this.width<=f&&this.height<=_){if(v)return[{key:null,x1:r,y1:u,x2:f,y2:_}];for(let L=0;L<this.boxKeys.length;L++)I.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const z=this.circles[3*L],B=this.circles[3*L+1],V=this.circles[3*L+2];I.push({key:this.circleKeys[L],x1:z-V,y1:B-V,x2:z+V,y2:B+V})}}else this._forEachCell(r,u,f,_,this._queryCell,I,{hitTest:v,overlapMode:w,seenUids:{box:{},circle:{}}},S);return I}query(r,u,f,_){return this._query(r,u,f,_,!1,null)}hitTest(r,u,f,_,v,w){return this._query(r,u,f,_,!0,v,w).length>0}hitTestCircle(r,u,f,_,v){const w=r-f,S=r+f,I=u-f,L=u+f;if(S<0||w>this.width||L<0||I>this.height)return!1;const z=[];return this._forEachCell(w,I,S,L,this._queryCellCircle,z,{hitTest:!0,overlapMode:_,circle:{x:r,y:u,radius:f},seenUids:{box:{},circle:{}}},v),z.length>0}_queryCell(r,u,f,_,v,w,S,I){const{seenUids:L,hitTest:z,overlapMode:B}=S,V=this.boxCells[v];if(V!==null){const Y=this.bboxes;for(const K of V)if(!L.box[K]){L.box[K]=!0;const ue=4*K,me=this.boxKeys[K];if(r<=Y[ue+2]&&u<=Y[ue+3]&&f>=Y[ue+0]&&_>=Y[ue+1]&&(!I||I(me))&&(!z||!be(B,me.overlapMode))&&(w.push({key:me,x1:Y[ue],y1:Y[ue+1],x2:Y[ue+2],y2:Y[ue+3]}),z))return!0}}const Q=this.circleCells[v];if(Q!==null){const Y=this.circles;for(const K of Q)if(!L.circle[K]){L.circle[K]=!0;const ue=3*K,me=this.circleKeys[K];if(this._circleAndRectCollide(Y[ue],Y[ue+1],Y[ue+2],r,u,f,_)&&(!I||I(me))&&(!z||!be(B,me.overlapMode))){const ve=Y[ue],te=Y[ue+1],Ee=Y[ue+2];if(w.push({key:me,x1:ve-Ee,y1:te-Ee,x2:ve+Ee,y2:te+Ee}),z)return!0}}}return!1}_queryCellCircle(r,u,f,_,v,w,S,I){const{circle:L,seenUids:z,overlapMode:B}=S,V=this.boxCells[v];if(V!==null){const Y=this.bboxes;for(const K of V)if(!z.box[K]){z.box[K]=!0;const ue=4*K,me=this.boxKeys[K];if(this._circleAndRectCollide(L.x,L.y,L.radius,Y[ue+0],Y[ue+1],Y[ue+2],Y[ue+3])&&(!I||I(me))&&!be(B,me.overlapMode))return w.push(!0),!0}}const Q=this.circleCells[v];if(Q!==null){const Y=this.circles;for(const K of Q)if(!z.circle[K]){z.circle[K]=!0;const ue=3*K,me=this.circleKeys[K];if(this._circlesCollide(Y[ue],Y[ue+1],Y[ue+2],L.x,L.y,L.radius)&&(!I||I(me))&&!be(B,me.overlapMode))return w.push(!0),!0}}}_forEachCell(r,u,f,_,v,w,S,I){const L=this._convertToXCellCoord(r),z=this._convertToYCellCoord(u),B=this._convertToXCellCoord(f),V=this._convertToYCellCoord(_);for(let Q=L;Q<=B;Q++)for(let Y=z;Y<=V;Y++)if(v.call(this,r,u,f,_,this.xCellCount*Y+Q,w,S,I))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,u,f,_,v,w){const S=_-r,I=v-u,L=f+w;return L*L>S*S+I*I}_circleAndRectCollide(r,u,f,_,v,w,S){const I=(w-_)/2,L=Math.abs(r-(_+I));if(L>I+f)return!1;const z=(S-v)/2,B=Math.abs(u-(v+z));if(B>z+f)return!1;if(L<=I||B<=z)return!0;const V=L-I,Q=B-z;return V*V+Q*Q<=f*f}}function en(m,r,u,f,_){const v=c.create();return r?(c.scale(v,v,[1/_,1/_,1]),u||c.rotateZ(v,v,f.angle)):c.multiply(v,f.labelPlaneMatrix,m),v}function Ki(m,r,u,f,_){if(r){const v=c.clone(m);return c.scale(v,v,[_,_,1]),u||c.rotateZ(v,v,-f.angle),v}return f.glCoordMatrix}function Xt(m,r,u){let f;u?(f=[m.x,m.y,u(m.x,m.y),1],c.transformMat4(f,f,r)):(f=[m.x,m.y,0,1],or(f,f,r));const _=f[3];return{point:new c.pointGeometry(f[0]/_,f[1]/_),signedDistanceFromCamera:_}}function fn(m,r){return .5+m/r*.5}function An(m,r){const u=m[0]/m[3],f=m[1]/m[3];return u>=-r[0]&&u<=r[0]&&f>=-r[1]&&f<=r[1]}function Pi(m,r,u,f,_,v,w,S,I,L){const z=f?m.textSizeData:m.iconSizeData,B=c.evaluateSizeForZoom(z,u.transform.zoom),V=[256/u.width*2+1,256/u.height*2+1],Q=f?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Q.clear();const Y=m.lineVertexArray,K=f?m.text.placedSymbolArray:m.icon.placedSymbolArray,ue=u.transform.width/u.transform.height;let me=!1;for(let ve=0;ve<K.length;ve++){const te=K.get(ve);if(te.hidden||te.writingMode===c.WritingMode.vertical&&!me){jt(te.numGlyphs,Q);continue}let Ee;if(me=!1,L?(Ee=[te.anchorX,te.anchorY,L(te.anchorX,te.anchorY),1],c.transformMat4(Ee,Ee,r)):(Ee=[te.anchorX,te.anchorY,0,1],or(Ee,Ee,r)),!An(Ee,V)){jt(te.numGlyphs,Q);continue}const xe=fn(u.transform.cameraToCenterDistance,Ee[3]),Le=c.evaluateSizeForFeature(z,B,te),ke=w?Le/xe:Le*xe,Ge=new c.pointGeometry(te.anchorX,te.anchorY),Me=Xt(Ge,_,L).point,ct={},et=Ht(te,ke,!1,S,r,_,v,m.glyphOffsetArray,Y,Q,Me,Ge,ct,ue,I,L);me=et.useVertical,(et.notEnoughRoom||me||et.needsFlipping&&Ht(te,ke,!0,S,r,_,v,m.glyphOffsetArray,Y,Q,Me,Ge,ct,ue,I,L).notEnoughRoom)&&jt(te.numGlyphs,Q)}f?m.text.dynamicLayoutVertexBuffer.updateData(Q):m.icon.dynamicLayoutVertexBuffer.updateData(Q)}function un(m,r,u,f,_,v,w,S,I,L,z,B,V){const Q=S.glyphStartIndex+S.numGlyphs,Y=S.lineStartIndex,K=S.lineStartIndex+S.lineLength,ue=r.getoffsetX(S.glyphStartIndex),me=r.getoffsetX(Q-1),ve=xn(m*ue,u,f,_,v,w,S.segment,Y,K,I,L,z,B,V);if(!ve)return null;const te=xn(m*me,u,f,_,v,w,S.segment,Y,K,I,L,z,B,V);return te?{first:ve,last:te}:null}function Ke(m,r,u,f){return m===c.WritingMode.horizontal&&Math.abs(u.y-r.y)>Math.abs(u.x-r.x)*f?{useVertical:!0}:(m===c.WritingMode.vertical?r.y<u.y:r.x>u.x)?{needsFlipping:!0}:null}function Ht(m,r,u,f,_,v,w,S,I,L,z,B,V,Q,Y,K){const ue=r/24,me=m.lineOffsetX*ue,ve=m.lineOffsetY*ue;let te;if(m.numGlyphs>1){const Ee=m.glyphStartIndex+m.numGlyphs,xe=m.lineStartIndex,Le=m.lineStartIndex+m.lineLength,ke=un(ue,S,me,ve,u,z,B,m,I,v,V,Y,K);if(!ke)return{notEnoughRoom:!0};const Ge=Xt(ke.first.point,w,K).point,Me=Xt(ke.last.point,w,K).point;if(f&&!u){const ct=Ke(m.writingMode,Ge,Me,Q);if(ct)return ct}te=[ke.first];for(let ct=m.glyphStartIndex+1;ct<Ee-1;ct++)te.push(xn(ue*S.getoffsetX(ct),me,ve,u,z,B,m.segment,xe,Le,I,v,V,Y,K));te.push(ke.last)}else{if(f&&!u){const xe=Xt(B,_,K).point,Le=m.lineStartIndex+m.segment+1,ke=new c.pointGeometry(I.getx(Le),I.gety(Le)),Ge=Xt(ke,_,K),Me=Ge.signedDistanceFromCamera>0?Ge.point:$t(B,ke,xe,1,_,K),ct=Ke(m.writingMode,xe,Me,Q);if(ct)return ct}const Ee=xn(ue*S.getoffsetX(m.glyphStartIndex),me,ve,u,z,B,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,I,v,V,Y,K);if(!Ee)return{notEnoughRoom:!0};te=[Ee]}for(const Ee of te)c.addDynamicAttributes(L,Ee.point,Ee.angle);return{}}function $t(m,r,u,f,_,v){const w=Xt(m.add(m.sub(r)._unit()),_,v).point,S=u.sub(w);return u.add(S._mult(f/S.mag()))}function xn(m,r,u,f,_,v,w,S,I,L,z,B,V,Q){const Y=f?m-r:m+r;let K=Y>0?1:-1,ue=0;f&&(K*=-1,ue=Math.PI),K<0&&(ue+=Math.PI);let me=K>0?S+w:S+w+1,ve=_,te=_,Ee=0,xe=0;const Le=Math.abs(Y),ke=[];for(;Ee+xe<=Le;){if(me+=K,me<S||me>=I)return null;if(te=ve,ke.push(ve),ve=B[me],ve===void 0){const dt=new c.pointGeometry(L.getx(me),L.gety(me)),qt=Xt(dt,z,Q);if(qt.signedDistanceFromCamera>0)ve=B[me]=qt.point;else{const Jt=me-K;ve=$t(Ee===0?v:new c.pointGeometry(L.getx(Jt),L.gety(Jt)),dt,te,Le-Ee+1,z,Q)}}Ee+=xe,xe=te.dist(ve)}const Ge=(Le-Ee)/xe,Me=ve.sub(te),ct=Me.mult(Ge)._add(te);ct._add(Me._unit()._perp()._mult(u*K));const et=ue+Math.atan2(ve.y-te.y,ve.x-te.x);return ke.push(ct),{point:ct,angle:V?et:0,path:ke}}const Ir=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function jt(m,r){for(let u=0;u<m;u++){const f=r.length;r.resize(f+4),r.float32.set(Ir,3*f)}}function or(m,r,u){const f=r[0],_=r[1];return m[0]=u[0]*f+u[4]*_+u[12],m[1]=u[1]*f+u[5]*_+u[13],m[3]=u[3]*f+u[7]*_+u[15],m}const pn=100;class ys{constructor(r,u=new je(r.width+200,r.height+200,25),f=new je(r.width+200,r.height+200,25)){this.transform=r,this.grid=u,this.ignoredGrid=f,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+pn,this.screenBottomBoundary=r.height+pn,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,u,f,_,v,w){const S=this.projectAndGetPerspectiveRatio(_,r.anchorPointX,r.anchorPointY,w),I=f*S.perspectiveRatio,L=r.x1*I+S.point.x,z=r.y1*I+S.point.y,B=r.x2*I+S.point.x,V=r.y2*I+S.point.y;return!this.isInsideGrid(L,z,B,V)||u!=="always"&&this.grid.hitTest(L,z,B,V,u,v)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[L,z,B,V],offscreen:this.isOffscreen(L,z,B,V)}}placeCollisionCircles(r,u,f,_,v,w,S,I,L,z,B,V,Q,Y){const K=[],ue=new c.pointGeometry(u.anchorX,u.anchorY),me=Xt(ue,w,Y),ve=fn(this.transform.cameraToCenterDistance,me.signedDistanceFromCamera),te=(z?v/ve:v*ve)/c.ONE_EM,Ee=Xt(ue,S,Y).point,xe=un(te,_,u.lineOffsetX*te,u.lineOffsetY*te,!1,Ee,ue,u,f,S,{},!1,Y);let Le=!1,ke=!1,Ge=!0;if(xe){const Me=.5*V*ve+Q,ct=new c.pointGeometry(-100,-100),et=new c.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),dt=new ci,qt=xe.first,Jt=xe.last;let Rt=[];for(let di=qt.path.length-1;di>=1;di--)Rt.push(qt.path[di]);for(let di=1;di<Jt.path.length;di++)Rt.push(Jt.path[di]);const Ti=2.5*Me;if(I){const di=Rt.map(fi=>Xt(fi,I,Y));Rt=di.some(fi=>fi.signedDistanceFromCamera<=0)?[]:di.map(fi=>fi.point)}let Ai=[];if(Rt.length>0){const di=Rt[0].clone(),fi=Rt[0].clone();for(let Si=1;Si<Rt.length;Si++)di.x=Math.min(di.x,Rt[Si].x),di.y=Math.min(di.y,Rt[Si].y),fi.x=Math.max(fi.x,Rt[Si].x),fi.y=Math.max(fi.y,Rt[Si].y);Ai=di.x>=ct.x&&fi.x<=et.x&&di.y>=ct.y&&fi.y<=et.y?[Rt]:fi.x<ct.x||di.x>et.x||fi.y<ct.y||di.y>et.y?[]:c.clipLine([Rt],ct.x,ct.y,et.x,et.y)}for(const di of Ai){dt.reset(di,.25*Me);let fi=0;fi=dt.length<=.5*Me?1:Math.ceil(dt.paddedLength/Ti)+1;for(let Si=0;Si<fi;Si++){const In=Si/Math.max(fi-1,1),Zr=dt.lerp(In),Lr=Zr.x+pn,Xr=Zr.y+pn;K.push(Lr,Xr,Me,0);const Ps=Lr-Me,Er=Xr-Me,Jn=Lr+Me,ss=Xr+Me;if(Ge=Ge&&this.isOffscreen(Ps,Er,Jn,ss),ke=ke||this.isInsideGrid(Ps,Er,Jn,ss),r!=="always"&&this.grid.hitTestCircle(Lr,Xr,Me,r,B)&&(Le=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!L&&Le||!ke||ve<this.perspectiveRatioCutoff?[]:K,offscreen:Ge,collisionDetected:Le}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let f=1/0,_=1/0,v=-1/0,w=-1/0;for(const z of r){const B=new c.pointGeometry(z.x+pn,z.y+pn);f=Math.min(f,B.x),_=Math.min(_,B.y),v=Math.max(v,B.x),w=Math.max(w,B.y),u.push(B)}const S=this.grid.query(f,_,v,w).concat(this.ignoredGrid.query(f,_,v,w)),I={},L={};for(const z of S){const B=z.key;if(I[B.bucketInstanceId]===void 0&&(I[B.bucketInstanceId]={}),I[B.bucketInstanceId][B.featureIndex])continue;const V=[new c.pointGeometry(z.x1,z.y1),new c.pointGeometry(z.x2,z.y1),new c.pointGeometry(z.x2,z.y2),new c.pointGeometry(z.x1,z.y2)];c.polygonIntersectsPolygon(u,V)&&(I[B.bucketInstanceId][B.featureIndex]=!0,L[B.bucketInstanceId]===void 0&&(L[B.bucketInstanceId]=[]),L[B.bucketInstanceId].push(B.featureIndex))}return L}insertCollisionBox(r,u,f,_,v,w){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:v,collisionGroupID:w,overlapMode:u},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,u,f,_,v,w){const S=f?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:v,collisionGroupID:w,overlapMode:u};for(let L=0;L<r.length;L+=4)S.insertCircle(I,r[L],r[L+1],r[L+2])}projectAndGetPerspectiveRatio(r,u,f,_){let v;return _?(v=[u,f,_(u,f),1],c.transformMat4(v,v,r)):(v=[u,f,0,1],or(v,v,r)),{point:new c.pointGeometry((v[0]/v[3]+1)/2*this.transform.width+pn,(-v[1]/v[3]+1)/2*this.transform.height+pn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(r,u,f,_){return f<pn||r>=this.screenRightBoundary||_<pn||u>this.screenBottomBoundary}isInsideGrid(r,u,f,_){return f>=0&&r<this.gridRightBoundary&&_>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const r=c.identity([]);return c.translate(r,r,[-100,-100,0]),r}}function tn(m,r,u){return r*(c.EXTENT/(m.tileSize*Math.pow(2,u-m.tileID.overscaledZ)))}class Sn{constructor(r,u,f,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?u:-u))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class wi{constructor(r,u,f,_,v){this.text=new Sn(r?r.text:null,u,f,v),this.icon=new Sn(r?r.icon:null,u,_,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class vs{constructor(r,u,f){this.text=r,this.icon=u,this.skipFade=f}}class xr{constructor(){this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.circles=[]}}class br{constructor(r,u,f,_,v){this.bucketInstanceId=r,this.featureIndex=u,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=v}}class ts{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const u=++this.maxGroupID;this.collisionGroups[r]={ID:u,predicate:f=>f.collisionGroupID===u}}return this.collisionGroups[r]}}function xs(m,r,u,f,_){const{horizontalAlign:v,verticalAlign:w}=c.getAnchorAlignment(m),S=-(v-.5)*r,I=-(w-.5)*u,L=c.evaluateVariableOffset(m,f);return new c.pointGeometry(S+L[0]*_,I+L[1]*_)}function Hr(m,r,u,f,_,v){const{x1:w,x2:S,y1:I,y2:L,anchorPointX:z,anchorPointY:B}=m,V=new c.pointGeometry(r,u);return f&&V._rotate(_?v:-v),{x1:w+V.x,y1:I+V.y,x2:S+V.x,y2:L+V.y,anchorPointX:z,anchorPointY:B}}class X{constructor(r,u,f,_,v){this.transform=r.clone(),this.terrain=u,this.collisionIndex=new ys(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ts(_),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,u,f,_){const v=f.getBucket(u),w=f.latestFeatureIndex;if(!v||!w||u.id!==v.layerIds[0])return;const S=f.collisionBoxArray,I=v.layers[0].layout,L=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),z=f.tileSize/c.EXTENT,B=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),V=I.get("text-pitch-alignment")==="map",Q=I.get("text-rotation-alignment")==="map",Y=tn(f,1,this.transform.zoom),K=en(B,V,Q,this.transform,Y);let ue=null;if(V){const ve=Ki(B,V,Q,this.transform,Y);ue=c.multiply([],this.transform.labelPlaneMatrix,ve)}this.retainedQueryData[v.bucketInstanceId]=new br(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,f.tileID);const me={bucket:v,layout:I,posMatrix:B,textLabelPlaneMatrix:K,labelToScreenMatrix:ue,scale:L,textPixelRatio:z,holdingForFade:f.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(const ve of v.sortKeyRanges){const{sortKey:te,symbolInstanceStart:Ee,symbolInstanceEnd:xe}=ve;r.push({sortKey:te,symbolInstanceStart:Ee,symbolInstanceEnd:xe,parameters:me})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:me})}attemptAnchorPlacement(r,u,f,_,v,w,S,I,L,z,B,V,Q,Y,K,ue){const me=[V.textOffset0,V.textOffset1],ve=xs(r,f,_,me,v),te=this.collisionIndex.placeCollisionBox(Hr(u,ve.x,ve.y,w,S,this.transform.angle),B,I,L,z.predicate,ue);if((!K||this.collisionIndex.placeCollisionBox(Hr(K,ve.x,ve.y,w,S,this.transform.angle),B,I,L,z.predicate,ue).box.length!==0)&&te.box.length>0){let Ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:me,width:f,height:_,anchor:r,textBoxScale:v,prevAnchor:Ee},this.markUsedJustification(Q,r,V,Y),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,Y,V),this.placedOrientations[V.crossTileID]=Y),{shift:ve,placedGlyphBoxes:te}}}placeLayerBucketPart(r,u,f){const{bucket:_,layout:v,posMatrix:w,textLabelPlaneMatrix:S,labelToScreenMatrix:I,textPixelRatio:L,holdingForFade:z,collisionBoxArray:B,partiallyEvaluatedTextSize:V,collisionGroup:Q}=r.parameters,Y=v.get("text-optional"),K=v.get("icon-optional"),ue=c.getOverlapMode(v,"text-overlap","text-allow-overlap"),me=ue==="always",ve=c.getOverlapMode(v,"icon-overlap","icon-allow-overlap"),te=ve==="always",Ee=v.get("text-rotation-alignment")==="map",xe=v.get("text-pitch-alignment")==="map",Le=v.get("icon-text-fit")!=="none",ke=v.get("symbol-z-order")==="viewport-y",Ge=me&&(te||!_.hasIconData()||K),Me=te&&(me||!_.hasTextData()||Y);!_.collisionArrays&&B&&_.deserializeCollisionBoxes(B);const ct=(et,dt)=>{if(u[et.crossTileID])return;if(z)return void(this.placements[et.crossTileID]=new vs(!1,!1,!1));let qt=!1,Jt=!1,Rt=!0,Ti=null,Ai={box:null,offscreen:null},di={box:null,offscreen:null},fi=null,Si=null,In=null,Zr=0,Lr=0,Xr=0;dt.textFeatureIndex?Zr=dt.textFeatureIndex:et.useRuntimeCollisionCircles&&(Zr=et.featureIndex),dt.verticalTextFeatureIndex&&(Lr=dt.verticalTextFeatureIndex);const Ps=this.retainedQueryData[_.bucketInstanceId].tileID,Er=this.terrain?(wn,ni)=>this.terrain.getElevation(Ps,wn,ni):null;for(const wn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const ni=dt[wn];ni&&(ni.elevation=Er?Er(ni.anchorPointX,ni.anchorPointY):0)}const Jn=dt.textBox;if(Jn){const wn=Ei=>{let Pn=c.WritingMode.horizontal;if(_.allowVerticalPlacement&&!Ei&&this.prevPlacement){const Mn=this.prevPlacement.placedOrientations[et.crossTileID];Mn&&(this.placedOrientations[et.crossTileID]=Mn,Pn=Mn,this.markUsedOrientation(_,Pn,et))}return Pn},ni=(Ei,Pn)=>{if(_.allowVerticalPlacement&&et.numVerticalGlyphVertices>0&&dt.verticalTextBox){for(const Mn of _.writingModes)if(Mn===c.WritingMode.vertical?(Ai=Pn(),di=Ai):Ai=Ei(),Ai&&Ai.box&&Ai.box.length)break}else Ai=Ei()};if(v.get("text-variable-anchor")){let Ei=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[et.crossTileID]){const $i=this.prevPlacement.variableOffsets[et.crossTileID];Ei.indexOf($i.anchor)>0&&(Ei=Ei.filter(Tr=>Tr!==$i.anchor),Ei.unshift($i.anchor))}const Pn=($i,Tr,Ys)=>{const Fc=$i.x2-$i.x1,Ro=$i.y2-$i.y1,Mh=et.textBoxScale,Bc=Le&&ve==="never"?Tr:null;let Ms={box:[],offscreen:!1};const Ks=ue!=="never"?2*Ei.length:Ei.length;for(let Js=0;Js<Ks;++Js){const dl=this.attemptAnchorPlacement(Ei[Js%Ei.length],$i,Fc,Ro,Mh,Ee,xe,L,w,Q,Js>=Ei.length?ue:"never",et,_,Ys,Bc,Er);if(dl&&(Ms=dl.placedGlyphBoxes,Ms&&Ms.box&&Ms.box.length)){qt=!0,Ti=dl.shift;break}}return Ms};ni(()=>Pn(Jn,dt.iconBox,c.WritingMode.horizontal),()=>{const $i=dt.verticalTextBox;return _.allowVerticalPlacement&&!(Ai&&Ai.box&&Ai.box.length)&&et.numVerticalGlyphVertices>0&&$i?Pn($i,dt.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null}}),Ai&&(qt=Ai.box,Rt=Ai.offscreen);const Mn=wn(Ai&&Ai.box);if(!qt&&this.prevPlacement){const $i=this.prevPlacement.variableOffsets[et.crossTileID];$i&&(this.variableOffsets[et.crossTileID]=$i,this.markUsedJustification(_,$i.anchor,et,Mn))}}else{const Ei=(Pn,Mn)=>{const $i=this.collisionIndex.placeCollisionBox(Pn,ue,L,w,Q.predicate,Er);return $i&&$i.box&&$i.box.length&&(this.markUsedOrientation(_,Mn,et),this.placedOrientations[et.crossTileID]=Mn),$i};ni(()=>Ei(Jn,c.WritingMode.horizontal),()=>{const Pn=dt.verticalTextBox;return _.allowVerticalPlacement&&et.numVerticalGlyphVertices>0&&Pn?Ei(Pn,c.WritingMode.vertical):{box:null,offscreen:null}}),wn(Ai&&Ai.box&&Ai.box.length)}}if(fi=Ai,qt=fi&&fi.box&&fi.box.length>0,Rt=fi&&fi.offscreen,et.useRuntimeCollisionCircles){const wn=_.text.placedSymbolArray.get(et.centerJustifiedTextSymbolIndex),ni=c.evaluateSizeForFeature(_.textSizeData,V,wn),Ei=v.get("text-padding");Si=this.collisionIndex.placeCollisionCircles(ue,wn,_.lineVertexArray,_.glyphOffsetArray,ni,w,S,I,f,xe,Q.predicate,et.collisionCircleDiameter,Ei,Er),Si.circles.length&&Si.collisionDetected&&!f&&c.warnOnce("Collisions detected, but collision boxes are not shown"),qt=me||Si.circles.length>0&&!Si.collisionDetected,Rt=Rt&&Si.offscreen}if(dt.iconFeatureIndex&&(Xr=dt.iconFeatureIndex),dt.iconBox){const wn=ni=>{const Ei=Le&&Ti?Hr(ni,Ti.x,Ti.y,Ee,xe,this.transform.angle):ni;return this.collisionIndex.placeCollisionBox(Ei,ve,L,w,Q.predicate,Er)};di&&di.box&&di.box.length&&dt.verticalIconBox?(In=wn(dt.verticalIconBox),Jt=In.box.length>0):(In=wn(dt.iconBox),Jt=In.box.length>0),Rt=Rt&&In.offscreen}const ss=Y||et.numHorizontalGlyphVertices===0&&et.numVerticalGlyphVertices===0,hl=K||et.numIconVertices===0;if(ss||hl?hl?ss||(Jt=Jt&&qt):qt=Jt&&qt:Jt=qt=Jt&&qt,qt&&fi&&fi.box&&this.collisionIndex.insertCollisionBox(fi.box,ue,v.get("text-ignore-placement"),_.bucketInstanceId,di&&di.box&&Lr?Lr:Zr,Q.ID),Jt&&In&&this.collisionIndex.insertCollisionBox(In.box,ve,v.get("icon-ignore-placement"),_.bucketInstanceId,Xr,Q.ID),Si&&(qt&&this.collisionIndex.insertCollisionCircles(Si.circles,ue,v.get("text-ignore-placement"),_.bucketInstanceId,Zr,Q.ID),f)){const wn=_.bucketInstanceId;let ni=this.collisionCircleArrays[wn];ni===void 0&&(ni=this.collisionCircleArrays[wn]=new xr);for(let Ei=0;Ei<Si.circles.length;Ei+=4)ni.circles.push(Si.circles[Ei+0]),ni.circles.push(Si.circles[Ei+1]),ni.circles.push(Si.circles[Ei+2]),ni.circles.push(Si.collisionDetected?1:0)}if(et.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[et.crossTileID]=new vs(qt||Ge,Jt||Me,Rt||_.justReloaded),u[et.crossTileID]=!0};if(ke){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const et=_.getSortedSymbolIndexes(this.transform.angle);for(let dt=et.length-1;dt>=0;--dt){const qt=et[dt];ct(_.symbolInstances.get(qt),_.collisionArrays[qt])}}else for(let et=r.symbolInstanceStart;et<r.symbolInstanceEnd;et++)ct(_.symbolInstances.get(et),_.collisionArrays[et]);if(f&&_.bucketInstanceId in this.collisionCircleArrays){const et=this.collisionCircleArrays[_.bucketInstanceId];c.invert(et.invProjMatrix,w),et.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(r,u,f,_){let v;v=_===c.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[c.getAnchorJustification(u)];const w=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const S of w)S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=v>=0&&S!==v?0:f.crossTileID)}markUsedOrientation(r,u,f){const _=u===c.WritingMode.horizontal||u===c.WritingMode.horizontalOnly?u:0,v=u===c.WritingMode.vertical?u:0,w=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const S of w)r.text.placedSymbolArray.get(S).placedOrientation=_;f.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let f=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const _=u?u.symbolFadeChange(r):1,v=u?u.opacities:{},w=u?u.variableOffsets:{},S=u?u.placedOrientations:{};for(const I in this.placements){const L=this.placements[I],z=v[I];z?(this.opacities[I]=new wi(z,_,L.text,L.icon),f=f||L.text!==z.text.placed||L.icon!==z.icon.placed):(this.opacities[I]=new wi(null,_,L.text,L.icon,L.skipFade),f=f||L.text||L.icon)}for(const I in v){const L=v[I];if(!this.opacities[I]){const z=new wi(L,_,!1,!1);z.isHidden()||(this.opacities[I]=z,f=f||L.text.placed||L.icon.placed)}}for(const I in w)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=w[I]);for(const I in S)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=S[I]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:r)}updateLayerOpacities(r,u){const f={};for(const _ of u){const v=_.getBucket(r);v&&_.latestFeatureIndex&&r.id===v.layerIds[0]&&this.updateBucketOpacities(v,f,_.collisionBoxArray)}}updateBucketOpacities(r,u,f){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const _=r.layers[0].layout,v=new wi(null,0,!1,!1,!0),w=_.get("text-allow-overlap"),S=_.get("icon-allow-overlap"),I=_.get("text-variable-anchor"),L=_.get("text-rotation-alignment")==="map",z=_.get("text-pitch-alignment")==="map",B=_.get("icon-text-fit")!=="none",V=new wi(null,0,w&&(S||!r.hasIconData()||_.get("icon-optional")),S&&(w||!r.hasTextData()||_.get("text-optional")),!0);!r.collisionArrays&&f&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(f);const Q=(Y,K,ue)=>{for(let me=0;me<K/4;me++)Y.opacityVertexArray.emplaceBack(ue)};for(let Y=0;Y<r.symbolInstances.length;Y++){const K=r.symbolInstances.get(Y),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:me,crossTileID:ve}=K;let te=this.opacities[ve];u[ve]?te=v:te||(te=V,this.opacities[ve]=te),u[ve]=!0;const Ee=K.numIconVertices>0,xe=this.placedOrientations[K.crossTileID],Le=xe===c.WritingMode.vertical,ke=xe===c.WritingMode.horizontal||xe===c.WritingMode.horizontalOnly;if(ue>0||me>0){const Ge=de(te.text);Q(r.text,ue,Le?Pe:Ge),Q(r.text,me,ke?Pe:Ge);const Me=te.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach(dt=>{dt>=0&&(r.text.placedSymbolArray.get(dt).hidden=Me||Le?1:0)}),K.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=Me||ke?1:0);const ct=this.variableOffsets[K.crossTileID];ct&&this.markUsedJustification(r,ct.anchor,K,xe);const et=this.placedOrientations[K.crossTileID];et&&(this.markUsedJustification(r,"left",K,et),this.markUsedOrientation(r,et,K))}if(Ee){const Ge=de(te.icon),Me=!(B&&K.verticalPlacedIconSymbolIndex&&Le);K.placedIconSymbolIndex>=0&&(Q(r.icon,K.numIconVertices,Me?Ge:Pe),r.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=te.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(Q(r.icon,K.numVerticalIconVertices,Me?Pe:Ge),r.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=te.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ge=r.collisionArrays[Y];if(Ge){let Me=new c.pointGeometry(0,0);if(Ge.textBox||Ge.verticalTextBox){let et=!0;if(I){const dt=this.variableOffsets[ve];dt?(Me=xs(dt.anchor,dt.width,dt.height,dt.textOffset,dt.textBoxScale),L&&Me._rotate(z?this.transform.angle:-this.transform.angle)):et=!1}Ge.textBox&&R(r.textCollisionBox.collisionVertexArray,te.text.placed,!et||Le,Me.x,Me.y),Ge.verticalTextBox&&R(r.textCollisionBox.collisionVertexArray,te.text.placed,!et||ke,Me.x,Me.y)}const ct=Boolean(!ke&&Ge.verticalIconBox);Ge.iconBox&&R(r.iconCollisionBox.collisionVertexArray,te.icon.placed,ct,B?Me.x:0,B?Me.y:0),Ge.verticalIconBox&&R(r.iconCollisionBox.collisionVertexArray,te.icon.placed,!ct,B?Me.x:0,B?Me.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Y.invProjMatrix,r.placementViewportMatrix=Y.viewportMatrix,r.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,u){const f=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function R(m,r,u,f,_){m.emplaceBack(r?1:0,u?1:0,f||0,_||0),m.emplaceBack(r?1:0,u?1:0,f||0,_||0),m.emplaceBack(r?1:0,u?1:0,f||0,_||0),m.emplaceBack(r?1:0,u?1:0,f||0,_||0)}const F=Math.pow(2,25),q=Math.pow(2,24),W=Math.pow(2,17),oe=Math.pow(2,16),he=Math.pow(2,9),le=Math.pow(2,8),re=Math.pow(2,1);function de(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const r=m.placed?1:0,u=Math.floor(127*m.opacity);return u*F+r*q+u*W+r*oe+u*he+r*le+u*re+r}const Pe=0;class Be{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,u,f,_,v){const w=this._bucketParts;for(;this._currentTileIndex<r.length;)if(u.getBucketParts(w,_,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,I)=>S.sortKey-I.sortKey));this._currentPartIndex<w.length;)if(u.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,v())return!0;return!1}}class Ie{constructor(r,u,f,_,v,w,S,I){this.placement=new X(r,u,w,S,I),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(r,u,f){const _=c.exported.now(),v=()=>{const w=c.exported.now()-_;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=u[r[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Be(w)),this._inProgressLayer.continuePlacement(f[w.source],this.placement,this._showCollisionBoxes,w,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const mt=512/c.EXTENT/2;class vt{constructor(r,u,f){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(let _=0;_<u.length;_++){const v=u.get(_),w=v.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,r)})}}getScaledCoordinates(r,u){const f=mt/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*c.EXTENT+r.anchorX)*f),y:Math.floor((u.canonical.y*c.EXTENT+r.anchorY)*f)}}findMatches(r,u,f){const _=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let v=0;v<r.length;v++){const w=r.get(v);if(w.crossTileID)continue;const S=this.indexedSymbolInstances[w.key];if(!S)continue;const I=this.getScaledCoordinates(w,u);for(const L of S)if(Math.abs(L.coord.x-I.x)<=_&&Math.abs(L.coord.y-I.y)<=_&&!f[L.crossTileID]){f[L.crossTileID]=!0,w.crossTileID=L.crossTileID;break}}}}class nt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const u=Math.round((r-this.lng)/360);if(u!==0)for(const f in this.indexes){const _=this.indexes[f],v={};for(const w in _){const S=_[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+u),v[S.tileID.key]=S}this.indexes[f]=v}this.lng=r}addBucket(r,u,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<u.symbolInstances.length;v++)u.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const _=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>r.overscaledZ)for(const S in w){const I=w[S];I.tileID.isChildOf(r)&&I.findMatches(u.symbolInstances,r,_)}else{const S=w[r.scaledTo(Number(v)).key];S&&S.findMatches(u.symbolInstances,r,_)}}for(let v=0;v<u.symbolInstances.length;v++){const w=u.symbolInstances.get(v);w.crossTileID||(w.crossTileID=f.generate(),_[w.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new vt(r,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(r,u){for(const f in u.indexedSymbolInstances)for(const _ of u.indexedSymbolInstances[f])delete this.usedCrossTileIDs[r][_.crossTileID]}removeStaleBuckets(r){let u=!1;for(const f in this.indexes){const _=this.indexes[f];for(const v in _)r[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[v]),delete _[v],u=!0)}return u}}class St{constructor(){this.layerIndexes={},this.crossTileIDs=new nt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,u,f){let _=this.layerIndexes[r.id];_===void 0&&(_=this.layerIndexes[r.id]=new kt);let v=!1;const w={};_.handleWrapJump(f);for(const S of u){const I=S.getBucket(r);I&&r.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(S.tileID,I,this.crossTileIDs)&&(v=!0),w[I.bucketInstanceId]=!0)}return _.removeStaleBuckets(w)&&(v=!0),v}pruneUnusedLayers(r){const u={};r.forEach(f=>{u[f]=!0});for(const f in this.layerIndexes)u[f]||delete this.layerIndexes[f]}}var Yt=c.createLayout([{name:"a_pos",type:"Int16",components:2}]);class Ot extends c.Evented{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=r._cache.max,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const r in this._tiles){const u=this._tiles[r];u.textures.forEach(f=>f.destroy()),u.textures=[]}}update(r,u){this.sourceCache.update(r,u),this._renderableTilesKeys=[];for(const f of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u}))this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.posMatrix=new Float64Array(16),c.ortho(f.posMatrix,0,c.EXTENT,0,c.EXTENT,0,1),this._tiles[f.key]=new ht(f,this.tileSize))}removeOutdated(r){const u={};this.renderHistory=this.renderHistory.filter((f,_)=>this.renderHistory.indexOf(f)===_).slice(0,this.renderHistorySize);for(const f of this._renderableTilesKeys)u[f]=!0;for(const f of this.renderHistory)u[f]=!0;for(const f in this._tiles)u[f]||(this._tiles[f].clearTextures(r),delete this._tiles[f])}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const u={};for(const f of this._renderableTilesKeys){const _=this._tiles[f].tileID;if(_.canonical.equals(r.canonical)){const v=r.clone();v.posMatrix=new Float64Array(16),c.ortho(v.posMatrix,0,c.EXTENT,0,c.EXTENT,0,1),u[f]=v}else if(_.canonical.isChildOf(r.canonical)){const v=r.clone();v.posMatrix=new Float64Array(16);const w=_.canonical.z-r.canonical.z,S=_.canonical.x-(_.canonical.x>>w<<w),I=_.canonical.y-(_.canonical.y>>w<<w),L=c.EXTENT>>w;c.ortho(v.posMatrix,0,L,0,L,0,1),c.translate(v.posMatrix,v.posMatrix,[-S*L,-I*L,0]),u[f]=v}else if(r.canonical.isChildOf(_.canonical)){const v=r.clone();v.posMatrix=new Float64Array(16);const w=r.canonical.z-_.canonical.z,S=r.canonical.x-(r.canonical.x>>w<<w),I=r.canonical.y-(r.canonical.y>>w<<w),L=c.EXTENT>>w;c.ortho(v.posMatrix,0,c.EXTENT,0,c.EXTENT,0,1),c.translate(v.posMatrix,v.posMatrix,[S*L,I*L,0]),c.scale(v.posMatrix,v.posMatrix,[1/2**w,1/2**w,0]),u[f]=v}}return u}getSourceTile(r,u){const f=this.sourceCache._source;let _=r.overscaledZ-this.deltaZoom;if(_>f.maxzoom&&(_=f.maxzoom),_<f.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(_).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!v||!v.dem)&&u)for(;_>=f.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(r.scaledTo(_--).key);return v}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(u=>u.timeLoaded>=r)}}class Vt{constructor(r,u,f){this.style=r,this.sourceCache=new Ot(u),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.elevationOffset=typeof f.elevationOffset=="number"?f.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(r,u,f,_=c.EXTENT){if(!(u>=0&&u<_&&f>=0&&f<_))return this.elevationOffset;let v=0;const w=this.getTerrainData(r);if(w.tile&&w.tile.dem){const S=c.transformMat4$1([],[u/_*c.EXTENT,f/_*c.EXTENT],w.u_terrain_matrix),I=[S[0]*w.tile.dem.dim,S[1]*w.tile.dem.dim],L=[Math.floor(I[0]),Math.floor(I[1])],z=w.tile.dem.get(L[0],L[1]),B=w.tile.dem.get(L[0],L[1]+1),V=w.tile.dem.get(L[0]+1,L[1]),Q=w.tile.dem.get(L[0]+1,L[1]+1);v=c.number(c.number(z,B,I[0]-L[0]),c.number(V,Q,I[0]-L[0]),I[1]-L[1])}return v}rememberForRerender(r,u){for(const f in this.sourceCache._tiles){const _=this.sourceCache._tiles[f];(_.tileID.equals(u)||_.tileID.isChildOf(u))&&(r===this.sourceCache.sourceCache.id&&(_.timeLoaded=Date.now()),this._rerender[r]=this._rerender[r]||{},this._rerender[r][_.tileID.key]=!0)}}needsRerender(r,u){return this._rerender[r]&&this._rerender[r][u.key]}clearRerenderCache(){this._rerender={}}getElevation(r,u,f,_=c.EXTENT){return(this.getDEMElevation(r,u,f,_)+this.elevationOffset)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const _=this.style.map.painter.context,v=new c.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new se(_,v,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new se(_,new c.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.identity([])}const u=this.sourceCache.getSourceTile(r,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const _=this.style.map.painter.context;u.demTexture=this.style.map.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new se(_,u.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),u.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const f=u&&u+u.tileID.key+r.key;if(f&&!this._demMatrixCache[f]){const _=this.sourceCache.sourceCache._source.maxzoom;let v=r.canonical.z-u.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=_?v=r.canonical.z-_:c.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=r.canonical.x-(r.canonical.x>>v<<v),S=r.canonical.y-(r.canonical.y>>v<<v),I=c.fromScaling(new Float64Array(16),[1/(c.EXTENT<<v),1/(c.EXTENT<<v),0]);c.translate(I,I,[w*c.EXTENT,S*c.EXTENT,0]),this._demMatrixCache[r.key]={matrix:I,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getRTTFramebuffer(){const r=this.style.map.painter;if(!this._rttFramebuffer){const u=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=r.context.createFramebuffer(u,u,!0),this._rttFramebuffer.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,u,u))}return this._rttFramebuffer}getFramebuffer(r){const u=this.style.map.painter,f=u.width/devicePixelRatio,_=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new se(u.context,{width:f,height:_,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new se(u.context,{width:f,height:_,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(f,_,!0),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,f,_))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,w=0;v<this._coordsTextureSize;v++)for(let S=0;S<this._coordsTextureSize;S++,w+=4)u[w+0]=255&S,u[w+1]=255&v,u[w+2]=S>>8<<4|v>>8,u[w+3]=0;const f=new c.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),_=new se(r,f,r.gl.RGBA,{premultiply:!1});return _.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(r){const u=new Uint8Array(4),f=this.style.map.painter,_=f.context,v=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(r.x,f.height/devicePixelRatio-r.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null);const w=u[0]+(u[2]>>4<<8),S=u[1]+((15&u[2])<<8),I=this.coordsIndex[255-u[3]],L=I&&this.sourceCache.getTileByID(I);if(!L)return null;const z=this._coordsTextureSize,B=(1<<L.tileID.canonical.z)*z;return new c.MercatorCoordinate((L.tileID.canonical.x*z+w)/B,(L.tileID.canonical.y*z+S)/B,this.getElevation(L.tileID,w,S,z))}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.style.map.painter.context,u=new c.PosArray,f=new c.TriangleIndexArray,_=this.meshSize,v=c.EXTENT/_,w=_*_;for(let S=0;S<=_;S++)for(let I=0;I<=_;I++)u.emplaceBack(I*v,S*v);for(let S=0;S<w;S+=_+1)for(let I=0;I<_;I++)f.emplaceBack(I+S,_+I+S+1,_+I+S+2),f.emplaceBack(I+S,_+I+S+2,I+S+1);return this._mesh={indexBuffer:r.createIndexBuffer(f),vertexBuffer:r.createVertexBuffer(u,Yt.members),segments:c.SegmentVector.simpleSegment(0,0,u.length,f.length)},this._mesh}getMinMaxElevation(r){const u=this.getTerrainData(r).tile,f={minElevation:null,maxElevation:null};return u&&u.dem&&(f.minElevation=(u.dem.min+this.elevationOffset)*this.exaggeration,f.maxElevation=(u.dem.max+this.elevationOffset)*this.exaggeration),f}}const ti=(m,r)=>c.emitValidationErrors(m,r&&r.filter(u=>u.identifier!=="source.canvas")),oi=c.pick(ze,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ci=c.pick(ze,["setCenter","setZoom","setBearing","setPitch"]),Li=function(){const m={},r=c.spec.$version;for(const u in c.spec.$root){const f=c.spec.$root[u];if(f.required){let _=null;_=u==="version"?r:f.type==="array"?[]:{},_!=null&&(m[u]=_)}}return m}();class bn extends c.Evented{constructor(r,u={}){super(),this.map=r,this.dispatcher=new Mt(Fe(),this),this.imageManager=new fe,this.imageManager.setEventedParent(this),this.glyphManager=new $e(r._requestManager,u.localIdeographFontFamily),this.lineAtlas=new wt(256,512),this.crossTileSymbolIndex=new St,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const f=this;this._rtlTextPluginCallback=bn.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,w)=>{if(c.triggerPluginCompletionEvent(v),w&&w.every(S=>S))for(const S in f.sourceCaches)f.sourceCaches[S].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.sourceCaches[_.sourceId];if(!v)return;const w=v.getSource();if(w&&w.vectorLayerIds)for(const S in this._layers){const I=this._layers[S];I.source===w.id&&this._validateLayer(I)}})}loadURL(r,u={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const f=typeof u.validate!="boolean"||u.validate,_=this.map._requestManager.transformRequest(r,c.ResourceType.Style);this._request=c.getJSON(_,(v,w)=>{this._request=null,v?this.fire(new c.ErrorEvent(v)):w&&this._load(w,f)})}loadJSON(r,u={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(r,u.validate!==!1)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(Li,!1)}_load(r,u){if(u&&ti(this,c.validateStyle(r)))return;this._loaded=!0,this.stylesheet=r;for(const _ in r.sources)this.addSource(_,r.sources[_],{validate:!1});r.sprite?this._loadSprite(r.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(r.glyphs);const f=lt(this.stylesheet.layers);this._order=f.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of f)_=c.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new at(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}_loadSprite(r){this._spriteRequest=function(u,f,_,v){let w,S,I;const L=_>1?"@2x":"";let z=c.getJSON(f.transformRequest(f.normalizeSpriteURL(u,L,".json"),c.ResourceType.SpriteJSON),(Q,Y)=>{z=null,I||(I=Q,w=Y,V())}),B=c.getImage(f.transformRequest(f.normalizeSpriteURL(u,L,".png"),c.ResourceType.SpriteImage),(Q,Y)=>{B=null,I||(I=Q,S=Y,V())});function V(){if(I)v(I);else if(w&&S){const Q=c.exported.getImageData(S),Y={};for(const K in w){const{width:ue,height:me,x:ve,y:te,sdf:Ee,pixelRatio:xe,stretchX:Le,stretchY:ke,content:Ge}=w[K],Me=new c.RGBAImage({width:ue,height:me});c.RGBAImage.copy(Q,Me,{x:ve,y:te},{x:0,y:0},{width:ue,height:me}),Y[K]={data:Me,pixelRatio:xe,sdf:Ee,stretchX:Le,stretchY:ke,content:Ge}}v(null,Y)}}return{cancel(){z&&(z.cancel(),z=null),B&&(B.cancel(),B=null)}}}(r,this.map._requestManager,this.map.getPixelRatio(),(u,f)=>{if(this._spriteRequest=null,u)this.fire(new c.ErrorEvent(u));else if(f)for(const _ in f)this.imageManager.addImage(_,f[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(r){const u=this.sourceCaches[r.source];if(!u)return;const f=r.sourceLayer;if(!f)return;const _=u.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(f)===-1)&&this.fire(new c.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${_.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const u=[];for(const f of r){const _=this._layers[f];_.type!=="custom"&&u.push(_.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const u=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(const w in this._updatedSources){const S=this._updatedSources[w];if(S==="reload")this._reloadSource(w);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(w)}}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const f={};for(const _ in this.sourceCaches){const v=this.sourceCaches[_];f[_]=v.used,v.used=!1}for(const _ of this._order){const v=this._layers[_];v.recalculate(r,this._availableImages),!v.isHidden(r.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const _ in f){const v=this.sourceCaches[_];f[_]!==v.used&&v.fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(r),this.z=r.zoom,u&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(r){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),r){const u=this.sourceCaches[r.source];if(!u)throw new Error(`cannot load terrain, because there exists no source with ID: ${r.source}`);this.terrain=new Vt(this,u,r),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=f=>{f.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=f=>{f.tile&&(f.sourceId===r.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(f.sourceId,f.tile.tileID)):f.source.type==="geojson"&&this.terrain.rememberForRerender(f.sourceId,f.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new c.Event("terrain",{terrain:r}))}setState(r){if(this._checkLoaded(),ti(this,c.validateStyle(r)))return!1;(r=c.clone$1(r)).layers=lt(r.layers);const u=function(_,v){if(!_)return[{command:ze.setStyle,args:[v]}];let w=[];try{if(!k(_.version,v.version))return[{command:ze.setStyle,args:[v]}];k(_.center,v.center)||w.push({command:ze.setCenter,args:[v.center]}),k(_.zoom,v.zoom)||w.push({command:ze.setZoom,args:[v.zoom]}),k(_.bearing,v.bearing)||w.push({command:ze.setBearing,args:[v.bearing]}),k(_.pitch,v.pitch)||w.push({command:ze.setPitch,args:[v.pitch]}),k(_.sprite,v.sprite)||w.push({command:ze.setSprite,args:[v.sprite]}),k(_.glyphs,v.glyphs)||w.push({command:ze.setGlyphs,args:[v.glyphs]}),k(_.transition,v.transition)||w.push({command:ze.setTransition,args:[v.transition]}),k(_.light,v.light)||w.push({command:ze.setLight,args:[v.light]});const S={},I=[];(function(z,B,V,Q){let Y;for(Y in B=B||{},z=z||{})Object.prototype.hasOwnProperty.call(z,Y)&&(Object.prototype.hasOwnProperty.call(B,Y)||Ve(Y,V,Q));for(Y in B)Object.prototype.hasOwnProperty.call(B,Y)&&(Object.prototype.hasOwnProperty.call(z,Y)?k(z[Y],B[Y])||(z[Y].type==="geojson"&&B[Y].type==="geojson"&&Tt(z,B,Y)?V.push({command:ze.setGeoJSONSourceData,args:[Y,B[Y].data]}):Ct(Y,B,V,Q)):Xe(Y,B,V))})(_.sources,v.sources,I,S);const L=[];_.layers&&_.layers.forEach(z=>{S[z.source]?w.push({command:ze.removeLayer,args:[z.id]}):L.push(z)}),w=w.concat(I),function(z,B,V){B=B||[];const Q=(z=z||[]).map(Bt),Y=B.map(Bt),K=z.reduce(Zt,{}),ue=B.reduce(Zt,{}),me=Q.slice(),ve=Object.create(null);let te,Ee,xe,Le,ke,Ge,Me;for(te=0,Ee=0;te<Q.length;te++)xe=Q[te],Object.prototype.hasOwnProperty.call(ue,xe)?Ee++:(V.push({command:ze.removeLayer,args:[xe]}),me.splice(me.indexOf(xe,Ee),1));for(te=0,Ee=0;te<Y.length;te++)xe=Y[Y.length-1-te],me[me.length-1-te]!==xe&&(Object.prototype.hasOwnProperty.call(K,xe)?(V.push({command:ze.removeLayer,args:[xe]}),me.splice(me.lastIndexOf(xe,me.length-Ee),1)):Ee++,Ge=me[me.length-te],V.push({command:ze.addLayer,args:[ue[xe],Ge]}),me.splice(me.length-te,0,xe),ve[xe]=!0);for(te=0;te<Y.length;te++)if(xe=Y[te],Le=K[xe],ke=ue[xe],!ve[xe]&&!k(Le,ke))if(k(Le.source,ke.source)&&k(Le["source-layer"],ke["source-layer"])&&k(Le.type,ke.type)){for(Me in Pt(Le.layout,ke.layout,V,xe,null,ze.setLayoutProperty),Pt(Le.paint,ke.paint,V,xe,null,ze.setPaintProperty),k(Le.filter,ke.filter)||V.push({command:ze.setFilter,args:[xe,ke.filter]}),k(Le.minzoom,ke.minzoom)&&k(Le.maxzoom,ke.maxzoom)||V.push({command:ze.setLayerZoomRange,args:[xe,ke.minzoom,ke.maxzoom]}),Le)Object.prototype.hasOwnProperty.call(Le,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Pt(Le[Me],ke[Me],V,xe,Me.slice(6),ze.setPaintProperty):k(Le[Me],ke[Me])||V.push({command:ze.setLayerProperty,args:[xe,Me,ke[Me]]}));for(Me in ke)Object.prototype.hasOwnProperty.call(ke,Me)&&!Object.prototype.hasOwnProperty.call(Le,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Pt(Le[Me],ke[Me],V,xe,Me.slice(6),ze.setPaintProperty):k(Le[Me],ke[Me])||V.push({command:ze.setLayerProperty,args:[xe,Me,ke[Me]]}))}else V.push({command:ze.removeLayer,args:[xe]}),Ge=me[me.lastIndexOf(xe)+1],V.push({command:ze.addLayer,args:[ke,Ge]})}(L,v.layers,w)}catch(S){console.warn("Unable to compute style diff:",S),w=[{command:ze.setStyle,args:[v]}]}return w}(this.serialize(),r).filter(_=>!(_.command in Ci));if(u.length===0)return!1;const f=u.filter(_=>!(_.command in oi));if(f.length>0)throw new Error(`Unimplemented: ${f.map(_=>_.command).join(", ")}.`);return u.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=r,!0}addImage(r,u){if(this.getImage(r))return this.fire(new c.ErrorEvent(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,u),this._afterImageUpdated(r)}updateImage(r,u){this.imageManager.updateImage(r,u)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new c.ErrorEvent(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,u,f={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(c.validateStyle.source,`sources.${r}`,u,null,f))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const _=this.sourceCaches[r]=new Et(r,u,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:r})),_.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===r)return this.fire(new c.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${f}" is using it.`)));const u=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],u.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,u){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const f=this.sourceCaches[r].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(u),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,u,f={}){this._checkLoaded();const _=r.id;if(this.getLayer(_))return void this.fire(new c.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let v;if(r.type==="custom"){if(ti(this,c.validateCustomStyleLayer(r)))return;v=c.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=c.clone$1(r),r=c.extend(r,{source:_})),this._validate(c.validateStyle.layer,`layers.${_}`,r,{arrayIndex:-1},f))return;v=c.createStyleLayer(r),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize()}const w=u?this._order.indexOf(u):this._order.length;if(u&&w===-1)this.fire(new c.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${u}".`)));else{if(this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=v,this._removedLayers[_]&&v.source&&v.type!=="custom"){const S=this._removedLayers[_];delete this._removedLayers[_],S.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(r,u){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===u)return;const f=this._order.indexOf(r);this._order.splice(f,1);const _=u?this._order.indexOf(u):this._order.length;u&&_===-1?this.fire(new c.ErrorEvent(new Error(`Cannot move layer "${r}" before non-existing layer "${u}".`))):(this._order.splice(_,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const u=this._layers[r];if(!u)return void this.fire(new c.ErrorEvent(new Error(`Cannot remove non-existing layer "${r}".`)));u.setEventedParent(null);const f=this._order.indexOf(r);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=u,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],u.onRemove&&u.onRemove(this.map)}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,u,f){this._checkLoaded();const _=this.getLayer(r);_?_.minzoom===u&&_.maxzoom===f||(u!=null&&(_.minzoom=u),f!=null&&(_.maxzoom=f),this._updateLayer(_)):this.fire(new c.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,u,f={}){this._checkLoaded();const _=this.getLayer(r);if(_){if(!k(_.filter,u))return u==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(c.validateStyle.filter,`layers.${_.id}.filter`,u,null,f)||(_.filter=c.clone$1(u),this._updateLayer(_)))}else this.fire(new c.ErrorEvent(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return c.clone$1(this.getLayer(r).filter)}setLayoutProperty(r,u,f,_={}){this._checkLoaded();const v=this.getLayer(r);v?k(v.getLayoutProperty(u),f)||(v.setLayoutProperty(u,f,_),this._updateLayer(v)):this.fire(new c.ErrorEvent(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,u){const f=this.getLayer(r);if(f)return f.getLayoutProperty(u);this.fire(new c.ErrorEvent(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,u,f,_={}){this._checkLoaded();const v=this.getLayer(r);v?k(v.getPaintProperty(u),f)||(v.setPaintProperty(u,f,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new c.ErrorEvent(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,u){return this.getLayer(r).getPaintProperty(u)}setFeatureState(r,u){this._checkLoaded();const f=r.source,_=r.sourceLayer,v=this.sourceCaches[f];if(v===void 0)return void this.fire(new c.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const w=v.getSource().type;w==="geojson"&&_?this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||_?(r.id===void 0&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),v.setFeatureState(_,r.id,u)):this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,u){this._checkLoaded();const f=r.source,_=this.sourceCaches[f];if(_===void 0)return void this.fire(new c.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const v=_.getSource().type,w=v==="vector"?r.sourceLayer:void 0;v!=="vector"||w?u&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(w,r.id,u):this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const u=r.source,f=r.sourceLayer,_=this.sourceCaches[u];if(_!==void 0)return _.getSource().type!=="vector"||f?(r.id===void 0&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(f,r.id)):void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:c.mapObject(this.sourceCaches,r=>r.serialize()),layers:this._serializeLayers(this._order)},r=>r!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(r){const u=w=>this._layers[w].type==="fill-extrusion",f={},_=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(u(S)){f[S]=w;for(const I of r){const L=I[S];if(L)for(const z of L)_.push(z)}}}_.sort((w,S)=>S.intersectionZ-w.intersectionZ);const v=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(u(S))for(let I=_.length-1;I>=0;I--){const L=_[I].feature;if(f[L.layer.id]<w)break;v.push(L),_.pop()}else for(const I of r){const L=I[S];if(L)for(const z of L)v.push(z.feature)}}return v}queryRenderedFeatures(r,u,f){u&&u.filter&&this._validate(c.validateStyle.filter,"queryRenderedFeatures.filter",u.filter,null,u);const _={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const w of u.layers){const S=this._layers[w];if(!S)return this.fire(new c.ErrorEvent(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];_[S.source]=!0}}const v=[];u.availableImages=this._availableImages;for(const w in this.sourceCaches)u.layers&&!_[w]||v.push(qn(this.sourceCaches[w],this._layers,this._serializedLayers,r,u,f));return this.placement&&v.push(function(w,S,I,L,z,B,V){const Q={},Y=B.queryRenderedSymbols(L),K=[];for(const ue of Object.keys(Y).map(Number))K.push(V[ue]);K.sort(Ne);for(const ue of K){const me=ue.featureIndex.lookupSymbolFeatures(Y[ue.bucketInstanceId],S,ue.bucketIndex,ue.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const ve in me){const te=Q[ve]=Q[ve]||[],Ee=me[ve];Ee.sort((xe,Le)=>{const ke=ue.featureSortOrder;if(ke){const Ge=ke.indexOf(xe.featureIndex);return ke.indexOf(Le.featureIndex)-Ge}return Le.featureIndex-xe.featureIndex});for(const xe of Ee)te.push(xe)}}for(const ue in Q)Q[ue].forEach(me=>{const ve=me.feature,te=I[w[ue].source].getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=te});return Q}(this._layers,this._serializedLayers,this.sourceCaches,r,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,u){u&&u.filter&&this._validate(c.validateStyle.filter,"querySourceFeatures.filter",u.filter,null,u);const f=this.sourceCaches[r];return f?function(_,v){const w=_.getRenderableIds().map(L=>_.getTileByID(L)),S=[],I={};for(let L=0;L<w.length;L++){const z=w[L],B=z.tileID.canonical.key;I[B]||(I[B]=!0,z.querySourceFeatures(S,v))}return S}(f,u):[]}addSourceType(r,u,f){return bn.getSourceType(r)?f(new Error(`A source type called "${r}" already exists.`)):(bn.setSourceType(r,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:u.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(r,u={}){this._checkLoaded();const f=this.light.getLight();let _=!1;for(const w in r)if(!k(r[w],f[w])){_=!0;break}if(!_)return;const v={now:c.exported.now(),transition:c.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,u),this.light.updateTransitions(v)}_validate(r,u,f,_,v={}){return(!v||v.validate!==!1)&&ti(this,r.call(c.validateStyle,c.extend({key:u,style:this.serialize(),value:f,styleSpec:c.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const u=this.sourceCaches[r];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const u in this.sourceCaches)this.sourceCaches[u].update(r,this.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,u,f,_,v=!1){let w=!1,S=!1;const I={};for(const L of this._order){const z=this._layers[L];if(z.type!=="symbol")continue;if(!I[z.source]){const V=this.sourceCaches[z.source];I[z.source]=V.getRenderableIds(!0).map(Q=>V.getTileByID(Q)).sort((Q,Y)=>Y.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(Y.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(z,I[z.source],r.center.lng);w=w||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),r.zoom))&&(this.pauseablePlacement=new Ie(r,this.terrain,this._order,v,u,f,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w)for(const L of this._order){const z=this._layers[L];z.type==="symbol"&&this.placement.updateLayerOpacities(z,I[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,u,f){this.imageManager.getImages(u.icons,f),this._updateTilesForChangedImages();const _=this.sourceCaches[u.source];_&&_.setDependencies(u.tileID.key,u.type,u.icons)}getGlyphs(r,u,f){this.glyphManager.getGlyphs(u.stacks,f)}getResource(r,u,f){return c.makeRequest(u,f)}}bn.getSourceType=function(m){return Ri[m]},bn.setSourceType=function(m,r){Ri[m]=r},bn.registerForPluginStateChange=c.registerForPluginStateChange;var Pr="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Dn={prelude:_i(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:_i(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:_i(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:_i(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:_i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:_i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:_i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:_i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:_i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:_i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:_i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:_i(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:_i(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:_i(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:_i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:_i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:_i(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:_i(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:_i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:_i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:_i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:_i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:_i("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Pr),terrainDepth:_i("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Pr),terrainCoords:_i("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Pr)};function _i(m,r){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=r.match(/attribute ([\w]+) ([\w]+)/g),_=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v?v.concat(_):_,S={};return{fragmentSource:m=m.replace(u,(I,L,z,B,V)=>(S[V]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${V}
varying ${z} ${B} ${V};
#else
uniform ${z} ${B} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${z} ${B} ${V} = u_${V};
#endif
`)),vertexSource:r=r.replace(u,(I,L,z,B,V)=>{const Q=B==="float"?"vec2":"vec4",Y=V.match(/color/)?"color":Q;return S[V]?L==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${z} ${Q} a_${V};
varying ${z} ${B} ${V};
#else
uniform ${z} ${B} u_${V};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${z} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${Y}(a_${V}, u_${V}_t);
#else
    ${z} ${B} ${V} = u_${V};
#endif
`:L==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${z} ${Q} a_${V};
#else
uniform ${z} ${B} u_${V};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${B} ${V} = a_${V};
#else
    ${z} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${B} ${V} = unpack_mix_${Y}(a_${V}, u_${V}_t);
#else
    ${z} ${B} ${V} = u_${V};
#endif
`}),staticAttributes:f,staticUniforms:w}}class $s{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,u,f,_,v,w,S,I,L){this.context=r;let z=this.boundPaintVertexBuffers.length!==_.length;for(let B=0;!z&&B<_.length;B++)this.boundPaintVertexBuffers[B]!==_[B]&&(z=!0);r.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===f&&!z&&this.boundIndexBuffer===v&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===I&&this.boundDynamicVertexBuffer3===L?(r.bindVertexArrayOES.set(this.vao),S&&S.bind(),v&&v.dynamicDraw&&v.bind(),I&&I.bind(),L&&L.bind()):this.freshBind(u,f,_,v,w,S,I,L)}freshBind(r,u,f,_,v,w,S,I){let L;const z=r.numAttributes,B=this.context,V=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=r,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=I;else{L=B.currentNumAttributes||0;for(let Q=z;Q<L;Q++)V.disableVertexAttribArray(Q)}u.enableAttributes(V,r);for(const Q of f)Q.enableAttributes(V,r);w&&w.enableAttributes(V,r),S&&S.enableAttributes(V,r),I&&I.enableAttributes(V,r),u.bind(),u.setVertexAttribPointers(V,r,v);for(const Q of f)Q.bind(),Q.setVertexAttribPointers(V,r,v);w&&(w.bind(),w.setVertexAttribPointers(V,r,v)),_&&_.bind(),S&&(S.bind(),S.setVertexAttribPointers(V,r,v)),I&&(I.bind(),I.setVertexAttribPointers(V,r,v)),B.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Hs(m){const r=[];for(let u=0;u<m.length;u++){if(m[u]===null)continue;const f=m[u].split(" ");r.push(f.pop())}return r}class vo{constructor(r,u,f,_,v,w,S){const I=r.gl;this.program=I.createProgram();const L=Hs(f.staticAttributes),z=_?_.getBinderAttributes():[],B=L.concat(z),V=Dn.prelude.staticUniforms?Hs(Dn.prelude.staticUniforms):[],Q=f.staticUniforms?Hs(f.staticUniforms):[],Y=_?_.getBinderUniforms():[],K=V.concat(Q).concat(Y),ue=[];for(const ke of K)ue.indexOf(ke)<0&&ue.push(ke);const me=_?_.defines():[];w&&me.push("#define OVERDRAW_INSPECTOR;"),S&&me.push("#define TERRAIN3D;");const ve=me.concat(Dn.prelude.fragmentSource,f.fragmentSource).join(`
`),te=me.concat(Dn.prelude.vertexSource,f.vertexSource).join(`
`),Ee=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Ee,ve),I.compileShader(Ee),I.attachShader(this.program,Ee);const xe=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(xe,te),I.compileShader(xe),I.attachShader(this.program,xe),this.attributes={};const Le={};this.numAttributes=B.length;for(let ke=0;ke<this.numAttributes;ke++)B[ke]&&(I.bindAttribLocation(this.program,ke,B[ke]),this.attributes[B[ke]]=ke);I.linkProgram(this.program),I.deleteShader(xe),I.deleteShader(Ee);for(let ke=0;ke<ue.length;ke++){const Ge=ue[ke];if(Ge&&!Le[Ge]){const Me=I.getUniformLocation(this.program,Ge);Me&&(Le[Ge]=Me)}}this.fixedUniforms=v(r,Le),this.terrainUniforms=((ke,Ge)=>({u_depth:new c.Uniform1i(ke,Ge.u_depth),u_terrain:new c.Uniform1i(ke,Ge.u_terrain),u_terrain_dim:new c.Uniform1f(ke,Ge.u_terrain_dim),u_terrain_matrix:new c.UniformMatrix4f(ke,Ge.u_terrain_matrix),u_terrain_unpack:new c.Uniform4f(ke,Ge.u_terrain_unpack),u_terrain_offset:new c.Uniform1f(ke,Ge.u_terrain_offset),u_terrain_exaggeration:new c.Uniform1f(ke,Ge.u_terrain_exaggeration)}))(r,Le),this.binderUniforms=_?_.getUniforms(r,Le):[]}draw(r,u,f,_,v,w,S,I,L,z,B,V,Q,Y,K,ue,me,ve){const te=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(f),r.setStencilMode(_),r.setColorMode(v),r.setCullFace(w),I){r.activeTexture.set(te.TEXTURE2),te.bindTexture(te.TEXTURE_2D,I.depthTexture),r.activeTexture.set(te.TEXTURE3),te.bindTexture(te.TEXTURE_2D,I.texture);for(const xe in this.terrainUniforms)this.terrainUniforms[xe].set(I[xe])}for(const xe in this.fixedUniforms)this.fixedUniforms[xe].set(S[xe]);K&&K.setUniforms(r,this.binderUniforms,Q,{zoom:Y});let Ee=0;switch(u){case te.LINES:Ee=2;break;case te.TRIANGLES:Ee=3;break;case te.LINE_STRIP:Ee=1}for(const xe of V.get()){const Le=xe.vaos||(xe.vaos={});(Le[L]||(Le[L]=new $s)).bind(r,this,z,K?K.getPaintVertexBuffers():[],B,xe.vertexOffset,ue,me,ve),te.drawElements(u,xe.primitiveLength*Ee,te.UNSIGNED_SHORT,xe.primitiveOffset*Ee*2)}}}function xo(m,r,u){const f=1/tn(u,1,r.transform.tileZoom),_=Math.pow(2,u.tileID.overscaledZ),v=u.tileSize*Math.pow(2,r.transform.tileZoom)/_,w=v*(u.tileID.canonical.x+u.tileID.wrap*_),S=v*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[f,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const bs=(m,r,u,f)=>{const _=r.style.light,v=_.properties.get("position"),w=[v.x,v.y,v.z],S=c.create$1();_.properties.get("anchor")==="viewport"&&c.fromRotation(S,-r.transform.angle),c.transformMat3(w,w,S);const I=_.properties.get("color");return{u_matrix:m,u_lightpos:w,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+u,u_opacity:f}},Mr=(m,r,u,f,_,v,w)=>c.extend(bs(m,r,u,f),xo(v,r,w),{u_height_factor:-Math.pow(2,_.overscaledZ)/w.tileSize/8}),bo=m=>({u_matrix:m}),wo=(m,r,u,f)=>c.extend(bo(m),xo(u,r,f)),Eo=(m,r)=>({u_matrix:m,u_world:r}),na=(m,r,u,f,_)=>c.extend(wo(m,r,u,f),{u_world:_}),Xa=(m,r,u,f)=>{const _=m.transform;let v,w;if(f.paint.get("circle-pitch-alignment")==="map"){const S=tn(u,1,_.zoom);v=!0,w=[S,S]}else v=!1,w=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(r.posMatrix,u,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:w}},is=(m,r,u)=>{const f=tn(u,1,r.zoom),_=Math.pow(2,r.zoom-u.tileID.overscaledZ),v=u.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[r.pixelsToGLUnits[0]/(f*_),r.pixelsToGLUnits[1]/(f*_)],u_overscale_factor:v}},j=(m,r,u=1)=>({u_matrix:m,u_color:r,u_overlay:0,u_overlay_scale:u}),Z=m=>({u_matrix:m}),ae=(m,r,u,f)=>({u_matrix:m,u_extrude_scale:tn(r,1,u),u_intensity:f});function Ae(m,r){const u=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new c.MercatorCoordinate(0,f/u).toLngLat().lat,new c.MercatorCoordinate(0,(f+1)/u).toLngLat().lat]}const He=(m,r,u,f)=>{const _=m.transform;return{u_matrix:hn(m,r,u,f),u_ratio:1/tn(r,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},_t=(m,r,u,f,_)=>c.extend(He(m,r,u,_),{u_image:0,u_image_height:f}),ii=(m,r,u,f,_)=>{const v=m.transform,w=Kt(r,v);return{u_matrix:hn(m,r,u,_),u_texsize:r.imageAtlasTexture.size,u_ratio:1/tn(r,1,v.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[w,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Wi=(m,r,u,f,_,v)=>{const w=m.lineAtlas,S=Kt(r,m.transform),I=u.layout.get("line-cap")==="round",L=w.getDash(f.from,I),z=w.getDash(f.to,I),B=L.width*_.fromScale,V=z.width*_.toScale;return c.extend(He(m,r,u,v),{u_patternscale_a:[S/B,-L.height/2],u_patternscale_b:[S/V,-z.height/2],u_sdfgamma:w.width/(256*Math.min(B,V)*m.pixelRatio)/2,u_image:0,u_tex_y_a:L.y,u_tex_y_b:z.y,u_mix:_.t})};function Kt(m,r){return 1/tn(m,1,r.tileZoom)}function hn(m,r,u,f){return m.translatePosMatrix(f?f.posMatrix:r.tileID.posMatrix,r,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const ar=(m,r,u,f,_)=>{return{u_matrix:m,u_tl_parent:r,u_scale_parent:u,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(w=_.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(v=_.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Ku(_.paint.get("raster-hue-rotate"))};var v,w};function Ku(m){m*=Math.PI/180;const r=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*r-u+1)/3,(Math.sqrt(3)*r-u+1)/3]}const uc=(m,r,u,f,_,v,w,S,I,L)=>{const z=_.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:z.width/z.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+I,u_pitch_with_map:+f,u_texsize:L,u_texture:0}},Ya=(m,r,u,f,_,v,w,S,I,L,z)=>{const B=_.transform;return c.extend(uc(m,r,u,f,_,v,w,S,I,L),{u_gamma_scale:f?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+z})},Ju=(m,r,u,f,_,v,w,S,I,L)=>c.extend(Ya(m,r,u,f,_,v,w,S,!0,I,!0),{u_texsize_icon:L,u_texture_icon:1}),pf=(m,r,u)=>({u_matrix:m,u_opacity:r,u_color:u}),mf=(m,r,u,f,_,v)=>c.extend(function(w,S,I,L){const z=I.imageManager.getPattern(w.from.toString()),B=I.imageManager.getPattern(w.to.toString()),{width:V,height:Q}=I.imageManager.getPixelSize(),Y=Math.pow(2,L.tileID.overscaledZ),K=L.tileSize*Math.pow(2,I.transform.tileZoom)/Y,ue=K*(L.tileID.canonical.x+L.tileID.wrap*Y),me=K*L.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[V,Q],u_mix:S.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/tn(L,1,I.transform.tileZoom),u_pixel_coord_upper:[ue>>16,me>>16],u_pixel_coord_lower:[65535&ue,65535&me]}}(f,v,u,_),{u_matrix:m,u_opacity:r}),hc={fillExtrusion:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_lightpos:new c.Uniform3f(m,r.u_lightpos),u_lightintensity:new c.Uniform1f(m,r.u_lightintensity),u_lightcolor:new c.Uniform3f(m,r.u_lightcolor),u_vertical_gradient:new c.Uniform1f(m,r.u_vertical_gradient),u_opacity:new c.Uniform1f(m,r.u_opacity)}),fillExtrusionPattern:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_lightpos:new c.Uniform3f(m,r.u_lightpos),u_lightintensity:new c.Uniform1f(m,r.u_lightintensity),u_lightcolor:new c.Uniform3f(m,r.u_lightcolor),u_vertical_gradient:new c.Uniform1f(m,r.u_vertical_gradient),u_height_factor:new c.Uniform1f(m,r.u_height_factor),u_image:new c.Uniform1i(m,r.u_image),u_texsize:new c.Uniform2f(m,r.u_texsize),u_pixel_coord_upper:new c.Uniform2f(m,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(m,r.u_pixel_coord_lower),u_scale:new c.Uniform3f(m,r.u_scale),u_fade:new c.Uniform1f(m,r.u_fade),u_opacity:new c.Uniform1f(m,r.u_opacity)}),fill:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix)}),fillPattern:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_image:new c.Uniform1i(m,r.u_image),u_texsize:new c.Uniform2f(m,r.u_texsize),u_pixel_coord_upper:new c.Uniform2f(m,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(m,r.u_pixel_coord_lower),u_scale:new c.Uniform3f(m,r.u_scale),u_fade:new c.Uniform1f(m,r.u_fade)}),fillOutline:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_world:new c.Uniform2f(m,r.u_world)}),fillOutlinePattern:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_world:new c.Uniform2f(m,r.u_world),u_image:new c.Uniform1i(m,r.u_image),u_texsize:new c.Uniform2f(m,r.u_texsize),u_pixel_coord_upper:new c.Uniform2f(m,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(m,r.u_pixel_coord_lower),u_scale:new c.Uniform3f(m,r.u_scale),u_fade:new c.Uniform1f(m,r.u_fade)}),circle:(m,r)=>({u_camera_to_center_distance:new c.Uniform1f(m,r.u_camera_to_center_distance),u_scale_with_map:new c.Uniform1i(m,r.u_scale_with_map),u_pitch_with_map:new c.Uniform1i(m,r.u_pitch_with_map),u_extrude_scale:new c.Uniform2f(m,r.u_extrude_scale),u_device_pixel_ratio:new c.Uniform1f(m,r.u_device_pixel_ratio),u_matrix:new c.UniformMatrix4f(m,r.u_matrix)}),collisionBox:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_camera_to_center_distance:new c.Uniform1f(m,r.u_camera_to_center_distance),u_pixels_to_tile_units:new c.Uniform1f(m,r.u_pixels_to_tile_units),u_extrude_scale:new c.Uniform2f(m,r.u_extrude_scale),u_overscale_factor:new c.Uniform1f(m,r.u_overscale_factor)}),collisionCircle:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_inv_matrix:new c.UniformMatrix4f(m,r.u_inv_matrix),u_camera_to_center_distance:new c.Uniform1f(m,r.u_camera_to_center_distance),u_viewport_size:new c.Uniform2f(m,r.u_viewport_size)}),debug:(m,r)=>({u_color:new c.UniformColor(m,r.u_color),u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_overlay:new c.Uniform1i(m,r.u_overlay),u_overlay_scale:new c.Uniform1f(m,r.u_overlay_scale)}),clippingMask:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix)}),heatmap:(m,r)=>({u_extrude_scale:new c.Uniform1f(m,r.u_extrude_scale),u_intensity:new c.Uniform1f(m,r.u_intensity),u_matrix:new c.UniformMatrix4f(m,r.u_matrix)}),heatmapTexture:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_world:new c.Uniform2f(m,r.u_world),u_image:new c.Uniform1i(m,r.u_image),u_color_ramp:new c.Uniform1i(m,r.u_color_ramp),u_opacity:new c.Uniform1f(m,r.u_opacity)}),hillshade:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_image:new c.Uniform1i(m,r.u_image),u_latrange:new c.Uniform2f(m,r.u_latrange),u_light:new c.Uniform2f(m,r.u_light),u_shadow:new c.UniformColor(m,r.u_shadow),u_highlight:new c.UniformColor(m,r.u_highlight),u_accent:new c.UniformColor(m,r.u_accent)}),hillshadePrepare:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_image:new c.Uniform1i(m,r.u_image),u_dimension:new c.Uniform2f(m,r.u_dimension),u_zoom:new c.Uniform1f(m,r.u_zoom),u_unpack:new c.Uniform4f(m,r.u_unpack)}),line:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_ratio:new c.Uniform1f(m,r.u_ratio),u_device_pixel_ratio:new c.Uniform1f(m,r.u_device_pixel_ratio),u_units_to_pixels:new c.Uniform2f(m,r.u_units_to_pixels)}),lineGradient:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_ratio:new c.Uniform1f(m,r.u_ratio),u_device_pixel_ratio:new c.Uniform1f(m,r.u_device_pixel_ratio),u_units_to_pixels:new c.Uniform2f(m,r.u_units_to_pixels),u_image:new c.Uniform1i(m,r.u_image),u_image_height:new c.Uniform1f(m,r.u_image_height)}),linePattern:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_texsize:new c.Uniform2f(m,r.u_texsize),u_ratio:new c.Uniform1f(m,r.u_ratio),u_device_pixel_ratio:new c.Uniform1f(m,r.u_device_pixel_ratio),u_image:new c.Uniform1i(m,r.u_image),u_units_to_pixels:new c.Uniform2f(m,r.u_units_to_pixels),u_scale:new c.Uniform3f(m,r.u_scale),u_fade:new c.Uniform1f(m,r.u_fade)}),lineSDF:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_ratio:new c.Uniform1f(m,r.u_ratio),u_device_pixel_ratio:new c.Uniform1f(m,r.u_device_pixel_ratio),u_units_to_pixels:new c.Uniform2f(m,r.u_units_to_pixels),u_patternscale_a:new c.Uniform2f(m,r.u_patternscale_a),u_patternscale_b:new c.Uniform2f(m,r.u_patternscale_b),u_sdfgamma:new c.Uniform1f(m,r.u_sdfgamma),u_image:new c.Uniform1i(m,r.u_image),u_tex_y_a:new c.Uniform1f(m,r.u_tex_y_a),u_tex_y_b:new c.Uniform1f(m,r.u_tex_y_b),u_mix:new c.Uniform1f(m,r.u_mix)}),raster:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_tl_parent:new c.Uniform2f(m,r.u_tl_parent),u_scale_parent:new c.Uniform1f(m,r.u_scale_parent),u_buffer_scale:new c.Uniform1f(m,r.u_buffer_scale),u_fade_t:new c.Uniform1f(m,r.u_fade_t),u_opacity:new c.Uniform1f(m,r.u_opacity),u_image0:new c.Uniform1i(m,r.u_image0),u_image1:new c.Uniform1i(m,r.u_image1),u_brightness_low:new c.Uniform1f(m,r.u_brightness_low),u_brightness_high:new c.Uniform1f(m,r.u_brightness_high),u_saturation_factor:new c.Uniform1f(m,r.u_saturation_factor),u_contrast_factor:new c.Uniform1f(m,r.u_contrast_factor),u_spin_weights:new c.Uniform3f(m,r.u_spin_weights)}),symbolIcon:(m,r)=>({u_is_size_zoom_constant:new c.Uniform1i(m,r.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(m,r.u_is_size_feature_constant),u_size_t:new c.Uniform1f(m,r.u_size_t),u_size:new c.Uniform1f(m,r.u_size),u_camera_to_center_distance:new c.Uniform1f(m,r.u_camera_to_center_distance),u_pitch:new c.Uniform1f(m,r.u_pitch),u_rotate_symbol:new c.Uniform1i(m,r.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(m,r.u_aspect_ratio),u_fade_change:new c.Uniform1f(m,r.u_fade_change),u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(m,r.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(m,r.u_coord_matrix),u_is_text:new c.Uniform1i(m,r.u_is_text),u_pitch_with_map:new c.Uniform1i(m,r.u_pitch_with_map),u_texsize:new c.Uniform2f(m,r.u_texsize),u_texture:new c.Uniform1i(m,r.u_texture)}),symbolSDF:(m,r)=>({u_is_size_zoom_constant:new c.Uniform1i(m,r.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(m,r.u_is_size_feature_constant),u_size_t:new c.Uniform1f(m,r.u_size_t),u_size:new c.Uniform1f(m,r.u_size),u_camera_to_center_distance:new c.Uniform1f(m,r.u_camera_to_center_distance),u_pitch:new c.Uniform1f(m,r.u_pitch),u_rotate_symbol:new c.Uniform1i(m,r.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(m,r.u_aspect_ratio),u_fade_change:new c.Uniform1f(m,r.u_fade_change),u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(m,r.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(m,r.u_coord_matrix),u_is_text:new c.Uniform1i(m,r.u_is_text),u_pitch_with_map:new c.Uniform1i(m,r.u_pitch_with_map),u_texsize:new c.Uniform2f(m,r.u_texsize),u_texture:new c.Uniform1i(m,r.u_texture),u_gamma_scale:new c.Uniform1f(m,r.u_gamma_scale),u_device_pixel_ratio:new c.Uniform1f(m,r.u_device_pixel_ratio),u_is_halo:new c.Uniform1i(m,r.u_is_halo)}),symbolTextAndIcon:(m,r)=>({u_is_size_zoom_constant:new c.Uniform1i(m,r.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(m,r.u_is_size_feature_constant),u_size_t:new c.Uniform1f(m,r.u_size_t),u_size:new c.Uniform1f(m,r.u_size),u_camera_to_center_distance:new c.Uniform1f(m,r.u_camera_to_center_distance),u_pitch:new c.Uniform1f(m,r.u_pitch),u_rotate_symbol:new c.Uniform1i(m,r.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(m,r.u_aspect_ratio),u_fade_change:new c.Uniform1f(m,r.u_fade_change),u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(m,r.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(m,r.u_coord_matrix),u_is_text:new c.Uniform1i(m,r.u_is_text),u_pitch_with_map:new c.Uniform1i(m,r.u_pitch_with_map),u_texsize:new c.Uniform2f(m,r.u_texsize),u_texsize_icon:new c.Uniform2f(m,r.u_texsize_icon),u_texture:new c.Uniform1i(m,r.u_texture),u_texture_icon:new c.Uniform1i(m,r.u_texture_icon),u_gamma_scale:new c.Uniform1f(m,r.u_gamma_scale),u_device_pixel_ratio:new c.Uniform1f(m,r.u_device_pixel_ratio),u_is_halo:new c.Uniform1i(m,r.u_is_halo)}),background:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_opacity:new c.Uniform1f(m,r.u_opacity),u_color:new c.UniformColor(m,r.u_color)}),backgroundPattern:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_opacity:new c.Uniform1f(m,r.u_opacity),u_image:new c.Uniform1i(m,r.u_image),u_pattern_tl_a:new c.Uniform2f(m,r.u_pattern_tl_a),u_pattern_br_a:new c.Uniform2f(m,r.u_pattern_br_a),u_pattern_tl_b:new c.Uniform2f(m,r.u_pattern_tl_b),u_pattern_br_b:new c.Uniform2f(m,r.u_pattern_br_b),u_texsize:new c.Uniform2f(m,r.u_texsize),u_mix:new c.Uniform1f(m,r.u_mix),u_pattern_size_a:new c.Uniform2f(m,r.u_pattern_size_a),u_pattern_size_b:new c.Uniform2f(m,r.u_pattern_size_b),u_scale_a:new c.Uniform1f(m,r.u_scale_a),u_scale_b:new c.Uniform1f(m,r.u_scale_b),u_pixel_coord_upper:new c.Uniform2f(m,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(m,r.u_pixel_coord_lower),u_tile_units_to_pixels:new c.Uniform1f(m,r.u_tile_units_to_pixels)}),terrain:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_texture:new c.Uniform1i(m,r.u_texture)}),terrainDepth:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix)}),terrainCoords:(m,r)=>({u_matrix:new c.UniformMatrix4f(m,r.u_matrix),u_texture:new c.Uniform1i(m,r.u_texture),u_terrain_coords_id:new c.Uniform1f(m,r.u_terrain_coords_id)})};class dc{constructor(r,u,f){this.context=r;const _=r.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pc{constructor(r,u,f,_){this.length=u.length,this.attributes=f,this.itemSize=u.bytesPerElement,this.dynamicDraw=_,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),r.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,u){for(let f=0;f<this.attributes.length;f++){const _=u.attributes[this.attributes[f].name];_!==void 0&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,u,f){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],w=u.attributes[v.name];w!==void 0&&r.vertexAttribPointer(w,v.components,r[fc[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vi{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qu extends vi{getDefault(){return c.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class gf extends vi{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class ra extends vi{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class sa extends vi{getDefault(){return[!0,!0,!0,!0]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class eh extends vi{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class lr extends vi{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class mc extends vi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const u=this.current;(r.func!==u.func||r.ref!==u.ref||r.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Ka extends vi{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Ja extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=r,this.dirty=!1}}class gc extends vi{getDefault(){return[0,1]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class _c extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=r,this.dirty=!1}}class Qa extends vi{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class yc extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.BLEND):u.disable(u.BLEND),this.current=r,this.dirty=!1}}class vc extends vi{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class el extends vi{getDefault(){return c.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class th extends vi{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class ih extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=r,this.dirty=!1}}class To extends vi{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class _f extends vi{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class yf extends vi{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class vf extends vi{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class xf extends vi{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class bf extends vi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class wf extends vi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class xc extends vi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class tl extends vi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class bc extends vi{getDefault(){return null}set(r){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class wc extends vi{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Ao extends vi{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class nh extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class rh extends vi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class il extends vi{constructor(r,u){super(r),this.context=r,this.parent=u}getDefault(){return null}}class qs extends il{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class sh extends il{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class So{constructor(r,u,f,_){this.context=r,this.width=u,this.height=f;const v=r.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new qs(r,w),_&&(this.depthAttachment=new sh(r,w)),v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,u=this.colorAttachment.get();if(u&&r.deleteTexture(u),this.depthAttachment){const f=this.depthAttachment.get();f&&r.deleteRenderbuffer(f)}r.deleteFramebuffer(this.framebuffer)}}class Ni{constructor(r,u,f){this.blendFunction=r,this.blendColor=u,this.mask=f}}Ni.Replace=[1,0],Ni.disabled=new Ni(Ni.Replace,c.Color.transparent,[!1,!1,!1,!1]),Ni.unblended=new Ni(Ni.Replace,c.Color.transparent,[!0,!0,!0,!0]),Ni.alphaBlended=new Ni([1,771],c.Color.transparent,[!0,!0,!0,!0]);class oh{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Qu(this),this.clearDepth=new gf(this),this.clearStencil=new ra(this),this.colorMask=new sa(this),this.depthMask=new eh(this),this.stencilMask=new lr(this),this.stencilFunc=new mc(this),this.stencilOp=new Ka(this),this.stencilTest=new Ja(this),this.depthRange=new gc(this),this.depthTest=new _c(this),this.depthFunc=new Qa(this),this.blend=new yc(this),this.blendFunc=new vc(this),this.blendColor=new el(this),this.blendEquation=new th(this),this.cullFace=new ih(this),this.cullFaceSide=new To(this),this.frontFace=new _f(this),this.program=new yf(this),this.activeTexture=new vf(this),this.viewport=new xf(this),this.bindFramebuffer=new bf(this),this.bindRenderbuffer=new wf(this),this.bindTexture=new xc(this),this.bindVertexBuffer=new tl(this),this.bindElementBuffer=new bc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new wc(this),this.pixelStoreUnpack=new Ao(this),this.pixelStoreUnpackPremultiplyAlpha=new nh(this),this.pixelStoreUnpackFlipY=new rh(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,u){return new dc(this,r,u)}createVertexBuffer(r,u,f){return new pc(this,r,u,f)}createRenderbuffer(r,u,f){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,r,u,f),this.bindRenderbuffer.set(null),v}createFramebuffer(r,u,f){return new So(this,r,u,f)}clear({color:r,depth:u}){const f=this.gl;let _=0;r&&(_|=f.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(_|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),f.clear(_)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){k(r.blendFunction,Ni.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ui{constructor(r,u,f){this.func=r,this.mask=u,this.range=f}}ui.ReadOnly=!1,ui.ReadWrite=!0,ui.disabled=new ui(519,ui.ReadOnly,[0,1]);const xi=7680;class Di{constructor(r,u,f,_,v,w){this.test=r,this.ref=u,this.mask=f,this.fail=_,this.depthFail=v,this.pass=w}}Di.disabled=new Di({func:519,mask:0},0,0,xi,xi,xi);class ji{constructor(r,u,f){this.enable=r,this.mode=u,this.frontFace=f}}let oa;function Io(m,r,u,f,_,v,w){const S=m.context,I=S.gl,L=m.useProgram("collisionBox"),z=[];let B=0,V=0;for(let te=0;te<f.length;te++){const Ee=f[te],xe=r.getTile(Ee),Le=xe.getBucket(u);if(!Le)continue;let ke=Ee.posMatrix;_[0]===0&&_[1]===0||(ke=m.translatePosMatrix(Ee.posMatrix,xe,_,v));const Ge=w?Le.textCollisionBox:Le.iconCollisionBox,Me=Le.collisionCircleArray;if(Me.length>0){const ct=c.create(),et=ke;c.mul(ct,Le.placementInvProjMatrix,m.transform.glCoordMatrix),c.mul(ct,ct,Le.placementViewportMatrix),z.push({circleArray:Me,circleOffset:V,transform:et,invTransform:ct,coord:Ee}),B+=Me.length/4,V=B}Ge&&L.draw(S,I.LINES,ui.disabled,Di.disabled,m.colorModeForRenderPass(),ji.disabled,is(ke,m.transform,xe),m.style.terrain&&m.style.terrain.getTerrainData(Ee),u.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,null,m.transform.zoom,null,null,Ge.collisionVertexBuffer)}if(!w||!z.length)return;const Q=m.useProgram("collisionCircle"),Y=new c.CollisionCircleLayoutArray;Y.resize(4*B),Y._trim();let K=0;for(const te of z)for(let Ee=0;Ee<te.circleArray.length/4;Ee++){const xe=4*Ee,Le=te.circleArray[xe+0],ke=te.circleArray[xe+1],Ge=te.circleArray[xe+2],Me=te.circleArray[xe+3];Y.emplace(K++,Le,ke,Ge,Me,0),Y.emplace(K++,Le,ke,Ge,Me,1),Y.emplace(K++,Le,ke,Ge,Me,2),Y.emplace(K++,Le,ke,Ge,Me,3)}(!oa||oa.length<2*B)&&(oa=function(te){const Ee=2*te,xe=new c.QuadTriangleArray;xe.resize(Ee),xe._trim();for(let Le=0;Le<Ee;Le++){const ke=6*Le;xe.uint16[ke+0]=4*Le+0,xe.uint16[ke+1]=4*Le+1,xe.uint16[ke+2]=4*Le+2,xe.uint16[ke+3]=4*Le+2,xe.uint16[ke+4]=4*Le+3,xe.uint16[ke+5]=4*Le+0}return xe}(B));const ue=S.createIndexBuffer(oa,!0),me=S.createVertexBuffer(Y,c.collisionCircleLayout.members,!0);for(const te of z){const Ee={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(ve=m.transform).cameraToCenterDistance,u_viewport_size:[ve.width,ve.height]};Q.draw(S,I.TRIANGLES,ui.disabled,Di.disabled,m.colorModeForRenderPass(),ji.disabled,Ee,m.style.terrain&&m.style.terrain.getTerrainData(te.coord),u.id,me,ue,c.SegmentVector.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,m.transform.zoom,null,null,null)}var ve;me.destroy(),ue.destroy()}ji.disabled=new ji(!1,1029,2305),ji.backCCW=new ji(!0,1029,2305);const Ef=c.identity(new Float32Array(16));function Tf(m,r,u,f,_,v){const{horizontalAlign:w,verticalAlign:S}=c.getAnchorAlignment(m),I=-(w-.5)*r,L=-(S-.5)*u,z=c.evaluateVariableOffset(m,f);return new c.pointGeometry((I/_+z[0])*v,(L/_+z[1])*v)}function ah(m,r,u,f,_,v,w,S,I,L,z){const B=m.text.placedSymbolArray,V=m.text.dynamicLayoutVertexArray,Q=m.icon.dynamicLayoutVertexArray,Y={};V.clear();for(let K=0;K<B.length;K++){const ue=B.get(K),me=m.allowVerticalPlacement&&!ue.placedOrientation,ve=ue.hidden||!ue.crossTileID||me?null:f[ue.crossTileID];if(ve){const te=new c.pointGeometry(ue.anchorX,ue.anchorY),Ee=Xt(te,u?w:v,z),xe=fn(_.cameraToCenterDistance,Ee.signedDistanceFromCamera);let Le=c.evaluateSizeForFeature(m.textSizeData,I,ue)*xe/c.ONE_EM;u&&(Le*=m.tilePixelRatio/S);const{width:ke,height:Ge,anchor:Me,textOffset:ct,textBoxScale:et}=ve,dt=Tf(Me,ke,Ge,ct,et,Le),qt=u?Xt(te.add(dt),v,z).point:Ee.point.add(r?dt.rotate(-_.angle):dt),Jt=m.allowVerticalPlacement&&ue.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let Rt=0;Rt<ue.numGlyphs;Rt++)c.addDynamicAttributes(V,qt,Jt);L&&ue.associatedIconIndex>=0&&(Y[ue.associatedIconIndex]={shiftedAnchor:qt,angle:Jt})}else jt(ue.numGlyphs,V)}if(L){Q.clear();const K=m.icon.placedSymbolArray;for(let ue=0;ue<K.length;ue++){const me=K.get(ue);if(me.hidden)jt(me.numGlyphs,Q);else{const ve=Y[ue];if(ve)for(let te=0;te<me.numGlyphs;te++)c.addDynamicAttributes(Q,ve.shiftedAnchor,ve.angle);else jt(me.numGlyphs,Q)}}m.icon.dynamicLayoutVertexBuffer.updateData(Q)}m.text.dynamicLayoutVertexBuffer.updateData(V)}function Af(m,r,u){return u.iconsInText&&r?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function nl(m,r,u,f,_,v,w,S,I,L,z,B){const V=m.context,Q=V.gl,Y=m.transform,K=S==="map",ue=I==="map",me=S!=="viewport"&&u.layout.get("symbol-placement")!=="point",ve=K&&!ue&&!me,te=!u.layout.get("symbol-sort-key").isConstant();let Ee=!1;const xe=m.depthModeForSublayer(0,ui.ReadOnly),Le=u.layout.get("text-variable-anchor"),ke=[];for(const Ge of f){const Me=r.getTile(Ge),ct=Me.getBucket(u);if(!ct)continue;const et=_?ct.text:ct.icon;if(!et||!et.segments.get().length)continue;const dt=et.programConfigurations.get(u.id),qt=_||ct.sdfIcons,Jt=_?ct.textSizeData:ct.iconSizeData,Rt=ue||Y.pitch!==0,Ti=m.useProgram(Af(qt,_,ct),dt),Ai=c.evaluateSizeForZoom(Jt,Y.zoom),di=m.style.terrain&&m.style.terrain.getTerrainData(Ge);let fi,Si,In,Zr,Lr=[0,0],Xr=null;if(_){if(Si=Me.glyphAtlasTexture,In=Q.LINEAR,fi=Me.glyphAtlasTexture.size,ct.iconsInText){Lr=Me.imageAtlasTexture.size,Xr=Me.imageAtlasTexture;const Tr=Jt.kind==="composite"||Jt.kind==="camera";Zr=Rt||m.options.rotating||m.options.zooming||Tr?Q.LINEAR:Q.NEAREST}}else{const Tr=u.layout.get("icon-size").constantOr(0)!==1||ct.iconsNeedLinear;Si=Me.imageAtlasTexture,In=qt||m.options.rotating||m.options.zooming||Tr||Rt?Q.LINEAR:Q.NEAREST,fi=Me.imageAtlasTexture.size}const Ps=tn(Me,1,m.transform.zoom),Er=en(Ge.posMatrix,ue,K,m.transform,Ps),Jn=Ki(Ge.posMatrix,ue,K,m.transform,Ps),ss=Le&&ct.hasTextData(),hl=u.layout.get("icon-text-fit")!=="none"&&ss&&ct.hasIconData();if(me){const Tr=m.style.terrain?(Fc,Ro)=>m.style.terrain.getElevation(Ge,Fc,Ro):null,Ys=u.layout.get("text-rotation-alignment")==="map";Pi(ct,Ge.posMatrix,m,_,Er,Jn,ue,L,Ys,Tr)}const wn=m.translatePosMatrix(Ge.posMatrix,Me,v,w),ni=me||_&&Le||hl?Ef:Er,Ei=m.translatePosMatrix(Jn,Me,v,w,!0),Pn=qt&&u.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mn;Mn=qt?ct.iconsInText?Ju(Jt.kind,Ai,ve,ue,m,wn,ni,Ei,fi,Lr):Ya(Jt.kind,Ai,ve,ue,m,wn,ni,Ei,_,fi,!0):uc(Jt.kind,Ai,ve,ue,m,wn,ni,Ei,_,fi);const $i={program:Ti,buffers:et,uniformValues:Mn,atlasTexture:Si,atlasTextureIcon:Xr,atlasInterpolation:In,atlasInterpolationIcon:Zr,isSDF:qt,hasHalo:Pn};if(te&&ct.canOverlap){Ee=!0;const Tr=et.segments.get();for(const Ys of Tr)ke.push({segments:new c.SegmentVector([Ys]),sortKey:Ys.sortKey,state:$i,terrainData:di})}else ke.push({segments:et.segments,sortKey:0,state:$i,terrainData:di})}Ee&&ke.sort((Ge,Me)=>Ge.sortKey-Me.sortKey);for(const Ge of ke){const Me=Ge.state;if(V.activeTexture.set(Q.TEXTURE0),Me.atlasTexture.bind(Me.atlasInterpolation,Q.CLAMP_TO_EDGE),Me.atlasTextureIcon&&(V.activeTexture.set(Q.TEXTURE1),Me.atlasTextureIcon&&Me.atlasTextureIcon.bind(Me.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),Me.isSDF){const ct=Me.uniformValues;Me.hasHalo&&(ct.u_is_halo=1,aa(Me.buffers,Ge.segments,u,m,Me.program,xe,z,B,ct,Ge.terrainData)),ct.u_is_halo=0}aa(Me.buffers,Ge.segments,u,m,Me.program,xe,z,B,Me.uniformValues,Ge.terrainData)}}function aa(m,r,u,f,_,v,w,S,I,L){const z=f.context;_.draw(z,z.gl.TRIANGLES,v,w,S,ji.disabled,I,L,u.id,m.layoutVertexBuffer,m.indexBuffer,r,u.paint,f.transform.zoom,m.programConfigurations.get(u.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function la(m,r,u,f,_,v,w){const S=m.context.gl,I=u.paint.get("fill-pattern"),L=I&&I.constantOr(1),z=u.getCrossfadeParameters();let B,V,Q,Y,K;w?(V=L&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=S.LINES):(V=L?"fillPattern":"fill",B=S.TRIANGLES);for(const ue of f){const me=r.getTile(ue);if(L&&!me.patternsLoaded())continue;const ve=me.getBucket(u);if(!ve)continue;const te=ve.programConfigurations.get(u.id),Ee=m.useProgram(V,te),xe=m.style.terrain&&m.style.terrain.getTerrainData(ue);L&&(m.context.activeTexture.set(S.TEXTURE0),me.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),te.updatePaintBuffers(z));const Le=I.constantOr(null);if(Le&&me.imageAtlas){const Me=me.imageAtlas,ct=Me.patternPositions[Le.to.toString()],et=Me.patternPositions[Le.from.toString()];ct&&et&&te.setConstantPatternPositions(ct,et)}const ke=xe?ue:null,Ge=m.translatePosMatrix(ke?ke.posMatrix:ue.posMatrix,me,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(w){Y=ve.indexBuffer2,K=ve.segments2;const Me=[S.drawingBufferWidth,S.drawingBufferHeight];Q=V==="fillOutlinePattern"&&L?na(Ge,m,z,me,Me):Eo(Ge,Me)}else Y=ve.indexBuffer,K=ve.segments,Q=L?wo(Ge,m,z,me):bo(Ge);Ee.draw(m.context,B,_,m.stencilModeForClipping(ue),v,ji.disabled,Q,xe,u.id,ve.layoutVertexBuffer,Y,K,u.paint,m.transform.zoom,te)}}function ca(m,r,u,f,_,v,w){const S=m.context,I=S.gl,L=u.paint.get("fill-extrusion-pattern"),z=L.constantOr(1),B=u.getCrossfadeParameters(),V=u.paint.get("fill-extrusion-opacity");for(const Q of f){const Y=r.getTile(Q),K=Y.getBucket(u);if(!K)continue;const ue=m.style.terrain&&m.style.terrain.getTerrainData(Q),me=K.programConfigurations.get(u.id),ve=m.useProgram(z?"fillExtrusionPattern":"fillExtrusion",me);z&&(m.context.activeTexture.set(I.TEXTURE0),Y.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),me.updatePaintBuffers(B));const te=L.constantOr(null);if(te&&Y.imageAtlas){const ke=Y.imageAtlas,Ge=ke.patternPositions[te.to.toString()],Me=ke.patternPositions[te.from.toString()];Ge&&Me&&me.setConstantPatternPositions(Ge,Me)}const Ee=m.translatePosMatrix(Q.posMatrix,Y,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),xe=u.paint.get("fill-extrusion-vertical-gradient"),Le=z?Mr(Ee,m,xe,V,Q,B,Y):bs(Ee,m,xe,V);ve.draw(S,S.gl.TRIANGLES,_,v,w,ji.backCCW,Le,ue,u.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,u.paint,m.transform.zoom,me,m.style.terrain&&K.centroidVertexBuffer)}}function Ec(m,r,u,f,_,v,w){const S=m.context,I=S.gl,L=u.fbo;if(!L)return;const z=m.useProgram("hillshade"),B=m.style.terrain&&m.style.terrain.getTerrainData(r);S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,L.colorAttachment.get()),z.draw(S,I.TRIANGLES,_,v,w,ji.disabled,((V,Q,Y,K)=>{const ue=Y.paint.get("hillshade-shadow-color"),me=Y.paint.get("hillshade-highlight-color"),ve=Y.paint.get("hillshade-accent-color");let te=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);Y.paint.get("hillshade-illumination-anchor")==="viewport"&&(te-=V.transform.angle);const Ee=!V.options.moving;return{u_matrix:K?K.posMatrix:V.transform.calculatePosMatrix(Q.tileID.toUnwrapped(),Ee),u_image:0,u_latrange:Ae(0,Q.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),te],u_shadow:ue,u_highlight:me,u_accent:ve}})(m,u,f,B?r:null),B,f.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function lh(m,r,u,f,_,v){const w=m.context,S=w.gl,I=r.dem;if(I&&I.data){const L=I.dim,z=I.stride,B=I.getPixels();if(w.activeTexture.set(S.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||m.getTileTexture(z),r.demTexture){const Q=r.demTexture;Q.update(B,{premultiply:!1}),Q.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else r.demTexture=new se(w,B,S.RGBA,{premultiply:!1}),r.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);w.activeTexture.set(S.TEXTURE0);let V=r.fbo;if(!V){const Q=new se(w,{width:L,height:L,data:null},S.RGBA);Q.bind(S.LINEAR,S.CLAMP_TO_EDGE),V=r.fbo=w.createFramebuffer(L,L,!0),V.colorAttachment.set(Q.texture)}w.bindFramebuffer.set(V.framebuffer),w.viewport.set([0,0,L,L]),m.useProgram("hillshadePrepare").draw(w,S.TRIANGLES,f,_,v,ji.disabled,((Q,Y)=>{const K=Y.stride,ue=c.create();return c.ortho(ue,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(ue,ue,[0,-c.EXTENT,0]),{u_matrix:ue,u_image:1,u_dimension:[K,K],u_zoom:Q.overscaledZ,u_unpack:Y.getUnpackVector()}})(r.tileID,I),null,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function rl(m,r,u,f,_,v){const w=f.paint.get("raster-fade-duration");if(!v&&w>0){const S=c.exported.now(),I=(S-m.timeAdded)/w,L=r?(S-r.timeAdded)/w:-1,z=u.getSource(),B=_.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),V=!r||Math.abs(r.tileID.overscaledZ-B)>Math.abs(m.tileID.overscaledZ-B),Q=V&&m.refreshedUponExpiration?1:c.clamp(V?I:1-L,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),r?{opacity:1,mix:1-Q}:{opacity:Q,mix:0}}return{opacity:1,mix:0}}const sl=new c.Color(1,0,0,1),Cr=new c.Color(0,1,0,1),ch=new c.Color(0,0,1,1),Tc=new c.Color(1,0,1,1),uh=new c.Color(0,1,1,1);function Ws(m,r,u,f){Po(m,0,r+u/2,m.transform.width,u,f)}function ua(m,r,u,f){Po(m,r-u/2,0,u,m.transform.height,f)}function Po(m,r,u,f,_,v){const w=m.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(r*m.pixelRatio,u*m.pixelRatio,f*m.pixelRatio,_*m.pixelRatio),w.clear({color:v}),S.disable(S.SCISSOR_TEST)}function Sf(m,r,u){const f=m.context,_=f.gl,v=u.posMatrix,w=m.useProgram("debug"),S=ui.disabled,I=Di.disabled,L=m.colorModeForRenderPass(),z="$debug",B=m.style.terrain&&m.style.terrain.getTerrainData(u);f.activeTexture.set(_.TEXTURE0),m.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const V=r.getTileByID(u.key).latestRawTileData,Q=Math.floor((V&&V.byteLength||0)/1024),Y=r.getTile(u).tileSize,K=512/Math.min(Y,512)*(u.overscaledZ/m.transform.zoom)*.5;let ue=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ue+=` => ${u.overscaledZ}`),function(me,ve){me.initDebugOverlayCanvas();const te=me.debugOverlayCanvas,Ee=me.context.gl,xe=me.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,te.width,te.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(ve,5,5),xe.strokeText(ve,5,5),me.debugOverlayTexture.update(te),me.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}(m,`${ue} ${Q}kB`),w.draw(f,_.TRIANGLES,S,I,Ni.alphaBlended,ji.disabled,j(v,c.Color.transparent,K),null,z,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),w.draw(f,_.LINE_STRIP,S,I,L,ji.disabled,j(v,c.Color.red),B,z,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function ol(m,r,u){const f=m.context,_=f.gl,v=m.colorModeForRenderPass(),w=new ui(_.LEQUAL,ui.ReadWrite,m.depthRangeFor3D),S=m.useProgram("terrain"),I=r.getTerrainMesh(),L=r.getTerrainData(u.tileID);f.bindFramebuffer.set(null),f.viewport.set([0,0,m.width,m.height]),f.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,r.getRTTFramebuffer().colorAttachment.get());const z=m.transform.calculatePosMatrix(u.tileID.toUnwrapped());S.draw(f,_.TRIANGLES,w,Di.disabled,v,ji.backCCW,{u_matrix:z,u_texture:0},L,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}function hh(m,r,u,f){const _=m.context,v=u.tileSize*r.qualityFactor;u.textures[f]||(u.textures[f]=m.getTileTexture(v)||new se(_,{width:v,height:v,data:null},_.gl.RGBA),u.textures[f].bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),f===0&&r.sourceCache.renderHistory.unshift(u.tileID.key));const w=r.getRTTFramebuffer();w.colorAttachment.set(u.textures[f].texture),_.bindFramebuffer.set(w.framebuffer),_.viewport.set([0,0,v,v])}class dh{constructor(r){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=r,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=r.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const r=this.painter.style,u=r.terrain;for(const f in r.sourceCaches){this._coordsDescendingInv[f]={};const _=r.sourceCaches[f].getVisibleCoordinates();for(const v of _){const w=u.sourceCache.getTerrainCoords(v);for(const S in w)this._coordsDescendingInv[f][S]||(this._coordsDescendingInv[f][S]=[]),this._coordsDescendingInv[f][S].push(w[S])}}for(const f of r._order){const _=r._layers[f],v=_.source;if(this._renderToTexture[_.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const w in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][w]=this._coordsDescendingInv[v][w].map(S=>S.key).sort().join()}}return this._renderableTiles.forEach(f=>{for(const _ in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[_][f.tileID.key];v&&v!==f.textureCoords[_]&&f.clearTextures(this.painter),u.needsRerender(_,f.tileID)&&f.clearTextures(this.painter)}this._rerender[f.tileID.key]=!f.textures.length}),u.clearRerenderCache(),u.sourceCache.removeOutdated(this.painter),this}renderLayer(r){const u=r.type,f=this.painter,_=f.style._order,v=f.currentLayer,w=v+1===_.length;if(this._renderToTexture[u]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(_[v]),!w))return!0;if(this._renderToTexture[this._prevType]||u==="hillshade"||this._renderToTexture[u]&&w){this._prevType=u;const S=this._stacks.length-1,I=this._stacks[S]||[];for(const L of this._renderableTiles){if(hh(f,f.style.terrain,L,S),this._rerender[L.tileID.key]){f.context.clear({color:c.Color.transparent});for(let z=0;z<I.length;z++){const B=f.style._layers[I[z]],V=B.source?this._coordsDescendingInv[B.source][L.tileID.key]:[L.tileID];f._renderTileClippingMasks(B,V),f.renderLayer(f,f.style.sourceCaches[B.source],B,V),B.source&&(L.textureCoords[B.source]=this._coordsDescendingInvStr[B.source][L.tileID.key])}}ol(f,f.style.terrain,L)}if(u==="hillshade"){this._stacks.push([_[v]]);for(const L of this._renderableTiles){const z=this._coordsDescendingInv[r.source][L.tileID.key];hh(f,f.style.terrain,L,this._stacks.length-1),f.context.clear({color:c.Color.transparent}),f._renderTileClippingMasks(r,z),f.renderLayer(f,f.style.sourceCaches[r.source],r,z),ol(f,f.style.terrain,L)}return!0}return this._renderToTexture[u]}return!1}}const ha={symbol:function(m,r,u,f,_){if(m.renderPass!=="translucent")return;const v=Di.disabled,w=m.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(S,I,L,z,B,V,Q){const Y=I.transform,K=B==="map",ue=V==="map";for(const me of S){const ve=z.getTile(me),te=ve.getBucket(L);if(!te||!te.text||!te.text.segments.get().length)continue;const Ee=c.evaluateSizeForZoom(te.textSizeData,Y.zoom),xe=tn(ve,1,I.transform.zoom),Le=en(me.posMatrix,ue,K,I.transform,xe),ke=L.layout.get("icon-text-fit")!=="none"&&te.hasIconData();if(Ee){const Ge=Math.pow(2,Y.zoom-ve.tileID.overscaledZ);ah(te,K,ue,Q,Y,Le,me.posMatrix,Ge,Ee,ke,I.style.terrain?(Me,ct)=>I.style.terrain.getElevation(me,Me,ct):null)}}}(f,m,u,r,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),_),u.paint.get("icon-opacity").constantOr(1)!==0&&nl(m,r,u,f,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),v,w),u.paint.get("text-opacity").constantOr(1)!==0&&nl(m,r,u,f,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),v,w),r.map.showCollisionBoxes&&(Io(m,r,u,f,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Io(m,r,u,f,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,r,u,f){if(m.renderPass!=="translucent")return;const _=u.paint.get("circle-opacity"),v=u.paint.get("circle-stroke-width"),w=u.paint.get("circle-stroke-opacity"),S=!u.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(v.constantOr(1)===0||w.constantOr(1)===0))return;const I=m.context,L=I.gl,z=m.depthModeForSublayer(0,ui.ReadOnly),B=Di.disabled,V=m.colorModeForRenderPass(),Q=[];for(let Y=0;Y<f.length;Y++){const K=f[Y],ue=r.getTile(K),me=ue.getBucket(u);if(!me)continue;const ve=me.programConfigurations.get(u.id),te=m.useProgram("circle",ve),Ee=me.layoutVertexBuffer,xe=me.indexBuffer,Le=m.style.terrain&&m.style.terrain.getTerrainData(K),ke={programConfiguration:ve,program:te,layoutVertexBuffer:Ee,indexBuffer:xe,uniformValues:Xa(m,K,ue,u),terrainData:Le};if(S){const Ge=me.segments.get();for(const Me of Ge)Q.push({segments:new c.SegmentVector([Me]),sortKey:Me.sortKey,state:ke})}else Q.push({segments:me.segments,sortKey:0,state:ke})}S&&Q.sort((Y,K)=>Y.sortKey-K.sortKey);for(const Y of Q){const{programConfiguration:K,program:ue,layoutVertexBuffer:me,indexBuffer:ve,uniformValues:te,terrainData:Ee}=Y.state;ue.draw(I,L.TRIANGLES,z,B,V,ji.disabled,te,Ee,u.id,me,ve,Y.segments,u.paint,m.transform.zoom,K)}},heatmap:function(m,r,u,f){if(u.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const _=m.context,v=_.gl,w=Di.disabled,S=new Ni([v.ONE,v.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(I,L,z){const B=I.gl;I.activeTexture.set(B.TEXTURE1),I.viewport.set([0,0,L.width/4,L.height/4]);let V=z.heatmapFbo;if(V)B.bindTexture(B.TEXTURE_2D,V.colorAttachment.get()),I.bindFramebuffer.set(V.framebuffer);else{const Q=B.createTexture();B.bindTexture(B.TEXTURE_2D,Q),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),V=z.heatmapFbo=I.createFramebuffer(L.width/4,L.height/4,!1),function(Y,K,ue,me){const ve=Y.gl;ve.texImage2D(ve.TEXTURE_2D,0,ve.RGBA,K.width/4,K.height/4,0,ve.RGBA,Y.extRenderToTextureHalfFloat?Y.extTextureHalfFloat.HALF_FLOAT_OES:ve.UNSIGNED_BYTE,null),me.colorAttachment.set(ue)}(I,L,Q,V)}})(_,m,u),_.clear({color:c.Color.transparent});for(let I=0;I<f.length;I++){const L=f[I];if(r.hasRenderableParent(L))continue;const z=r.getTile(L),B=z.getBucket(u);if(!B)continue;const V=B.programConfigurations.get(u.id),Q=m.useProgram("heatmap",V),{zoom:Y}=m.transform;Q.draw(_,v.TRIANGLES,ui.disabled,w,S,ji.disabled,ae(L.posMatrix,z,Y,u.paint.get("heatmap-intensity")),null,u.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,u.paint,m.transform.zoom,V)}_.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(_,v){const w=_.context,S=w.gl,I=v.heatmapFbo;if(!I)return;w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.colorAttachment.get()),w.activeTexture.set(S.TEXTURE1);let L=v.colorRampTexture;L||(L=v.colorRampTexture=new se(w,v.colorRamp,S.RGBA)),L.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(w,S.TRIANGLES,ui.disabled,Di.disabled,_.colorModeForRenderPass(),ji.disabled,((z,B,V,Q)=>{const Y=c.create();c.ortho(Y,0,z.width,z.height,0,0,1);const K=z.context.gl;return{u_matrix:Y,u_world:[K.drawingBufferWidth,K.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}})(_,v),null,v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(m,u))},line:function(m,r,u,f){if(m.renderPass!=="translucent")return;const _=u.paint.get("line-opacity"),v=u.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;const w=m.depthModeForSublayer(0,ui.ReadOnly),S=m.colorModeForRenderPass(),I=u.paint.get("line-dasharray"),L=u.paint.get("line-pattern"),z=L.constantOr(1),B=u.paint.get("line-gradient"),V=u.getCrossfadeParameters(),Q=z?"linePattern":I?"lineSDF":B?"lineGradient":"line",Y=m.context,K=Y.gl;let ue=!0;for(const me of f){const ve=r.getTile(me);if(z&&!ve.patternsLoaded())continue;const te=ve.getBucket(u);if(!te)continue;const Ee=te.programConfigurations.get(u.id),xe=m.context.program.get(),Le=m.useProgram(Q,Ee),ke=ue||Le.program!==xe,Ge=m.style.terrain&&m.style.terrain.getTerrainData(me),Me=L.constantOr(null);if(Me&&ve.imageAtlas){const dt=ve.imageAtlas,qt=dt.patternPositions[Me.to.toString()],Jt=dt.patternPositions[Me.from.toString()];qt&&Jt&&Ee.setConstantPatternPositions(qt,Jt)}const ct=Ge?me:null,et=z?ii(m,ve,u,V,ct):I?Wi(m,ve,u,I,V,ct):B?_t(m,ve,u,te.lineClipsArray.length,ct):He(m,ve,u,ct);if(z)Y.activeTexture.set(K.TEXTURE0),ve.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Ee.updatePaintBuffers(V);else if(I&&(ke||m.lineAtlas.dirty))Y.activeTexture.set(K.TEXTURE0),m.lineAtlas.bind(Y);else if(B){const dt=te.gradients[u.id];let qt=dt.texture;if(u.gradientVersion!==dt.version){let Jt=256;if(u.stepInterpolant){const Rt=r.getSource().maxzoom,Ti=me.canonical.z===Rt?Math.ceil(1<<m.transform.maxZoom-me.canonical.z):1;Jt=c.clamp(c.nextPowerOfTwo(te.maxLineLength/c.EXTENT*1024*Ti),256,Y.maxTextureSize)}dt.gradient=c.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Jt,image:dt.gradient||void 0,clips:te.lineClipsArray}),dt.texture?dt.texture.update(dt.gradient):dt.texture=new se(Y,dt.gradient,K.RGBA),dt.version=u.gradientVersion,qt=dt.texture}Y.activeTexture.set(K.TEXTURE0),qt.bind(u.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}Le.draw(Y,K.TRIANGLES,w,m.stencilModeForClipping(me),S,ji.disabled,et,Ge,u.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,u.paint,m.transform.zoom,Ee,te.layoutVertexBuffer2),ue=!1}},fill:function(m,r,u,f){const _=u.paint.get("fill-color"),v=u.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const w=m.colorModeForRenderPass(),S=u.paint.get("fill-pattern"),I=m.opaquePassEnabledForLayer()&&!S.constantOr(1)&&_.constantOr(c.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===I){const L=m.depthModeForSublayer(1,m.renderPass==="opaque"?ui.ReadWrite:ui.ReadOnly);la(m,r,u,f,L,w,!1)}if(m.renderPass==="translucent"&&u.paint.get("fill-antialias")){const L=m.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,ui.ReadOnly);la(m,r,u,f,L,w,!0)}},"fill-extrusion":function(m,r,u,f){const _=u.paint.get("fill-extrusion-opacity");if(_!==0&&m.renderPass==="translucent"){const v=new ui(m.context.gl.LEQUAL,ui.ReadWrite,m.depthRangeFor3D);if(_!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))ca(m,r,u,f,v,Di.disabled,Ni.disabled),ca(m,r,u,f,v,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const w=m.colorModeForRenderPass();ca(m,r,u,f,v,Di.disabled,w)}}},hillshade:function(m,r,u,f){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const _=m.context,v=m.depthModeForSublayer(0,ui.ReadOnly),w=m.colorModeForRenderPass(),[S,I]=m.renderPass==="translucent"?m.stencilConfigForOverlap(f):[{},f];for(const L of I){const z=r.getTile(L);z.needsHillshadePrepare!==void 0&&z.needsHillshadePrepare&&m.renderPass==="offscreen"?lh(m,z,u,v,Di.disabled,w):m.renderPass==="translucent"&&Ec(m,L,z,u,v,S[L.overscaledZ],w)}_.viewport.set([0,0,m.width,m.height])},raster:function(m,r,u,f){if(m.renderPass!=="translucent"||u.paint.get("raster-opacity")===0||!f.length)return;const _=m.context,v=_.gl,w=r.getSource(),S=m.useProgram("raster"),I=m.colorModeForRenderPass(),[L,z]=w instanceof Bi?[{},f]:m.stencilConfigForOverlap(f),B=z[z.length-1].overscaledZ,V=!m.options.moving;for(const Q of z){const Y=m.depthModeForSublayer(Q.overscaledZ-B,u.paint.get("raster-opacity")===1?ui.ReadWrite:ui.ReadOnly,v.LESS),K=r.getTile(Q);K.registerFadeDuration(u.paint.get("raster-fade-duration"));const ue=r.findLoadedParent(Q,0),me=rl(K,ue,r,u,m.transform,m.style.terrain);let ve,te;const Ee=u.paint.get("raster-resampling")==="nearest"?v.NEAREST:v.LINEAR;_.activeTexture.set(v.TEXTURE0),K.texture.bind(Ee,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(v.TEXTURE1),ue?(ue.texture.bind(Ee,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),ve=Math.pow(2,ue.tileID.overscaledZ-K.tileID.overscaledZ),te=[K.tileID.canonical.x*ve%1,K.tileID.canonical.y*ve%1]):K.texture.bind(Ee,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST);const xe=m.style.terrain&&m.style.terrain.getTerrainData(Q),Le=xe?Q:null,ke=Le?Le.posMatrix:m.transform.calculatePosMatrix(Q.toUnwrapped(),V),Ge=ar(ke,te||[0,0],ve||1,me,u);w instanceof Bi?S.draw(_,v.TRIANGLES,Y,Di.disabled,I,ji.disabled,Ge,xe,u.id,w.boundsBuffer,m.quadTriangleIndexBuffer,w.boundsSegments):S.draw(_,v.TRIANGLES,Y,L[Q.overscaledZ],I,ji.disabled,Ge,xe,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,r,u,f){const _=u.paint.get("background-color"),v=u.paint.get("background-opacity");if(v===0)return;const w=m.context,S=w.gl,I=m.transform,L=I.tileSize,z=u.paint.get("background-pattern");if(m.isPatternMissing(z))return;const B=!z&&_.a===1&&v===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==B)return;const V=Di.disabled,Q=m.depthModeForSublayer(0,B==="opaque"?ui.ReadWrite:ui.ReadOnly),Y=m.colorModeForRenderPass(),K=m.useProgram(z?"backgroundPattern":"background"),ue=f||I.coveringTiles({tileSize:L,terrain:m.style.terrain});z&&(w.activeTexture.set(S.TEXTURE0),m.imageManager.bind(m.context));const me=u.getCrossfadeParameters();for(const ve of ue){const te=f?ve.posMatrix:m.transform.calculatePosMatrix(ve.toUnwrapped()),Ee=z?mf(te,v,m,z,{tileID:ve,tileSize:L},me):pf(te,v,_),xe=m.style.terrain&&m.style.terrain.getTerrainData(ve);K.draw(w,S.TRIANGLES,Q,V,Y,ji.disabled,Ee,xe,u.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,r,u){for(let f=0;f<u.length;f++)Sf(m,r,u[f])},custom:function(m,r,u){const f=m.context,_=u.implementation;if(m.renderPass==="offscreen"){const v=_.prerender;v&&(m.setCustomLayerDefaults(),f.setColorMode(m.colorModeForRenderPass()),v.call(_,f.gl,m.transform.customLayerMatrix()),f.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),f.setColorMode(m.colorModeForRenderPass()),f.setStencilMode(Di.disabled);const v=_.renderingMode==="3d"?new ui(m.context.gl.LEQUAL,ui.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,ui.ReadOnly);f.setDepthMode(v),_.render(f.gl,m.transform.customLayerMatrix()),f.setDirty(),m.setBaseState(),f.bindFramebuffer.set(null)}}};class Ac{constructor(r,u){this.context=new oh(r),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.create(),renderTime:0},this.setup(),this.numSublayers=Et.maxUnderzooming+Et.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new St,this.gpuTimers={}}resize(r,u,f){if(this.width=r*f,this.height=u*f,this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const r=this.context,u=new c.PosArray;u.emplaceBack(0,0),u.emplaceBack(c.EXTENT,0),u.emplaceBack(0,c.EXTENT),u.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(u,Yt.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const f=new c.PosArray;f.emplaceBack(0,0),f.emplaceBack(c.EXTENT,0),f.emplaceBack(0,c.EXTENT),f.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=r.createVertexBuffer(f,Yt.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const _=new c.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(c.EXTENT,0,c.EXTENT,0),_.emplaceBack(0,c.EXTENT,0,c.EXTENT),_.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.rasterBoundsBuffer=r.createVertexBuffer(_,si.members),this.rasterBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const v=new c.PosArray;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(v,Yt.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const w=new c.LineStripIndexArray;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(w);const S=new c.TriangleIndexArray;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(S),this.emptyTexture=new se(r,{width:1,height:1,data:new Uint8Array([0,0,0,0])},r.gl.RGBA);const I=this.context.gl;this.stencilClearMode=new Di({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const r=this.context,u=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=c.create();c.ortho(f,0,this.width,this.height,0,0,1),c.scale(f,f,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,u.TRIANGLES,ui.disabled,this.stencilClearMode,Ni.disabled,ji.disabled,Z(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,u){if(this.currentStencilSource===r.source||!r.isTileClipped()||!u||!u.length)return;this.currentStencilSource=r.source;const f=this.context,_=f.gl;this.nextStencilID+u.length>256&&this.clearStencil(),f.setColorMode(Ni.disabled),f.setDepthMode(ui.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of u){const S=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,I=this.style.terrain&&this.style.terrain.getTerrainData(w);v.draw(f,_.TRIANGLES,ui.disabled,new Di({func:_.ALWAYS,mask:0},S,255,_.KEEP,_.KEEP,_.REPLACE),Ni.disabled,ji.disabled,Z(w.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,u=this.context.gl;return new Di({func:u.NOTEQUAL,mask:255},r,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(r){const u=this.context.gl;return new Di({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(r){const u=this.context.gl,f=r.sort((w,S)=>S.overscaledZ-w.overscaledZ),_=f[f.length-1].overscaledZ,v=f[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let S=0;S<v;S++)w[S+_]=new Di({func:u.GEQUAL,mask:255},S+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=v,[w,f]}return[{[_]:Di.disabled},f]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Ni([r.CONSTANT_COLOR,r.ONE],new c.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ni.unblended:Ni.alphaBlended}depthModeForSublayer(r,u,f){if(!this.opaquePassEnabledForLayer())return ui.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new ui(f||this.context.gl.LEQUAL,u,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,u){this.style=r,this.options=u,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const f=this.style._order,_=this.style.sourceCaches,v=this.style.terrain&&new dh(this);for(const L in _){const z=_[L];z.used&&z.prepare(this.context)}const w={},S={},I={};for(const L in _){const z=_[L];w[L]=z.getVisibleCoordinates(),S[L]=w[L].slice().reverse(),I[L]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<f.length;L++)if(this.style._layers[f[L]].is3D()){this.opaquePassCutoff=L;break}if(v){this.opaquePassCutoff=0;const L=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!c.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||L.length)&&(c.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(z,B){const V=z.context,Q=V.gl,Y=Ni.unblended,K=new ui(Q.LEQUAL,ui.ReadWrite,[0,1]),ue=B.getTerrainMesh(),me=B.sourceCache.getRenderableTiles(),ve=z.useProgram("terrainDepth");V.bindFramebuffer.set(B.getFramebuffer("depth").framebuffer),V.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),V.clear({color:c.Color.transparent,depth:1});for(const te of me){const Ee=B.getTerrainData(te.tileID),xe=z.transform.calculatePosMatrix(te.tileID.toUnwrapped());ve.draw(V,Q.TRIANGLES,K,Di.disabled,Y,ji.backCCW,{u_matrix:xe},Ee,"terrain",ue.vertexBuffer,ue.indexBuffer,ue.segments)}V.bindFramebuffer.set(null),V.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain),function(z,B){const V=z.context,Q=V.gl,Y=Ni.unblended,K=new ui(Q.LEQUAL,ui.ReadWrite,[0,1]),ue=B.getTerrainMesh(),me=B.getCoordsTexture(),ve=B.sourceCache.getRenderableTiles(),te=z.useProgram("terrainCoords");V.bindFramebuffer.set(B.getFramebuffer("coords").framebuffer),V.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),V.clear({color:c.Color.transparent,depth:1}),B.coordsIndex=[];for(const Ee of ve){const xe=B.getTerrainData(Ee.tileID);V.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,me.texture);const Le=z.transform.calculatePosMatrix(Ee.tileID.toUnwrapped());te.draw(V,Q.TRIANGLES,K,Di.disabled,Y,ji.backCCW,{u_matrix:Le,u_terrain_coords_id:(255-B.coordsIndex.length)/255,u_texture:0},xe,"terrain",ue.vertexBuffer,ue.indexBuffer,ue.segments),B.coordsIndex.push(Ee.tileID.key)}V.bindFramebuffer.set(null),V.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const L of f){const z=this.style._layers[L];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const B=S[z.source];(z.type==="custom"||B.length)&&this.renderLayer(this,_[z.source],z,B)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?c.Color.black:c.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!v)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[f[this.currentLayer]],z=_[L.source],B=w[L.source];this._renderTileClippingMasks(L,B),this.renderLayer(this,z,L,B)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const L=this.style._layers[f[this.currentLayer]],z=_[L.source];if(v&&v.renderLayer(L))continue;const B=(L.type==="symbol"?I:S)[L.source];this._renderTileClippingMasks(L,w[L.source]),this.renderLayer(this,z,L,B)}if(this.options.showTileBoundaries){let L,z;Object.values(this.style._layers).forEach(B=>{B.source&&!B.isHidden(this.transform.zoom)&&(B.source!==(z&&z.id)&&(z=this.style.sourceCaches[B.source]),(!L||L.getSource().maxzoom<z.getSource().maxzoom)&&(L=z))}),L&&ha.debug(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const z=L.transform.padding;Ws(L,L.transform.height-(z.top||0),3,sl),Ws(L,z.bottom||0,3,Cr),ua(L,z.left||0,3,ch),ua(L,L.transform.width-(z.right||0),3,Tc);const B=L.transform.centerPoint;(function(V,Q,Y,K){Po(V,Q-1,Y-10,2,20,K),Po(V,Q-10,Y-1,20,2,K)})(L,B.x,L.transform.height-B.y,uh)}(this),this.context.setDefault()}renderLayer(r,u,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(_||[]).length)&&(this.id=f.id,this.gpuTimingStart(f),ha[f.type](r,u,f,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let f=this.gpuTimers[r.id];f||(f=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),f.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,f.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}queryGpuTimers(r){const u={};for(const f in r){const _=r[f],v=this.context.extTimerQuery,w=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),u[f]=w}return u}translatePosMatrix(r,u,f,_,v){if(!f[0]&&!f[1])return r;const w=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const L=Math.sin(w),z=Math.cos(w);f=[f[0]*z-f[1]*L,f[0]*L+f[1]*z]}const S=[v?f[0]:tn(u,f[0],this.transform.zoom),v?f[1]:tn(u,f[1],this.transform.zoom),0],I=new Float32Array(16);return c.translate(I,r,S),I}saveTileTexture(r){const u=this._tileTextures[r.size[0]];u?u.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const u=this._tileTextures[r];return u&&u.length>0?u.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const u=this.imageManager.getPattern(r.from.toString()),f=this.imageManager.getPattern(r.to.toString());return!u||!f}useProgram(r,u){this.cache=this.cache||{};const f=r+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new vo(this.context,r,Dn[r],u,hc[r],this._showOverdrawInspector,this.style.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new se(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class al{constructor(r,u){this.points=r,this.planes=u}static fromInvProjectionMatrix(r,u,f){const _=Math.pow(2,f),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const I=1/(S=c.transformMat4([],S,r))[3]/u*_;return c.mul$1(S,S,[I,I,1/S[3],I])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const I=c.sub([],v[S[0]],v[S[1]]),L=c.sub([],v[S[2]],v[S[1]]),z=c.normalize([],c.cross([],I,L)),B=-c.dot(z,v[S[1]]);return z.concat(B)});return new al(v,w)}}class da{constructor(r,u){this.min=r,this.max=u,this.center=c.scale$1([],c.add([],this.min,this.max),.5)}quadrant(r){const u=[r%2==0,r<2],f=c.clone$2(this.min),_=c.clone$2(this.max);for(let v=0;v<u.length;v++)f[v]=u[v]?this.min[v]:this.center[v],_[v]=u[v]?this.center[v]:this.max[v];return _[2]=this.max[2],new da(f,_)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const u=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let _=0;_<r.planes.length;_++){const v=r.planes[_];let w=0;for(let S=0;S<u.length;S++)c.dot$1(v,u[S])>=0&&w++;if(w===0)return 0;w!==u.length&&(f=!1)}if(f)return 2;for(let _=0;_<3;_++){let v=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let S=0;S<r.points.length;S++){const I=r.points[S][_]-this.min[_];v=Math.min(v,I),w=Math.max(w,I)}if(w<0||v>this.max[_]-this.min[_])return 0}return 1}}class Mo{constructor(r=0,u=0,f=0,_=0){if(isNaN(r)||r<0||isNaN(u)||u<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=u,this.left=f,this.right=_}interpolate(r,u,f){return u.top!=null&&r.top!=null&&(this.top=c.number(r.top,u.top,f)),u.bottom!=null&&r.bottom!=null&&(this.bottom=c.number(r.bottom,u.bottom,f)),u.left!=null&&r.left!=null&&(this.left=c.number(r.left,u.left,f)),u.right!=null&&r.right!=null&&(this.right=c.number(r.right,u.right,f)),this}getCenter(r,u){const f=c.clamp((this.left+r-this.right)/2,0,r),_=c.clamp((this.top+u-this.bottom)/2,0,u);return new c.pointGeometry(f,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Mo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class fa{constructor(r,u,f,_,v){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=v===void 0||!!v,this._minZoom=r||0,this._maxZoom=u||22,this._minPitch=f==null?0:f,this._maxPitch=_==null?60:_,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Mo,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const r=new fa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.tileSize=this.tileSize,r.latRange=this.latRange,r.width=this.width,r.height=this.height,r._center=this._center,r._elevation=this._elevation,r.zoom=this.zoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const u=-c.wrap(r,-180,180)*Math.PI/180;var f;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(f=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),function(_,v,w){var S=v[0],I=v[1],L=v[2],z=v[3],B=Math.sin(w),V=Math.cos(w);_[0]=S*V+L*B,_[1]=I*V+z*B,_[2]=S*-B+L*V,_[3]=I*-B+z*V}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const u=c.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const u=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,u,f){this._unmodified=!1,this._edgeInsets.interpolate(r,u,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const u=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(r){const u=[new c.UnwrappedTileID(0,r)];if(this._renderWorldCopies){const f=this.pointCoordinate(new c.pointGeometry(0,0)),_=this.pointCoordinate(new c.pointGeometry(this.width,0)),v=this.pointCoordinate(new c.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new c.pointGeometry(0,this.height)),S=Math.floor(Math.min(f.x,_.x,v.x,w.x)),I=Math.floor(Math.max(f.x,_.x,v.x,w.x)),L=1;for(let z=S-L;z<=I+L;z++)z!==0&&u.push(new c.UnwrappedTileID(z,r))}return u}coveringTiles(r){var u,f;let _=this.coveringZoomLevel(r);const v=_;if(r.minzoom!==void 0&&_<r.minzoom)return[];r.maxzoom!==void 0&&_>r.maxzoom&&(_=r.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),S=c.MercatorCoordinate.fromLngLat(this.center),I=Math.pow(2,_),L=[I*w.x,I*w.y,0],z=[I*S.x,I*S.y,0],B=al.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let V=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(V=_);const Q=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,Y=te=>({aabb:new da([te*I,0,0],[(te+1)*I,I,0]),zoom:0,x:0,y:0,wrap:te,fullyVisible:!1}),K=[],ue=[],me=_,ve=r.reparseOverscaled?v:_;if(this._renderWorldCopies)for(let te=1;te<=3;te++)K.push(Y(-te)),K.push(Y(te));for(K.push(Y(0));K.length>0;){const te=K.pop(),Ee=te.x,xe=te.y;let Le=te.fullyVisible;if(!Le){const dt=te.aabb.intersects(B);if(dt===0)continue;Le=dt===2}const ke=r.terrain?L:z,Ge=te.aabb.distanceX(ke),Me=te.aabb.distanceY(ke),ct=Math.max(Math.abs(Ge),Math.abs(Me)),et=Q+(1<<me-te.zoom)-2;if(te.zoom===me||ct>et&&te.zoom>=V){const dt=me-te.zoom,qt=L[0]-.5-(Ee<<dt),Jt=L[1]-.5-(xe<<dt);ue.push({tileID:new c.OverscaledTileID(te.zoom===me?ve:te.zoom,te.wrap,te.zoom,Ee,xe),distanceSq:c.sqrLen([z[0]-.5-Ee,z[1]-.5-xe]),tileDistanceToCamera:Math.sqrt(qt*qt+Jt*Jt)})}else for(let dt=0;dt<4;dt++){const qt=(Ee<<1)+dt%2,Jt=(xe<<1)+(dt>>1),Rt=te.zoom+1;let Ti=te.aabb.quadrant(dt);if(r.terrain){const Ai=new c.OverscaledTileID(Rt,te.wrap,Rt,qt,Jt),di=r.terrain.getMinMaxElevation(Ai),fi=(u=di.minElevation)!==null&&u!==void 0?u:this.elevation,Si=(f=di.maxElevation)!==null&&f!==void 0?f:this.elevation;Ti=new da([Ti.min[0],Ti.min[1],fi],[Ti.max[0],Ti.max[1],Si])}K.push({aabb:Ti,zoom:Rt,x:qt,y:Jt,wrap:te.wrap,fullyVisible:Le})}}return ue.sort((te,Ee)=>te.distanceSq-Ee.distanceSq).map(te=>te.tileID)}resize(r,u){this.width=r,this.height=u,this.pixelsToGLUnits=[2/r,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const u=c.clamp(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new c.pointGeometry(c.mercatorXfromLng(r.lng)*this.worldSize,c.mercatorYfromLat(u)*this.worldSize)}unproject(r){return new c.MercatorCoordinate(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(r){this.freezeElevation||(this.elevation=r?this.getElevation(this._center,r):0)}getElevation(r,u){const f=c.MercatorCoordinate.fromLngLat(r),_=(1<<this.tileZoom)*c.EXTENT,v=f.x*_,w=f.y*_,S=Math.floor(v/c.EXTENT),I=Math.floor(w/c.EXTENT),L=new c.OverscaledTileID(this.tileZoom,0,this.tileZoom,S,I);return u.getElevation(L,v%c.EXTENT,w%c.EXTENT,c.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const u=this.pointLocation(this.centerPoint,r),f=this.getElevation(u,r);if(!(this.elevation-f))return;const _=this.getCameraPosition(),v=c.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),w=c.MercatorCoordinate.fromLngLat(u,f),S=v.x-w.x,I=v.y-w.y,L=v.z-w.z,z=Math.sqrt(S*S+I*I+L*L),B=this.scaleZoom(this.cameraToCenterDistance/z/this.tileSize);this._elevation=f,this._center=u,this.zoom=B}setLocationAtPoint(r,u){const f=this.pointCoordinate(u),_=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(r),w=new c.MercatorCoordinate(v.x-(f.x-_.x),v.y-(f.y-_.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,u){return u?this.coordinatePoint(this.locationCoordinate(r),this.getElevation(r,u),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,u){return this.coordinateLocation(this.pointCoordinate(r,u))}locationCoordinate(r){return c.MercatorCoordinate.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,u){if(u){const V=u.pointCoordinate(r);if(V!=null)return V}const f=[r.x,r.y,0,1],_=[r.x,r.y,1,1];c.transformMat4(f,f,this.pixelMatrixInverse),c.transformMat4(_,_,this.pixelMatrixInverse);const v=f[3],w=_[3],S=f[1]/v,I=_[1]/w,L=f[2]/v,z=_[2]/w,B=L===z?0:(0-L)/(z-L);return new c.MercatorCoordinate(c.number(f[0]/v,_[0]/w,B)/this.worldSize,c.number(S,I,B)/this.worldSize)}coordinatePoint(r,u=0,f=this.pixelMatrix){const _=[r.x*this.worldSize,r.y*this.worldSize,u,1];return c.transformMat4(_,_,f),new c.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new c.LngLatBounds().extend(this.pointLocation(new c.pointGeometry(0,r))).extend(this.pointLocation(new c.pointGeometry(this.width,r))).extend(this.pointLocation(new c.pointGeometry(this.width,this.height))).extend(this.pointLocation(new c.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new c.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(r,u=!1){const f=r.key,_=u?this._alignedPosMatrixCache:this._posMatrixCache;if(_[f])return _[f];const v=r.canonical,w=this.worldSize/this.zoomScale(v.z),S=v.x+Math.pow(2,v.z)*r.wrap,I=c.identity(new Float64Array(16));return c.translate(I,I,[S*w,v.y*w,0]),c.scale(I,I,[w/c.EXTENT,w/c.EXTENT,1]),c.multiply(I,u?this.alignedProjMatrix:this.projMatrix,I),_[f]=new Float32Array(I),_[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r,u,f,_,v=-90,w=90,S=-180,I=180;const L=this.size,z=this._unmodified;if(this.latRange){const Q=this.latRange;v=c.mercatorYfromLat(Q[1])*this.worldSize,w=c.mercatorYfromLat(Q[0])*this.worldSize,r=w-v<L.y?L.y/(w-v):0}if(this.lngRange){const Q=this.lngRange;S=c.wrap(c.mercatorXfromLng(Q[0])*this.worldSize,0,this.worldSize),I=c.wrap(c.mercatorXfromLng(Q[1])*this.worldSize,0,this.worldSize),I<S&&(I+=this.worldSize),u=I-S<L.x?L.x/(I-S):0}const B=this.point,V=Math.max(u||0,r||0);if(V)return this.center=this.unproject(new c.pointGeometry(u?(I+S)/2:B.x,r?(w+v)/2:B.y)),this.zoom+=this.scaleZoom(V),this._unmodified=z,void(this._constraining=!1);if(this.latRange){const Q=B.y,Y=L.y/2;Q-Y<v&&(_=v+Y),Q+Y>w&&(_=w-Y)}if(this.lngRange){const Q=(S+I)/2,Y=c.wrap(B.x,Q-this.worldSize/2,Q+this.worldSize/2),K=L.x/2;Y-K<S&&(f=S+K),Y+K>I&&(f=I-K)}f===void 0&&_===void 0||(this.center=this.unproject(new c.pointGeometry(f!==void 0?f:B.x,_!==void 0?_:B.y)).wrap()),this._unmodified=z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,u=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=c.identity(new Float64Array(16));c.scale(_,_,[this.width/2,-this.height/2,1]),c.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=c.identity(new Float64Array(16)),c.scale(_,_,[1,-1,1]),c.translate(_,_,[-1,-1,0]),c.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const v=Math.PI/2+this._pitch,w=this._fov*(.5+r.y/this.height),S=Math.sin(w)*this.cameraToSeaLevelDistance/Math.sin(c.clamp(Math.PI-v-w,.01,Math.PI-.01)),I=this.getHorizon(),L=2*Math.atan(I/this.cameraToCenterDistance)*(.5+r.y/(2*I)),z=Math.sin(L)*this.cameraToSeaLevelDistance/Math.sin(c.clamp(Math.PI-v-L,.01,Math.PI-.01)),B=Math.cos(Math.PI/2-this._pitch)*S+this.cameraToSeaLevelDistance,V=Math.cos(Math.PI/2-this._pitch)*z+this.cameraToSeaLevelDistance,Q=1.01*Math.min(B,V),Y=this.height/50;_=new Float64Array(16),c.perspective(_,this._fov,this.width/this.height,Y,Q),_[8]=2*-r.x/this.width,_[9]=2*r.y/this.height,c.scale(_,_,[1,-1,1]),c.translate(_,_,[0,0,-this.cameraToCenterDistance]),c.rotateX(_,_,this._pitch),c.rotateZ(_,_,this.angle),c.translate(_,_,[-u,-f,0]),this.mercatorMatrix=c.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),c.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,_),c.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=c.invert([],_),this.pixelMatrix3D=c.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const K=this.width%2/2,ue=this.height%2/2,me=Math.cos(this.angle),ve=Math.sin(this.angle),te=u-Math.round(u)+me*K+ve*ue,Ee=f-Math.round(f)+me*ue+ve*K,xe=new Float64Array(_);if(c.translate(xe,xe,[te>.5?te-1:te,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=xe,_=c.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new c.pointGeometry(0,0)),u=[r.x*this.worldSize,r.y*this.worldSize,0,1];return c.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.pointGeometry(0,r))}getCameraQueryGeometry(r){const u=this.getCameraPoint();if(r.length===1)return[r[0],u];{let f=u.x,_=u.y,v=u.x,w=u.y;for(const S of r)f=Math.min(f,S.x),_=Math.min(_,S.y),v=Math.max(v,S.x),w=Math.max(w,S.y);return[new c.pointGeometry(f,_),new c.pointGeometry(v,_),new c.pointGeometry(v,w),new c.pointGeometry(f,w),new c.pointGeometry(f,_)]}}}class fh{constructor(r){this._hashName=r&&encodeURIComponent(r),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(u,f){let _=!1,v=null;const w=()=>{v=null,_&&(u(),v=setTimeout(w,300),_=!1)};return()=>(_=!0,v||w(),v)}(this._updateHashUnthrottled.bind(this))}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const u=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),w=Math.round(u.lng*v)/v,S=Math.round(u.lat*v)/v,I=this._map.getBearing(),L=this._map.getPitch();let z="";if(z+=r?`/${w}/${S}/${f}`:`${f}/${S}/${w}`,(I||L)&&(z+="/"+Math.round(10*I)/10),L&&(z+=`/${Math.round(L)}`),this._hashName){const B=this._hashName;let V=!1;const Q=window.location.hash.slice(1).split("&").map(Y=>{const K=Y.split("=")[0];return K===B?(V=!0,`${K}=${z}`):Y}).filter(Y=>Y);return V||Q.push(`${B}=${z}`),`#${Q.join("&")}`}return`#${z}`}_getCurrentHash(){const r=window.location.hash.replace("#","");if(this._hashName){let u;return r.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(u=f)}),(u&&u[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._getCurrentHash();if(r.length>=3&&!r.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:u,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,r)}catch{}}}const pa={linearity:.3,easing:c.bezier(0,0,.3,1)},ph=c.extend({deceleration:2500,maxSpeed:1400},pa),mh=c.extend({deceleration:20,maxSpeed:1400},pa),gh=c.extend({deceleration:1e3,maxSpeed:360},pa),Co=c.extend({deceleration:1e3,maxSpeed:90},pa);class _h{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,u=c.exported.now();for(;r.length>0&&u-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new c.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)u.zoom+=v.zoomDelta||0,u.bearing+=v.bearingDelta||0,u.pitch+=v.pitchDelta||0,v.panDelta&&u.pan._add(v.panDelta),v.around&&(u.around=v.around),v.pinchAround&&(u.pinchAround=v.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(u.pan.mag()){const v=ga(u.pan.mag(),f,c.extend({},ph,r||{}));_.offset=u.pan.mult(v.amount/u.pan.mag()),_.center=this._map.transform.center,ma(_,v)}if(u.zoom){const v=ga(u.zoom,f,mh);_.zoom=this._map.transform.zoom+v.amount,ma(_,v)}if(u.bearing){const v=ga(u.bearing,f,gh);_.bearing=this._map.transform.bearing+c.clamp(v.amount,-179,179),ma(_,v)}if(u.pitch){const v=ga(u.pitch,f,Co);_.pitch=this._map.transform.pitch+v.amount,ma(_,v)}if(_.zoom||_.bearing){const v=u.pinchAround===void 0?u.around:u.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),c.extend(_,{noMoveStart:!0})}}function ma(m,r){(!m.duration||m.duration<r.duration)&&(m.duration=r.duration,m.easing=r.easing)}function ga(m,r,u){const{maxSpeed:f,linearity:_,deceleration:v}=u,w=c.clamp(m*_/(r/1e3),-f,f),S=Math.abs(w)/(v*_);return{easing:u.easing,duration:1e3*S,amount:w*(S/2)}}class cr extends c.Event{constructor(r,u,f,_={}){const v=C.mousePos(u.getCanvasContainer(),f),w=u.unproject(v);super(r,c.extend({point:v,lngLat:w,originalEvent:f},_)),this._defaultPrevented=!1,this.target=u}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class _a extends c.Event{constructor(r,u,f){const _=r==="touchend"?f.changedTouches:f.touches,v=C.touchPos(u.getCanvasContainer(),_),w=v.map(I=>u.unproject(I)),S=v.reduce((I,L,z,B)=>I.add(L.div(B.length)),new c.pointGeometry(0,0));super(r,{points:v,point:S,lngLats:w,lngLat:u.unproject(S),originalEvent:f}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ur extends c.Event{constructor(r,u,f){super(r,{originalEvent:f}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class If{constructor(r,u){this._map=r,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new ur(r.type,this._map,r))}mousedown(r,u){return this._mousedownPos=u,this._firePreventable(new cr(r.type,this._map,r))}mouseup(r){this._map.fire(new cr(r.type,this._map,r))}click(r,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new cr(r.type,this._map,r))}dblclick(r){return this._firePreventable(new cr(r.type,this._map,r))}mouseover(r){this._map.fire(new cr(r.type,this._map,r))}mouseout(r){this._map.fire(new cr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new _a(r.type,this._map,r))}touchmove(r){this._map.fire(new _a(r.type,this._map,r))}touchend(r){this._map.fire(new _a(r.type,this._map,r))}touchcancel(r){this._map.fire(new _a(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ws{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new cr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new cr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new cr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yh{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,u){this.isEnabled()&&r.shiftKey&&r.button===0&&(C.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(r,u){if(!this._active)return;const f=u;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=f,this._box||(this._box=C.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const v=Math.min(_.x,f.x),w=Math.max(_.x,f.x),S=Math.min(_.y,f.y),I=Math.max(_.y,f.y);C.setTransform(this._box,`translate(${v}px,${S}px)`),this._box.style.width=w-v+"px",this._box.style.height=I-S+"px"}mouseupWindow(r,u){if(!this._active||r.button!==0)return;const f=this._startPos,_=u;if(this.reset(),C.suppressClick(),f.x!==_.x||f.y!==_.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,u){return this._map.fire(new c.Event(r,{originalEvent:u}))}}function ns(m,r){if(m.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${r.length}`);const u={};for(let f=0;f<m.length;f++)u[m[f].identifier]=r[f];return u}class ya{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,u,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const v=new c.pointGeometry(0,0);for(const w of _)v._add(w);return v.div(_.length)}(u),this.touches=ns(f,u)))}touchmove(r,u,f){if(this.aborted||!this.centroid)return;const _=ns(f,u);for(const v in this.touches){const w=this.touches[v],S=_[v];(!S||S.dist(w)>30)&&(this.aborted=!0)}}touchend(r,u,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Sc{constructor(r){this.singleTap=new ya(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,u,f){this.singleTap.touchstart(r,u,f)}touchmove(r,u,f){this.singleTap.touchmove(r,u,f)}touchend(r,u,f){const _=this.singleTap.touchend(r,u,f);if(_){const v=r.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(v&&w||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Pf{constructor(){this._zoomIn=new Sc({numTouches:1,numTaps:2}),this._zoomOut=new Sc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,u,f){this._zoomIn.touchstart(r,u,f),this._zoomOut.touchstart(r,u,f)}touchmove(r,u,f){this._zoomIn.touchmove(r,u,f),this._zoomOut.touchmove(r,u,f)}touchend(r,u,f){const _=this._zoomIn.touchend(r,u,f),v=this._zoomOut.touchend(r,u,f);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Mf={0:1,2:2};class ll{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(r,u){return!1}_move(r,u){return{}}mousedown(r,u){if(this._lastPoint)return;const f=C.mouseButton(r);this._correctButton(r,f)&&(this._lastPoint=u,this._eventButton=f)}mousemoveWindow(r,u){const f=this._lastPoint;if(f){if(r.preventDefault(),function(_,v){const w=Mf[v];return _.buttons===void 0||(_.buttons&w)!==w}(r,this._eventButton))this.reset();else if(this._moved||!(u.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(f,u)}}mouseupWindow(r){this._lastPoint&&C.mouseButton(r)===this._eventButton&&(this._moved&&C.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class va extends ll{mousedown(r,u){super.mousedown(r,u),this._lastPoint&&(this._active=!0)}_correctButton(r,u){return u===0&&!r.ctrlKey}_move(r,u){return{around:u,panDelta:u.sub(r)}}}class rs extends ll{_correctButton(r,u){return u===0&&r.ctrlKey||u===2}_move(r,u){const f=.8*(u.x-r.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(r){r.preventDefault()}}class gt extends ll{_correctButton(r,u){return u===0&&r.ctrlKey||u===2}_move(r,u){const f=-.5*(u.y-r.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(r){r.preventDefault()}}class vh{constructor(r,u){this._minTouches=r.cooperativeGestures?2:1,this._clickTolerance=r.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(r,u,f){return this._calculateTransform(r,u,f)}touchmove(r,u,f){if(this._map._cooperativeGestures&&(this._minTouches===2&&f.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(r,!1,f.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(f.length<this._minTouches))return r.preventDefault(),this._calculateTransform(r,u,f)}touchend(r,u,f){this._calculateTransform(r,u,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,u,f){f.length>0&&(this._active=!0);const _=ns(f,u),v=new c.pointGeometry(0,0),w=new c.pointGeometry(0,0);let S=0;for(const L in _){const z=_[L],B=this._touches[L];B&&(v._add(z),w._add(z.sub(B)),S++,_[L]=z)}if(this._touches=_,S<this._minTouches||!w.mag())return;const I=w.div(S);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(S),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zs{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(r){}_move(r,u,f){return{}}touchstart(r,u,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([u[0],u[1]]))}touchmove(r,u,f){if(!this._firstTwoTouches)return;r.preventDefault();const[_,v]=this._firstTwoTouches,w=Es(f,u,_),S=Es(f,u,v);if(!w||!S)return;const I=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],I,r)}touchend(r,u,f){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,w=Es(f,u,_),S=Es(f,u,v);w&&S||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Es(m,r,u){for(let f=0;f<m.length;f++)if(m[f].identifier===u)return r[f]}function Ic(m,r){return Math.log(m/r)/Math.LN2}class rt extends Zs{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,u){const f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Ic(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ic(this._distance,f),pinchAround:u}}}function cl(m,r){return 180*m.angleWith(r)/Math.PI}class Cf extends Zs{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,u){const f=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:cl(this._vector,f),pinchAround:u}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const u=25/(Math.PI*this._minDiameter)*360,f=cl(r,this._startVector);return Math.abs(f)<u}}function Pc(m){return Math.abs(m.y)>Math.abs(m.x)}class Mc extends Zs{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,u,f){super.touchstart(r,u,f),this._currentTouchCount=f.length}_start(r){this._lastPoints=r,Pc(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,u,f){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=r[0].sub(this._lastPoints[0]),v=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,v,f.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(r,u,f){if(this._valid!==void 0)return this._valid;const _=r.mag()>=2,v=u.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const w=r.y>0==u.y>0;return Pc(r)&&Pc(u)&&w}}const xh={panStep:100,bearingStep:15,pitchStep:10};class bh{constructor(){const r=xh;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let u=0,f=0,_=0,v=0,w=0;switch(r.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),w=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:S=>{const I=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Lf,zoom:u?Math.round(I)+u*(r.shiftKey?2:1):I,bearing:S.getBearing()+f*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:S.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Lf(m){return m*(2-m)}const wh=4.000244140625;class Cc{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;r.preventDefault()}let u=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const f=c.exported.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,u!==0&&u%wh==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),r.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=r,this._delta-=u,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=C.mousePos(this._el,r);this._around=c.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>wh?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&I!==0&&(I=1/I);const L=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(L*I))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,f=this._startZoom,_=this._easing;let v,w=!1;if(this._type==="wheel"&&f&&_){const S=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),I=_(S);v=c.number(f,u,I),S<1?this._frameId||(this._frameId=!0):w=!0}else v=u,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:v-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let u=c.ease;if(this._prevEase){const f=this._prevEase,_=(c.exported.now()-f.start)/f.duration,v=f.easing(_+.01)-f.easing(_),w=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.0729-w*w);u=c.bezier(w,S,.25,1)}return this._prevEase={start:c.exported.now(),duration:r,easing:u},u}reset(){this._active=!1}}class Lc{constructor(r,u){this._clickZoom=r,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class kc{constructor(){this.reset()}reset(){this._active=!1}dblclick(r,u){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(r.shiftKey?-1:1),around:f.unproject(u)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rc{constructor(){this._tap=new Sc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(r,u,f){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=u[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(r,u,f))}touchmove(r,u,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=u[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,u,f)}touchend(r,u,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(r,u,f)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kn{constructor(r,u,f){this._el=r,this._mousePan=u,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ts{constructor(r,u,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=u,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Eh{constructor(r,u,f,_){this._el=r,this._touchZoom=u,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Lo=m=>m.zoom||m.drag||m.pitch||m.rotate;class Dc extends c.Event{}function xa(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Th{constructor(r,u){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new _h(r),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),c.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,v,w]of this._listeners)C.addEventListener(_,v,_===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[r,u,f]of this._listeners)C.removeEventListener(r,u,r===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(r){const u=this._map,f=u.getCanvasContainer();this._add("mapEvent",new If(u,r));const _=u.boxZoom=new yh(u,r);this._add("boxZoom",_);const v=new Pf,w=new kc;u.doubleClickZoom=new Lc(w,v),this._add("tapZoom",v),this._add("clickZoom",w);const S=new Rc;this._add("tapDragZoom",S);const I=u.touchPitch=new Mc(u);this._add("touchPitch",I);const L=new rs(r),z=new gt(r);u.dragRotate=new Ts(r,L,z),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const B=new va(r),V=new vh(r,u);u.dragPan=new Kn(f,B,V),this._add("mousePan",B),this._add("touchPan",V,["touchZoom","touchRotate"]);const Q=new Cf,Y=new rt;u.touchZoomRotate=new Eh(f,Y,Q,S),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]);const K=u.scrollZoom=new Cc(u,this);this._add("scrollZoom",K,["mousePan"]);const ue=u.keyboard=new bh;this._add("keyboard",ue),this._add("blockableMapEvent",new ws(u));for(const me of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[me]&&u[me].enable(r[me])}_add(r,u,f){this._handlers.push({handlerName:r,handler:u,allowed:f}),this._handlersById[r]=u}stop(r){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Lo(this._eventsInProgress))||this.isZooming()}_blockedByActive(r,u,f){for(const _ in r)if(_!==f&&(!u||u.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const u=[];for(const f of r)this._el.contains(f.target)&&u.push(f);return u}handleEvent(r,u){if(r.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const f=r.type==="renderFrame"?void 0:r,_={needsRenderFrame:!1},v={},w={},S=r.touches,I=S?this._getMapTouches(S):void 0,L=I?C.touchPos(this._el,I):C.mousePos(this._el,r);for(const{handlerName:V,handler:Q,allowed:Y}of this._handlers){if(!Q.isEnabled())continue;let K;this._blockedByActive(w,Y,V)?Q.reset():Q[u||r.type]&&(K=Q[u||r.type](r,L,I),this.mergeHandlerResult(_,v,K,V,f),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||Q.isActive())&&(w[V]=Q)}const z={};for(const V in this._previousActiveHandlers)w[V]||(z[V]=f);this._previousActiveHandlers=w,(Object.keys(z).length||xa(_))&&(this._changes.push([_,v,z]),this._triggerRenderFrame()),(Object.keys(w).length||xa(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=_;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(r,u,f,_,v){if(!f)return;c.extend(r,f);const w={handlerName:_,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(u.zoom=w),f.panDelta!==void 0&&(u.drag=w),f.pitchDelta!==void 0&&(u.pitch=w),f.bearingDelta!==void 0&&(u.rotate=w)}_applyChanges(){const r={},u={},f={};for(const[_,v,w]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new c.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),c.extend(u,v),c.extend(f,w);this._updateMapTransform(r,u,f),this._changes=[]}_updateMapTransform(r,u,f){const _=this._map,v=_.transform,w=_.style&&_.style.terrain;if(!(xa(r)||w&&this._drag))return this._fireEvents(u,f,!0);let{panDelta:S,zoomDelta:I,bearingDelta:L,pitchDelta:z,around:B,pinchAround:V}=r;V!==void 0&&(B=V),_._stop(!0),B=B||_.transform.centerPoint;const Q=v.pointLocation(S?B.sub(S):B);L&&(v.bearing+=L),z&&(v.pitch+=z),I&&(v.zoom+=I),w?u.drag&&!this._drag?(this._drag={center:v.centerPoint,lngLat:v.pointLocation(B),point:B,handlerName:u.drag.handlerName},_.fire(new c.Event("freezeElevation",{freeze:!0}))):this._drag&&f[this._drag.handlerName]?(_.fire(new c.Event("freezeElevation",{freeze:!1})),this._drag=null):u.drag&&this._drag&&(v.center=v.pointLocation(v.centerPoint.sub(S))):v.setLocationAtPoint(Q,B),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(u,f,!0)}_fireEvents(r,u,f){const _=Lo(this._eventsInProgress),v=Lo(r),w={};for(const z in r){const{originalEvent:B}=r[z];this._eventsInProgress[z]||(w[`${z}start`]=B),this._eventsInProgress[z]=r[z]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const z in w)this._fireEvent(z,w[z]);v&&this._fireEvent("move",v.originalEvent);for(const z in r){const{originalEvent:B}=r[z];this._fireEvent(z,B)}const S={};let I;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:V}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],I=u[B]||V,S[`${z}end`]=I)}for(const z in S)this._fireEvent(z,S[z]);const L=Lo(this._eventsInProgress);if(f&&(_||v)&&!L){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;z?(B(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:I})):(this._map.fire(new c.Event("moveend",{originalEvent:I})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,u){this._map.fire(new c.Event(r,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new Dc("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const wr={extend:(m,...r)=>c.extend(m,...r),run(m){m()},logToElement(m,r=!1,u="log"){const f=window.document.getElementById(u);f&&(r&&(f.innerHTML=""),f.innerHTML+=`<br>${m}`)}};class Gi extends c.Evented{constructor(r,u){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=u.bearingSnap,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,u){return this.jumpTo({center:r},u)}panBy(r,u,f){return r=c.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,c.extend({offset:r},u),f)}panTo(r,u,f){return this.easeTo(c.extend({center:r},u),f)}getZoom(){return this.transform.zoom}setZoom(r,u){return this.jumpTo({zoom:r},u),this}zoomTo(r,u,f){return this.easeTo(c.extend({zoom:r},u),f)}zoomIn(r,u){return this.zoomTo(this.getZoom()+1,r,u),this}zoomOut(r,u){return this.zoomTo(this.getZoom()-1,r,u),this}getBearing(){return this.transform.bearing}setBearing(r,u){return this.jumpTo({bearing:r},u),this}getPadding(){return this.transform.padding}setPadding(r,u){return this.jumpTo({padding:r},u),this}rotateTo(r,u,f){return this.easeTo(c.extend({bearing:r},u),f)}resetNorth(r,u){return this.rotateTo(0,c.extend({duration:1e3},r),u),this}resetNorthPitch(r,u){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},r),u),this}snapToNorth(r,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,u):this}getPitch(){return this.transform.pitch}setPitch(r,u){return this.jumpTo({pitch:r},u),this}cameraForBounds(r,u){r=c.LngLatBounds.convert(r);const f=u&&u.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),f,u)}_cameraForBoxAndBearing(r,u,f,_){const v={top:0,bottom:0,right:0,left:0};if(typeof(_=c.extend({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const xe=_.padding;_.padding={top:xe,bottom:xe,right:xe,left:xe}}_.padding=c.extend(v,_.padding);const w=this.transform,S=w.padding,I=w.project(c.LngLat.convert(r)),L=w.project(c.LngLat.convert(u)),z=I.rotate(-f*Math.PI/180),B=L.rotate(-f*Math.PI/180),V=new c.pointGeometry(Math.max(z.x,B.x),Math.max(z.y,B.y)),Q=new c.pointGeometry(Math.min(z.x,B.x),Math.min(z.y,B.y)),Y=V.sub(Q),K=(w.width-(S.left+S.right+_.padding.left+_.padding.right))/Y.x,ue=(w.height-(S.top+S.bottom+_.padding.top+_.padding.bottom))/Y.y;if(ue<0||K<0)return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const me=Math.min(w.scaleZoom(w.scale*Math.min(K,ue)),_.maxZoom),ve=c.pointGeometry.convert(_.offset),te=new c.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(f*Math.PI/180),Ee=ve.add(te).mult(w.scale/w.zoomScale(me));return{center:w.unproject(I.add(L).div(2).sub(Ee)),zoom:me,bearing:f}}fitBounds(r,u,f){return this._fitInternal(this.cameraForBounds(r,u),u,f)}fitScreenCoordinates(r,u,f,_,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.pointGeometry.convert(r)),this.transform.pointLocation(c.pointGeometry.convert(u)),f,_),_,v)}_fitInternal(r,u,f){return r?(delete(u=c.extend(r,u)).padding,u.linear?this.easeTo(u,f):this.flyTo(u,f)):this}jumpTo(r,u){this.stop();const f=this.transform;let _=!1,v=!1,w=!1;return"zoom"in r&&f.zoom!==+r.zoom&&(_=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=c.LngLat.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(v=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(w=!0,f.pitch=+r.pitch),r.padding==null||f.isPaddingEqual(r.padding)||(f.padding=r.padding),this.fire(new c.Event("movestart",u)).fire(new c.Event("move",u)),_&&this.fire(new c.Event("zoomstart",u)).fire(new c.Event("zoom",u)).fire(new c.Event("zoomend",u)),v&&this.fire(new c.Event("rotatestart",u)).fire(new c.Event("rotate",u)).fire(new c.Event("rotateend",u)),w&&this.fire(new c.Event("pitchstart",u)).fire(new c.Event("pitch",u)).fire(new c.Event("pitchend",u)),this.fire(new c.Event("moveend",u))}calculateCameraOptionsFromTo(r,u,f,_=0){const v=c.MercatorCoordinate.fromLngLat(r,u),w=c.MercatorCoordinate.fromLngLat(f,_),S=w.x-v.x,I=w.y-v.y,L=w.z-v.z,z=Math.hypot(S,I,L);if(z===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(S,I),V=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),Q=180*Math.atan2(S,-I)/Math.PI;let Y=180*Math.acos(B/z)/Math.PI;return Y=L<0?90-Y:90+Y,{center:w.toLngLat(),zoom:V,pitch:Y,bearing:Q}}easeTo(r,u){this._stop(!1,r.easeId),((r=c.extend({offset:[0,0],duration:500,easing:c.ease},r)).animate===!1||!r.essential&&c.exported.prefersReducedMotion)&&(r.duration=0);const f=this.transform,_=this.getZoom(),v=this.getBearing(),w=this.getPitch(),S=this.getPadding(),I="zoom"in r?+r.zoom:_,L="bearing"in r?this._normalizeBearing(r.bearing,v):v,z="pitch"in r?+r.pitch:w,B="padding"in r?r.padding:f.padding,V=c.pointGeometry.convert(r.offset);let Q=f.centerPoint.add(V);const Y=f.pointLocation(Q),K=c.LngLat.convert(r.center||Y);this._normalizeCenter(K);const ue=f.project(Y),me=f.project(K).sub(ue),ve=f.zoomScale(I-_);let te,Ee;r.around&&(te=c.LngLat.convert(r.around),Ee=f.locationPoint(te));const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||I!==_,this._rotating=this._rotating||v!==L,this._pitching=this._pitching||z!==w,this._padding=!f.isPaddingEqual(B),this._easeId=r.easeId,this._prepareEase(u,r.noMoveStart,xe),this._ease(Le=>{if(this._zooming&&(f.zoom=c.number(_,I,Le)),this._rotating&&(f.bearing=c.number(v,L,Le)),this._pitching&&(f.pitch=c.number(w,z,Le)),this._padding&&(f.interpolatePadding(S,B,Le),Q=f.centerPoint.add(V)),te)f.setLocationAtPoint(te,Ee);else{const ke=f.zoomScale(f.zoom-_),Ge=I>_?Math.min(2,ve):Math.max(.5,ve),Me=Math.pow(Ge,1-Le),ct=f.unproject(ue.add(me.mult(Le*Me)).mult(ke));f.setLocationAtPoint(f.renderWorldCopies?ct.wrap():ct,Q)}this._fireMoveEvents(u)},Le=>{this._afterEase(u,Le)},r),this}_prepareEase(r,u,f={}){this._moving=!0,this.fire(new c.Event("freezeElevation",{freeze:!0})),u||f.moving||this.fire(new c.Event("movestart",r)),this._zooming&&!f.zooming&&this.fire(new c.Event("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new c.Event("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new c.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new c.Event("move",r)),this._zooming&&this.fire(new c.Event("zoom",r)),this._rotating&&this.fire(new c.Event("rotate",r)),this._pitching&&this.fire(new c.Event("pitch",r))}_afterEase(r,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId,this.fire(new c.Event("freezeElevation",{freeze:!1}));const f=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new c.Event("zoomend",r)),_&&this.fire(new c.Event("rotateend",r)),v&&this.fire(new c.Event("pitchend",r)),this.fire(new c.Event("moveend",r))}flyTo(r,u){if(!r.essential&&c.exported.prefersReducedMotion){const Rt=c.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Rt,u)}this.stop(),r=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},r);const f=this.transform,_=this.getZoom(),v=this.getBearing(),w=this.getPitch(),S=this.getPadding(),I="zoom"in r?c.clamp(+r.zoom,f.minZoom,f.maxZoom):_,L="bearing"in r?this._normalizeBearing(r.bearing,v):v,z="pitch"in r?+r.pitch:w,B="padding"in r?r.padding:f.padding,V=f.zoomScale(I-_),Q=c.pointGeometry.convert(r.offset);let Y=f.centerPoint.add(Q);const K=f.pointLocation(Y),ue=c.LngLat.convert(r.center||K);this._normalizeCenter(ue);const me=f.project(K),ve=f.project(ue).sub(me);let te=r.curve;const Ee=Math.max(f.width,f.height),xe=Ee/V,Le=ve.mag();if("minZoom"in r){const Rt=c.clamp(Math.min(r.minZoom,_,I),f.minZoom,f.maxZoom),Ti=Ee/f.zoomScale(Rt-_);te=Math.sqrt(Ti/Le*2)}const ke=te*te;function Ge(Rt){const Ti=(xe*xe-Ee*Ee+(Rt?-1:1)*ke*ke*Le*Le)/(2*(Rt?xe:Ee)*ke*Le);return Math.log(Math.sqrt(Ti*Ti+1)-Ti)}function Me(Rt){return(Math.exp(Rt)-Math.exp(-Rt))/2}function ct(Rt){return(Math.exp(Rt)+Math.exp(-Rt))/2}const et=Ge(0);let dt=function(Rt){return ct(et)/ct(et+te*Rt)},qt=function(Rt){return Ee*((ct(et)*(Me(Ti=et+te*Rt)/ct(Ti))-Me(et))/ke)/Le;var Ti},Jt=(Ge(1)-et)/te;if(Math.abs(Le)<1e-6||!isFinite(Jt)){if(Math.abs(Ee-xe)<1e-6)return this.easeTo(r,u);const Rt=xe<Ee?-1:1;Jt=Math.abs(Math.log(xe/Ee))/te,qt=function(){return 0},dt=function(Ti){return Math.exp(Rt*te*Ti)}}return r.duration="duration"in r?+r.duration:1e3*Jt/("screenSpeed"in r?+r.screenSpeed/te:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=v!==L,this._pitching=z!==w,this._padding=!f.isPaddingEqual(B),this._prepareEase(u,!1),this._ease(Rt=>{const Ti=Rt*Jt,Ai=1/dt(Ti);f.zoom=Rt===1?I:_+f.scaleZoom(Ai),this._rotating&&(f.bearing=c.number(v,L,Rt)),this._pitching&&(f.pitch=c.number(w,z,Rt)),this._padding&&(f.interpolatePadding(S,B,Rt),Y=f.centerPoint.add(Q));const di=Rt===1?ue:f.unproject(me.add(ve.mult(qt(Ti))).mult(Ai));f.setLocationAtPoint(f.renderWorldCopies?di.wrap():di,Y),this._fireMoveEvents(u)},()=>this._afterEase(u),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,u)}if(!r){const f=this.handlers;f&&f.stop(!1)}return this}_ease(r,u,f){f.animate===!1||f.duration===0?(r(1),u()):(this._easeStart=c.exported.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,u){r=c.wrap(r,-180,180);const f=Math.abs(r-u);return Math.abs(r-360-u)<f&&(r-=360),Math.abs(r+360-u)<f&&(r+=360),r}_normalizeCenter(r){const u=this.transform;if(!u.renderWorldCopies||u.lngRange)return;const f=r.lng-u.center.lng;r.lng+=f>180?-360:f<-180?360:0}}class ba{constructor(r={}){this.options=r,c.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options&&this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,u){const f=this._map._getUIString(`AttributionControl.${u}`);r.title=f,r.setAttribute("aria-label",f)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const u=this._map.style.sourceCaches;for(const _ in u){const v=u[_];if(v.used||v.usedForTerrain){const w=v.getSource();w.attribution&&r.indexOf(w.attribution)<0&&r.push(w.attribution)}}r=r.filter(_=>String(_).trim()),r.sort((_,v)=>_.length-v.length),r=r.filter((_,v)=>{for(let w=v+1;w<r.length;w++)if(r[w].indexOf(_)>=0)return!1;return!0});const f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class ul{constructor(r={}){this.options=r,c.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl mapboxgl-ctrl");const u=C.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const r=this._container.children;if(r.length){const u=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact","mapboxgl-compact"):u.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Ah{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const u=++this._id;return this._queue.push({callback:r,id:u,cancelled:!1}),u}remove(r){const u=this._currentlyRunning,f=u?this._queue.concat(u):this._queue;for(const _ of f)if(_.id===r)return void(_.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const f of u)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Sh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Ih={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},kf={showCompass:!0,showZoom:!0,visualizePitch:!1};class qr{constructor(r,u,f=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new rs({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,f&&(this.mousePitch=new gt({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),C.addEventListener(u,"mousedown",this.mousedown),C.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(u,"touchmove",this.touchmove),C.addEventListener(u,"touchend",this.touchend),C.addEventListener(u,"touchcancel",this.reset)}down(r,u){this.mouseRotate.mousedown(r,u),this.mousePitch&&this.mousePitch.mousedown(r,u),C.disableDrag()}move(r,u){const f=this.map,_=this.mouseRotate.mousemoveWindow(r,u);if(_&&_.bearingDelta&&f.setBearing(f.getBearing()+_.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(r,u);v&&v.pitchDelta&&f.setPitch(f.getPitch()+v.pitchDelta)}}off(){const r=this.element;C.removeEventListener(r,"mousedown",this.mousedown),C.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(r,"touchmove",this.touchmove),C.removeEventListener(r,"touchend",this.touchend),C.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup)}mousedown(r){this.down(c.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),C.mousePos(this.element,r)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)}mousemove(r){this.move(r,C.mousePos(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function wa(m,r,u){if(m=new c.LngLat(m.lng,m.lat),r){const f=new c.LngLat(m.lng-360,m.lat),_=new c.LngLat(m.lng+360,m.lat),v=u.locationPoint(m).distSqr(r);u.locationPoint(f).distSqr(r)<v?m=f:u.locationPoint(_).distSqr(r)<v&&(m=_)}for(;Math.abs(m.lng-u.center.lng)>180;){const f=u.locationPoint(m);if(f.x>=0&&f.y>=0&&f.x<=u.width&&f.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const At={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ft(m,r,u){const f=m.classList;for(const _ in At)f.remove(`maplibregl-${u}-anchor-${_}`,`mapboxgl-${u}-anchor-${_}`);f.add(`maplibregl-${u}-anchor-${r}`,`mapboxgl-${u}-anchor-${r}`)}class ko extends c.Evented{constructor(r,u){if(super(),(r instanceof HTMLElement||u)&&(r=c.extend({element:r},u)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=c.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div"),this._element.setAttribute("aria-label","Map marker");const f=C.createNS("http://www.w3.org/2000/svg","svg"),_=41,v=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${_}px`),f.setAttributeNS(null,"width",`${v}px`),f.setAttributeNS(null,"viewBox",`0 0 ${v} ${_}`);const w=C.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const S=C.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const I=C.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ve of L){const te=C.createNS("http://www.w3.org/2000/svg","ellipse");te.setAttributeNS(null,"opacity","0.04"),te.setAttributeNS(null,"cx","10.5"),te.setAttributeNS(null,"cy","5.80029008"),te.setAttributeNS(null,"rx",ve.rx),te.setAttributeNS(null,"ry",ve.ry),I.appendChild(te)}const z=C.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const B=C.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(B);const V=C.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"opacity","0.25"),V.setAttributeNS(null,"fill","#000000");const Q=C.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),V.appendChild(Q);const Y=C.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const K=C.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ue=C.createNS("http://www.w3.org/2000/svg","circle");ue.setAttributeNS(null,"fill","#000000"),ue.setAttributeNS(null,"opacity","0.25"),ue.setAttributeNS(null,"cx","5.5"),ue.setAttributeNS(null,"cy","5.5"),ue.setAttributeNS(null,"r","5.4999962");const me=C.createNS("http://www.w3.org/2000/svg","circle");me.setAttributeNS(null,"fill","#FFFFFF"),me.setAttributeNS(null,"cx","5.5"),me.setAttributeNS(null,"cy","5.5"),me.setAttributeNS(null,"r","5.4999962"),K.appendChild(ue),K.appendChild(me),S.appendChild(I),S.appendChild(z),S.appendChild(V),S.appendChild(Y),S.appendChild(K),f.appendChild(S),f.setAttributeNS(null,"height",_*this._scale+"px"),f.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(f),this._offset=c.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),Ft(this._element,this._anchor,"marker"),this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=c.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(r){const u=r.code,f=r.charCode||r.keyCode;u!=="Space"&&u!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(r){const u=r.originalEvent.target,f=this._element;this._popup&&(u===f||f.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?r.remove():r.addTo(this._map),this):this}_update(r){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=wa(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let u="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?u=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),r&&r.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${At[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${u}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),v=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*v?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(r){return this._offset=c.pointGeometry.convert(r),this._update(),this}_onMove(r){if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(r){this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const zc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let As,zn=0,Ss=!1;const Wr={maxWidth:100,unit:"metric"};function Ph(m,r,u){const f=u&&u.maxWidth||100,_=m._container.clientHeight/2,v=m.unproject([0,_]),w=m.unproject([f,_]),S=v.distanceTo(w);if(u&&u.unit==="imperial"){const I=3.2808*S;I>5280?Is(r,f,I/5280,m._getUIString("ScaleControl.Miles")):Is(r,f,I,m._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?Is(r,f,S/1852,m._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Is(r,f,S/1e3,m._getUIString("ScaleControl.Kilometers")):Is(r,f,S,m._getUIString("ScaleControl.Meters"))}function Is(m,r,u,f){const _=function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let S=v/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(I){const L=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*L)/L}(S),w*S}(u);m.style.width=r*(_/u)+"px",m.innerHTML=`${_}&nbsp;${f}`}const nn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},mn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Oc(m){if(m){if(typeof m=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new c.pointGeometry(0,0),top:new c.pointGeometry(0,m),"top-left":new c.pointGeometry(r,r),"top-right":new c.pointGeometry(-r,r),bottom:new c.pointGeometry(0,-m),"bottom-left":new c.pointGeometry(r,-r),"bottom-right":new c.pointGeometry(-r,-r),left:new c.pointGeometry(m,0),right:new c.pointGeometry(-m,0)}}if(m instanceof c.pointGeometry||Array.isArray(m)){const r=c.pointGeometry.convert(m);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:c.pointGeometry.convert(m.center||[0,0]),top:c.pointGeometry.convert(m.top||[0,0]),"top-left":c.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":c.pointGeometry.convert(m["top-right"]||[0,0]),bottom:c.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":c.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":c.pointGeometry.convert(m["bottom-right"]||[0,0]),left:c.pointGeometry.convert(m.left||[0,0]),right:c.pointGeometry.convert(m.right||[0,0])}}return Oc(new c.pointGeometry(0,0))}const Xs={supported:b,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends Gi{constructor(m){var r;if(c.PerformanceUtils.mark(c.PerformanceMarkers.create),(m=c.extend({},Ih,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fa(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Ah,this._controls=[],this._mapId=c.uniqueId(),this._locale=c.extend({},Sh,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=(r=m.pixelRatio)!==null&&r!==void 0?r:devicePixelRatio,this._requestManager=new H(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Th(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new fh(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,c.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new ba({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new ul,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new c.Event(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new c.Event(`${u.dataType}dataloading`,u))}),this.on("dataabort",u=>{this.fire(new c.Event("sourcedataabort",u))})}_getMapId(){return this._mapId}addControl(m,r){if(r===void 0&&(r=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(u,f.firstChild):f.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(m);return r>-1&&this._controls.splice(r,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,r,u,f){return f==null&&this.style.terrain&&(f=this.transform.getElevation(u,this.style.terrain)),super.calculateCameraOptionsFromTo(m,r,u,f)}resize(m){const r=this._containerDimensions(),u=r[0],f=r[1];this._resizeCanvas(u,f,this.getPixelRatio()),this.transform.resize(u,f),this.painter.resize(u,f,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new c.Event("movestart",m)).fire(new c.Event("move",m))),this.fire(new c.Event("resize",m)),_&&this.fire(new c.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[r,u]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(r,u,m),this.painter.resize(r,u,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(c.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m==null?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m==null?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m==null?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m==null?60:m)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(c.LngLat.convert(m),this.style&&this.style.terrain)}unproject(m){return this.transform.pointLocation(c.pointGeometry.convert(m),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,r,u){if(m==="mouseenter"||m==="mouseover"){let f=!1;return{layer:r,listener:u,delegates:{mousemove:v=>{const w=this.getLayer(r)?this.queryRenderedFeatures(v.point,{layers:[r]}):[];w.length?f||(f=!0,u.call(this,new cr(m,this,v.originalEvent,{features:w}))):f=!1},mouseout:()=>{f=!1}}}}if(m==="mouseleave"||m==="mouseout"){let f=!1;return{layer:r,listener:u,delegates:{mousemove:w=>{(this.getLayer(r)?this.queryRenderedFeatures(w.point,{layers:[r]}):[]).length?f=!0:f&&(f=!1,u.call(this,new cr(m,this,w.originalEvent)))},mouseout:w=>{f&&(f=!1,u.call(this,new cr(m,this,w.originalEvent)))}}}}{const f=_=>{const v=this.getLayer(r)?this.queryRenderedFeatures(_.point,{layers:[r]}):[];v.length&&(_.features=v,u.call(this,_),delete _.features)};return{layer:r,listener:u,delegates:{[m]:f}}}}on(m,r,u){if(u===void 0)return super.on(m,r);const f=this._createDelegatedListener(m,r,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(m,r,u){if(u===void 0)return super.once(m,r);const f=this._createDelegatedListener(m,r,u);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(m,r,u){return u===void 0?super.off(m,r):(this._delegatedListeners&&this._delegatedListeners[m]&&(f=>{const _=this._delegatedListeners[m];for(let v=0;v<_.length;v++){const w=_[v];if(w.layer===r&&w.listener===u){for(const S in w.delegates)this.off(S,w.delegates[S]);return _.splice(v,1),this}}})(),this)}queryRenderedFeatures(m,r){if(!this.style)return[];let u;if(r!==void 0||m===void 0||m instanceof c.pointGeometry||Array.isArray(m)||(r=m,m=void 0),r=r||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof c.pointGeometry||typeof m[0]=="number")u=[c.pointGeometry.convert(m)];else{const f=c.pointGeometry.convert(m[0]),_=c.pointGeometry.convert(m[1]);u=[f,new c.pointGeometry(_.x,f.y),_,new c.pointGeometry(f.x,_.y),f]}return this.style.queryRenderedFeatures(u,r,this.transform)}querySourceFeatures(m,r){return this.style.querySourceFeatures(m,r)}setStyle(m,r){return(r=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(m,r))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const r=this._locale[m];if(r==null)throw new Error(`Missing UI string '${m}'`);return r}_updateStyle(m,r){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new bn(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new bn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,r){if(typeof m=="string"){const u=this._requestManager.transformRequest(m,c.ResourceType.Style);c.getJSON(u,(f,_)=>{f?this.fire(new c.ErrorEvent(f)):_&&this._updateDiff(_,r)})}else typeof m=="object"&&this._updateDiff(m,r)}_updateDiff(m,r){try{this.style.setState(m)&&this._update(!0)}catch(u){c.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(m,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.warnOnce("There is no style added to the map.")}addSource(m,r){return this._lazyInitEmptyStyle(),this.style.addSource(m,r),this._update(!0)}isSourceLoaded(m){const r=this.style&&this.style.sourceCaches[m];if(r!==void 0)return r.loaded();this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){return this.style.setTerrain(m),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const r in m){const u=m[r]._tiles;for(const f in u){const _=u[f];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(m,r,u){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,r,u)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,r,{pixelRatio:u=1,sdf:f=!1,stretchX:_,stretchY:v,content:w}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||c.isImageBitmap(r)){const{width:S,height:I,data:L}=c.exported.getImageData(r);this.style.addImage(m,{data:new c.RGBAImage({width:S,height:I},L),pixelRatio:u,stretchX:_,stretchY:v,content:w,sdf:f,version:0})}else{if(r.width===void 0||r.height===void 0)return this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:I,data:L}=r,z=r;this.style.addImage(m,{data:new c.RGBAImage({width:S,height:I},new Uint8Array(L)),pixelRatio:u,stretchX:_,stretchY:v,content:w,sdf:f,version:0,userImage:z}),z.onAdd&&z.onAdd(this,m)}}}updateImage(m,r){const u=this.style.getImage(m);if(!u)return this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=r instanceof HTMLImageElement||c.isImageBitmap(r)?c.exported.getImageData(r):r,{width:_,height:v,data:w}=f;if(_===void 0||v===void 0)return this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==u.data.width||v!==u.data.height)return this.fire(new c.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(r instanceof HTMLImageElement||c.isImageBitmap(r));u.data.replace(w,S),this.style.updateImage(m,u)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,r){c.getImage(this._requestManager.transformRequest(m,c.ResourceType.Image),r)}listImages(){return this.style.listImages()}addLayer(m,r){return this._lazyInitEmptyStyle(),this.style.addLayer(m,r),this._update(!0)}moveLayer(m,r){return this.style.moveLayer(m,r),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,r,u){return this.style.setLayerZoomRange(m,r,u),this._update(!0)}setFilter(m,r,u={}){return this.style.setFilter(m,r,u),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,r,u,f={}){return this.style.setPaintProperty(m,r,u,f),this._update(!0)}getPaintProperty(m,r){return this.style.getPaintProperty(m,r)}setLayoutProperty(m,r,u,f={}){return this.style.setLayoutProperty(m,r,u,f),this._update(!0)}getLayoutProperty(m,r){return this.style.getLayoutProperty(m,r)}setLight(m,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,r){return this.style.setFeatureState(m,r),this._update()}removeFeatureState(m,r){return this.style.removeFeatureState(m,r),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,r=0;return this._container&&(m=this._container.clientWidth||400,r=this._container.clientHeight||300),[m,r]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const r=this._canvasContainer=C.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&r.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const u=this._containerDimensions();this._resizeCanvas(u[0],u[1],this.getPixelRatio());const f=this._controlContainer=C.create("div","maplibregl-control-container mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{_[v]=C.create("div",`maplibregl-ctrl-${v} mapboxgl-ctrl-${v}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const m=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=C.create("div","maplibregl-cooperative-gesture-screen",m);let r="Control",u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",r="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${u}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",f=>{f.key===r&&(this._metaPress=!0)}),document.addEventListener("keyup",f=>{f.key===r&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",f=>{this._onCooperativeGesture(f,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(m,r,u){this._canvas.width=u*m,this._canvas.height=u*r,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const m=c.extend({},b.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);r?(this.painter=new Ac(r,this.transform),c.exported$1.testSupport(r)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(m,r,u){return!r&&u<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let r,u=0;const f=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(r=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,r),u=c.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const w=this.transform.zoom,S=c.exported.now();this.style.zoomHistory.update(w,S);const I=new c.EvaluationParameters(w,{now:S,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),L=I.crossFadingFactor();L===1&&L===this._crossFadingFactor||(_=!0,this._crossFadingFactor=L),this.style.update(I)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.PerformanceUtils.mark(c.PerformanceMarkers.load),this.fire(new c.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const w=c.exported.now()-u;f.endQueryEXT(f.TIME_ELAPSED_EXT,r),setTimeout(()=>{const S=f.getQueryObjectEXT(r,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(r),this.fire(new c.Event("gpu-timing-frame",{cpuTime:w,gpuTime:S}))},50)}if(this.listens("gpu-timing-layer")){const w=this.painter.collectGpuTimers();setTimeout(()=>{const S=this.painter.queryGpuTimers(w);this.fire(new c.Event("gpu-timing-layer",{layerTimes:S}))},50)}const v=this._sourcesDirty||this._styleDirty||this._placementDirty;return v||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.Event("idle")),!this._loaded||this._fullyLoaded||v||(this._fullyLoaded=!0,c.PerformanceUtils.mark(c.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._cooperativeGestures&&C.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),c.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=c.exported.frame(m=>{c.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,r){c.setCacheLimits(m,r)}get version(){return"2.4.0"}},NavigationControl:class{constructor(m){this.options=c.extend({},kf,m),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),r=m===this._map.getMaxZoom(),u=m===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new qr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,r){const u=C.create("button",m,this._container);return u.type="button",u.addEventListener("click",r),u}_setButtonTitle(m,r){const u=this._map._getUIString(`NavigationControl.${r}`);m.title=u,m.setAttribute("aria-label",u)}},GeolocateControl:class extends c.Evented{constructor(m){super(),this.options=c.extend({},zc,m),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var r;return this._map=m,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,As!==void 0?r(As):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(u=>{As=u.state!=="denied",r(As)}):(As=!!window.navigator.geolocation,r(As)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,zn=0,Ss=!1}_isOutOfMapMaxBounds(m){const r=this._map.getMaxBounds(),u=m.coords;return r&&(u.longitude<r.getWest()||u.longitude>r.getEast()||u.latitude<r.getSouth()||u.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",m)),this._finish()}}_updateCamera(m){const r=new c.LngLat(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,f=this._map.getBearing(),_=c.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(u),_,{geolocateSource:!0})}_updateMarker(m){if(m){const r=new c.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,r=this._map.unproject([0,m]),u=this._map.unproject([1,m]),f=r.distanceTo(u),_=Math.ceil(2*this._accuracy/f);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&Ss)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ko(this._dotElement),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ko({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zn--,Ss=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),zn++,zn>1?(m={maximumAge:6e5,timeout:0},Ss=!0):(m=this.options.positionOptions,Ss=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ba,LogoControl:ul,ScaleControl:class{constructor(m){this.options=c.extend({},Wr,m),c.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ph(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,Ph(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(m){this.options=m,c.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(m){return this._map=m,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends c.Evented{constructor(m){super(),this.options=c.extend(Object.create(nn),m),c.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=c.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const r=document.createDocumentFragment(),u=document.createElement("body");let f;for(u.innerHTML=m;f=u.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=C.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(v=>this._container.classList.add(v)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=wa(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const r=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let u=this.options.anchor;const f=Oc(this.options.offset);if(!u){const v=this._container.offsetWidth,w=this._container.offsetHeight;let S;S=r.y+f.bottom.y<w?["top"]:r.y>this._map.transform.height-w?["bottom"]:[],r.x<v/2?S.push("left"):r.x>this._map.transform.width-v/2&&S.push("right"),u=S.length===0?"bottom":S.join("-")}const _=r.add(f[u]).round();C.setTransform(this._container,`${At[u]} translate(${_.x}px,${_.y}px)`),Ft(this._container,u,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(mn);m&&m.focus()}_onClose(){this.remove()}},Marker:ko,Style:bn,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.pointGeometry,MercatorCoordinate:c.MercatorCoordinate,Evented:c.Evented,AJAXError:c.AJAXError,config:c.config,CanvasSource:cn,GeoJSONSource:li,ImageSource:Bi,RasterDEMTileSource:pt,RasterTileSource:Ut,VectorTileSource:gi,VideoSource:ln,prewarm:function(){Fe().acquire(J)},clearPrewarmedResources:function(){const m=Re;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(J),Re=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return ce.workerCount},set workerCount(m){ce.workerCount=m},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){c.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){c.clearTileCache(m)},workerUrl:"",addProtocol(m,r){c.config.REGISTERED_PROTOCOLS[m]=r},removeProtocol(m){delete c.config.REGISTERED_PROTOCOLS[m]}};return wr.extend(Xs,{isSafari:c.isSafari,getPerformanceMetrics:c.PerformanceUtils.getPerformanceMetrics}),Xs});var p=a;return p})})(hw);const M6=hw.exports,C6=8,L6="Dark Matter without labels",k6={"maputnik:renderer":"mbgljs"},R6={carto:{type:"vector",url:"https://tiles.basemaps.cartocdn.com/vector/carto.streets/v1/tiles.json"}},D6="https://tiles.basemaps.cartocdn.com/gl/dark-matter-gl-style/sprite",z6="https://tiles.basemaps.cartocdn.com/fonts/{fontstack}/{range}.pbf",O6=[{id:"background",type:"background",layout:{visibility:"visible"},paint:{"background-color":"#FFFFFF","background-opacity":0}},{id:"landcover",type:"fill",source:"carto","source-layer":"landcover",filter:["any",["==","class","wood"],["==","class","grass"],["==","subclass","recreation_ground"]],paint:{"fill-color":{stops:[[8,"#0e0e0e"],[9,"#0e0e0e"],[11,"#0e0e0e"],[13,"#0e0e0e"],[15,"#0e0e0e"]]},"fill-opacity":1}},{id:"park_national_park",type:"fill",source:"carto","source-layer":"park",minzoom:9,filter:["all",["==","class","national_park"]],layout:{visibility:"visible"},paint:{"fill-color":{stops:[[8,"#0e0e0e"],[9,"#0e0e0e"],[11,"#0e0e0e"],[13,"#0e0e0e"],[15,"#0e0e0e"]]},"fill-opacity":1,"fill-translate-anchor":"map"}},{id:"park_nature_reserve",type:"fill",source:"carto","source-layer":"park",minzoom:0,filter:["all",["==","class","nature_reserve"]],layout:{visibility:"visible"},paint:{"fill-color":{stops:[[8,"#0e0e0e"],[9,"#0e0e0e"],[11,"#0e0e0e"],[13,"#0e0e0e"],[15,"#0e0e0e"]]},"fill-antialias":!0,"fill-opacity":{stops:[[6,.7],[9,.9]]}}},{id:"landuse_residential",type:"fill",source:"carto","source-layer":"landuse",minzoom:6,filter:["any",["==","class","residential"]],paint:{"fill-color":{stops:[[5,"rgba(0, 0, 0, 0.5)"],[8,"rgba(0, 0, 0, 0.45)"],[9,"rgba(0, 0, 0, 0.4)"],[11,"rgba(0, 0, 0, 0.35)"],[13,"rgba(0, 0, 0, 0.3)"],[15,"rgba(0, 0, 0, 0.25)"],[16,"rgba(0, 0, 0, 0.15)"]]},"fill-opacity":{stops:[[6,.6],[9,1]]}}},{id:"landuse",type:"fill",source:"carto","source-layer":"landuse",filter:["any",["==","class","cemetery"],["==","class","stadium"]],paint:{"fill-color":{stops:[[8,"#0e0e0e"],[9,"#0e0e0e"],[11,"#0e0e0e"],[13,"#0e0e0e"],[15,"#0e0e0e"]]}}},{id:"waterway",type:"line",source:"carto","source-layer":"waterway",paint:{"line-color":"rgba(63, 90, 109, 1)","line-width":{stops:[[8,.5],[9,1],[15,2],[16,3]]}}},{id:"boundary_county",type:"line",source:"carto","source-layer":"boundary",minzoom:9,maxzoom:24,filter:["all",["==","admin_level",6],["==","maritime",0]],paint:{"line-color":{stops:[[4,"#222"],[5,"#222"],[6,"#2C353C"]]},"line-width":{stops:[[4,.5],[7,1]]},"line-dasharray":{stops:[[6,[1]],[7,[2,2]]]}}},{id:"boundary_state",type:"line",source:"carto","source-layer":"boundary",minzoom:4,filter:["all",["==","admin_level",4],["==","maritime",0]],paint:{"line-color":{stops:[[4,"rgba(103, 103, 114, 1)"],[5,"rgba(103, 103, 114, 1)"],[6,"rgba(103, 103, 114, 1)"]]},"line-width":{stops:[[4,.5],[7,1],[8,1],[9,1.2]]},"line-dasharray":{stops:[[6,[1,2,3]],[7,[1,2,3]]]}}},{id:"water",type:"fill",source:"carto","source-layer":"water",minzoom:0,maxzoom:24,filter:["all",["==","$type","Polygon"]],layout:{visibility:"visible"},paint:{"fill-color":"#37CF98","fill-antialias":!0,"fill-translate-anchor":"map","fill-opacity":1}},{id:"water_shadow",type:"fill",source:"carto","source-layer":"water",minzoom:0,filter:["all",["==","$type","Polygon"]],layout:{visibility:"visible"},paint:{"fill-color":"transparent","fill-antialias":!0,"fill-translate-anchor":"map","fill-opacity":1,"fill-translate":{stops:[[0,[0,2]],[6,[0,1]],[14,[0,1]],[17,[0,2]]]}}},{id:"aeroway-runway",type:"line",source:"carto","source-layer":"aeroway",minzoom:12,filter:["all",["==","class","runway"]],layout:{"line-cap":"square"},paint:{"line-width":{stops:[[11,1],[13,4],[14,6],[15,8],[16,10]]},"line-color":"#111"}},{id:"aeroway-taxiway",type:"line",source:"carto","source-layer":"aeroway",minzoom:10,filter:["all",["==","class","taxiway"]],paint:{"line-color":"#111","line-width":{stops:[[13,.5],[14,1],[15,2],[16,4]]}}},{id:"tunnel_service_case",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["==","class","service"],["==","brunnel","tunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[15,1],[16,3],[17,6],[18,8]]},"line-opacity":1,"line-color":"#1a1a1a"}},{id:"tunnel_minor_case",type:"line",source:"carto","source-layer":"transportation",minzoom:10,maxzoom:24,filter:["all",["==","class","minor"],["==","brunnel","tunnel"]],layout:{"line-cap":"butt","line-join":"miter"},paint:{"line-width":{stops:[[11,.5],[12,.5],[14,2],[15,4],[16,6],[17,10],[18,14]]},"line-opacity":1,"line-color":"#1a1a1a"}},{id:"tunnel_sec_case",type:"line",source:"carto","source-layer":"transportation",minzoom:11,maxzoom:24,filter:["all",["in","class","secondary","tertiary"],["==","brunnel","tunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[11,.5],[12,1],[13,2],[14,5],[15,6],[16,8],[17,12],[18,16]]},"line-opacity":1,"line-color":"#1a1a1a"}},{id:"tunnel_pri_case",type:"line",source:"carto","source-layer":"transportation",minzoom:8,maxzoom:24,filter:["all",["==","class","primary"],["!=","ramp",1],["==","brunnel","tunnel"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":{stops:[[6,.5],[7,.8],[8,1],[11,3],[13,4],[14,6],[15,8],[16,10],[17,14],[18,18]]},"line-opacity":{stops:[[5,.5],[7,1]]},"line-color":"#1a1a1a"}},{id:"tunnel_trunk_case",type:"line",source:"carto","source-layer":"transportation",minzoom:5,maxzoom:24,filter:["all",["==","class","trunk"],["!=","ramp",1],["==","brunnel","tunnel"]],layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-width":{stops:[[6,.5],[7,.8],[8,1],[11,3],[13,4],[14,6],[15,8],[16,10],[17,14],[18,18]]},"line-opacity":{stops:[[5,.5],[7,1]]},"line-color":"#232323"}},{id:"tunnel_mot_case",type:"line",source:"carto","source-layer":"transportation",minzoom:5,maxzoom:24,filter:["all",["==","class","motorway"],["!=","ramp",1],["==","brunnel","tunnel"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":{stops:[[6,.5],[7,.8],[8,1],[11,3],[12,4],[13,5],[14,7],[15,9],[16,11],[17,13],[18,22]]},"line-opacity":{stops:[[6,.5],[7,1]]},"line-color":"#232323"}},{id:"tunnel_path",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["==","class","path"],["==","brunnel","tunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[15,.5],[16,1],[18,3]]},"line-opacity":1,"line-color":"#262626","line-dasharray":{stops:[[15,[2,2]],[18,[3,3]]]}}},{id:"tunnel_service_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["==","class","service"],["==","brunnel","tunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[15,2],[16,2],[17,4],[18,6]]},"line-opacity":1,"line-color":"#161616"}},{id:"tunnel_minor_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["==","class","minor"],["==","brunnel","tunnel"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":{stops:[[15,3],[16,4],[17,8],[18,12]]},"line-opacity":1,"line-color":"rgba(22, 22, 22, 1)"}},{id:"tunnel_sec_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:10,maxzoom:24,filter:["all",["in","class","secondary","tertiary"],["==","brunnel","tunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[11,2],[13,2],[14,3],[15,4],[16,6],[17,10],[18,14]]},"line-opacity":1,"line-color":"#161616"}},{id:"tunnel_pri_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:11,maxzoom:24,filter:["all",["==","class","primary"],["!=","ramp",1],["==","brunnel","tunnel"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":{stops:[[11,1],[13,2],[14,4],[15,6],[16,8],[17,12],[18,16]]},"line-opacity":1,"line-color":"rgba(65, 71, 88, 1)"}},{id:"tunnel_trunk_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:11,maxzoom:24,filter:["all",["==","class","trunk"],["!=","ramp",1],["==","brunnel","tunnel"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-width":{stops:[[11,1],[13,2],[14,4],[15,6],[16,8],[17,12],[18,16]]},"line-opacity":1,"line-color":"#161616"}},{id:"tunnel_mot_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:10,maxzoom:24,filter:["all",["==","class","motorway"],["!=","ramp",1],["==","brunnel","tunnel"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":{stops:[[10,1],[12,2],[13,3],[14,5],[15,7],[16,9],[17,11],[18,20]]},"line-opacity":1,"line-color":"rgba(65, 71, 88, 1)"}},{id:"tunnel_rail",type:"line",source:"carto","source-layer":"transportation",minzoom:10,filter:["all",["==","class","rail"],["==","brunnel","tunnel"]],layout:{visibility:"visible","line-join":"round"},paint:{"line-color":"#1a1a1a","line-width":{base:1.3,stops:[[13,.5],[14,1],[15,1],[16,3],[21,7]]},"line-opacity":.5}},{id:"tunnel_rail_dash",type:"line",source:"carto","source-layer":"transportation",minzoom:15,filter:["all",["==","class","rail"],["==","brunnel","tunnel"]],layout:{visibility:"visible","line-join":"round"},paint:{"line-color":"#111","line-width":{base:1.3,stops:[[15,.5],[16,1],[20,5]]},"line-dasharray":{stops:[[15,[5,5]],[16,[6,6]]]},"line-opacity":.5}},{id:"road_service_case",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["==","class","service"],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[15,1],[16,3],[17,6],[18,8]]},"line-opacity":1,"line-color":"#1c1c1c"}},{id:"road_minor_case",type:"line",source:"carto","source-layer":"transportation",minzoom:10,maxzoom:24,filter:["all",["==","class","minor"],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[11,.5],[12,.5],[14,2],[15,3],[16,4.3],[17,10],[18,14]]},"line-opacity":1,"line-color":{stops:[[13,"rgba(65, 71, 88, 1)"],[15.7,"rgba(65, 71, 88, 1)"],[16,"rgba(65, 71, 88, 1)"]]}}},{id:"road_pri_case_ramp",type:"line",source:"carto","source-layer":"transportation",minzoom:12,maxzoom:24,filter:["all",["==","class","primary"],["==","ramp",1]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[12,2],[13,3],[14,4],[15,5],[16,8],[17,10]]},"line-opacity":{stops:[[5,.5],[7,1]]},"line-color":"#232323"}},{id:"road_trunk_case_ramp",type:"line",source:"carto","source-layer":"transportation",minzoom:12,maxzoom:24,filter:["all",["==","class","trunk"],["==","ramp",1]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[12,2],[13,3],[14,4],[15,5],[16,8],[17,10]]},"line-opacity":1,"line-color":{stops:[[12,"#1a1a1a"],[14,"#232323"]]}}},{id:"road_mot_case_ramp",type:"line",source:"carto","source-layer":"transportation",minzoom:12,maxzoom:24,filter:["all",["==","class","motorway"],["==","ramp",1]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[12,2],[13,3],[14,4],[15,5],[16,8],[17,10]]},"line-opacity":1,"line-color":{stops:[[12,"#1a1a1a"],[14,"#232323"]]}}},{id:"road_sec_case_noramp",type:"line",source:"carto","source-layer":"transportation",minzoom:11,maxzoom:24,filter:["all",["in","class","secondary","tertiary"],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[11,.9],[12,1.5],[13,3],[14,5],[15,6],[16,8],[17,12],[18,16]]},"line-opacity":1,"line-color":{stops:[[11,"rgba(65, 71, 88, 1)"],[12.99,"rgba(65, 71, 88, 1)"],[13,"rgba(65, 71, 88, 1)"]]}}},{id:"road_pri_case_noramp",type:"line",source:"carto","source-layer":"transportation",minzoom:7,maxzoom:24,filter:["all",["==","class","primary"],["!=","ramp",1],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[6,.5],[7,.8],[8,1],[11,3],[13,4],[14,6],[15,8],[16,10],[17,14],[18,18]]},"line-opacity":{stops:[[5,.5],[7,1]]},"line-color":{stops:[[7,"#1a1a1a"],[12,"#232323"]]}}},{id:"road_trunk_case_noramp",type:"line",source:"carto","source-layer":"transportation",minzoom:5,maxzoom:24,filter:["all",["==","class","trunk"],["!=","ramp",1],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[6,.5],[7,.8],[8,1],[11,3],[13,4],[14,6],[15,8],[16,10],[17,14],[18,18]]},"line-opacity":{stops:[[5,.5],[7,1]]},"line-color":{stops:[[5,"#1a1a1a"],[12,"#232323"]]}}},{id:"road_mot_case_noramp",type:"line",source:"carto","source-layer":"transportation",minzoom:5,maxzoom:24,filter:["all",["==","class","motorway"],["!=","ramp",1],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[6,.5],[7,.7],[8,.8],[11,3],[12,4],[13,5],[14,7],[15,9],[16,11],[17,13],[18,22]]},"line-opacity":{stops:[[6,.5],[7,1]]},"line-color":{stops:[[5,"#1a1a1a"],[12,"#232323"]]}}},{id:"road_path",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["in","class","path","track"],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[15,.5],[16,1],[18,3]]},"line-opacity":1,"line-color":"#262626","line-dasharray":{stops:[[15,[2,2]],[18,[3,3]]]}}},{id:"road_service_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["==","class","service"],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[15,2],[16,2],[17,4],[18,6]]},"line-opacity":1,"line-color":"#0b0b0b"}},{id:"road_minor_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["==","class","minor"],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[15,3],[16,4],[17,8],[18,12]]},"line-opacity":1,"line-color":"rgba(65, 71, 88, 1)"}},{id:"road_pri_fill_ramp",type:"line",source:"carto","source-layer":"transportation",minzoom:12,maxzoom:24,filter:["all",["==","class","primary"],["==","ramp",1]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[12,1],[13,1.5],[14,2],[15,3],[16,6],[17,8]]},"line-opacity":1,"line-color":"#0b0b0b"}},{id:"road_trunk_fill_ramp",type:"line",source:"carto","source-layer":"transportation",minzoom:12,maxzoom:24,filter:["all",["==","class","trunk"],["==","ramp",1]],layout:{"line-cap":"square","line-join":"round"},paint:{"line-width":{stops:[[12,1],[13,1.5],[14,2],[15,3],[16,6],[17,8]]},"line-opacity":1,"line-color":"#0b0b0b"}},{id:"road_mot_fill_ramp",type:"line",source:"carto","source-layer":"transportation",minzoom:12,maxzoom:24,filter:["all",["==","class","motorway"],["==","ramp",1]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[12,1],[13,1.5],[14,2],[15,3],[16,6],[17,8]]},"line-opacity":1,"line-color":"rgba(65, 71, 88, 1)"}},{id:"road_sec_fill_noramp",type:"line",source:"carto","source-layer":"transportation",minzoom:10,maxzoom:24,filter:["all",["in","class","secondary","tertiary"],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[11,2],[13,2],[14,3],[15,4],[16,6],[17,10],[18,14]]},"line-opacity":1,"line-color":"rgba(65, 71, 88, 1)"}},{id:"road_pri_fill_noramp",type:"line",source:"carto","source-layer":"transportation",minzoom:10,maxzoom:24,filter:["all",["==","class","primary"],["!=","ramp",1],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[10,.3],[13,2],[14,4],[15,6],[16,8],[17,12],[18,16]]},"line-opacity":1,"line-color":"rgba(83, 86, 102, 1)"}},{id:"road_trunk_fill_noramp",type:"line",source:"carto","source-layer":"transportation",minzoom:10,maxzoom:24,filter:["all",["==","class","trunk"],["!=","ramp",1],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[11,1],[13,2],[14,4],[15,6],[16,8],[17,12],[18,16]]},"line-opacity":1,"line-color":"rgba(65, 71, 88, 1)"}},{id:"road_mot_fill_noramp",type:"line",source:"carto","source-layer":"transportation",minzoom:10,maxzoom:24,filter:["all",["==","class","motorway"],["!=","ramp",1],["!has","brunnel"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[10,1],[12,2],[13,3],[14,5],[15,7],[16,9],[17,11],[18,20]]},"line-opacity":1,"line-color":"rgba(73, 73, 73, 1)"}},{id:"rail",type:"line",source:"carto","source-layer":"transportation",minzoom:10,filter:["all",["==","class","rail"],["!=","brunnel","tunnel"]],layout:{visibility:"visible","line-join":"round"},paint:{"line-color":"#1a1a1a","line-width":{base:1.3,stops:[[13,.5],[14,1],[15,1],[16,3],[21,7]]}}},{id:"rail_dash",type:"line",source:"carto","source-layer":"transportation",minzoom:15,filter:["all",["==","class","rail"],["!=","brunnel","tunnel"]],layout:{visibility:"visible","line-join":"round"},paint:{"line-color":"#111","line-width":{base:1.3,stops:[[15,.5],[16,1],[20,5]]},"line-dasharray":{stops:[[15,[5,5]],[16,[6,6]]]}}},{id:"bridge_service_case",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["==","class","service"],["==","brunnel","bridge"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":{stops:[[15,1],[16,3],[17,6],[18,8]]},"line-opacity":1,"line-color":"#1c1c1c"}},{id:"bridge_minor_case",type:"line",source:"carto","source-layer":"transportation",minzoom:10,maxzoom:24,filter:["all",["==","class","minor"],["==","brunnel","bridge"]],layout:{"line-cap":"butt","line-join":"miter"},paint:{"line-width":{stops:[[11,.5],[12,.5],[14,2],[15,3],[16,4.3],[17,10],[18,14]]},"line-opacity":1,"line-color":{stops:[[13,"#161616"],[15.7,"#161616"],[16,"#1c1c1c"]]}}},{id:"bridge_sec_case",type:"line",source:"carto","source-layer":"transportation",minzoom:11,maxzoom:24,filter:["all",["in","class","secondary","tertiary"],["==","brunnel","bridge"]],layout:{"line-cap":"butt","line-join":"miter"},paint:{"line-width":{stops:[[11,.5],[12,1.5],[13,3],[14,5],[15,6],[16,8],[17,12],[18,16]]},"line-opacity":1,"line-color":{stops:[[11,"#1a1a1a"],[12.99,"#1a1a1a"],[13,"#232323"]]}}},{id:"bridge_pri_case",type:"line",source:"carto","source-layer":"transportation",minzoom:8,maxzoom:24,filter:["all",["==","class","primary"],["!=","ramp",1],["==","brunnel","bridge"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":{stops:[[6,.5],[7,.8],[8,1],[11,3],[13,4],[14,6],[15,8],[16,10],[17,14],[18,18]]},"line-opacity":{stops:[[5,.5],[7,1]]},"line-color":{stops:[[8,"#1a1a1a"],[12,"#232323"]]}}},{id:"bridge_trunk_case",type:"line",source:"carto","source-layer":"transportation",minzoom:5,maxzoom:24,filter:["all",["==","class","trunk"],["!=","ramp",1],["==","brunnel","bridge"]],layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-width":{stops:[[6,.5],[7,.8],[8,1],[11,3],[13,4],[14,6],[15,8],[16,10],[17,14],[18,18]]},"line-opacity":{stops:[[5,.5],[7,1]]},"line-color":{stops:[[5,"#1a1a1a"],[12,"#232323"]]}}},{id:"bridge_mot_case",type:"line",source:"carto","source-layer":"transportation",minzoom:5,maxzoom:24,filter:["all",["==","class","motorway"],["!=","ramp",1],["==","brunnel","bridge"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":{stops:[[6,.5],[7,.8],[8,1],[11,3],[12,4],[13,5],[14,7],[15,9],[16,11],[17,13],[18,22]]},"line-opacity":{stops:[[6,.5],[7,1]]},"line-color":{stops:[[5,"#1a1a1a"],[10,"#232323"]]}}},{id:"bridge_path",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["==","class","path"],["==","brunnel","bridge"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[15,.5],[16,1],[18,3]]},"line-opacity":1,"line-color":"#262626","line-dasharray":{stops:[[15,[2,2]],[18,[3,3]]]}}},{id:"bridge_service_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["==","class","service"],["==","brunnel","bridge"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[15,2],[16,2],[17,4],[18,6]]},"line-opacity":1,"line-color":"#0b0b0b"}},{id:"bridge_minor_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:15,maxzoom:24,filter:["all",["==","class","minor"],["==","brunnel","bridge"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":{stops:[[15,3],[16,4],[17,8],[18,12]]},"line-opacity":1,"line-color":"#0b0b0b"}},{id:"bridge_sec_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:10,maxzoom:24,filter:["all",["in","class","secondary","tertiary"],["==","brunnel","bridge"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":{stops:[[11,2],[13,2],[14,3],[15,4],[16,6],[17,10],[18,14]]},"line-opacity":1,"line-color":"#0b0b0b"}},{id:"bridge_pri_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:11,maxzoom:24,filter:["all",["==","class","primary"],["!=","ramp",1],["==","brunnel","bridge"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":{stops:[[11,1],[13,2],[14,4],[15,6],[16,8],[17,12],[18,16]]},"line-opacity":1,"line-color":"#0b0b0b"}},{id:"bridge_trunk_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:11,maxzoom:24,filter:["all",["==","class","trunk"],["!=","ramp",1],["==","brunnel","bridge"]],layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-width":{stops:[[11,1],[13,2],[14,4],[15,6],[16,8],[17,12],[18,16]]},"line-opacity":1,"line-color":"rgba(65, 71, 88, 1)"}},{id:"bridge_mot_fill",type:"line",source:"carto","source-layer":"transportation",minzoom:10,maxzoom:24,filter:["all",["==","class","motorway"],["!=","ramp",1],["==","brunnel","bridge"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":{stops:[[10,1],[12,2],[13,3],[14,5],[15,7],[16,9],[17,11],[18,20]]},"line-opacity":1,"line-color":"rgba(65, 71, 88, 1)"}},{id:"building",type:"fill",source:"carto","source-layer":"building",layout:{visibility:"visible"},paint:{"fill-color":{base:1,stops:[[15.5,"transparent"],[16,"transparent"]]},"fill-antialias":!0}},{id:"building-top",type:"fill",source:"carto","source-layer":"building",layout:{visibility:"visible"},paint:{"fill-translate":{base:1,stops:[[14,[0,0]],[16,[-2,-2]]]},"fill-outline-color":"#0e0e0e","fill-color":"rgba(57, 57, 57, 1)","fill-opacity":{base:1,stops:[[13,0],[16,1]]}}},{id:"boundary_country_outline",type:"line",source:"carto","source-layer":"boundary",minzoom:6,maxzoom:24,filter:["all",["==","admin_level",2],["==","maritime",0]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2C353C","line-opacity":.5,"line-width":8,"line-offset":0}},{id:"boundary_country_inner",type:"line",source:"carto","source-layer":"boundary",minzoom:0,filter:["all",["==","admin_level",2],["==","maritime",0]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":{stops:[[4,"rgba(92, 94, 94, 1)"],[5,"rgba(96, 96, 96, 1)"],[6,"rgba(102, 102, 102, 1)"]]},"line-opacity":1,"line-width":{stops:[[3,1],[6,1.5]]},"line-offset":0}}],F6="voyager",B6="Carto",N6={version:C6,name:L6,metadata:k6,sources:R6,sprite:D6,glyphs:z6,layers:O6,id:F6,owner:B6},U6=ut("a",{href:"#contact"},null,-1),V6={class:"contact"},j6={class:"left-panel"},G6=GT('<div class="picture-wrapper"><div class="image-wrapper"><div class="image-side"></div><img src="'+NP+'" alt="" class="picture"><div class="image-side"></div></div><span>Erwan Le Forestier</span></div>',1),$6={class:"text"},H6=ut("a",{href:"mail:leforestiererwan@gmail.com"},[ut("span",{class:"contact-info mail"},"leforestiererwan@gmail.com")],-1),q6=ut("a",{c:"",href:"tel:33783613196"},[ut("span",{class:"contact-info phone"},"+33 7 83 61 31 96")],-1),W6={class:"links"},Z6={href:"https://github.com/erwanlfrt/",target:"_blank",rel:"noopener noreferrer"},X6={href:"https://www.linkedin.com/in/erwanlfrt/",target:"_blank",rel:"noopener noreferrer"},Y6={class:"button-wrapper"},K6=["href"],J6=ut("div",{class:"right-panel"},[ut("div",{id:"map"})],-1),fw=sr({__name:"ContactView",setup(t){const e=[6.1432,46.2044],i=sc(),{language:s}=rc(i),a=Qi(()=>Ip[s.value].title),h=Qi(()=>Ip[s.value].text),p=Qi(()=>Ip[s.value].textButton);return rf(()=>{const c=new M6.Map({container:"map",style:N6,center:e,zoom:12,bearing:0,pitch:35});function b(){return`
  <svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 96 960 960" width="48"><path fill="#df058d" d="M479.752 572Q511 572 533.5 549.748q22.5-22.252 22.5-53.5T533.748 442.5q-22.252-22.5-53.5-22.5T426.5 442.252q-22.5 22.252-22.5 53.5t22.252 53.748q22.252 22.5 53.5 22.5ZM480 998Q311 854 227 730.985q-84-123.015-84-227.116 0-157.714 101.599-251.292Q346.198 159 479.908 159q133.711 0 235.401 93.577Q817 346.155 817 503.869q0 104.101-84 227.116Q649 854 480 998Z"/></svg>
  `}function T(C){return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(C)}`}const P=[e],k=new _6({layers:[new Kg({id:"icon-layer",data:P,getIcon:C=>({url:T(b()),width:50,height:50}),sizeScale:10,getSize:C=>4,getPosition:C=>C})]});c.addControl(k)}),(c,b)=>(pi(),ki(on,null,[U6,ut("div",V6,[ut("div",j6,[ut("h2",null,Rn(zt(a)),1),G6,ut("p",$6,Rn(zt(h)),1),H6,q6,ut("div",W6,[ut("a",Z6,[(pi(),ta(Cd(zt(XP)),{class:"icon"}))]),ut("a",X6,[(pi(),ta(Cd(zt($P)),{class:"icon"}))]),ut("div",Y6,[ut("a",{href:"/cv/CV_"+zt(s)+"_Erwan_LE-FORESTIER.pdf",target:"_blank",rel:"noopener noreferrer"},Rn(zt(p)),9,K6)])])]),J6])],64))}});const Q6=sr({__name:"HomeView",setup(t){return(e,i)=>(pi(),ki(on,null,[Fi(Ex),Fi(Tx),Fi(Sx),Fi(Ix),Fi(fw)],64))}}),eF=MS({history:qA("/"),scrollBehavior(){var t;(t=document.getElementById("app"))==null||t.scrollIntoView({behavior:"smooth"})},routes:[{path:"/",name:"home",component:Q6},{path:"/expertise",name:"expertise",component:Tx},{path:"/experience",name:"experience",component:Sx},{path:"/contact",name:"contact",component:fw},{path:"/projects",name:"projects",component:Ix},{path:"/welcome",name:"welcome",component:Ex}]});const Jg=xA(eI);Jg.use(EA());Jg.use(eF);Jg.mount("#app");
